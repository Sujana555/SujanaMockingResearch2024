questionId,questionTitle,questionTags,questionBody,questionVotes,questionViewCount,questionCreationDate,favoriteCount,answerCount,questionCommentCount,Code
50707105,How do I resolve a dependency in a Class Library from the container configured in Startup?,<c#><unit-testing><asp.net-core><dependency-injection><mocking>,"<p>The objective is using IoC and being able to [mock dependencies] for unit testing.</p>

<p>The project: .NET Core Web API with multiple class libraries</p>

<p>I'm using Microsoft.Extensions.DependencyInjection for my IoC and I'd like to keep using it if it supports what I'm trying to accomplish.</p>

<p>The problem: At least one class in my assemblies (class libraries) has a dependency that needs to mocked (e.g. using Moq). I completely understand that I can use constructor injection to inject the interface but that doesn't fit the scenario. </p>

<p>What I'm simply trying to accomplish in my assembly is to resolve the dependency using the container that I initiated in my Startup class of the Web API. </p>

<p>How would I do that? And if that isn't possible, what may be another way to accomplish the same thing, i.e. mocking my printer without using dependency injection?</p>

<p>Below is some sample code which hopefully clarifies this a bit.</p>

<p>Web API's Startup.cs (has a reference to assembly which defines printer)</p>

<pre><code>public void ConfigureServices(IServiceCollection services)
{
    services.AddScoped&lt;IPrinter, Printer&gt;();
}
</code></pre>

<p>In a different assembly, I'd like to resolve an instance of Printer using the same container.</p>

<pre><code>    public interface IPrinter
    {
        void Print(string text);
    }

    public class Printer : IPrinter
    {
        public void Print(string text)
        {
            Console.WriteLine(""Printing: "" + text);
        }
    }


    public class Task
    {
        public void PrintSomething(string text)
        {
            //do not 'new up' but resolve it from the container of Startup.cs
            var printer = new Printer(); 
            printer.Print(text);
        }
    }
</code></pre>
",1,1569,2018-06-05 18:53,,1,5,how
37766792,Assert the tested class internal objects,<java><unit-testing><mocking><easymock><software-quality>,"<p>I am using Easy mock.</p>

<ol>
<li>I call a method of my actual class from my Test class.</li>
<li>Inside that method I create an object called 'A' on the fly with child objects.</li>
<li>I pass that object 'A' to a remote service and a output returns.</li>
</ol>

<p>I don't want to asset that returned output. (That is already taken care of)</p>

<p>I want assert and make sure that, my object created successfully and weather it contains the relevant child objects?
Can I access this object from my Test Class before or after it get passed to remote service.</p>

<p>Is this possible.</p>

<p>Thank you very much :)</p>
",0,215,2016-06-11 17:44,,1,0,what
74172501,AddRangeAsync xunit MockQueryable.Moq error,<c#><moq>,"<p>The actual result always return 0 while testing method <code>AddRangeAsync</code> by <code>MockQueryable.Moq</code>.Any ideas on this?
Thanks!</p>
<h3>Running on:</h3>
<ul>
<li>.net core 3.1</li>
<li>MockQueryable.Moq 5.02</li>
<li>xunit 2.4.0</li>
</ul>
<h3>Service</h3>
<pre class=""lang-cs prettyprint-override""><code>    public class ProductService : IProductService
    {
        private readonly MyDb _myDb;

        public ProductService(MyDb myDb)
        {
            _myDb = myDb;
        }

        public async Task AddRange()
        {
            var products = new Product[]
            {
                new Product { Id = 1, Count = 2, Name = &quot;Apple&quot;, Price = 24 },
                new Product { Id = 2, Count = 14, Name = &quot;Banana&quot;, Price = 13 },
            };
            await _myDb.Products.AddRangeAsync(products);
            await _myDb.SaveChangesAsync();
        }
    }
</code></pre>
<h3>Test Code</h3>
<pre class=""lang-cs prettyprint-override""><code>        [Fact]
        public async Task AddRangeTest()
        {
            var initProducts = new List&lt;Product&gt;();
            var mockProducts = initProducts.AsQueryable().BuildMockDbSet();
            mockProducts
                .Setup(x =&gt; x.AddRangeAsync(It.IsAny&lt;IEnumerable&lt;Product&gt;&gt;(), It.IsAny&lt;CancellationToken&gt;()))
                .Callback((IEnumerable&lt;Product&gt; products, CancellationToken _) =&gt; initProducts.AddRange(products));
            var mockDb = new Mock&lt;MyDb&gt;();
            mockDb.Setup(x =&gt; x.Products).Returns(mockProducts.Object);

            var productService = new ProductService(mockDb.Object);
            await productService.AddRange();
            // the actual always return 0
            Assert.Equal(2, mockDb.Object.Products.Count());
        }
</code></pre>
<h3>Result</h3>
<p>Message: 
Assert.Equal() Failure
Expected: 2
Actual:   0</p>
",1,381,2022-10-23 15:42,,2,1,why
57852142,How to mock android context using mockk library,<android><kotlin><junit><android-resources><mockk>,"<p>I am new in JUnit testing on Android and I'm testing a function, which is using android context object to get a string resources and making some comparsions. How can I mock android context object to successfully test this function? For testing I'm using Mockk testing library.</p>

<pre><code>  private val context = mockk&lt;Context&gt;()
  private val contextWrapper = ApplicationContextWrapper(context)
  private val objectUnderTest = AppLinkService(contextWrapper)
</code></pre>

<p>I was trying to mock context using <code>mockk&lt;Context&gt;()</code>, but I'm getting the following exception</p>

<pre><code>io.mockk.MockKException: no answer found for: Context(#1).getApplicationContext()
</code></pre>
",24,15163,2019-09-09 10:25,,2,0,how
20343591,How to implement BDD on very complex business rules?,<web-services><unit-testing><moq><bdd><mspec>,"<p>I am learning the art of Unit Testing and BDD and in my company there is no one who follows this approach. I try a lot to learn it by myself but get stuck somewhere and give up after trying for a few days. After some time I get inspiration again from someone and try to learn to swim in these waters again. </p>

<p>I have recently developed a Windows Service that started out small but ended up a big ball of messy business rules. Here is a brief overview of what the service does.</p>

<ol>
<li><p>Log to database “Service starting…”</p></li>
<li><p>Get Data From DB that needs to be posted to another web service</p></li>
<li><p>If there is no data to post Log to database “No data to process…”
and exit service</p></li>
<li><p>If data contains duplicate values Log to database “Duplicate data
found, this record will be skipped.”</p></li>
<li><p>Update the status of the record for which duplicate data was found
to something e.g. 302</p></li>
<li><p>If the data is null, Log to database “Record contains null value and cannot be processed.”</p></li>
<li><p>Update the status of the record appropriately e.g. 310</p></li>
<li><p>If the database is unavailable or down due to some reason, Log in a file “Database is down…”</p></li>
<li><p>If the service is down where we have to post the data log to database “Receiver service is down.”</p></li>
<li><p>Log to the database “Exiting service…”</p></li>
</ol>

<p>So my service basically retrieves some data from the Database, creates JSON request from it and post it to another service. </p>

<p>It also parses the response from that service and logs if the data was posted successfully or not. I have just entered some of the business rules that are currently implemented in the service to give you an idea of what lies under the hood. I am learning BDD and unit testing and would really love to know how an expert will write test cases that test these complex business rules?</p>

<p>From my understanding BDD does not need to focus internally on how the service is written, instead it will test scenarios that service should fulfill For example</p>

<p>When executing the windows service with duplicate data </p>

<ul>
<li>It should log to database “Duplicate data found, this record will be
skipped.”</li>
<li>It should update the status of the record to 302</li>
</ul>

<p><em>I can write multiple scenarios that test some functionality of the service. Is this the right approach or should I right very large sets of scenarios that test each business rule in every test?</em></p>

<p><em>Secondly as the service is communicating with the DB as well as a web service, how can I test the HttpRequest and HttpResponse that is sent and received by the service?</em></p>

<p><em>Finally how do I actually test something as complex as the business rules I have written above, If I simple assert that the service called some specific method of some class is that enough? How do we know that by simply calling some method it will perform the right task?</em></p>
",3,1033,2013-12-03 5:29,,1,0,how
73018146,jest: repeatedly mock navigator & test against userAgent/vendor,<typescript><unit-testing><jestjs><mocking><navigator>,"<p>Intent:</p>
<ul>
<li>want to cycle through different combinations of the userAgent</li>
<li>mock navigator</li>
<li>run test</li>
</ul>
<p>What is happening:</p>
<ul>
<li>I mock navigator.userAgent, mock happens as intended, first test runs as expected</li>
<li>2nd mock is run, but the test sees the userAgent value from the first mock</li>
</ul>
<p>function to test:</p>
<pre><code>export const isBrowseriOS = () =&gt; {
  console.log(navigator.userAgent, ' &amp; ', navigator.vendor);
  return (
    navigator.vendor === 'Apple Computer, Inc.' ||
    (/iPad|iPhone|iPod/.test(navigator.userAgent) &amp;&amp;
      !window.MSStream &amp;&amp;
      'ontouchend' in document)
  );
};
</code></pre>
<p>test file:</p>
<pre><code>import { isBrowseriOS } from './isIOS';

const browserDevices = [
  {
    name: 'iPhone 12 Pro',
    userAgent:
      'Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1',
    vendor: 'Apple Computer, Inc.',
    iOSDevice: true,
  },
   {
     name: 'Samsung SM-G955U',
     userAgent:
       'Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Mobile Safari/537.36',
     vendor: 'Google Inc.',
     iOSDevice: false,
   },
  
];

describe.each(browserDevices)('iOS test for $name', (device) =&gt; {
  beforeEach(() =&gt; {
    Object.defineProperty(window, 'navigator', {
      value: {
        userAgent: device.userAgent,
        vendor: device.vendor,
      },
    });
  });
  afterEach(() =&gt; jest.resetAllMocks());
  it(`returns ${device.iOSDevice}`, () =&gt; {
    expect(isBrowseriOS()).toBe(device.iOSDevice);
  });
});

</code></pre>
<p>result:
<a href=""https://i.sstatic.net/OiySk.png"" rel=""nofollow noreferrer""><img src=""https://i.sstatic.net/OiySk.png"" alt=""enter image description here"" /></a></p>
",1,2976,2022-07-18 6:35,,1,1,what
76768119,Mocking .env variables with Vitest,<javascript><typescript><testing><mocking><vitest>,"<p>I want to mock env variables with Vitest. For now, I was able to do it this way:</p>
<pre><code>// test
beforeAll(() =&gt; {
  import.meta.env.HASHNODE_URL = 'https://blog.IgorKrpenja.com';
});

// tested function using an env variable
export const getCanonicalUrl = (slug: string): string =&gt; {
  return `${process.env.HASHNODE_URL}/${slug}`;
};
</code></pre>
<p>However, this a bit cumbersome as I would need to do this in <strong>every</strong> test suite for the same env variables.</p>
<p>I also tried using <code>setup files</code> this way but it didn't work:</p>
<pre><code>// vitest.config.ts
/// &lt;reference types=&quot;vitest&quot; /&gt;

import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    setupFiles: ['./test/env-mock.ts'],
  },
});
 
// test/env-mock.ts
beforeAll(() =&gt; {
  import.meta.env.HASHNODE_URL = 'https://blog.IgorKrpenja.com';
});

afterAll(() =&gt; {
  delete import.meta.env.HASHNODE_URL;
});
</code></pre>
<p>And could not get this to work with <code>globalSetup</code> either:</p>
<pre><code>// In same vitest.config.ts
globalSetup: './test/global-setup.ts',

// test/global-setup.ts
export function setup(): void {
  import.meta.env.HASHNODE_URL = 'https://blog.IgorKrpenja.com';
}

export function teardown(): void {}
</code></pre>
<p>Any ideas? This is with Typescript Node.js project, Vitest 0.33.0.</p>
",2,2700,2023-07-26 4:51,,3,0,how
75249035,Mock async generic method from base class,<c#><unit-testing><mocking>,"<p>I've classes similar to this:</p>
<pre><code>public class Class1
    {
        private readonly IClient _client;

        public Class1(Configuration config, CacheManager cacheManager)
        {
            _client = new Client(config, cacheManager);
        }

        protected async Task&lt;T&gt; PostAndDeserialize&lt;T&gt;(string param1, object param2)
        {
            var result = await _client.PostSomething(param1, param2);

            return JsonConvert.DeserializeObject&lt;T&gt;(await result.Content.ReadAsStringAsync());
        }
    }

    public class Class2 : Class1
    {
        public Class2(Configuration config, CacheManager cacheManager) : base(config, cacheManager)
        {
        }

        public async Task&lt;Response&gt; CreateSomething(Request request)
        {
            //do something
            var result = PostAndDeserialize&lt;Result&gt;(&quot;test&quot;, test);

            return new Response { Id = result.Id };
        }
    }
</code></pre>
<p>I need to write unit test for Class2, CreateSomething method - how do I mock PostAndDeserialize method ? I've tried and find a way to mock protected generic class from base class but I couldn't find any help with it :( Or maybe it should be done in some other way ?(I'm new to unit test). Any help is appreciated.</p>
<p>I've tried using Protected() and calling method by it's name but as it's generic method it didn't work.</p>
",1,132,2023-01-26 16:33,,1,3,how
36068260,Why is my Moq not returning null?,<c#><moq>,"<p>My Moq is returning data I don't expect.</p>

<pre><code>var artist = new Artist();
artist.Id = ""4576"";
var deserializer = Mock.Of&lt;IXmlDeserializer&lt;Album&gt;&gt;(
    d =&gt; d.Deserialize(""foo"").Artist == artist);
Assert.IsNull(deserializer.Deserialize(null));
</code></pre>

<p>The above test fails.</p>

<p>The really puzzling thing is that the mock returns a Mock but that</p>

<pre><code>Assert.AreEqual(""4576"", deserializer.Deserialize(null).Artist.Id)
</code></pre>

<p>returns true.</p>

<p>It's as if the ""default"" returned by my mock for an unspecified argument (in this case null) was somehow influenced by what I told it to return when called with ""foo"".</p>
",1,78,2016-03-17 17:57,,1,0,why
34832973,Not able to call instance_double twice,<ruby><rspec><mocking>,"<p>I'm writing a test fot rspec to check that items are added into a class that I use like an array</p>

<pre><code>    describe '#collection' do
        let(:process) {
            instance_double(""WebServerProcess"", :cpu =&gt; 33, :mem =&gt; 22, :pid =&gt; 1, :port =&gt; 8000)
        }
        it 'return the collection' do
            WebServersCollection.add process
            expect(subject.collection).to eq([process])
        end
        it 'should add with &lt;&lt;' do
            WebServersCollection &lt;&lt; process
            expect(subject.collection).to eq([process])
        end
    end
</code></pre>

<p>Show me this error</p>

<blockquote>
  <p>Failure/Error: expect(subject.collection).to eq([process])
         # was originally created in one example but has leaked into another example and can no
  longer be used. rspec-mocks' doubles are designed to only last for one
  example, and you need to create a new one in each example you wish to
  use it for.</p>
</blockquote>
",0,942,2016-01-16 22:43,,1,0,other
19047838,Mocking spring bean in jersey resource,<java><spring><rest><mocking><jersey>,"<p>Im using @Autowire in Jerse Resources and spring interation. Now i want to be able to use mock 
object on Autowired fields., </p>

<p>I was able to do this in Jersey 1.17, but on 2.2 i could not find any documentations.  </p>

<p>I have tired some thing like this 
<a href=""https://stackoverflow.com/questions/18463311/jersey-2-how-to-replace-injectableprovider-and-abstracthttpcontextinjectable/18464901#18464901"">Jersey 2.*. How to replace InjectableProvider and AbstractHttpContextInjectable of Jersey 1.*</a></p>

<p>And provided own SpringComponent when setting up the container., but this does either work.,</p>

<pre><code>Example: 
@Path(""/myresource"")
public class MyResource {

 @Autowired
 private ConfigurationApi configurationApi;

 @GET
 @Produces(""text/plain"")
 public String getIt() {
 boolean isTrue = configurationApi.isEnabled(""aconfig"");
 return ""Hi there!: configuration is "" + isTrue;
}
</code></pre>

<p>In jersey 1.17 i could do somthing like this:</p>

<pre><code>return new WebAppDescriptor.Builder(""rest.resource"")
                .contextPath(""application"")
                .servletClass(SpringServlet.class)
                .servletPath(""api"")
                .contextParam(""contextClass"", ""rest.resource.test.spring.MockableContext"")
                .contextParam(SpringServlet.CONTEXT_CONFIG_LOCATION, ""context.poc-test.xml"")
                .contextListenerClass(ContextLoaderListener.class)
                .build();
</code></pre>

<p>And then later on the actual test i could add mock object to the context class by a hash map.,</p>

<p>Any help is appriciated .,</p>
",3,432,2013-09-27 9:53,,0,1,how
4158393,Is there a way to inject a mock while using White for acceptance testing?,<mocking><acceptance-testing><white-framework>,"<p>In our client / server application, the server side is exposed by a collection of web services. The client interacts with what we call an Application Context to make calls to the server. I'd like to be able to mock the Application Context during acceptance testing so as to isolate the testing to just the client, rather than letting the tests flow all the way from client to server to database and having to set up the database with the right data for each test that we want to run.</p>

<p>Is this possible? Or should I be taking a different approach?</p>
",0,180,2010-11-11 19:21,,1,0,what
75545303,Unit test RabbitMQ MessageProducer in an ASP.NET Core Web API,<c#><asp.net-core><rabbitmq><xunit><nsubstitute>,"<p>I have setup a <code>MessageProducer</code> with publisher confirms following the tutorial provided by RabbitMQ docs (<a href=""https://www.rabbitmq.com/tutorials/tutorial-seven-dotnet.html"" rel=""nofollow noreferrer"">https://www.rabbitmq.com/tutorials/tutorial-seven-dotnet.html</a>).</p>
<p>I am using XUnit and NSubstitute for my tests, and I now struggle to unit-test the functionality of the callback function I've defined for the <code>IModel _channel</code>.</p>
<p>If I just test that the channel received the expected amounts of <code>BasicPublish()</code> the test runs to completion.</p>
<p>Here's my service method:</p>
<pre><code>public async Task SendMessagesWithConfirmAsync&lt;T&gt;(IEnumerable&lt;T&gt; messages, string queueName, string routingKey)
{
    _channel.QueueDeclare(queueName, true, false);

    _channel.ConfirmSelect();

    // Register callbacks to handle acknowledgments
    _channel.BasicAcks += (sender, ea) =&gt; CleanOutstandingConfirms(ea.DeliveryTag, ea.Multiple);

    _channel.BasicNacks += (sender, ea) =&gt;
        {
            _outstandingConfirms.TryGetValue(ea.DeliveryTag, out var body);

            Console.WriteLine(
                $&quot;Message with body {body} has been nack-ed. Sequence number: {ea.DeliveryTag}, multiple: {ea.Multiple}&quot;);

            CleanOutstandingConfirms(ea.DeliveryTag, ea.Multiple);
    };

    foreach (var message in messages)
    {
        var body = JsonSerializer.Serialize(message);
        _outstandingConfirms.TryAdd(_channel.NextPublishSeqNo, body);
        _channel.BasicPublish(queueName, routingKey, null, Encoding.UTF8.GetBytes(body));
    }

    await Task.CompletedTask;
}
</code></pre>
<p>And in my unit test I want to make sure the callback events are correctly triggered</p>
<pre><code>[Theory]
[InlineData(&quot;Test 1&quot;, &quot;Test 2&quot;, &quot;Test 3&quot;)]
public async void SendMessageWithConfirm_MultipleMessages_ShouldPublishMessagesAndWaitForConfirmOrDie(
    params string[] messages)
{
    // Arrange
    var messageProducer = new RabbitMqMessageProducer(_connectionFactory);

    // Act
    await messageProducer.SendMessagesWithConfirmAsync(messages, &quot;invitations&quot;, &quot;invitation&quot;);

    // Assert
    _channel.Received(messages.Length).BasicPublish(Arg.Any&lt;string&gt;(), Arg.Any&lt;string&gt;(),
        null, Arg.Any&lt;ReadOnlyMemory&lt;byte&gt;&gt;());

    // Assert on callback events
    // ...
}
</code></pre>
<p>Another thing is that the <code>_channel.NextPublishSeqNo</code> never gets incremented.</p>
<p>Any help or derivation to the correct documentation here would be much appreciated.</p>
",1,747,2023-02-23 13:10,,1,0,how
23233418,Unit testing retrieval methods - redundant?,<c#><unit-testing><mocking><xunit.net>,"<p>I have the following method in my service layer</p>

<pre><code>public ModuleResponse GetModules(ModuleRequest request)
{
    var response = new ModuleResponse(request.RequestId);
    try
    {
        response.Modules = Mapper.ToDataTransferObjects(ModuleDao.GetModules());
        return response;
    }
    catch (Exception ex)
    {
        Log.Error(ex);
        response.Acknowledge = AcknowledgeType.Failure;
        response.Message = ""An error occured."";
        return response;
    }
}
</code></pre>

<p>And I have a unit test written in xUnit like this:</p>

<pre><code>[Fact]
public void GetModulesTest()
{
    //Arrange            
    var mockModuleDao = Mock.Create&lt;IModuleDao&gt;();
    var mockLog = Mock.Create&lt;ILog&gt;();
    var mockAuditDao = Mock.Create&lt;IAuditDao&gt;();

    var moduleList = new List&lt;ModuleItem&gt;
    {
        new ModuleItem {Id = 100, Category = ""User Accounts"", Feature = ""Users""},
        new ModuleItem {Id = 101, Category = ""User Accounts"", Feature = ""Roles Permissions""}
    };

    mockModuleDao.Arrange(dao =&gt; dao.GetModules()).Returns(moduleList);

    IUserManagementService userService = new UserManagementService(mockModuleDao, mockLog, mockAuditDao);

    var request = new ModuleRequest().Prepare();

    //Act
    var actualResponse = userService.GetModules(request);

    //Assert
    Assert.Equal(AcknowledgeType.Success, actualResponse.Acknowledge);
    Assert.Equal(2, actualResponse.Modules.Count);
}
</code></pre>

<p>Now I have a whole other bunch of retrieval methods in my code similar to the one above.</p>

<p>Are testing such methods redundant? I mean, they are almost a sure pass test, unless I mess up the logic of my Mapping or something.</p>

<p>Also, when testing retrieval methods, what is it that I should be testing for? In my scenario above, I have 2 assert statements, 1 to check if the response is a success, and the 2nd is to check the count of the list. </p>

<p>Is this sufficient? or how can this be further improved to enhance the value of such a unit test?</p>
",3,147,2014-04-23 1:49,,2,6,what
6261139,Moq: Return mock object with most implementation created,<moq>,"<p>I want to mock my Repository object in such a way that it can still do actual DB retrieve operations. Only for Saving operations, I wanted to setup to return mock data since I don't want it to save into the DB.</p>

<p>How should I do it?</p>

<p>Thanks.</p>
",1,188,2011-06-07 6:00,,2,0,how
75880165,Accessing Calls to Mocked Class functions,<python><django><unit-testing><mocking><python-mock>,"<p>I have written a custom class to mock a general API client in a codebase so that I can centrally and easily mock all of the class methods for unit testing. This is working great so far, however I am looking for a way to track individual calls to each class method. Right now that only trackable call via Mock is the initial class instantiation.</p>
<p>Here is the mock class:</p>
<pre><code>from faker import Factory

faker = Factory.create()

class MockAPIClass
  def get_some_data(self, data):
    return f&quot;{data} - {faker.pyint()}&quot;
</code></pre>
<p>Then in my util file:</p>
<pre><code>def func_to_test_that_calls_client(arg):
  client = regular_api_client()
  return client.get_some_data(arg)
</code></pre>
<p>Then in my unit tests:</p>
<pre><code>from unittest import mock
from django.test import TransactionTestCase
from .file import MockAPIClass

from .util import func_to_test_that_calls_client

class TestUils(TransactionTestCase):

  def setUp(self):
    self.api_call_patcher = mock.patch('path.to.mocked.class.instantiation')
    self.patch_api = self.api_call_patcher.start()
    self.mock_api = MockAPIClass()  # this done so that the mocked class can be referenced below
    self.patch_api.return_value = self.mock_api

  def tearDown(self):
    mock.patch.stopall()

  def test_util_func(self):
    res = func_to_test_that_calls_client(&quot;test&quot;)

    self.assertTrue(res)
    self.patch_api.assert_called_once()
  
</code></pre>
<p>The above functions exactly as expected and intended. However, inside of the funciton <code>func_to_test_that_calls_client</code>, the original client is instantiated then the class method <code>get_some_data()</code> is called. With this implementation, I have no visibility into the call stack of the class methods like that function, only the parent instantiation of the class. I would like to be able to see for example that <code>func_to_test_that_calls_client</code> was called with <code>&quot;test&quot;</code> with this current implementation. Is there a way to do this with mock or some other python trick?</p>
",0,48,2023-03-29 17:07,,1,3,how
20786877,Mockito matchers InvalidUseOfMatchersException returning null,<junit><mocking><mockito>,"<p>I need to return null from:</p>

<pre><code>Cookie controlCookieValue = getCookie(cookiesConfigBean.getControlCookieName());
</code></pre>

<p>I'm doing:</p>

<pre><code>when(baseHandler.getCookie(any(String.class))).thenReturn(null);
</code></pre>

<p>but the code throws <code>InvalidUseOfMatchersException</code>. I tried using <code>anyObject()</code> and <code>anyString()</code>, but nothing works. The <code>baseHandler</code> object is a mock.</p>
",0,104,2013-12-26 15:00,,0,2,other
35208951,How do you mock IEnumerable<T> ElementAt() using NSubstitute?,<linq><unit-testing><mocking><nsubstitute>,"<p>I have been having issues implementing the correct technique to mock out the Linq methods for an IEnumerable.</p>

<pre><code>{
    var qs = Substitute.For&lt;IEnumerable&lt;object&gt;&gt;();
    qs.ElementAt(i).Returns(q);
    qs.Count().Returns(i);
}
</code></pre>

<p>Which is meant to test a method, which contains both pulling an item out of the list at random or in a controlled fashion.</p>

<pre><code>private IEnumerable&lt;T&gt; list;
async object Save(object obj, byte i = 0)
{
     var random = new Random();
     var index = i == 0 ? random.Next(0, list.Count()) : i;
     return list.ElementAt(index);
}
</code></pre>

<p>Doing this results in:</p>

<pre><code>at System.ThrowHelper.ThrowArgumentOutOfRangeException(ExceptionArgument argument, ExceptionResource resource)
   at System.Collections.Generic.List`1.get_Item(Int32 index)
   at System.Linq.Enumerable.ElementAt[TSource](IEnumerable`1 source, Int32 index)
   at King.Azure.Unit.Test.Data.StorageQueueShardsTests.&lt;Save&gt;d__11.MoveNext() in C:\Users\jefkin\Documents\GitHub\King.Azure\King.Azure.Unit.Test\Data\StorageQueueShardsTests.cs:line 127
--- End of stack trace from previous location where exception was thrown ---
   at NUnit.Framework.Internal.AsyncInvocationRegion.AsyncTaskInvocationRegion.WaitForPendingOperationsToComplete(Object invocationResult)
   at NUnit.Framework.Internal.Commands.TestMethodCommand.RunAsyncTestMethod(TestExecutionContext context)
Result Message: 
System.ArgumentOutOfRangeException : Index was out of range. Must be non-negative and less than the size of the collection.
Parameter name: index
</code></pre>
",1,1674,2016-02-04 18:36,,1,0,how
37061048,How to use RSpec to set up expectations for top level methods on a Sinatra App?,<ruby><rspec><mocking><sinatra>,"<p>Spec helper: </p>

<pre><code>def app
  Sinatra::Application
end
</code></pre>

<p>App:</p>

<pre><code>require 'sinatra'

get '/' do
  track_request
  ""Welcome""
end

def track_request
  puts self.inspect
  ....
end
</code></pre>

<p>How to mock <code>track_request</code>?</p>

<pre><code>allow(app).to receive :track_request
allow_any_instance_of(Sinatra::Application).to receive :track_request
allow(Sinatra::Application).to receive :track_request
</code></pre>

<p>None of these worked.</p>

<p><code>self</code> is main, so I guess we need to mock a method on main. But didn't find out how to do it.</p>
",1,131,2016-05-05 22:04,,1,1,how
67719732,Micronaut test fileupload,<java><mocking><micronaut>,"<p>I want to test a method, which receives a CompletedFileUpload.</p>
<pre><code>public void uploadZip(String orderId, CompletedFileUpload fileUpload) throws IOException {

    Path path = Files.createTempFile(&quot;file-&quot;, &quot;-temp&quot;);
    File tempFile = path.toFile();
    try (FileOutputStream outputStream = new FileOutputStream(tempFile)) {
        outputStream.write(fileUpload.getBytes());
        someMethod(orderId, tempFile);
    }
}
</code></pre>
<p>The CompletedFileUpload is an interface:</p>
<pre><code>package io.micronaut.http.multipart;

public interface CompletedFileUpload extends FileUpload, CompletedPart {
}
</code></pre>
<p>I want to find a way to Mock the File upload, for spring boot i found :</p>
<pre><code>MockMultipartFile multipartFile =
                new MockMultipartFile(&quot;springboot.png&quot;, &quot;springboot.png&quot;, &quot;image/png&quot;, &quot;&quot;.getBytes());
</code></pre>
<p>Is there something similar that I can use in Micronaut?</p>
",0,1319,2021-05-27 9:51,,1,0,what
67026762,Using real data when mocking objects in unit test,<python><unit-testing><mocking><azure-service-principal>,"<p>I am mocking in some unit tests, and I am wondering whether is fine or recommended to use real data (I am dealing with non-sensitive data) when mocking.</p>
<p>For instance, I am testing the user's members which are allowed to authenticate in an application by using an azure service principal here:</p>
<pre><code>def create_mock(status_code, data):
    def mocked_requests(*args, **kwargs):
        class MockResponse:
            def __init__(self, status_code, json_data):
                self.json_data = json_data
                self.status_code = status_code

            def json(self):
                return self.json_data

        return MockResponse(status_code, data)

    return mocked_requests

class RolesTestCase(unittest.TestCase):
    @mock.patch('requests.get',
                side_effect=create_mock(
                    200,
                    # HERE MY OBJECT OR DATA MOCKED.
                    {
                        &quot;@odata.context&quot;: &quot;https://graph.microsoft.com/v1.0/$metadata#servicePrincipals('99999')/appRoleAssignedTo&quot;,
                        &quot;value&quot;: [{
                            &quot;id&quot;: &quot;99999&quot;,
                            &quot;deletedDateTime&quot;: &quot;null&quot;,
                            &quot;appRoleId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,
                            &quot;createdDateTime&quot;: &quot;2021-03-21T17:15:40.516616Z&quot;,
                            &quot;principalDisplayName&quot;: &quot;Bernardo Garcia Loaiza&quot;,
                            &quot;principalId&quot;: &quot;99999&quot;,
                            &quot;principalType&quot;: &quot;User&quot;,
                            &quot;resourceDisplayName&quot;: &quot;my-service-principal-name&quot;,
                            &quot;resourceId&quot;: &quot;99999&quot;
                        }]
                    }
                 )
                )
    @mock.patch('roles.get_sp_object_id')
    def test_get_user_role_assignments(self, get_sp_object_id, mock):
        token = &quot;FOOBAR&quot;
        get_user_role_assignments(token, {&quot;id&quot;: &quot;123&quot;, &quot;name&quot;: &quot;group_name&quot;})
        get_sp_object_id.assert_called_with(token, {&quot;id&quot;: &quot;123&quot;, &quot;name&quot;: &quot;group_name&quot;})
</code></pre>
<p>At the <code>@mock.patch('requests.get, ...'</code> code section above, is ok if instead of <code>99999</code> values on the JSON doc, I put the real values?</p>
",1,1005,2021-04-09 18:51,,1,0,what
27308190,Manipulating objects with DbSet<T> and IQueryable<T> with NSubstitute returns error,<c#><entity-framework><unit-testing><nsubstitute><dbset>,"<p>I'd like to use <a href=""http://nsubstitute.github.io/"" rel=""nofollow"">NSubstitute</a> to unit test Entity Framework 6.x by mocking <a href=""http://msdn.microsoft.com/en-us/library/gg696460(v=vs.113).aspx"" rel=""nofollow"">DbSet</a>. Fortunately, <a href=""https://github.com/scott-xu"" rel=""nofollow"">Scott Xu</a> provides a good unit testing library, <a href=""https://www.nuget.org/packages/EntityFrameworkTesting.Moq/"" rel=""nofollow"">EntityFramework.Testing.Moq</a> using <a href=""http://www.moqthis.com/"" rel=""nofollow"">Moq</a>. So, I modified his code to be suitable for NSubstitute and it's been looking good so far, until I wanted to test <code>DbSet&lt;T&gt;.Add()</code>, <code>DbSet&lt;T&gt;.Remove()</code> methods. Here's my code bits:</p>

<pre><code>public static class NSubstituteDbSetExtensions
{
  public static DbSet&lt;TEntity&gt; SetupData&lt;TEntity&gt;(this DbSet&lt;TEntity&gt; dbset, ICollection&lt;TEntity&gt; data = null, Func&lt;object[], TEntity&gt; find = null) where TEntity : class
  {
    data = data ?? new List&lt;TEntity&gt;();
    find = find ?? (o =&gt; null);

    var query = new InMemoryAsyncQueryable&lt;TEntity&gt;(data.AsQueryable());

    ((IQueryable&lt;TEntity&gt;)dbset).Provider.Returns(query.Provider);
    ((IQueryable&lt;TEntity&gt;)dbset).Expression.Returns(query.Expression);
    ((IQueryable&lt;TEntity&gt;)dbset).ElementType.Returns(query.ElementType);
    ((IQueryable&lt;TEntity&gt;)dbset).GetEnumerator().Returns(query.GetEnumerator());

#if !NET40
    ((IDbAsyncEnumerable&lt;TEntity&gt;)dbset).GetAsyncEnumerator().Returns(new InMemoryDbAsyncEnumerator&lt;TEntity&gt;(query.GetEnumerator()));
    ((IQueryable&lt;TEntity&gt;)dbset).Provider.Returns(query.Provider);
#endif

    ...

    dbset.Remove(Arg.Do&lt;TEntity&gt;(entity =&gt;
                                 {
                                   data.Remove(entity);
                                   dbset.SetupData(data, find);
                                 }));

    ...

    dbset.Add(Arg.Do&lt;TEntity&gt;(entity =&gt;
                              {
                                data.Add(entity);
                                dbset.SetupData(data, find);
                              });

    ...

    return dbset;
  }
}
</code></pre>

<p>And I created a test method like:</p>

<pre><code>[TestClass]
public class ManipulationTests
{
  [TestMethod]
  public void Can_remove_set()
  {
    var blog = new Blog();
    var data = new List&lt;Blog&gt; { blog };

    var set = Substitute.For&lt;DbSet&lt;Blog&gt;, IQueryable&lt;Blog&gt;, IDbAsyncEnumerable&lt;Blog&gt;&gt;()
                        .SetupData(data);

    set.Remove(blog);

    var result = set.ToList();

    Assert.AreEqual(0, result.Count);
  }
}

public class Blog
{
   ...
}
</code></pre>

<p>The issue arises when the test method calls <code>set.Remove(blog)</code>. It throws an <code>InvalidOperationException</code> with error message of</p>

<blockquote>
  <p>Collection was modified; enumeration operation may not execute.</p>
</blockquote>

<p>This is because the fake <code>data</code> object has been modified when the <code>set.Remove(blog)</code> method is called. However, the original Scott's way using <code>Moq</code> doesn't result in the issue.</p>

<p>Therefore, I wrapped the <code>set.Remove(blog)</code> method with a <code>try ... catch (InvalidOperationException ex)</code> block and let the <code>catch</code> block do nothing, then the test doesn't throw an exception (of course) and does get passed as expected.</p>

<p>I know this is not the solution, but how can I achieve my goal to unit test <code>DbSet&lt;T&gt;.Add()</code> and <code>DbSet&lt;T&gt;.Remove()</code> methods?</p>
",3,4430,2014-12-05 3:21,,1,0,how
20913236,Verifying a method call in a base class that takes a delegate parameter using Moq,<c#><unit-testing><delegates><mocking><moq>,"<p>I am trying to test that a method is called, and that method exists in a base class of the class under test.  </p>

<p>When I run the below example with a simple string parameter it works but when there is a delegate parameter the test fails.</p>

<p>I created the below sample to demonstrate the problem.  If you take out the delegate parameter in <code>SomeMethod</code> and in the test, the test will pass. </p>

<h3>Failing Code:</h3>

<pre><code>public abstract class BaseClass
{
    public virtual void SomeMethod(string someString, Func&lt;bool&gt; function)
    {
        //do something
    }
}

public class DerivedClass : BaseClass
{
    public void DoSomething()
    {
        SomeMethod(""foo"", () =&gt; true);
    }
}

[TestClass]
public class Tests
{
    [TestMethod]
    public void TestMethod1()
    {
        var test = new Mock&lt;DerivedClass&gt;();
        test.Object.DoSomething();
        test.Verify(x =&gt; x.SomeMethod(""foo"", () =&gt; true), Times.AtLeastOnce);
    }
}
</code></pre>

<h3>Passing Code:</h3>

<pre><code>public abstract class BaseClass
{
    public virtual void SomeMethod(string someString)
    {
        //do something
    }
}

public class DerivedClass : BaseClass
{
    public void DoSomething()
    {
        SomeMethod(""foo"");
    }
}

[TestClass]
public class Tests
{
    [TestMethod]
    public void TestMethod1()
    {
        var test = new Mock&lt;DerivedClass&gt;();
        test.Object.DoSomething();
        test.Verify(x =&gt; x.SomeMethod(""foo""), Times.AtLeastOnce);
    }
}
</code></pre>

<p>Error message for failing test:</p>



<pre class=""lang-none prettyprint-override""><code>Expected invocation on the mock at least once, but was never performed: x =&gt; x.SomeMethod(""foo"", () =&gt; True)
No setups configured.

Performed invocations:
BaseClass.SomeMethod(""foo"", System.Func1[System.Boolean])`
</code></pre>

<p>Whole error message:</p>

<pre class=""lang-none prettyprint-override""><code>Test method UnitTestProject1.Tests.TestMethod1 threw exception: 
Moq.MockException: 
Expected invocation on the mock at least once, but was never performed: x =&gt; x.SomeMethod(""foo"", () =&gt; True)
No setups configured.

Performed invocations:
BaseClass.SomeMethod(""foo"", System.Func`1[System.Boolean])
   at Moq.Mock.ThrowVerifyException(MethodCall expected, IEnumerable`1 setups, IEnumerable`1 actualCalls, Expression expression, Times times, Int32 callCount)
   at Moq.Mock.VerifyCalls(Interceptor targetInterceptor, MethodCall expected, Expression expression, Times times)
   at Moq.Mock.Verify(Mock`1 mock, Expression`1 expression, Times times, String failMessage)
   at Moq.Mock`1.Verify(Expression`1 expression, Times times)
   at Moq.Mock`1.Verify(Expression`1 expression, Func`1 times)
   at UnitTestProject1.Tests.TestMethod1() in UnitTest1.cs: line 16
</code></pre>
",5,1534,2014-01-03 21:45,,1,0,other
51892214,gmock with base class constructor,<c++><googlemock>,"<p>I'm getting a compiler error, which I don't understand why. Or rather, I believe I'm doing what it telling me to. (Or not doing what I shouldn't do)</p>

<pre><code>// InterfaceClass.h
class InterfaceClass {
 public:
    explicit InterfaceClass(DependencyClass * const p_dc);
};

// MockClass.h
class MockClass : public InterfaceClass {
 public:
    explicit MockClass(DependencyClass * const p_dc) : InterfaceClass(p_dc) {}
};

// test_MyTest.cpp
class MyTestFixture : public testing::Test {
 protected:
    MockDependencyClass mock_dependency;
    NiceMock&lt;mocks::MockClass&gt; mock;
 public:
    MyTestFixture() : mock(&amp;mock_depedency) {}
};
</code></pre>

<p>The error I'm getting when compiling my test is this:</p>

<pre><code>In file included from test/test_MyTest.cpp:2:
In file included from vendor/googlemock/include/gmock/gmock.h:62:
vendor/googlemock/include/gmock/gmock-generated-nice-strict.h:92:12: error: constructor for 'testing::NiceMock&lt;MockClass&gt;' must explicitly initialize the base class 'InterfaceClass' which does not have a default constructor
  explicit NiceMock(const A1&amp; a1) : MockClass(a1) {
           ^
test/test_MyTest.cpp:43:30: note: in instantiation of function template specialization 'testing::NiceMock&lt;MockClass&gt;::NiceMock&lt;DependencyClass *&gt;' requested here
    MyTestFixture(void) : mock(&amp;mock_dependency) {
                          ^
src/InterfaceClass:21:7: note: 'InterfaceClass' declared here
class InterfaceClass {
      ^
</code></pre>

<p>So, if I'm understanding this correctly, its telling me that my mock cannot initialise the interface class, because there is no default constructor and I haven't specified a non-default constructor to use. But I have? And if I understand gmock's source correctly, it supports constructors with up to 10 parameters.</p>

<p>And in my test fixture; if I make the mock a regular mock (i.e. not a NiceMock), it compiles.</p>

<p>What am I doing wrong here?</p>
",1,559,2018-08-17 9:20,,0,1,what
57024669,"Function is apparently mocked and called when inspected at a break point, but `assert_called_with` fails",<python><unit-testing><mocking><with-statement><smtplib>,"<p>I'm trying to write a test for <code>send_email</code>:</p>

<pre><code>def send_email(email_info):
    user_name, user_email, message = email_info
    recipient = f'{user_name} &lt;{user_email}&gt;'
    message = format_email(message, UNAME, recipient)
    context = ssl.create_default_context()
    with smtplib.SMTP(SERVER, PORT) as server:
        server.starttls(context=context)
        server.login(UNAME, PASSWORD)
        server.send_message(message)
    return
</code></pre>

<p><code>send_email</code> is in my project subdirectory <code>&lt;project_name&gt;/base/tasks</code>.</p>

<p>Here's my attempt at a test:</p>

<pre><code>import mock
from pytest_mock import mocker

class TestEmailFunctions:
    @mock.patch('&lt;project_name&gt;.base.tasks.smtplib')
    def test_send_email(self, mock_smtp, mocker):
        server = mocker.MagicMock()
        server.starttls = mocker.MagicMock()
        server.login = mocker.MagicMock()
        server.send_message = mocker.MagicMock()
        mock_smtp.SMTP = mocker.MagicMock()
        mock_smtp.SMTP.return_value = server
        msg = {'subject': ""Hi, Elmo!"", 'body':""It's Grover!""}
        send_email(('Elmo', 'elmo@sesamestreet.org', msg))
        mock_smtp.SMTP.assert_called_once()
        server.login.assert_called_once()
        assert server.login.call_args[0] == 'Elmo'
        server.send_message.assert_called_once()
        assert server.send_message.call_args == 'Hi, Elmo!'
</code></pre>

<p><code>mock_smtp.SMTP.assert_called_once()</code> passes, so I know mocking is handled correctly up through the SMTP method.  But <code>server.login.assert_called_once()</code> fails: <code>AssertionError: Expected 'login' to have been called once. Called 0 times.</code></p>

<p>I've inserted a breakpoint a bunch of different places, but skipping to the most dispositive one -- I put one in the function itself, not the test, right after I called <code>server.login()</code> with its arguments:</p>

<pre><code>-&gt; server.send_message(message)
(Pdb) server
&lt;MagicMock name='mock().__enter__()' id='4581656560'&gt;
(Pdb) server.login
&lt;MagicMock name='mock().__enter__().login' id='4581885096'&gt;
(Pdb) server.login.mock_calls
[call('&lt;our email&gt;', '&lt;email password&gt;')]
</code></pre>

<p>It really seems like I set up the mocks correctly, so I'm at a loss as to why <code>mock_smtp.SMTP.assert_called_once()</code> passes but <code>server.login.assert_called_once()</code> fails.  Maybe it's something about the <code>with</code> statement?  I'd appreciate it if anyone could provide an explanation and some advice about the proper way to test this function.   </p>
",2,390,2019-07-14 4:44,,0,2,why
1196958,"Strange behavior in the ""Verify"" method in Moq",<c#><unit-testing><nunit><mocking><moq>,"<p>In the following code, Test1 succeeds but Test2 fails:</p>

<pre><code>protected Mock&lt;IMyInterface&gt; MyMock { get; set; }

[SetUp]
public virtual void  Initialize()
{
    MyMock = new Mock&lt;IMyInterface&gt;();
}

[Test]
void Test1()
{
    // ... code that causes IMyIntervace.myMethod to be called once

    MyMock.Verify(x=&gt; x.myMethod(), Times.Once());
}

[Test]
void Test2()
{
    MyMock.Verify(x=&gt; x.myMethod(), Times.Once());
}
</code></pre>

<p>This behavior is actually quite useful but I can't figure out why it's working like this.  It seems like Test2 should also succeed!</p>

<p>The only idea I have is that somehow Verify is smart enough to know that ""myMethod"" was called from a different test case and so it ""doesn't count""?</p>

<p>BTW, even if I remove the call to Verify in Test1, the same thing happens (Test2 fails).</p>
",1,1002,2009-07-28 21:52,,1,0,why
5743236,Google Mock: multiple expectations on same function with different parameters,<googletest><googlemock>,"<p>Consider the case where a certain mocked function is expected to be called several times, each time with a different value in a certain parameter. I would like to validate that the function was indeed called once and only once per value in a certain list of values (e.g. 1,2,5).</p>

<p>On the other hand, I would like to refrain from defining a sequence as that would dictate a certain order, which is an implementation detail I would like to keep free.</p>

<p>Is there some kind of matcher, or other solution for this case?</p>

<p>I'm not sure if this influences the solution in any way but I do intend to use WillOnce(Return(x)) with a different x per value in the list above.</p>
",9,17403,2011-04-21 11:05,,2,1,what
60708836,Mock a class before importing it,<python><mocking><python-unittest>,"<p>I'm trying to mock a method in a parent class that is declared out of any class method. The problem es I can't figure out how to make the LoggerUtils class to be instantiated in the parent class. Puting it inside an <em>__init__</em> is not an option due to the large size of the implementation and the cost of refactor. </p>

<ul>
<li><p>Is there a way to mock the parent class prior to the import of the tested class?</p></li>
<li><p>At least mock the method before is loaded when importing the class.</p></li>
<li><p>Is there any approach to solve the problem of non-lazy methods loading on import?</p></li>
</ul>

<p>I tried lazy loading <a href=""https://wil.yegelwel.com/lazily-importing-python-modules/"" rel=""nofollow noreferrer"">TensorFlow LazyLoad Library</a> methods but I just didnt get it to work; patching all methods with mock library, but the methods always load before I can mock anything. Below I have an example of the mocking tries, but LoggerUtils is always called.</p>

<p>Parent Class:</p>

<p>abstract_api.py</p>

<pre><code>class AbstractApi:

    logger = LoggerUtils.get_logger('AbstractApi')
    def update(self):
        &lt;code&gt;


</code></pre>

<p>Class to test:</p>

<p>api_map_asset_type.py</p>

<pre><code>from abstract_api import AbstractApi


class ApiMapAssetType(AbstractApi):
    def update(self):
        &lt;code&gt;

</code></pre>

<p>Test Class:</p>

<p>test_api_map_asset_type.py</p>

<pre><code>from unittest import TestCase
from mock imort patch
from api_map_asset_type import ApiMapAssetType


class TestApiMapAssetType(TestCase):

    @patch('api_map_asset_type.AbstractApi.LoggerUtils')
    @patch('api_map_asset_type.AbstractApi')
    def setUp(self, mock2_abstract_loger, mock_3):
        self.asset_api = ApiMapAssetType()

    @patch('AbstractApi.update')
    def test_update(self, mock_parent_update):

        mock_orm = MagicMock()
        self.asset_api.update()
        mock_parent_update.assert_called_with()
</code></pre>

<hr>

<p><strong>EDITED</strong></p>

<p>This is the only solution I found, since I am not able to mock parent classes or mock methods in class attributes before being imported, I decided to mock the whole test before importing, yet I think this is not an optimal or clean solution:</p>

<p>Test Class:</p>

<p>test_api_map_asset_type.py</p>

<pre><code>from undetermined_project_library.LoggerUtils import LoggerUtils
with patch.object(LoggerUtils, 'get_logger') as mock_logger:

    from unittest import TestCase
    from mock imort patch
    from api_map_asset_type import ApiMapAssetType


    class TestApiMapAssetType(TestCase):

    def setUp(self):
            self.asset_api = ApiMapAssetType()

        @patch('AbstractApi.update')
        def test_update(self, mock_parent_update):

            mock_orm = MagicMock()
            self.asset_api.update()
            mock_parent_update.assert_called_with()

</code></pre>
",1,2199,2020-03-16 15:32,,2,7,what
16214505,rspec mock not getting called on belongs_to association,<ruby-on-rails><rspec><mocking>,"<p>I'm trying to test my controller in rails with RSpec, but it's not calling one of the mocks I made and I'm not sure why.</p>

<p>my model has a user class, and a game class, and a player class, which belongs to a user and a game.</p>

<p>I'm trying to test something like this</p>

<pre><code>player = Player.find_by_id(params[:id])
if player != nil &amp;&amp; player.user == current_user &amp;&amp; player.game.remove_player?(player)
  redirect_to games_url
</code></pre>

<p>yet I can't seem to mock remove_player? correctly. What I'm doing is pretty much this:</p>

<pre><code>@player = double(""player"")
Player.should_receive(:find_by_id).with(mock_player_id.to_s).and_return { @gplayer }
@player.stub(:user).and_return(@current_user)
fakeGame = double(""game"")
@player.stub(:game).and_return(fakeGame)
fakeGame.should_receive(:remove_player?).with(@player).and_return(true)
</code></pre>

<p>I'm getting the error saying that remove_player? was never called. Any idea what I'm doing wrong? I can't tell for sure if it's reaching the player.user == curent_user, but it is calling find_by_id and not complaining about it at all, so I would imagine it must reach the user check.</p>

<p>EDIT: @current_user does equal current_user</p>

<p>Also, I tried replacing line 3 with</p>

<pre><code>fakeUser = double(""user"")
@player.should_receive(:user).and_return(@current_user)
</code></pre>

<p>it gives me the error saying :user wasn't called.</p>
",0,415,2013-04-25 12:16,,1,0,why
1595952,How to write tests without so many mocks?,<unit-testing><tdd><mocking>,"<p>I am a heavy advocate of proper Test Driven Design or Behavior Driven Design and I love writing tests. However, I keep coding myself into a corner where I need to use 3-5 mocks in a particular test case for a single class. No matter which way I start, top down or bottom up I end up with a design that requires at least three collaborators from the highest level of abstraction. </p>

<p>Can somebody give good advice on how to avoid this pitfall? </p>

<p>Here's a typical scenario. I design a Widget that produces a Midget from a given text value. It always starts really simple until I get into the details. My Widget must interact with several hard to test things like file systems, databases, and the network. </p>

<p>So, instead of designing all that into my Widget I make a Bridget collaborator. The Bridget takes care of one half of the complexity, the database and network, allowing me to focus on the other half which is multimedia presentation. So, then I make a Gidget that performs the multimedia piece. The entire thing needs to happen in the background, so now I include a Thridget to make that happen. When all is said and done I end up with a Widget that hands work to a Thridget which talks over a Bridget to give its result to a Gidget.</p>

<p>Because I'm working in CocoaTouch and trying to avoid mock objects I use the self-shunt pattern where abstractions over collaborators become protocols that my test adopts. With 3+ collaborators my test balloons and become too complicated. Even using something like OCMock mock objects leaves me with an order of complexity that I'd rather avoid. I tried wrapping my brain around a daisy-chain of collaborators (A delegates to B who delegates to C and so on) but I can't envision it.</p>

<p><strong><em>Edit</em></strong>
Taking an example from below let's assume we have an object that must read/write from sockets and present the movie data returned.</p>

<pre><code>//Assume myRequest is a String param...
InputStream   aIn  = aSocket.getInputStram();
OutputStream  aOut = aSocket.getOutputStram();
DataProcessor aProcessor = ...;

// This gets broken into a ""Network"" collaborator.
for(stuff in myRequest.charArray()) aOut.write(stuff);
Object Data = aIn.read(); // Simplified read

//This is our second collaborator
aProcessor.process(Data);
</code></pre>

<p>Now the above obviously deals with network latency so it has to be Threaded. This introduces a Thread abstraction to get us out of the practice of threaded unit tests. We now have</p>

<pre><code>AsynchronousWorker myworker = getWorker(); //here's our third collaborator
worker.doThisWork( new WorkRequest() {
//Assume myRequest is a String param...
DataProcessor aProcessor = ...;

// Use our ""Network"" collaborator.
NetworkHandler networkHandler = getNetworkHandler();
Object Data = networkHandler.retrieveData(); // Simplified read

//This is our multimedia collaborator
aProcessor.process(Data);
})
</code></pre>

<p>Forgive me for working backwards w/o tests but I'm about to take my daughter outside and I'm rushing thru the example. The idea here is that I'm orchestrating the collaboration of several collaborators from behind a simple interface that will get tied to a UI button click event. So the outter-most test reflects a Sprint task that says given a ""Play Movie"" button, when it is clicked, the movie will play.
<strong><em>Edit</em></strong>
Lets discuss.</p>
",22,4952,2009-10-20 16:52,,4,0,how
54989530,Spring Boot - test without spring context with Spock,<spring-boot><mocking><spock>,"<p>I have a service class and method with signature:</p>

<pre><code>@Service
public class FileService {
    ....
    ....
    public Optional&lt;FileDescr&gt; upload(MultipartFile uploadFile){...}

    public Resource downloadFile(int linkID){...}

}
</code></pre>

<p>And test file (Groovy):</p>

<pre><code>import org.junit.experimental.categories.Category
import org.springframework.mock.web.MockMultipartFile
import spock.lang.Shared
import spock.lang.Specification

@Category(WithoutSpringContext)
class FileServiceTestWithoutSpringContext extends Specification{

    @Shared
    FileService fileService = Mock()

    @Shared
    MockMultipartFile mockMultipartFile = Mock()

    def setupSpec(){

    }

    def setup(){

    }

    def clean(){

    }

    def cleanSpec(){

    }

    def ""upload file""(){
        given:
            fileService.upload(mockMultipartFile) &gt;&gt; true
        when:
            def result = fileService.upload(mockMultipartFile)
        then:
            result==true
    }

    def ""download file if exists""(){
        given:
            fileService.downloadFile(1) &gt;&gt; true
        when:
            def result = fileService.downloadFile(1)
        then:
            result==true
    }
}
</code></pre>

<p>I would like to test method with Mock, without spring context. How should I do it ? Now, the <code>result</code> variable return null. 
I would like to set the return value of the method.</p>
",0,428,2019-03-04 18:39,,1,0,how
32007032,Is it possible to mock the non-existence of a function in PHPUnit?,<php><mocking><phpunit>,"<p>I have a unit test that checks that an exception is thrown if the <code>openssl_random_pseudo_bytes</code> is not installed. However, if it <em>is</em> installed, it currently gets skipped. This is unsatisfactory to me, though, as it results in an imperfect test run. I could set the unit test to pass, but that feels like a cheat. </p>

<p>Does anyone have any ideas?</p>

<p>Here is my test as it stands:</p>

<pre><code>public function testGenerateOpenSSLThrowsExceptionWhenFunctionDoesNotExist()
{
    if (function_exists('openssl_random_pseudo_bytes')) {
        $this-&gt;markTestSkipped('Cannot run test: openssl_random_pseudo_bytes function exists.');
    }

    $this-&gt;_salt-&gt;generateFromOpenSSL();
}
</code></pre>
",3,800,2015-08-14 9:42,,1,0,what
45649545,How to only mock a method of a bean in Spring using Mockito?,<spring><unit-testing><mocking><mockito>,"<p>I use <code>@Primary</code> and <code>@Profile</code> to mock a bean in Spring test:</p>

<pre><code>@Profile(""test"")
@Configuration
public class TestBeanConf {

@Bean
@Primary
public UserService userService() {
    UserService userService = Mockito.mock(UserService.class);
    TokenValidationUrl validation = new TokenValidationUrl();
    validation.setValid(true);
    validation.setUid(""123456789"");
    Mockito.when(userService.tokenValidation(""23456"")).thenReturn(validation);
    return userService;
}
</code></pre>

<p>But other methods of <code>UserService</code> bean return <code>null</code>, how can i spy the real created bean and only mock <code>tokenValidation</code> method?</p>
",5,4308,2017-08-12 11:09,,1,0,how
26678518,Testing a private Static method,<java><unit-testing><mocking><static-methods><jmockit>,"<p>Hi I want to test the generateKey method and the messages being dispatched by the Dispatcher. I have tried to mock the class and the public method verifyOtherDetails(). Inside it I created an expectation that the dispatcher method had a literal value but it always passes. Any help would be appreciated.</p>

<p>See bottom for my attempted code thanks.</p>

<pre><code>abstract class KeyGen {

  private static void generateKey(String key, String username){
    if(Strings.isNullOrEmpty(key)){
      Dispatcher.dispatch(new WarningString(String.format(""The key is null or empty for user %s"", username)));
    }else{
      Dispatcher.dispatch(new InfoString(String.format(""The key is correct for user %s"", username)));
    }
  }

  public void verifyOtherDetails(String address, Map&lt;String, String&gt; favouriteFilms){
    String key ="""";
    String username ="""";
    generateKey(key, username);
  }
}

public class TestKeyGen {

  @Test
  public void testKey() {
    new MockUp&lt;KeyGen&gt;() {
      @Mock()
      public void verifyOtherDetails() {

        String key = ""sfjhlkjhfkjdhlsk"";
        final String username = ""Daniel"";
        new Expectations() {
          {
            Dispatcher.dispatch(new WarningString(String.format(""The key is null or empty for user %s"", username)));
          }
        };
      }
    };
  }
}
</code></pre>
",2,1670,2014-10-31 15:45,,2,2,how
43458023,Java unit test exception expected,<java><android><unit-testing><junit><mocking>,"<p>I have a problem, unit test should throw an exception</p>

<pre><code>public class MainActivityTest {
    NumberPicker warmUpSeconds;
    NumberPicker warmUpMinutes;
    NumberPicker restSeconds;
    NumberPicker restMinutes;
    NumberPicker coolDownSeconds;
    NumberPicker coolDownMinutes;
    NumberPicker workMinutes;
    NumberPicker workSeconds;
    NumberPicker rounds;
    @Test(expected = WrongTimeSetEx.class)
    public void testButtonOnClick() throws WrongTimeSetEx {
        MainActivity tested=mock(MainActivity.class);
        warmUpSeconds=mock(NumberPicker.class);
        warmUpMinutes=mock(NumberPicker.class);
        restSeconds=mock(NumberPicker.class);
        restMinutes=mock(NumberPicker.class);
        coolDownMinutes=mock(NumberPicker.class);
        coolDownSeconds=mock(NumberPicker.class);
        workMinutes=mock(NumberPicker.class);
        workSeconds=mock(NumberPicker.class);
        rounds=mock(NumberPicker.class);
        when(warmUpSeconds.getValue()).thenReturn(0);
        when(warmUpMinutes.getValue()).thenReturn(0);
        when(restMinutes.getValue()).thenReturn(0);
        when(restSeconds.getValue()).thenReturn(0);
        when(coolDownSeconds.getValue()).thenReturn(10);
        when(coolDownMinutes.getValue()).thenReturn(15);
        when(workMinutes.getValue()).thenReturn(10);
        when(workSeconds.getValue()).thenReturn(10);
        when(rounds.getValue()).thenReturn(0);
        tested.setTimes();
    }
}
</code></pre>

<p>and there is tested method</p>

<pre><code>public void setTimes() throws WrongTimeSetEx
    {
        warmUpTime = warmUpSeconds.getValue();
        warmUpTime += 60 * warmUpMinutes.getValue();
        restTime = restSeconds.getValue();
        restTime += 60 * restMinutes.getValue();
        coolDownTime = coolDownSeconds.getValue();
        coolDownTime += 60 * coolDownMinutes.getValue();
        workTime = workSeconds.getValue();
        workTime += 60 * workMinutes.getValue();
        roundsNumber = rounds.getValue();
        String communicate="""";
        if(restTime==0) //check if times are correct and make sense
            communicate+=""No time set for Rest Time!&lt;br&gt;\n"";
        if(workTime==0)
            communicate+=""No time set for Work Time!&lt;br&gt;\n"";
        if(roundsNumber==0)
            communicate+=""No rounds number is set!&lt;br&gt;\n"";
        if(!communicate.isEmpty())
            throw new WrongTimeSetEx(communicate);

    }
</code></pre>

<p>warmUpTimes and the rest of ""Times"" are package-private, the error I get during test is:</p>

<pre><code>java.lang.AssertionError: Expected exception: jablonskijakub.intervaltraining.exceptions.WrongTimeSetEx

    at org.junit.internal.runners.statements.ExpectException.evaluate(ExpectException.java:32)
    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:234)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:74)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)


Process finished with exit code -1
</code></pre>

<p>I'm not familiar with unit tests, I just read something about them and I can't find many examples. Sorry in advance for bad code. </p>

<p>@edit it's not even entering setTimes function
@edit2 Solved, I supposed my mocks don't make any sense, because I don't even pass them to function (function itself doesn't get any parameters), so I changed definition of setTimes and made it to get minutes and seconds in int and in test I passed only 0 as parameters. It worked, exception was thrown. </p>
",0,472,2017-04-17 19:17,,2,2,other
43970432,google mock - mock return value of a (free-standing) function called,<unit-testing><googletest><googlemock>,"<p>I have a function that I'm testing, <strong>f1()</strong>.</p>

<p><strong>f1()</strong> calls <strong>g1()</strong> which can return a few different values.</p>

<p>How do I mock <strong>g1()</strong> so I can iterate through the different values it returns in order to test the paths inside <strong>f1()</strong>?</p>

<pre><code>int f1()
{
    int res = g1();
    int ret = 0;
    switch(res):
    {
        case 0:
           // ret = something
        case 1:
           // ret = something else
        default:
           // ret = bad result
    }
    return ret;
}
</code></pre>
",0,110,2017-05-15 1:37,,1,0,how
75744664,"How do I refactor a code implementing 'using' key word , so that I can write unit tests for the method?",<unit-testing><nunit><fakeiteasy>,"<p>So, It seems I have arrived at an impasse. I have asked to write unit test for a legacy code base in .Net however I am frequently coming across code that is implementing the 'using' statement. This is problem because I am unable to mock the objects.</p>
<pre><code>using (var package1 = new ExcelPackage(sourceHierarchyFile))               
{                     
     ExcelWorksheet worksheet = package1.Workbook.Worksheets[0];                     
     var result = _industryBAL.SaveSourceHierarchy(industryId, userEnterpriseId, worksheet);
}
</code></pre>
<p>I am using the FakeItEasy mocking framework. But there is no provision for this type of code. Plus Wrapper methods would be one of the options. Basically guys I really need your help since not implementing these is causing an issue in the Code Coverage percentage.</p>
",0,51,2023-03-15 12:25,,1,1,how
30270838,Python mock testing process with retry logic. Creating different mock in each retry,<python><git><unit-testing><mocking>,"<p>Background:
I am trying to test my wrapper class for git. This class does things like retry git commands when they hang or fail (Our repos are huge). I can mock git with something like mockproc - <a href=""https://pypi.python.org/pypi/MockProc/"" rel=""nofollow"">https://pypi.python.org/pypi/MockProc/</a> </p>

<p>The problem I am facing is how to test retry logic, Ideally what I want is the ability to do this - </p>

<pre><code>@integrationtest('git')
def test_git_fetch(mock_proc):
  mock_proc.add_scripts(""sleep (60)"",
                        ""sleep (60)"",
                        ""exit (-1)"" )
  mygit.fetch()
  assert mock_proc.output_signal_count == 3
  assert mock_proc.get_output_signals[0] == -1
</code></pre>

<p>So in this case, when <code>mygit.fetch()</code> retries git 3 times, each time it runs the scripts defined in <code>add_scripts</code> function. With <code>mockproc</code> module I can mock any command for a given script, but I am stumped about how to achieve the retry testing such that each retry runs a different script. I would be grateful if someone can point to some module which can help me achieving this or some way to extend mockproc to add retry handling.</p>
",0,1467,2015-05-16 1:18,,1,0,what
75254082,How to mock and setup MudBlazor.IDialogService - dialogresult using Moq?,<moq><blazor-webassembly><mudblazor><bunit>,"<p>I am writing unit test for blazor webAssembly using Bunit, Xunit and Moq.</p>
<p>I want to mock MudBlazor.IDialogService</p>
<p>test file</p>
<pre><code>var mockDialogService = new Mock&lt;IDialogService&gt;();

var ctx = new Bunit.TestContext();
           ctx.Services.AddScoped&lt;IDialogService, DialogService&gt;();

var cut = new Participant(
           mockDialogService.Object
);
</code></pre>
<p>in .razor method</p>
<pre><code>var parameters = new DialogParameters();
parameters.Add(&quot;ContentText&quot;, &quot;Please assign coordinator before schedule a meeting.&quot;);
parameters.Add(&quot;ButtonText&quot;, &quot;Ok&quot;);
parameters.Add(&quot;Color&quot;, Color.Primary);

var options = new DialogOptions() { MaxWidth = MaxWidth.Medium };

var dialogresult = DialogService.Show&lt;ConfirmationDialog&gt;(&quot;Warning&quot;, parameters, options);  
// when debugging in test mode dialogresult is null how can I setup this?

var result = await dialogresult.Result;
</code></pre>
",2,791,2023-01-27 4:27,,1,0,how
13750737,Mocking ApiController which has Unit of work Dependency,<unit-testing><mocking><nunit><asp.net-web-api><simple-injector>,"<p>I have a <code>Apicontroller</code> Which has dependency on unit of work object. How to write a test case for mocking <code>ApiController</code> Which has dependency on unit of work implemented in <code>ApiController</code> constructor.</p>

<p>Here is the code:</p>

<p>ApiController: </p>

<pre class=""lang-cs prettyprint-override""><code>public class UserController : ApiController
{
    public IUoW UoW { get; set; }
    // GET api/user
    public UserController(IUoW uow)
    {
        UoW = uow;
    }

    public IEnumerable&lt;Users&gt; Get()
    {
        return UoW.Users.Getall();
    }     
}
</code></pre>

<p>The Test case : </p>

<pre class=""lang-cs prettyprint-override""><code>[TestMethod]
public void TestApiController()
{
    var userManager = new Mock&lt;IUoW&gt;();
    userManager.Setup(s =&gt; s.Users);

    var controller = new UserController(userManager.Object);
    var values = controller.Get();
    Assert.IsNotNull(values);
}
</code></pre>

<p>The Users Class which has been mentioned here in UoW.Users is </p>

<pre class=""lang-cs prettyprint-override""><code>public class UoW:IUoW,IDisposable
{
    private MvcWebApiContext DbContext { get; set; }
    protected IRepositoryProvider RepositoryProvider { get; set; }

    private IRepository&lt;T&gt; GetStandardRepo&lt;T&gt;() where T : class
    {
        return RepositoryProvider.GetRepositoryForEntityType&lt;T&gt;();
    }

    public IRepository&lt;Users&gt; Users
    {
        get { return GetStandardRepo&lt;Users&gt;(); }
    }
}
</code></pre>

<p>and the <code>Users</code> class itself is </p>

<pre class=""lang-cs prettyprint-override""><code>[Table(""UserProfile"")]
public class Users
{
    [Key]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public int UserId { get; set; }


    public string FirstName { get; set; }
    public string LastName { get; set; }
    public string UserName { get; set; }
    public string Password { get; set; }

    [DataType(DataType.PhoneNumber)]
    public long Mobile { get; set; }
}
</code></pre>

<p>When I am trying to debug the test case , the Test case shows the object <code>UoW.Users</code> is null in <code>UserController</code>. Its obvious its not initializing through <code>WebActivator</code> since global.asax isnt invoked here through mock. Now how to write a successful test scenario in this context so that the <code>WebApicontroller</code> returns me the users object with data ? </p>
",3,822,2012-12-06 19:08,,1,0,how
11638418,Mock private final static object with Mockito/PowerMockito,<java><mocking><mockito><powermock>,"<p>I'm currently trying to mock a private final static object within a class. It doesnt seem like my object is being mocked properly.  </p>

<p>Example:<br>
Code: In main class</p>

<pre><code>public class Main {

    private final static serviceA obj = new serviceA();

    public somemethod { return true; }

}
</code></pre>

<p>Mocked: In my test class I have </p>

<pre><code>Public class TestMain {

    private Main mainObj;
    private static  serviceA obj;

    @Before
    public void setupBeforeTest() {

        obj = Mockito.mock(serviceA.class);
        PowerMockito.whenNew(serviceA.class).withNoArguments().thenReturn(obj);
        mainObj= Mockito.spy(new Main());
    }
}
</code></pre>

<p>But obj doesnt return the values I specify when doing </p>

<pre><code>Mockito.when(obj.returnsFalseMethod()).thenReturn(false);
</code></pre>

<p>and will actually run the code for <code>obj.returnsFalseMethod()</code>. </p>

<p>Any advice would be helpful, also i cannot change any code in the Main class, thanks. </p>
",1,1355,2012-07-24 19:59,,1,0,how
67397293,Cannot mock Executors.newSingleThreadExecutor() and the real method is called,<java><multithreading><mocking><executorservice><powermock>,"<p>I'm trying to write unit tests for this method:</p>
<pre><code>public class ClassToTest{
....
    public void execute() {
        ExecutorService executor = Executors.newSingleThreadExecutor();
        executor.submit(this::launch);
    }
....
}
</code></pre>
<p>and I tried to mock Executors.newSingleThreadExecutor() to have an executorService that runs on the same thread as my tests, so that my assertions happens after the executions of the executorService and not before:</p>
<pre><code>@RunWith(PowerMockRunner.class)
@PrepareForTest({
        AnOtherClass.class,
        Executors.class
})
public class TestClass {

    @Before
    public void setUp() throws Exception {
        PowerMockito.mockStatic(Executors.class);
        ExecutorService executorService = mock(ExecutorService.class);
        implementAsDirectExecutor(executorService);
        PowerMockito.when(Executors.newSingleThreadExecutor()).thenReturn(executorService);
    }

    private void implementAsDirectExecutor(ExecutorService executor) {
        doAnswer(invocation -&gt; {
            Object[] args = invocation.getArguments();
            Runnable runnable = (Runnable)args[0];
            runnable.run();
            return null;
        }).when(executor).submit(any(Runnable.class));
    }
    
    @Test
    public void testMethod() {
       ....
       classToTest.execute();
       .... //assert something
    }
}
</code></pre>
<p><strong>Problem :</strong></p>
<p>Even with <code>PowerMockito.when(Executors.newSingleThreadExecutor()).thenReturn(executorService);</code>
the real method is called, and I don't get the mocked ExecutorService.</p>
",2,1108,2021-05-05 7:59,,2,2,other
3457453,Why use Mocks in Rspec?,<rspec><mocking><tdd><bdd>,"<p>I dont get why I should use Mocks in Rspec.</p>

<p>If I write Specs, shouldn't I write the actual code afterwards so that the tests would pass?</p>

<p>So why use Mocks and replace those actual classes?</p>
",3,472,2010-08-11 10:39,,1,0,why
53746280,"Moq, how to moq objects with private constructor?",<unit-testing><testing><mocking><moq>,"<p>I have this class hierarchy </p>

<pre><code>public class Order
{  
    private Client _client;
    public virtual Client { get =&gt; _client; }

    private OrderNumber _orderNumber;
    public virtual OrderNumber OrderNumber { get =&gt; _orderNumber; }

    private ShippingDetails _shippingDetails;
    public virtual ShippingDetails ShippingDetails { get =&gt; _shippingDetails; }

    private IList&lt;Product&gt; _products;
    protected internal virtual IEnumerable&lt;Product&gt; Products { get =&gt; _products; }


    public Order() { }

    public virtual void CreateDraftForClient(int id)
    {
         /// =&gt; business rule validation of value 

         _client= new Client(id);

          /// =&gt; event     
     }
}

public class Client
{
    private int _id;
    public virtual int Id { get =&gt; _id; }

    private Client() { }
    protected internal Client(int id) 
    {
        SetId(id);
    }

    private void SetId(int id)
    {
        _id = id; 
    }
}
</code></pre>

<p>And want to create a fully initialized mock of order</p>

<pre><code> clientMock = new Mock&lt;Client&gt;();
 clientMock.SetupGet(prop =&gt; prop.Client).Returns(1);

 orderMock = new Mock&lt;Order&gt;();
 orderMock.SetupGet(prop =&gt; prop.Client).Returns(orderMock.Object);
</code></pre>

<p>Exception :</p>

<pre><code>Message: System.AggregateException : One or more errors occurred. (Can not instantiate proxy of class: Client. Could not find a parameterless constructor.) (The following constructor parameters did not have matching fixture data: eRxTestSetup testSetup)
---- Castle.DynamicProxy.InvalidProxyConstructorArgumentsException : Can not instantiate proxy of class: Client. Could not find a parameterless constructor.
---- The following constructor parameters did not have matching fixture data: eRxTestSetup testSetup
</code></pre>

<p>Is there any way i can do so without having to change the structure of the Client? Or if not, what other options do I have ? </p>
",6,3081,2018-12-12 15:27,,1,7,what
50323580,How can I spy an inner function return value,<python><testing><mocking>,"<p>I'm doing some integration testing, and I wonder how to get some inner function's return value, I thought about using mocks , but there's only get parameters there</p>

<p>example:</p>

<pre><code>def foo():
    goo()

def goo():
    return 3

def test():
    with patch(goo) as goo_mock:
        foo()
        assert goo_mock.return_value == 3
</code></pre>
",0,3713,2018-05-14 5:30,,1,5,how
35414374,How Do I mock a DAO Layer using JMockit?,<java><unit-testing><junit><mocking><jmockit>,"<p>I am trying to mock a DAO layer Interface which looks something like this ...</p>

<pre><code>      public interface DummyDAO{

     public List&lt;VO&gt; getSearchCriteria(String Id, Integer version) throws Exception;

      }
</code></pre>

<p>In the implementation part, I run a query, and it fetches me a list of Value objects based on that query. How do I mock a List of VO's coming from a database. Is there a simple way to do this ?. I am trying to encourage my team to use Jmockit but I am still a newbie to this mocking tool. If you need more info please let me know.</p>

<p>Thanks</p>
",1,1996,2016-02-15 16:30,,2,0,how
41276912,Python mock.patch.object for properties,<python><unit-testing><mocking>,"<p>How a class property could be mocked? The mocked property doesn't work inside the class.</p>

<p>Code sample:</p>

<pre><code>class Box(object):
    def __init__(self, size):
        self._size = size

    @property
    def size(self):
        return self._size

    def volume(self):
        print(self.size)
        return self.size**3

def get_new_size():
    return 42


box = Box(13)
with mock.patch.object(Box, 'size', get_new_size):
    print(box.volume())
</code></pre>

<p>Returns:</p>

<pre><code>&lt;bound method Box.get_new_size of &lt;__main__.Box object at 0x10a8b2cd0&gt;&gt;
Traceback (most recent call last):
  File ""&lt;stdin&gt;"", line 2, in &lt;module&gt;
  File ""&lt;stdin&gt;"", line 9, in volume
TypeError: unsupported operand type(s) for ** or pow(): 'instancemethod' and 'int'
</code></pre>
",2,2673,2016-12-22 6:22,,1,0,how
30040346,Scala unit testing - stubbing a singleton,<scala><unit-testing><mocking>,"<p>I'm new to unit testing in Scala and I can't find a way to stub a function defined in a singleton object.</p>

<p>For example:</p>

<pre><code>class Profile {
  def getLatest
    ...
    Feed.getLatestEntries
    ...
}

object Feed {
  def getLatestEntries: Future[List[FeedEntry]] { /* Access some API*/ }
}
</code></pre>

<p>I'm trying to unit test the <code>getLatest</code> function defined in the Profile class.
Since I don't want to actually access an external API through the web in my unit tests I'm trying to stub the <code>Feed</code> object and its <code>getLatestEntries</code> function to return some predefined value.</p>

<p>I've looked into the ScalaMock, EasyMock and Mockito frameworks but could not find a way to stub a method of a singleton object. ScalaMock states</p>

<p>How come all the mocking frameworks do not offer this functionality? How can I do this? stub <code>Feed.getLatestEntries</code> ?</p>

<p>Thanks  </p>
",1,2794,2015-05-04 21:31,,1,0,how
4851573,PowerMock Mockito: how to mock all static methods?,<java><mocking><mockito><powermock>,"<p>Do we need to mock all static methods of a class when using PowerMock (with Mockito)? I mean, suppose we have:</p>

<pre><code>class MockMe {
   public static MockMe getInstance(){
              //return new Instance via complex process;
   }

   public static List&lt;X&gt; anotherStaticMethod(){
      // does xyz
   }
}
</code></pre>

<p>My question, if I need to mock getInstance method, is it necessary to mock ""anotherStaticMethod"" as well?</p>

<p>PowerMock version:1.3, Mockito version:1.8</p>
",5,9727,2011-01-31 13:46,,2,0,what
73231910,TargetParameterCountException when using event Raise with Moq,<c#><unit-testing><events><moq>,"<p>I have a class with following event:</p>
<pre><code>event Func&lt;ApplicationMessageProcessedEventArgs, Task&gt; ApplicationMessageProcessedAsync;
</code></pre>
<p>I would like to test the handler for an event, I am using Moq and have following code</p>
<pre><code>mqttClient.Mock.Raise(client =&gt; client.ApplicationMessageReceivedAsync += null, eventArg);
</code></pre>
<p>I am getting exception:</p>
<pre><code>System.Reflection.TargetParameterCountException: Parameter count mismatch.
    at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Delegate.DynamicInvokeImpl(Object[] args)
   at System.Delegate.DynamicInvoke(Object[] args)
   at Moq.Extensions.InvokePreserveStack(Delegate del, IReadOnlyList`1 args) in C:\projects\moq4\src\Moq\Extensions.cs:line 158
   at Moq.Mock.RaiseEvent(Mock mock, LambdaExpression expression, Stack`1 parts, Object[] arguments) in C:\projects\moq4\src\Moq\Mock.cs:line 745
   at Moq.Mock.RaiseEvent[T](Mock mock, Action`1 action, Object[] arguments) in C:\projects\moq4\src\Moq\Mock.cs:line 695
   at Moq.Mock`1.Raise(Action`1 eventExpression, EventArgs args) in C:\projects\moq4\src\Moq\Mock`1.cs:line 1366
   at MqttChannel.MqttChannelTest.MqttChannel_ProcessNewMessage() in C:\Development\Shared\OT.Test\MqttChannel\MqttChannelTest.cs:line 298
   at Microsoft.VisualStudio.TestPlatform.MSTestAdapter.PlatformServices.ThreadOperations.ExecuteWithAbortSafety(Action action)
</code></pre>
<p>Any idea how to solve this?</p>
",2,152,2022-08-04 7:29,,0,0,how
58847424,Faking an Extension Method in a 3rd Party Library,<unit-testing><fakeiteasy><lazycache>,"<p>Have I written an untestable method? As the library I am using has an important method which is implemented as an extension method, it seems like I am unable to fake it. And thus, unable to test my method.</p>

<p>First, I'll set out a truncated version of the method I want to test.
Then, I'll set out the attempt I have made to fake it using FakeItEasy.</p>

<p>The method uses caching and it is the call to the static method in the caching library <code>LazyCache</code> which I am struggling to fake:    </p>

<pre><code>public async Task&lt;BassRuleEditModel&gt; GetBassRuleEditModel(
    int facilityId,
    int criteriaId,
    int bassRuleId,
    BassRuleEditDto bassRuleEditDto)
{
    var url = _bassRuleService.GetServiceConnectionForFacility(facilityId).Url;
    var dto = bassRuleEditDto ?? _bassRuleService.GetBassRuleEditDto(bassRuleId);

    var bassRuleEditModel = new BassRuleEditModel
    {                
        ...
        LocationList = await GetLocations(url),
        ...
    };

    ...

    return bassRuleEditModel;
}


private async Task&lt;IEnumerable&lt;SelectListItem&gt;&gt; GetLocations(string url)
{
    var cacheKey = string.Concat(CacheKeys.Location, url);

    var selectList = await _appCache.GetOrAddAsync(cacheKey, async () =&gt;
        {
            return new SelectList(await _tasksAndPrioritiesService.ReturnLocationsAsync(url), NameProperty, NameProperty);
        }
    , CacheKeys.DefaultCacheLifetime);

    return selectList;
}
</code></pre>

<p>It is the <code>GetOrAddAsync</code> method which is an extension method.<br>
I just want the fake to return from the cache an empty <code>SelectList</code>.  </p>

<p>Note, the <code>AppCache</code> and all dependencies are injected using constructor injection.</p>

<p>The unit test which I have written, where I have tried to fake the <code>AppCache</code> is:</p>

<pre><code>[Fact]
public async Task Un_Named_Test_Does_Stuff()
{
    var url = ""http://somesite.com"";
    var referrer = new Uri(url);
    var facilityId = GetRandom.Id();
    var serviceConnectionDto = new ServiceConnectionDto
    {
        Url = ""http://google.com"" // this url does not matter
    };

    var cacheKey = string.Concat(CacheKeys.Location, serviceConnectionDto.Url);

    A.CallTo(() =&gt; _bassRuleService.GetServiceConnectionForFacility(facilityId)).Returns(serviceConnectionDto);
    A.CallTo(() =&gt; _urlHelper.Content(""~/ServiceSpec/ListView"")).Returns(url);
    A.CallTo(() =&gt; _appViewService.GetReferrer(url)).Returns(referrer);
    A.CallTo(() =&gt; _appCache.GetOrAddAsync(cacheKey, A&lt;Func&lt;Task&lt;SelectList&gt;&gt;&gt;.Ignored))
        .Returns(Task.FromResult(new SelectList(Enumerable.Empty&lt;SelectListItem&gt;().ToList())));

    var editModel = await
        _bassRuleService.GetBassRuleEditModel(GetRandom.Int32(),
            GetRandom.Int32(),
            GetRandom.Int32(),
            null
            );

    var path = editModel.Referrer.AbsolutePath;

    editModel.Referrer.AbsolutePath.ShouldBe(referrer.AbsolutePath);
}
</code></pre>

<p>I create the fakes in the constructor of the test (using xUnit):    </p>

<pre><code>public BassRuleQueryServiceTests()
{
    _currentUser = A.Fake&lt;ICurrentUser&gt;();
    _bassRuleService = A.Fake&lt;IBassRuleService&gt;();
    _tasksAndPrioritiesService = A.Fake&lt;ITasksAndPrioritiesService&gt;();
    _appViewService = A.Fake&lt;IAppViewService&gt;();
    _urlHelper = A.Fake&lt;IUrlHelper&gt;();
    _applicationDateTime = A.Fake&lt;IApplicationDateTime&gt;();
    _appCache = new MockCacheService();
}    
</code></pre>

<p>The error from running the test is:  </p>

<blockquote>
  <p>Message: 
  FakeItEasy.Configuration.FakeConfigurationException : 
   The current proxy generator can not intercept the method LazyCache.AppCacheExtenions.GetOrAddAsync<code>1[Microsoft.AspNetCore.Mvc.Rendering.SelectList](LazyCache.IAppCache cache, System.String key, 
   System.Func</code>1[System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.Rendering.SelectList]] addItemFactory) for the following reason:
    - Extension methods can not be intercepted since they're static.></p>
</blockquote>

<p>I get the fact that faking a static method is not on. I'm looking for solutions.   </p>

<p>Do I need to pressure library authors to not use extension methods? (Facetious question)</p>

<p>Cheers</p>
",2,1428,2019-11-14 0:00,,2,0,how
6575982,Runtime Generic Constraint Error with Moq and NUnit,<c#><unit-testing><nunit><moq>,"<p>I'm using NUnit and Moq to test a class which uses a generic WCF service client wrapper <a href=""http://geekswithblogs.net/mrsteve/archive/2011/06/30/generic-disposable-wcf-service-client.aspx"" rel=""nofollow"">I wrote</a>, and I've run into an error I can't figure out. I have the following interface:</p>

<pre><code>public interface IService
{
    void Call();
}
</code></pre>

<p>...implemented by the following service client:</p>

<pre><code>public class ServiceClient : ClientBase&lt;IService&gt;, IService
{
    public void Call()
    {
    }
}
</code></pre>

<p>...and wrapped by this class with the following generic constraints:</p>

<pre><code>public class ServiceClientWrapper&lt;TClient, TService&gt;
    where TClient : ClientBase&lt;TService&gt;, TService
    where TService : class
{
    public virtual TService CreateServiceClient()
    {
        return (TService)Activator.CreateInstance&lt;TClient&gt;();
    }
}
</code></pre>

<p>To make it testable I have a wrapper factory which I can mock. The wrapper factory interface is this:</p>

<pre><code>public interface IServiceClientWrapperFactory
{
    ServiceClientWrapper&lt;TClient, TService&gt;
        CreateServiceClientWrapper&lt;TClient, TService&gt;()
        where TClient : ClientBase&lt;TService&gt;, TService
        where TService : class;
}
</code></pre>

<p>I test this set up using this code:</p>

<pre><code>// A mock IService to return from my mock service wrapper:
var mockService = new Mock&lt;IService&gt;();

// A mock client wrapper to return from my mock wrapper factory:
var mockClientWrapper = 
    new Mock&lt;ServiceClientWrapper&lt;ServiceClient, IService&gt;&gt;();
mockClientWrapper
    .Setup(mcw =&gt; mcw.CreateServiceClient())
    .Returns(mockService.Object);

// A mock wrapper factory to inject into a client object:
var mockClientWrapperFactory = new Mock&lt;IServiceClientWrapperFactory&gt;();
mockClientWrapperFactory
    .Setup(mcwf =&gt; mcwf.CreateServiceClientWrapper&lt;ServiceClient, IService&gt;())
    .Returns(mockClientWrapper.Object);

// Get the mock client wrapper from the mock wrapper factory - boom!
mockClientWrapperFactory.Object
    .CreateServiceClientWrapper&lt;ServiceClient, IService&gt;();
</code></pre>

<p>The error is:</p>

<blockquote>
  <p>GenericArguments[0], 'TService', on
  'ServiceClientWrapper`2[TClient,TService]'
  violates the constraint of type
  parameter 'TClient'.</p>
</blockquote>

<p>The constraints are the same wherever I've stated them, it compiles and runs just fine, the error isn't thrown if I implement <code>IServiceClientWrapperFactory</code> and run it without Moq... any ideas?</p>
",1,600,2011-07-04 20:54,,1,2,how
4605495,Standards for Mock Objects,<c#><unit-testing><mocking><standards><isolation-frameworks>,"<p>In Roy Osherove's book [Unit Testing][1] book, he explains that a single unit test should contain between 0 and 1 mocks.  He suggests that if your test isn't asserting on the mock, then don't use a mock at all.  He further demonstrates how to use an isolation framework to produce stubs, which were created similarly to the mocks.  He places no suggested limit on the number of stubs created per test.</p>

<p>My question is this: can those recommendations be applied to all isolation frameworks (or all popular C# frameworks)?  In other words, is there a framework that can generate only mocks - not stubs?  Is there an isolation framework that does not distinguish mocks from stubs?</p>

<p>I'm just curious how easy Osherove's recommendations can be converted into coding standards.</p>

<p>[1]: <a href=""http://the"" rel=""nofollow"">http://the</a> system under test isn’t even being tested at all, instead data returned from mocks is what is being tested.</p>
",4,845,2011-01-05 15:02,,7,0,what
57596851,Can't create an instance of Attribute for a unit test,<java><unit-testing><reflection><constructor><mocking>,"<p>I am using an API that has a method that fetches some data from a remote server. The method usage is like this:</p>

<pre class=""lang-java prettyprint-override""><code>Attribute a = obj.getRemoteAttribute();
</code></pre>

<p>The <code>Attribute</code> class is like this</p>

<pre class=""lang-java prettyprint-override""><code>package a.package.outside.my.project;

import java.util.Date;

public class Attribute {
  private String id;
  private String name;
  private Date modifiedAt;
  private String metadata;

  Attribute(String id, String name, Date modifiedAt, String metadata) {
    this.id = id;
    this.name = name;
    this.modifiedAt = modifiedAt;
    this.metadata = metadata;
  }

  public String getId() {
    return id;
  }

  public Date getModifiedAt() {
    return modifiedAt;
  }

  public String getMetadata() {
    return metadata;
  }

  public String getName() {
    return name;
  }
}
</code></pre>

<p>I'm trying to create a unit test, mocking this method. I'm with <code>Mockito</code> for that. The test is something like this:</p>

<pre class=""lang-java prettyprint-override""><code>    @Test
    public void getAttributeShouldWork() throws Exception {
        Storage mockStorage = Mockito.mock(Storage.class);
        Attribute attribute = new Attribute(""fake"", ""fakeName"", new SimpleDateFormat(""dd/MM/yyyy"").parse(""21/08/2019""), ""fake Metadata""); 
        Mockito.when(storage.getAttribute()).thenReturn(attribute);
        // some other stuff
    }
</code></pre>

<p>However, the test does not compile - the constructor from <code>Attribute</code> (4º line) is package private and I can't use it in the test. I can't also extend the class - there is no default constructor. There is no factory to create <code>Attribute</code>, no accessible builder class. I also can't change <code>Attribute</code>'s code.</p>

<p>So, my question is - how can I create a fake object to use in this test with mocks? I don't want my unit tests depending on network or remote server's availability...</p>
",1,33,2019-08-21 17:51,,1,0,how
62800263,Facing error when running test cases using rspeck mock,<testing><rspec><mocking>,"<p>I was checking mock documentation and i had read somewhere that I can use &quot;...&quot; as a parameter, but when I try to use it I receive an error.
<a href=""https://i.sstatic.net/zxpKH.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>This is the code that's returning this error:</p>
<pre><code>require_relative '../../lib/random_joke'

describe JokeMessage do
  let(:bot) { double }
  let(:api) { double }
  let(:message) { double }

  it 'fires send_message' do
    expect(bot).to receive(:api).and_return(api)
    expect(api).to receive(:send_message).with(...)
    described_class.new(bot: bot, message: message).send_response
  end
end
</code></pre>
<p>Following the documentation &quot;...&quot; should work. I don't get what I'm doing wrong here.</p>
",0,14,2020-07-08 17:23,,0,3,what
43401535,Google Mock a Singleton C++ Class,<c++><unit-testing><singleton><googletest><googlemock>,"<p>I am having difficulties in figuring out how to mock the singleton class, and test it in another class. The goal is to verify that a method from a singleton class (Alarm) gets called from another class (CEvnts).</p>

<p>I was able to test this successfully by eliminating the singleton function, but since it is legacy code, I cannot change the structure.</p>

<p>Going through several articles and posts online, I have not found a clear answer. Does anyone know how to set up the Google Test for a singleton class? Any references or articles can be a big help.</p>

<p><strong>Singleton Class:</strong></p>

<pre><code>class Alarm
{
public:
    Alarm();
    virtual ~Alarm();

    // Singleton
    static Alarm* find(void)
    {
        if (!Alarm_Instance)
        {
            Alarm_Instance = new Alarm();
        }
        return Alarm_Instance;
    }

    // Member methods
    virtual ENUM_TYPE getType(ENUM_TYPE ENUM_ARG);

private:
    static Alarm* Alarm_Instance;
};

ENUM_TYPE Alarm::getType(ENUM_TYPE ENUM_ARG)
{
    return aMatch[ENUM_ARG].aType;
}
</code></pre>

<p><strong>Mock:</strong></p>

<pre><code>class Alarm_Mock : public Alarm
{
public:
    Alarm_Mock();
    virtual ~Alarm_Mock();

    MOCK_METHOD1(getType, ENUM_TYPE(ENUM_TYPE ENUMONE));
};
</code></pre>

<p><strong>Google Test:</strong></p>

<pre><code>class Ev_test: public testing::Test
{
    void SetUp()
    {
        mpsEV= new CEvents();
        ON_CALL(msMock, getType(_)).WillByDefault(Return(SOME_ENUM));
    }

    void TearDown()
    {
        delete mpsEV;
    }

protected:
    Alarm_Mock msMock;  
    CEvents* mpsEV;
};

TEST_F(Ev_test, testGetFunctions)
{   
    EXPECT_CALL(msMock, getAlarmType(_))
            .Times(1);

    mpsEV-&gt;aMethod(arg1, arg2, arg3, arg4);
}
</code></pre>

<p><strong>Class Method to Test - Does getType from Class Alarm get called?:</strong></p>

<pre><code>void CEvents::aMethod(arg1, arg2, arg3, arg4)
{
    Alarm::find()-&gt;getType(arg1);
}
</code></pre>
",2,7521,2017-04-13 20:53,,1,3,how
19817511,Python mock: mocking base class for inheritance,<python><unit-testing><inheritance><mocking>,"<p>I am testing a class that inherits from another one very complex, with DB connection methods and a mess of dependences. I would like to mock its base class so that I can nicely play with the method defined in the subclass, but in the moment I inherit from a mocked class, the object itself turns a mock and loses all its methods.</p>

<p><strong>How can I mock a superclass?</strong></p>

<p>More or less the situation can be summed up in this:</p>

<pre><code>import mock

ClassMock = mock.MagicMock()

class RealClass(ClassMock):

    def lol(self):
        print 'lol'

real = RealClass()
real.lol()  # Does not print lol, but returns another mock

print real # prints &lt;MagicMock id='...'&gt;
</code></pre>

<p>This is a simplified case. What is actually happening is that <code>RealClass</code> extends <code>AnotherClass</code>, but I managed to intercept the <code>AnotherClass</code> and replace it with a mock.</p>
",20,23960,2013-11-06 16:33,,4,2,how
12188002,python StringIO with urlli2.urlopen mocked with unittest,<python><unit-testing><mocking>,"<p>I have an interesting problem.  I am mocking urllib2.urlopen with the python  mock library as follows:</p>

<pre><code>def mock_url_open_conn_for_json_feed():
    json_str = """"""
        {""actions"":[{""causes"":[{""shortDescription"":""Started by user anonymous"",""userId"":null,""userName"":""anonymous""}]}],""artifacts"":[],""building"":false,""description"":null,""duration"":54,""estimatedDuration"":54,
        ""fullDisplayName"":""test3#1"",
        ""id"":""2012-08-24_14-10-34"",""keepLog"":false,""number"":1,""result"":""SUCCESS"",""timestamp"":1345842634000,
        ""url"":""http://localhost:8080/job/test3/1/"",""builtOn"":"""",""changeSet"":{""items"":[],""kind"":null},""culprits"":[]}
        """"""
    return StringIO(json_str)

def test_case_foo(self):
    io = mock_url_open_conn_for_json_feed()
    io.seek(0)
    mylib.urllib2.urlopen = Mock(return_value=io)
    test_obj.do_your_thing()

def test_case_foo_bar(self)
    io = mock_url_open_conn_for_json_feed()
    io.seek(0)
    mylib.urllib2.urlopen = Mock(return_value=io)
    test_obj.param = xyz
    test_obj.do_your_thing()

class ObjUnderTest():
    def do_your_thing(self):
        conn = urllib2.urlopen(url)
        simplejson.load(conn)
</code></pre>

<p>the first unit test ""test_case_foo"" runs without a problem.  But simplejson.load closes the StringIO, so ""test_case_foo_bar"" calls on do_your_thing() and it tries to simplejson.load the same StringIO object (even though I return the <em>constructor</em> of StringIO), and it's already been closed.  I get the following error:</p>

<pre><code>json = simplejson.load(conn)
 File ""/Users/sam/Library/Python/2.7/lib/python/site-packages/simplejson/__init__.py"", line 391, in load
return loads(fp.read(),
File ""/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/StringIO.py"", line 127, in read
_complain_ifclosed(self.closed)
File ""/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/StringIO.py"", line 40, in _complain_ifclosed
raise ValueError, ""I/O operation on closed file""
ValueError: I/O operation on closed file
</code></pre>

<p>I have two questions:</p>

<p>1) Why is the StringIO constructor not returning a new object?</p>

<p>2) Is there a work around for this? Or a better way to achieve what I'm trying to achieve?</p>
",0,561,2012-08-29 23:40,,0,5,what
817282,Unit testing with NSURLConnection,<objective-c><unit-testing><networking><mocking>,"<p>I want to test a piece of code that uses network (the <code>NSURLConnection</code> class, to be specific). The code (let’s call it <code>NetworkManager</code>) looks a bit like this:</p>

<pre><code>- (id) buildConnection
{
    // some more code and then:
    return [NSURLConnection …];
}

- (void) startNetworkSync
{
    id connection = [self buildConnection];
    //…
}
</code></pre>

<p>In the unit test I would like to get rid of the networking, ie. replace the <code>NSURLConnection</code> object by a mock. How do I do this?</p>

<p>I’ve tried creating a partial mock of the <code>NetworkManager</code> that would replace the <code>buildConnection</code> method by a stub. The problem is that partial mocks as done by <a href=""http://www.mulle-kybernetik.com/software/OCMock/"" rel=""nofollow noreferrer"">OCMock</a> only stub messages from the outside world – sending <code>buildConnection</code> from the <code>startNetworkSync</code> invokes the original method, not the stub.</p>

<p>I have also tried monkey-patching the <code>NetworkManager</code> class through a category. This works, I can easily override the <code>buildConnection</code> method by other code and replace the real <code>NSURLConnection</code> with a stub. The problem is that I found no simple way I could get the stubbed connection in the test – the connection is a private part of the <code>NetworkManager</code>.</p>

<p>Then I could subclass the <code>NetworkManager</code>, override the <code>buildConnection</code> method and add an instance variable plus an accessor for the created connection. This seems like a lot of code, though.</p>

<p>How would you solve this? I am looking for a solution that keeps the <code>NetworkManager</code> class design clean and does not require much magic nor much code in the test.</p>
",3,2047,2009-05-03 15:10,,3,0,how
3319125,JustMock vs. TypeMock vs. Other,<unit-testing><telerik><typemock><justmock>,"<p>With Telerik's JustMock product newly available, it has a lot of similarities to TypeMock, in the ability to mock concrete classes, not just abstract classes or interfaces.  I was just curious your opinion on one or both of the products.  What do you like or dislike?</p>

<p>Seems like JustMock might be shy on some of the features (TypeMock has been around for a while), but it had some good features.  Or if you have any others you feel are similar in features.</p>
",4,1164,2010-07-23 14:32,,1,1,what
21989277,Mockobject doesn't return instance of baseclass,<mocking><phpunit>,"<p>In this function below I want to mock a PDOStatement to give as a parameter to my function loadFromStatement.</p>

<pre><code>/**
 * @expectedException ObjectNotFoundException
 * @expectedExceptionMessage Unable to load site
 */
public function testLoadFromStatementThrowsObjectNotFoundException()
{
    $oMockedPDOStatement = $this-&gt;getMockBuilder('\PDOStatement')
                                -&gt;setMethods('rowCount')
                                -&gt;getMock();
    $oMockedPDOStatement-&gt;expects($this-&gt;any())-&gt;method('rowCount')-&gt;will($this-&gt;returnValue(0));
    SubSiteFactory::loadFromStatement($oMockedPDOStatement);
}
</code></pre>

<p>This is the signature of the function <code>loadFromStatement</code>:</p>

<pre><code>public static function loadFromStatement(\PDOStatement $oStatement, $aPrefixMap = NULL, $iIndex = NULL)
</code></pre>

<p>However the <code>oMockedPDOStatement</code> returns a <code>MockObject</code> which in turn generates an IllegalArgumentException.</p>

<p>Why can't <code>oMockedPDOStatement</code> return an instance off PDOStatement?</p>
",0,26,2014-02-24 13:31,,1,2,why
6272105,Robolectric Custom Shadow Object,<android><android-emulator><mocking><robolectric>,"<p>OOTB, <a href=""http://pivotal.github.com/robolectric/"" rel=""nofollow"">Robolectric</a> does not support Locales that well. Therefore, if your app is dependent on locales (which a lot of apps are if they are i18n'nd properly) this can be a royal pain. Long story short, I created my own ShadowFooGeocoder and ShadowFooAddress that allow me to simulate the locale I want. They're basically re-implementations of the existing shadows. </p>

<p>However, when I bind my class as such: bindShadowClass(ShadowFooGeocoder.class), this works great. At runtime, the correct shadow is returned. The problem is that I want to set up the simulations on this object and I'm not sure how. shadowOf(instance) where instance is an injected GeoCoder returns ShadowGeoCoder. I've tried working directly with the ShadowWrangler, but that also returns a ShadowGeocoder.</p>

<p>How can I get at my shadowed class that I've bound through the bindShadowClass(...) call so I can set my expectations (simulations)? </p>

<p>Note: This is a repost of the same question on the Robolectric group <a href=""https://groups.google.com/forum/#!topic/robolectric/i1BaUCI8e7U"" rel=""nofollow"">here</a>. I posted here because my success rate of getting anyone to answer questions on the group is fairly low. I'm hoping for a better result here. </p>
",2,877,2011-06-07 21:59,,1,0,how
66706811,.NET CORE unit test - mockRepo.Setup for repository always return NULL,<unit-testing><moq><xunit>,"<p>I have a simple method which is using an interface to call the repository, method is working just fine but whenever I try to mock <code>Login</code> method and return something fake, it just return null for me.</p>
<p>my method</p>
<pre class=""lang-c# prettyprint-override""><code>[HttpPost]
public ActionResult&lt;LoginResultViewModel&gt; Login([FromBody] UserViewModel model)
{
    var result = new LoginResultViewModel();
    var loginResult = _authRepository.Login(new User
    {
        Email = model.Email,
        Password = model.Password
    });
    result.IsLogin = loginResult.IsLogin;

    result.User = new UserViewModel
    {
        Email = loginResult.User.Email,
        Id = loginResult.User.Id,
    };

    return Ok(result);
}
</code></pre>
<p>And here is my test</p>
<pre class=""lang-c# prettyprint-override""><code>[Fact]
public void Login_Return_User_With_Token()
{
    // Arrange
    var _fakeLoginResult = new LoginResult
    {
        Token = &quot;Fake token&quot;,
        User = new User
        {
            Email = &quot;Fake email&quot;
        }
    };
    var fakeUser = new User { Email = &quot;Fake Email&quot;, Password = &quot;Fake Password&quot; };
    var fakeUserViewModel = new UserViewModel { Email = &quot;Fake Email&quot;, Password = &quot;Fake Password&quot; };
    
    var mockRepo = new Mock&lt;IAuthRepository&gt;();
    var controller = new AuthController(mockRepo.Object);
    mockRepo.Setup(repo =&gt; repo.Login(fakeUser)).Returns(_fakeLoginResult);
    

    // Act
    var methodResult = controller.Login(fakeUserViewModel);

    // Assert
    var testResult = methodResult.Result as OkObjectResult;
    Assert.Equal(_fakeLoginResult, testResult.Value);
}
</code></pre>
<p>Error catch in <code>result.IsLogin = loginResult.IsLogin;</code> because <code>loginResult</code> is null.</p>
",1,874,2021-03-19 10:54,,1,0,other
53145554,Still don't get how to mock an imported library - Python,<python><mocking><pytest>,"<p>I've looked around but still don't get how to mock a library used inside a function and assert that its been called properly.</p>

<pre><code>a.py

import win32clipboard

def copy():

    win32clipboard.OpenClipboard()
    win32clipboard.EmptyClipboard()
    win32clipboard.SetClipboardText('dummy')
    win32clipboard.CloseClipboard()
</code></pre>

<p>test_a.py</p>

<pre><code>import a
import pytest

def test_copy():

    # Mock win32clipboard somehow
    # Run a.copy()

    # assert mock win32clipboard.call_count == 4
</code></pre>
",1,65,2018-11-04 21:17,,1,0,how
31001609,How to generate mock automatically in google mock for c,<c++><unit-testing><googlemock>,"<p>I know there is a tool called gmock_gen.py in google mock that can be used to automatically generate mocks for c++ classes. Is there any similar tool that can generate mock for c functions, given a c source file, in which I want to mock those functions?</p>

<p>The background for my question:</p>

<p>I have lots of legacy c code (not c++) that need to be unit tested by google test and google mock. To test a function, I have to mock hundreds of functions that are called by some functions in the same c source file, even though they are not called by the function under unit test, otherwise, there will be ""undefined reference"" problems when linking.</p>
",4,3160,2015-06-23 11:31,,1,0,what
10077516,Why can't `Table` member implement underlying interface `ITable` member?,<linq-to-sql><inheritance><mocking><repository>,"<p>I'm experimenting with the following mockable repository pattern:</p>

<pre><code>public interface IEmployeeRepository
{
    ITable&lt;Employee&gt; Employees { get; }
}
</code></pre>

<p>This represents a container capable of returning an <code>ITable</code> of <code>Employee</code> objects.  I want to be able to create a mock object based off of the repository, as well as have my Linq-to-Sql <code>DataContext</code> implement the repository interface.  So I thought I could just use partial class to declare my <code>DataContext</code> type to implement <code>IEmployeeRepository</code>, as it already has an auto-generated member <code>Employees</code> of type <code>Table&lt;Employee&gt;</code>:</p>

<pre><code>public partial class MyDataContext : IEmployeeRepository { }
</code></pre>

<p>I get the following error message as a result:</p>

<blockquote>
  <p>'MyDataContext' does not implement interface member
  'IEmployeeRepository.Employees'. 'MyDataContext.Employees' cannot
  implement 'IEmployeeRepository.Employees' because it does not have the
  matching return type of 'System.Data.Linq.ITable'.</p>
</blockquote>

<p>But <code>Table&lt;Employee&gt;</code> inherits <code>ITable&lt;Employee&gt;</code>, so shouldn't it be a suitable return type to implement the interface?</p>
",1,148,2012-04-09 18:01,,1,1,why
78816207,Need help in creating mock classes with my c++ code,<c++><unit-testing><googletest><googlemock>,"<p>I am creating mock classes.
Code with real objects is running fine. So I believe that all virtual functions have been defined
I have following code :</p>
<pre><code>//db.h
#ifndef DB_H
#define DB_H

#include &quot;cursor.h&quot;
#include &lt;iostream&gt;
using namespace std ;

class Database {
protected:
    string dbname, uname, passwd ;
    Cursor *cursor ;
public :
    Database(string db, string u, string p) : dbname(db), uname(u), passwd(p) {}
    virtual ~Database() = default;
    virtual Cursor *getCursor() = 0;
} ; 

#endif // DB_H


//real_db.h
#ifndef REAL_DB_H
#define REAL_DB_H

#include &quot;db.h&quot;

class RealDatabase : public Database {
public :
    RealDatabase(string db, string u, string p) ;
    ~RealDatabase() { delete cursor ;}
    Cursor *getCursor() override ;
} ;

#endif

//real_db.cpp
#include &quot;real_db.h&quot;

RealDatabase::RealDatabase(string db, string u, string p) : Database(db, u, p) {
    cout&lt;&lt;&quot;THIS is REAL DB\n&quot; ;
    cout&lt;&lt;&quot;Creating connection for database-&gt;&quot;&lt;&lt;dbname&lt;&lt;&quot; for user-&gt;&quot;&lt;&lt;uname&lt;&lt;endl ;
    cursor = new Cursor ;
}
    
Cursor *RealDatabase::getCursor() {
    cout&lt;&lt;&quot;getting cursor for REAL db\n&quot; ;
    return cursor ;
} ;

//cursor.h
#ifndef CURSOR_H
#define CURSOR_H

#include &lt;iostream&gt;
using namespace std ;

class Cursor {
public :
    Cursor() {}
    virtual ~Cursor() {} //= default;
    virtual string executeQuery(string query) ;
} ;

#endif

//cursor.cpp
#include &quot;cursor.h&quot;

//Cursor::~Cursor() {}

string Cursor::executeQuery(string query) {
    return &quot;RES for ::: &quot; + query ;
}

//user_services.h
#ifndef USER_SERVICES_H
#define USER_SERVICES_H

#include &quot;real_db.h&quot;

class UserService {
    Database *db ;
    string query ;
public :
    void connectToDb(string dbname, string u, string p) ;
    void createQuery(string userInp) ;
    string getQueryResults() ;
} ;

#endif

//user_services.cpp
#include &quot;user_services.h&quot;

void UserService::connectToDb(string dbname, string u, string p) {
    db = new RealDatabase(dbname, u, p) ;
}

void UserService::createQuery(string userInp) {
    query = &quot;QUERY ::: &quot; + userInp ;
}

string UserService::getQueryResults() {
    Cursor *cursor = db-&gt;getCursor() ;
    return cursor-&gt;executeQuery(query) ;
}
</code></pre>
<p>I want to write unit test for <code>class UserService</code> using <code>gtest</code>
Also I want to create mock objects for <code>RealDatabase</code> and <code>Cursor</code></p>
<p>I am creating my mock_classes as follows :</p>
<pre><code>#include &quot;gmock/gmock.h&quot;
#include &quot;real_db.h&quot;
#include &quot;cursor.h&quot;

class MockCursor : public Cursor {
public:
    MOCK_METHOD(string, executeQuery, (string query), (override));
};

class MockRealDatabase : public RealDatabase {
public:
    MockRealDatabase(string db, string u, string p) : RealDatabase(db, u, p) {}

    MOCK_METHOD(Cursor*, getCursor, (), (override));
};
</code></pre>
<p>and my unit test file is as follows :</p>
<pre><code>// user_service_test.cpp
#include &quot;gtest/gtest.h&quot;
#include &quot;mock_classes.h&quot;
#include &quot;user_services.h&quot;

using ::testing::Return;

class TestableUserService : public UserService {
private:
    MockRealDatabase* mockDb;

protected:
    Database* createDatabase(const string&amp; dbname, const string&amp; uname, const string&amp; passwd) override {
        mockDb = new MockRealDatabase(dbname, uname, passwd);
        return mockDb;
    }

public:
    MockRealDatabase* getMockDb() { return mockDb;}
    ~TestableUserService() { delete mockDb; }
</code></pre>
<p>};</p>
<pre><code>class UserServiceTest : public ::testing::Test {
protected:
    TestableUserService userService;
    MockCursor* mockCursor;

    void SetUp() override { mockCursor = new MockCursor(); }
    void TearDown() override { delete mockCursor; }
};

TEST_F(UserServiceTest, TestGetQueryResults) {
    // Set expectations
    EXPECT_CALL(*(userService.getMockDb()), getCursor())
        .WillOnce(Return(mockCursor));
    EXPECT_CALL(*mockCursor, executeQuery(&quot;QUERY ::: test_query&quot;))
        .WillOnce(Return(&quot;RES for ::: QUERY ::: test_query&quot;));

    // Simulate UserService actions
    userService.connectToDb(&quot;test_db&quot;, &quot;test_user&quot;, &quot;test_pass&quot;);
    userService.createQuery(&quot;test_query&quot;);
    string result = userService.getQueryResults();

    // Verify the result
    EXPECT_EQ(result, &quot;RES for ::: QUERY ::: test_query&quot;);
}
</code></pre>
<p>My problem is that I am getting linker errors like :</p>
<ol>
<li>undefined reference to `vtable for Cursor'</li>
<li>undefined reference to `vtable for RealDatabase'</li>
</ol>
<p>and a few others related to above.</p>
<p>The test program with real objects executes properly.
So probably I am missing something while creating mock definitions.</p>
",-1,28,2024-07-31 12:05,,0,5,what
51795207,Mock Response.Header (Invalid setup on an extension method: x => x.Append),<c#><unit-testing><asp.net-core><moq><asp.net-core-webapi>,"<p>In my web api controller class, it returns a json result as well as a response header:</p>

<pre><code>[HttpGet]
[Route(""api/v1/{ID}"")]
public async Task&lt;IActionResult&gt; GetBookByID(string ID)
{

    var userID = Request.Headers[""UserID""]; //Getter from request header
    //...
    Response.Headers.Add(""Flag"", result.Key ? ""Y"" : ""N""); //Setter for Response Header
    return new ObjectResult(result);
}
</code></pre>

<p>In my unit test, I am trying to mock the header as follows:</p>

<pre><code> var testHeader = new Mock&lt;IHeaderDictionary&gt;();
 testHeader.SetupGet(x =&gt; x[""UserID""]).Returns(""1001""); 
 testHeader.Setup(x =&gt; x.Append(""Flag"",(StringValues) It.IsAny&lt;string&gt;()));
</code></pre>

<p>When I stepped through the break point, it breaks in this line:</p>

<pre><code>Response.Headers.Add(""Flag"", result.Key ? ""Y"" : ""N"");
</code></pre>

<p>and I got an error:</p>

<blockquote>
  <p>Message: System.NotSupportedException : Invalid setup on an extension
  method: x => x.Append(""Flag"", (StringValues)It.IsAny())</p>
</blockquote>

<p>Here is what I have tried, but none of them works:</p>

<pre><code>testResponseHeader.Setup(x =&gt; x.Append(""Flag"", It.IsAny&lt;StringValues&gt;()));

testResponseHeader.Setup(x =&gt; x.Append(""Flag"", ""Y""));

testResponseHeader.Setup(x =&gt; x.Append(""Flag"",(StringValues) ""Y""));
</code></pre>

<p>One thing I was curious is that, it is the response header code that broke the unit tests, not request header code:</p>

<pre><code>var userID = Request.Headers[""UserID""]; //This didn't break
</code></pre>

<p>And for the <code>IHeaderDictionary</code>, it was to <code>Represents HttpRequest and HttpResponse headers</code>. So my question would be why would HttpRequest work in this case, but not HttpResponse?</p>
",2,5995,2018-08-10 23:42,,1,4,why
41547730,Right way to return mocked object to tested method,<c#><unit-testing><moq>,"<p>I am writing unit test for my method: </p>

<pre><code>[HttpGet(""sani"")]
[RequireHttps]
public async Task&lt;IActionResult&gt; GetSuppliersAsync(double latitude, double longitude)
{
    if (ModelState.IsValid)
    {
        var supplierList = new List&lt;Supplier&gt;();
        var externalSupplierList = new List&lt;ExternalSupplier&gt;();
        try
        {
            await _supplierRepository.GetSuppliersAsync(supplierList);
            await _supplierRepository.GetExternalSupplierAsync(externalSupplierList);
        }
        catch (Exception)
        {
            return BadRequest(""db"");
        }

        var coll = new Dictionary&lt;dynamic, double&gt;();

        AddToCollectionInParallel(supplierList, latitude, longitude, coll);

        coll.OrderBy(x =&gt; x.Value);
        AddExternalToCollectionInParallel(externalSupplierList, latitude, longitude, coll);

        return new OkObjectResult(coll.Keys);
    }
    return BadRequest(""model"");
}
</code></pre>

<p>As you can see, I pass to <strong>GetSuppliersAsync()</strong> and <strong>GetExternalSuppliers()</strong> lists, that should be filled there. I do not return lists (so it would be something like: <code>var supplierList = _supplierRepository.GetSuppliersAsync();</code>) because it will be faster to pass object (list) and fill it in method then return list. 
So now I want to write an unit test. I am using Xunit for unit tests. My test method:</p>

<pre><code>[Xunit.Fact]
public async Task GetSuppliersAsyncDbTest()
{
    var list = new List&lt;Supplier&gt;();
    list.Add(new Supplier { SupplierId = ""ertre"", SupplierName = ""test"" });
    var extList = new List&lt;ExternalSupplier&gt;();
    extList.Add(new Models.ExternalSupplier { Id = 4});
    _mockRepo.Setup(repo =&gt; repo.GetSuppliersAsync(list)).Returns(Task.FromResult(list));
    _mockRepo.Setup(repo =&gt; repo.GetExternalSuppliersAsync(extList)).Returns(Task.FromResult(extList));
    var controller = new SupplierController(_mockRepo.Object);
    var result = await controller.GetSuppliersAsync(0.0, 0.0);
    var viewResult = Xunit.Assert.IsType&lt;OkObjectResult&gt;(result);
    Xunit.Assert.Equal(200, viewResult.StatusCode);
}
</code></pre>

<p>My problem is that during unit test, when I call line <code>await _supplierRepository.GetSuppliersAsync(supplierList);</code> it returns empty list, in despite of I've mocked to return list with one item inside. But when I change to <code>var supplierList = _supplierRepository.GetSuppliersAsync();</code> it returns one item, as expected.
Any ideas how can fix it, or I should just rewrite method to return values as List?</p>
",0,260,2017-01-09 12:06,,2,0,how
77507868,Controller ViewResult returns empty Model collection while doing Unit test using xUnit and Mock,<c#><unit-testing><asp.net-core><asp.net-core-mvc><moq>,"<p>When i debugging the controller index method it returns an empty model where I do mistake?
I am using Moq by Daniel Cazzulino and xUnit</p>
<p>Following is my controller code:</p>
<p><strong>TeacherController:</strong></p>
<pre><code>public class TeacherController : Controller
{
    private IClassScheduleUnitOfWork _classScheduleUnitOfWork { get; set; }

    public TeacherController(IClassScheduleUnitOfWork classScheduleUnitOfWork)
    {
        _classScheduleUnitOfWork = classScheduleUnitOfWork;
    }

    public ViewResult Index()
    {
        var options = new QueryOptions&lt;Teacher&gt; {
            OrderBy = t =&gt; t.LastName
        };
        IEnumerable&lt;Teacher&gt; list = _classScheduleUnitOfWork.teachers.List(options);
        return View(&quot;Index&quot;, list);
    }
}
</code></pre>
<p><strong>Here is my Unit test controller code:</strong></p>
<pre><code>public class TeacherControllerTests
{
    private readonly Mock&lt;IClassScheduleUnitOfWork&gt; _mock;

    public TeacherControllerTests()
    {
        _mock = new Mock&lt;IClassScheduleUnitOfWork&gt;();
    }

    [Fact]
    public void IndexActionMethod_ReturnsAViewResult()
    {
        var options = new QueryOptions&lt;Teacher&gt;
        {
            OrderBy = t =&gt; t.LastName
        };

        IEnumerable&lt;Teacher&gt; teachersList = GetAllTeachers();
 
        _mock.Setup(x =&gt;x.teachers.List(options))
            .Returns(teachersList);

        var controller = new TeacherController(_mock.Object);

        //act
        var result = controller.Index();
        var actualData = (IEnumerable&lt;Teacher&gt;?)result?.ViewData.Model;
        Assert.Equal(5, actualData?.Count());

   }

   private IEnumerable&lt;Teacher&gt; GetAllTeachers()
   {
        IEnumerable&lt;Teacher&gt; teachers = new List&lt;Teacher&gt;()
        {
           new Teacher { TeacherId = 1, FirstName = &quot;Anne&quot;, LastName = &quot;Sullivan&quot; },
           new Teacher { TeacherId = 2, FirstName = &quot;Maria&quot;, LastName = &quot;Montessori&quot; },
           new Teacher { TeacherId = 3, FirstName = &quot;Martin Luther&quot;, LastName = &quot;King&quot; },
           new Teacher { TeacherId = 4, FirstName = &quot;&quot;, LastName = &quot;Aristotle&quot; },
           new Teacher { TeacherId = 5, FirstName = &quot;Jaime&quot;, LastName = &quot;Escalante&quot; }
       };

       teachers = teachers.OrderBy(t =&gt; t.LastName).ToList();

       return teachers;
   }
}
</code></pre>
<p>Here is the definition of <strong>IClassScheduleUnitOfWork</strong></p>
<pre><code> public interface IClassScheduleUnitOfWork
 {
     public IRepository&lt;Teacher&gt; teachers { get; set; }
     public IRepository&lt;Class&gt; classes { get; set; }
     public IRepository&lt;Day&gt; days { get; set; }

     public void Save();

 }
</code></pre>
<p>Here is the IRepository code:</p>
<pre><code> public interface IRepository&lt;T&gt; where T : class
 {
     IEnumerable&lt;T&gt; List(QueryOptions&lt;T&gt; options);
     T? Get(int id);
     T? Get(QueryOptions&lt;T&gt; queryOptions);
     void Insert(T entity);
     void Update(T entity);
     void Delete(T entity);
     void Save();
 }
</code></pre>
",2,60,2023-11-18 16:52,,1,4,what
74445635,Why define constants in a metaclass?,<python><python-3.x><pytest><python-unittest><pytest-mock>,"<p>I've recently inherited some code.  It has a class called <code>SystemConfig</code> that acts as a grab-bag of constants that are used across the code base.  But while a few of the constants are defined directly on that class, a big pile of them are defined as properties of a metaclass of that class.  Like this:</p>
<pre><code>class _MetaSystemConfig(type):
    @property
    define CONSTANT_1(cls):
        return &quot;value 1&quot;

    @property
    define CONSTANT_2(cls):
        return &quot;value 2&quot;

    ...

class SystemConfig(metaclass=_MetaSystemConfig):
    CONSTANT_3 = &quot;value 3&quot;
    ...
</code></pre>
<p>The class is never instantiated; the values are just used as <code>SystemConfig.CONSTANT_1</code> and so on.</p>
<p>No-one who is still involved in the project seems to have any idea why it was done this way, except that someone seems to think the guy who did it thought it made unit testing easier.</p>
<p>Can someone explain to me any advantages of doing it this way and why I shouldn't just move all the properties to the <code>SystemConfig</code> class and delete the metaclass?</p>
<p>Edit to add:  The metaclass definition doesn't contain anything other than properties.</p>
",1,124,2022-11-15 12:28,,2,8,why
48226523,Django: How to write a mock/patch test for object creation?,<django><python-3.x><unit-testing><django-models><mocking>,"<p>I gave it a go, but I got the error message <code>AttributeError: Mock object has no attribute '_state'</code> for the code below. Not sure what I am doing wrong.</p>

<p>Do note at the end of the question I mention that I have tried using patches, without much more luck.</p>

<p><strong>Model.py</strong></p>

<pre><code>class Sale(models.Model):
    from_product = models.ForeignKey(Product)
    from_til = models.ForeignKey(Til)
    price = models.DecimalField(max_digits=8, decimal_places=2)
    create_date = models.DateTimeField('sale_date', editable=False)

    def __str__(self):
        return ""%s %s %s"" % (self.from_product, self.price, self.create_date)

    def save(self, *args, **kwargs):
        if not self.id:
            self.create_date = timezone.now()

        super(Sale, self).save(*args, **kwargs)
</code></pre>

<p><strong>test_models.py</strong></p>

<pre><code>class SaleModelTestCase(TestCase):
    @classmethod
    def setUpClass(cls):
        super(SaleModelTestCase, cls).setUpClass()
        cls.product = MagicMock(spec=Product)
        cls.til = MagicMock(spec=Til)
        cls.price = 2.34

    def test_create_sale(self):
        now = datetime.now()
        with mock.patch('django.utils.datetime_safe.datetime') as dt_mock:
            dt_mock.now().return_value = now
            new_sale = Sale.objects.create(from_product=self.product, from_til = self.til,
                                       price=self.price)
            self.assertTrue(isinstance(new_sale, Sale))
            self.assertEqual(new_sale.create_date, now)
</code></pre>

<p>I have been reading around and getting quite confused. If I understood correctly I can replace <code>Sale.objects</code> with <code>@patch('app.models.Sale.objects')</code>, which is placed above <code>class SaleModelTestCase(TestCase):</code> and include an extra mock_sale parameter. </p>

<p>I gave that a go too, but <code>self.assertTrue(isinstance(new_sale, Sale))</code> returns <code>False is not true</code>.</p>

<p>If anyone is about to show me where I am going wrong, I would be very grateful.</p>
",4,564,2018-01-12 12:41,,0,0,how
48682972,Mock a specific base class method,<c#><unit-testing><moq>,"<p>I have a scenario where I am confused how to mock the base class.</p>

<p>Code of my base class:</p>

<pre><code>public class ParentClass
{
   public virtual int Sum()
   {
      return 0;
   }
}
</code></pre>

<p>Code of my inherited class:</p>

<pre><code>public class ChildClass : ParentClass
{
    public override int Sum()
    {
        return 1 + base.Sum();
    }
}
</code></pre>

<p>Now I want to test inherited ChildClass.Sum() method but want to mock the ParentClass.Sum() method so that it returns some fixed value other than zero. </p>

<blockquote>
  <p>Unable to figure out what can be done to tell the mock object to mock the base class method but use actual implementation for the derived class method. </p>
</blockquote>

<p>This is test code I have written.</p>

<pre><code>[TestClass]
public class ChildClassTest
{
    private Mock&lt;ParentClass&gt; _parentClassMock;


    [TestInitialize]
    public void Init()
    {
      _parentClassMock = new Mock&lt;ParentClass&gt;();
    }

    [TestMethod]
    public void GivenChildClass_WhenAdding_ThenResultShouldSumUp()
    {
        //Arrange
        SetupParentClassSumMethod();
        ChildClass child = new ChildClass();

        //Act
        int result = child.Sum();

        //Assert
        Assert.AreEqual(21, result);   
     }

     private void SetupParentClassSumMethod()
     {
        _parentClassMock.Setup(x =&gt; x.Sum()).Returns(20);
     }
}
</code></pre>

<p>The Parent class is still returning value as 0.</p>

<p>Is what I want to do achievable or not?</p>
",3,3738,2018-02-08 10:16,,1,12,what
29059045,`answers` is not invoked when mocking a method with `call-by-name` parameter,<mocking><mockito><specs2><callbyname>,"<p>There is a class <code>InvokeLater</code>, the definition is like:</p>

<pre><code>class InvokeLater {
    def apply(f: =&gt; Any): Unit = { 
       // do something ...
       f 
       // do some other thing
    }
}
</code></pre>

<p>In specs test, I mocking it like:</p>

<pre><code>val invokeLater = mock[InvokeLater]
invokeLater.apply(any) answers { f =&gt; f:Unit }
</code></pre>

<p>But it seems the code inside <code>answers</code> never runs.</p>

<p>Does specs2 support this feature now?</p>
",0,132,2015-03-15 9:15,,1,2,what
19920762,How to avoid actual method call while running through junit test case,<java><junit><mocking>,"<p>I have the following scenario.</p>

<p>A class <code>MyClass</code> in which I have an API <code>myAPI()</code> whose contents are as follows:</p>

<pre><code>class MyClass {
    public void myAPI() {
        ...
        MyOtherClass myOtherObj = new MyOtherClass();
        String value = myOtherObj.decodeAndGetName();
        ...
    }
}
</code></pre>

<p>Here we have <code>MyOtherClass</code> which contains an API <code>decodeAndGetName()</code> which does some operation. It is in a different package and I can't modify its code.</p>

<p><strong>Requirement</strong></p>

<p>I need to write a junit test for the above <code>myAPI()</code>. Now I want to somehow mock the object of <code>MyOtherClass</code> and mock the return value of <code>decodeAndGetName()</code>.</p>

<p>I am not able to do this, as we have a <code>new MyOtherClass()</code> and as soon as the flow comes to this line, it creates a new instance and goes to the <code>decodeAndGetName()</code> API.
What I need is, some way to prevent the flow going to <code>decodeAndGetName()</code> and take a mock value instead when this call is encountered in the above code.</p>

<p>Please let me know a way to do this.</p>
",1,3086,2013-11-12 4:17,,1,0,how
74639501,how can mock variables and functions in a testcase?,<reactjs><jestjs><mocking><testcase><react-18>,"<p><strong>ParentComponent.js</strong></p>
<p>`</p>
<pre><code>import React, {useEffect} from 'react'
import store from '../store_path'
import loadable from '@loadable/component'
import useTokenHook from 'hook_path'

const ChildComponent = loadable(() =&gt; import('../childComponent_path'))

export const ParentComponent = () =&gt; {
    const token = useTokenHook()
    const [data, setData] = useState({})
    const [showChild, setShowChild] = useState(false)
    const lang = store(state =&gt; state.lang)
    const apiCall = store(state =&gt; state.apicall)

    const myFn = async() =&gt; {
        const res = await apiCall();
        setData(res)
        setShowChild(true)
    }

    useEffect(() =&gt; { myFn() }, [])

    return(
        &lt;&gt;
            {showChild ? &lt;ChildComponent data={data} /&gt; : 'No data found'}
        &lt;/&gt;
    )
}
</code></pre>
<p>`</p>
<p>I want to write JEST test cases for this component.
I am not able to mock store and values from store i.e. 'lang', 'apiCall'
I want to set some default value to 'lang' and i want to 'apiCall' to return specific value.
Also how can I set value 'setShowChild' to 'true' as initial value in testcase file</p>
<p>I tried few approaches to mock store like:</p>
<p>`</p>
<pre><code>jest.mock('../store_path', () =&gt; ({
    lang: 'en',
    apiCall: jest.fn(() =&gt; {return someValue })
}))
</code></pre>
<p>`</p>
<p>Here I am getting error as:
TypeError: (0, _store.default) is not a function</p>
<p>I also tried</p>
<p>`</p>
<pre><code>const appStore = jest.mock('../store_path', () =&gt; jest.fn())
appStore.mockImplementation(() =&gt; ({
    lang: 'en',
    apiCall: jest.fn(() =&gt; {return someValue })
</code></pre>
<p>}))
`</p>
<p>And Here I am getting error as:
appStore.mockImplementation is not a function</p>
",-1,131,2022-12-01 9:19,,1,0,how
78801189,Laravel 10 - how to mock static function in other class:,<php><laravel><mocking><phpunit><mockery>,"<p>in CommonHelper class:</p>
<pre><code>class CommonHelper {
    public static function getValue(string $category, string $name)
    {
       
    }
}
</code></pre>
<p>in MyService class:</p>
<pre><code> public function getContentOrtherService(): array
    {
...
         $this-&gt;lineUrl = CommonHelper::getValue(CommonHelper::LINE, CommonHelper::BASE_ENDPOINT);
   ...         
        } catch (Exception $e) {
            return $contents;
        }
    }
</code></pre>
<p>in MyServiceTest class:</p>
<pre><code>        $lineUrl = 'http:line/api';
        $this-&gt;commonHelper = Mockery::mock('alias:CommonHelper');
        $this-&gt;commonHelper-&gt;shouldReceive('getValue')
            -&gt;with(CommonHelper::LINE, CommonHelper::BASE_ENDPOINT)
            -&gt;andReturn($lineUrl);
</code></pre>
<p>But when I actually run it, I don't receive the value I mocked but return null</p>
<p>I want the mock to be correct with the parameters and values ​​I pass to the mock</p>
",2,61,2024-07-27 10:55,,2,7,how
25195090,PHPUnit Mocking class constant,<php><oop><mocking><phpunit>,"<p>I am testing a class that has a dependency injected. In my infinite cleverness, I scattered references to the dependency's class constant throughout my code.</p>

<p>(Sorry for the stupid example, wanted to deviate from foobar.)</p>

<pre><code>&lt;?php

class Book_PhoneBook extends Book {

    private $author;

    public function __construct(Author $author) {
        $this-&gt;author = $author;
    }

    public function getCover() {
        return $this-&gt;author-&gt;getTitle(Author::NAME_UNKNOWN) . ' - YELLOW PAGES';
    }
}


class Author {
    const NAME_UNKNOWN = 'anonymous';

    public function getTitle($nameStyle) {
        //do complicated calculation of author name
        if ($nameStyle == $this::NAME_UNKNOWN) {
            $name = ""Anonymous"";
        }

        //do further complicated calculations, modifying $name

        return $name;
    }
}
</code></pre>

<p>My problem is with unit tests! I'm getting ""Fatal error: Undefined class constant 'NAME_UNKNOWN'"" when I mock <code>Author</code>. The whole purpose of mocking is to avoid including the Author class file, so what is the correct way to handle that constant?</p>

<p>I could split <code>Author</code> into several objects or split the method that relies on the constant, but that would incur much repetition.</p>
",1,13620,2014-08-08 2:08,,2,4,what
78588536,Having trouble mocking response from Microsoft Graph Api 5.54.0,<c#><unit-testing><microsoft-graph-api><moq>,"<p>I have a service that is a wrapper around Microsoft Graph that I am trying to unit test.  I have my mocking working, but my mocked response always returns as null.</p>
<p>Here is the setup for my mocks:</p>
<pre><code> protected GraphServiceClient _graphClient;
 protected Mock&lt;HttpMessageHandler&gt; _messageHandlerMock;
 protected HttpClient _httpClientMock;
 protected Mock&lt;TokenCredential&gt; _tokenCredentialMock;

 protected const string _groupsApiUrl = &quot;https://graph.microsoft.com/v1.0/groups&quot;;
 protected const string _invitationsApiUrl = &quot;https://graph.microsoft.com/v1.0/invitations&quot;;

 [SetUp]
 public virtual void BeforeEachTest()
 {

     _httpClientFactoryMock = new Mock&lt;IHttpClientFactory&gt;();
     _messageHandlerMock = new Mock&lt;HttpMessageHandler&gt;();
     _tokenCredentialMock = new Mock&lt;TokenCredential&gt;();

     _httpClientMock = new HttpClient(_messageHandlerMock.Object);

     _httpClientFactoryMock.Setup(_ =&gt; _.CreateClient(It.IsAny&lt;string&gt;()))
         .Returns(_httpClientMock);

     _tokenCredentialMock.Setup(_ =&gt; _.GetTokenAsync(It.IsAny&lt;TokenRequestContext&gt;(), It.IsAny&lt;CancellationToken&gt;()))
         .ReturnsAsync(new AccessToken(Guid.NewGuid().ToString(), DateTimeOffset.UtcNow.AddYears(1)));

     _graphClient = new GraphServiceClient(_httpClientMock, _tokenCredentialMock.Object);

 }
</code></pre>
<p>And what I use to configure Moq to intercept http requests</p>
<pre><code>protected string? ConfigureInvitationsMock()
{
    var invitationUrl = $&quot;https://test.com/invitation/{Guid.NewGuid()}&quot;;

    var invitation = new Invitation()
    {
        Id = Guid.NewGuid().ToString(),
        InviteRedeemUrl = invitationUrl
    };

    _messageHandlerMock.Protected()
        .Setup&lt;Task&lt;HttpResponseMessage&gt;&gt;(&quot;SendAsync&quot;,
            ItExpr.Is&lt;HttpRequestMessage&gt;(x =&gt; x.Method == HttpMethod.Post
                                               &amp;&amp; x.RequestUri.AbsoluteUri.StartsWith(_invitationsApiUrl)),
            ItExpr.IsAny&lt;CancellationToken&gt;())
        .ReturnsAsync(new HttpResponseMessage
        {
            StatusCode = HttpStatusCode.OK,
            Content = new ByteArrayContent(Encoding.UTF8.GetBytes(JsonSerializer.Serialize(invitation)))
        });

    return invitationUrl;
}
</code></pre>
<p>And my simple test that makes sure my method returns the invitation url when it's not null from Graph</p>
<pre><code>[Test]
public async Task GetInvitationUriAsync_ReturnsInvitationUrl()
{
    var expected = ConfigureInvitationsMock();

    var recipient = new InvitationRecipientDto()
    {
        DisplayName = _displayName,
        EmailAddress = _email,
        RedirectAfterRegistration = _redirectUri,
        EntraTenantId = _entraTenantId
    };

    var result = await _target.GetInvitationUriAsync(recipient);

    result.ShouldNotBeNull();
    result.AbsoluteUri.ShouldBe(expected);
}
</code></pre>
<p><code>result.ShouldNotBeNull();</code> is always failing because the <code>Uri</code> thati s returned is always null.</p>
<p>The response from the Microsoft Graph Client is always null in my unit tests, even though you can clearly see in the mock I am returning a serialized <code>Invitation</code></p>
<p>I'm am sure my mock is correctly defined because of I comment it out, Microsoft Graph errors saying there was no response.  Alsom f I change the Status Code on the response to <code>InternalServerError</code>, Graph throws an exception about getting an error from the service.  So the problem lies exclusively in the format of the response and how graph is just returning null for some reason.</p>
",0,73,2024-06-06 18:46,,0,4,why
5292440,NoClassDefFoundError when using Powermock,<java><unit-testing><junit><easymock><powermock>,"<p>I'm running a <code>junit</code> test case using the <code>PowerMock</code> test runner.
I'm using the following command line to execute it:</p>

<pre><code>java -cp .:junit-4.9b2.jar:easymock-3.0.jar:powermock-easymock-1.4.8-full.jar org.junit.runner.JUnitCore SampleTest
</code></pre>

<p>When doing so I am receiving this error:</p>

<pre><code>initializationError(SampleTest)
java.lang.NoClassDefFoundError: org/junit/internal/runners/TestClassRunner
...
</code></pre>

<p>How can I fix it?</p>
",40,52738,2011-03-13 21:14,,5,0,how
76663156,How to match anonymous object in mockk,<kotlin><unit-testing><mockk>,"<p>I am trying to verify a <code>logger::error</code> method called like this:</p>
<pre><code>logger.error(MY_ENUM_VALUE, object {
    val field0 = field0Value
    val field1 = field1Value
})
</code></pre>
<p>I wonder how to match the anonymous object, something (type accurate) that would look around something like this:</p>
<pre class=""lang-kotlin prettyprint-override""><code>verify {
    loggerMock.error(MY_ENUM_VALUE, match { it.field0 = theField0Value &amp;&amp; it.field1 = theField1Value})
}
</code></pre>
<hr />
<p><strong>Edit: degraded version fixed, see comment below</strong></p>
<p>I tried this degraded version:</p>
<pre class=""lang-kotlin prettyprint-override""><code>verify {
    loggerMock.error(MY_ENUM_VALUE, any())
}
</code></pre>
<p>But I get a weird error code:</p>
<blockquote>
<p>Verification failed: call 1 of 1: DblLogger(loggerMock#2).error(eq(MY_ENUM_VALUE), any())) was not called.
Calls to same mock:</p>
<ol>
<li>DblLogger(loggerMock#2).error(MY_ENUM_VALUE, my.package.myClass$myFunction$memoryAddress&gt;)</li>
</ol>
</blockquote>
<p>To me, <code>DblLogger(loggerMock#2).error(eq(MY_ENUM_VALUE), any()))</code> should've matched <code>DblLogger(loggerMock#2).error(MY_ENUM_VALUE, my.package.myClass$myFunction$memoryAddress&gt;)</code></p>
",0,515,2023-07-11 14:42,,1,2,how
29266624,Mocking the $injector Service,<angularjs><unit-testing><dependency-injection><mocking><jasmine>,"<p>I have a situation where I want to add services <em>inside</em> a module, as I may not know what they are beforehand. From looking at the docs, it seems that the only way to do this (without global scope) is with Angular's <code>$injector</code> service. However, it seems that this service is not mockable, which makes sense as it is the way Angular itself gets the dependencies, which are still important even in testing.</p>

<p>Essentially, I am emulating <code>NodeJS</code>'s <code>passport</code> module. I want to have something like a keychain, where you add or remove an account during runtime. So far, I have this:</p>

<pre><code>angular.module('myModule').factory('accounts', function($injector) {
  return {
    add: function(name) {
      if(!$injector.has(name) {
        $log.warn('No Angular module with the name ' + name + ' exists. Aborting...');
        return false;
      }
      else {
        this.accounts[name] = $injector.get(name);
        return true;
      }
    },
    accounts: []
  };
});
</code></pre>

<p>However, whenever I try to mock the <code>$injector</code> function in <code>Jasmine</code>, like this:</p>

<pre><code>describe('accounts', {
  var $injector;
  var accounts;

  beforeEach(function() {
    $injector = {
      has: jasmine.createSpy(),
      get: jasmine.createSpy()
    };

    module(function($provide) {
      $provide.value('$injector', $injector);
    });

    module('ngMock');
    module('myModule');

    inject(function(_accounts_) {
      accounts = _accounts_;
    });
  });

  describe('get an account', function() {
    describe('that exists', function() {
      beforeEach(function() {
        $injector.has.and.returnValue(true);
      });

      it('should return true', function() {
        expect(accounts.add('testAccount')).toEqual(true);
      });
    });

    describe('that doesn't exist', function() {
      beforeEach(function() {
        $injector.has.and.returnValue(false);
      });

      it('should return true', function() {
        expect(accounts.add('testAccount')).toEqual(false);
      });
    });
  });
});
</code></pre>

<p>the 2nd test fails because the <code>accounts</code> service is calling the actual <code>$injector</code> service, and not the mock. I can confirm this by calling <code>$injector.get</code> or <code>$injector.has</code> during the test or in the service itself.</p>

<p>What should I do? There seems to be no other way to add new dependencies, but this is exactly what I want to do. Am I wrong? Is there in fact another way to do this, without using <code>$injector</code>?</p>

<p>Assuming I am right, and there is no other way to do what I want to do, how should I go about testing this function? I could just trust that the <code>$injector</code> service does its job, but I still want to mock it for the tests. I could manually add the dependencies during the <code>inject</code> function, but that doesn't replicate the actual behavior. I could just not test the function, but then I wouldn't be testing the function.</p>
",4,341,2015-03-25 21:12,,0,0,what
14856256,Creating and supplying mock objects as arguments,<unit-testing><interface><mocking>,"<p>I'm trying to restructure my project so that I'm developing to an interface to eventually
be able to create mock objects for testing and I'm having trouble 
implementing/understanding some of the concepts. I have an <code>IProducts</code> interface which
is implemented by <code>Products</code>. But obviously I'd like to be able to create a mock Products 
object. </p>

<p>How do I get it to depend on the interface and not the implementation?</p>

<pre><code>public void AddNewProduct()
        {
            IDatabase db = new Database();
            IProducts products = new Products();
            products.addProductsToCache();
        }
</code></pre>

<p>i.e. How would I specify this code to use the <code>MockDatabase</code> object instead.</p>
",1,44,2013-02-13 14:51,,2,1,how
64752756,Is there a way to mock isinstance() of an object in python?,<python><inheritance><mocking><invoke><isinstance>,"<p>I want to write a mock for a library object without inheriting from it in order to properly test, however without having to stub all non used functions of the original object.</p>
<p>To be specific I want to write a ContextMock for the invoke library.</p>
<pre><code>class ContextMock:
    ...
</code></pre>
<p>The main problem here is that I therefor call a @task function which then calls my code that I want to test. However the @task decorator checks whether the context object is an instance of a Context, like this:</p>
<pre><code>def __call__(self, *args, **kwargs):
    # Guard against calling tasks with no context.
    if not isinstance(args[0], Context):
        err = &quot;Task expected a Context as its first arg, got {} instead!&quot;
        # TODO: raise a custom subclass _of_ TypeError instead
        raise TypeError(err.format(type(args[0])))
</code></pre>
<p>Therefor my question is, can I somehow change the isinstance function of my ContextMock, or make it look like its an instance of Context without inheriting its attributes?
Or would it be possible to somehow mock the isinstance function?
How does the default implementation of <strong>instancecheck</strong> work? Is there perhabs a baseclass attribute that can be overwritten?</p>
<p>I already tried to provide a custom metaclass with an custom <strong>instancecheck</strong> function, which of course does not work as the <strong>instancecheck</strong> of the Context is called, right?</p>
<p>Also Note that I'm well aware that any hacky solution should not belong in production code, and is only used for testing.</p>
<p>Edit:
To add a generic example of what I want to archive:</p>
<pre class=""lang-py prettyprint-override""><code>class Context:
    pass

class ContextMock: 
    pass

mock = ContextMock

... do magic with mock

assert isinstance(mock, Context)
</code></pre>
",4,1058,2020-11-09 13:38,,1,1,what
68221572,How to mock Eloquent Model in Laravel 8 when calling a route in PHPUnit,<php><laravel><eloquent><phpunit><mockery>,"<p>I'm trying to mock a method in the Model so that I am able to test the controller api endpoint with different scenarios.</p>
<p>I am currently using Laravel 8 with PhpUnit and Mockery package.
In the route I am using Route model binding.</p>
<p><strong>api.php</strong></p>
<pre><code>Route::get('/api/{project}', [ProjectController::class, 'show']);
</code></pre>
<p><strong>ProjectController.php</strong></p>
<pre><code>class ProjectController extends Controller 
{
    public function show(Project $project)
    {
        $state = $project-&gt;getState();
        
        return response()-&gt;json($state);
    }
}
</code></pre>
<p><strong>ProjectControllerTest.php</strong></p>
<pre><code>class ProjectControllerTest extends TestCase
{
    /**
     * @test
     * @group ProjectController
     */
    public function shouldReturn200ForValidProjectGuid()
    {
        $project = Project::factory()-&gt;create();

        $mock = Mockery::mock(Project::class);

        // I have also tried this, see error below
        // $mock = Mockery::mock(Project::class)-&gt;makePartial();

        $this-&gt;app-&gt;instance(Project::class, $mock);

        $mock-&gt;shouldReceive('getState')-&gt;andReturn('New South Wales');

        $response = $this-&gt;getJson(&quot;/api/{$project-&gt;guid}&quot;);
        
        $response-&gt;assertStatus(200)
            -&gt;assertJson([
                'data' =&gt; 'New South Wales'
            ]);
     }
}

</code></pre>
<p>I am currently getting this error</p>
<pre><code>Received Mockery_0_App_Models_Project::resolveRouteBinding(), but no expectations were specified Exception caught at [/usr/src/app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(34) : eval()'d code@924
</code></pre>
<p>I have tried other options like makePartial() instead, however it results in the following error as well</p>
<pre><code>Received Mockery_0_App_Models_Project::__construct(), but no expectations were specified Exception caught at [/usr/src/app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(34) : eval()'d code@924
</code></pre>
<p>Any help would be much appreciated, thank you</p>
",0,5464,2021-07-02 7:56,,2,4,how
76310301,How to unit test an EF transaction that involves multiple repositories,<c#><sql-server><asp.net-web-api><entity-framework-core><mocking>,"<p>i have this code that starts a transaction and call two different repositories</p>
<pre><code>            using var transaction = await context.Database.BeginTransactionAsync();
            try
            {
                var data1 = await callRepository1();
                var data2 = await callRepository2(); 
                await transaction.CommitAsync();
                
            }
        
            catch (Exception e)
            {
                await transaction.RollbackAsync();
                throw;
            }
</code></pre>
<p>i can easily mock &quot;callRepository1&quot; and &quot;callRepository2&quot;
but how i can mock the context so i can use &quot;BeginTransactionAsync&quot; &quot;CommitAsync&quot; and &quot;RollbackAsync&quot;</p>
",0,169,2023-05-22 22:44,,1,0,how
64685323,Usage of Spock Mocks in the same way that was done with Mockito,<java><groovy><mocking><mockito><spock>,"<p>I just have an Object that I mock with Mockito, and I need to do the equivalent with Spock.
How do you guys recommend to do it?</p>
<p>This is the way that I did with Mockito</p>
<pre><code>        XptoOutputBoundary xpto;
        doAnswer({ invocation -&gt;
            xpto = invocation.getArgumentAt(1, OutputBoundary.class)
            xpto.response.response.abcd01 = abcd01
            xpto.response.response.abcd02 = abcd02
            xpto.response.response.abcd03 = abcd03
            xpto.response.response.abcd04 = null
            xpto.response.response.abcd05 = null
            xpto.response.response.abcd06 = abcd06
            xpto.response.response.abcd07 = abcd07
            return null
        }).when(service).execute(any(), any())
</code></pre>
<p>How can I mock in the same way, but using Spock?</p>
<p><strong>UPDATE</strong></p>
<p>Hello!</p>
<p>I've tried one of the suggestions, but it still not work... the &quot;xpto&quot; object keeps getting null using spock</p>
<p>Here is how is the code now:</p>
<pre><code>        given: 'i have a valid object'
        AbcdObjectXptoResponse xptoResponse = Fixture.from(AbcdObjectXptoResponse.class).gimme(&quot;valid&quot;)
        AbcdObjectRequest request = Fixture.from(AbcdObjectRequest.class).gimme(&quot;valid&quot;)
        XptoOutputBoundary xpto;

        repository.execute(_ as XptoOutputBoundary, _) &gt;&gt; { args -&gt;
            xpto = args[0] 
            xpto.response.response.abcd01 = abcd01
            xpto.response.response.abcd02 = abcd02
            xpto.response.response.abcd03 = abcd03
            xpto.response.response.abcd04 = null
            xpto.response.response.abcd05 = null
            xpto.response.response.abcd06 = abcd06
            xpto.response.response.abcd07 = abcd07
        }


        when: 'the request is performed'
        def response = service.getAbcdObjectRequest(request)
</code></pre>
",0,235,2020-11-04 17:57,,1,6,how
69132990,"MockK - Are multiple calls to verify() with different ""exact ="" in the same test supported?",<android><unit-testing><kotlin><mockk><mockk-verify>,"<p>I have strange behaviour. I have a unit-test that does some stuff and then performs the following verification statements:</p>
<pre><code>    verify(exactly = 2) {
        observer.onThingChanged()
    }
    verify(exactly = 1) {
        b.addThing(thing)
    }
    verify(exactly = 0) {
        observer.onAnotherThingChanged(any())
    }
</code></pre>
<p>This test fails on the <strong>second</strong> call to <code>verify()</code> with the following error:</p>
<pre><code>java.lang.AssertionError: Verification failed: call 1 of 1: Observer(#2).onThingChanged()).
2 matching calls found, but needs at least 1 and at most 1 calls
Calls:
1) Observer(#2).onThingChanged()
2) Observer(#2).onThingChanged()
</code></pre>
<p>This makes no sense. It seems to be using the &quot;exactly&quot; parameter from the <strong>second</strong> <code>verify()</code> call, but the code block from the <strong>first</strong> <code>verify()</code> call.</p>
<p>Am I missing something? Are multiple calls to <code>verify()</code> with different <code>exactly=</code> arguments supported?</p>
",1,3826,2021-09-10 13:31,,0,4,what
31993439,Can Mockito verify an argument has certain properties/fields?,<java><unit-testing><mocking><mockito>,"<p>Say I am mocking this class <code>Foo</code></p>

<pre><code>class Foo {
  public void doThing(Bar bar) {
    // ...
  }
}
</code></pre>

<p>and this is <code>Bar</code></p>

<pre><code>class Bar {
  private int i;
  public int getI() { return i; }
  public void setI(int i) { this.i = i; }
}
</code></pre>

<p>I know I can use Mockito's verify functionality to see if <code>Foo#doThing(Bar)</code> was called on the mock with a specific instance of <code>Bar</code> or any  <code>Bar</code> with <code>Mockito.any(Bar.class)</code>, <strong>but is there some way to ensure it was called by any <code>Bar</code> but with a specific value for <code>i</code> or <code>Bar#getI()</code>?</strong></p>

<p>What I know is possible:</p>

<pre><code>Foo mockedFoo = mock(Foo.class);
Bar someBar = mock(Bar.class);
...
verify(mockedFoo).doThing(someBar);
verify(mockedFoo).doThing(any(Bar.class);
</code></pre>

<p>What I want to know is if there is a way to verify that a <code>Bar</code> with particular things true about it was passed as an argument.</p>
",112,87904,2015-08-13 16:13,,5,0,what
69189944,How to check if hidl_vec is empty?,<android><c++><googlemock><hal><hidl>,"<p>In Android, we can use <a href=""https://source.android.com/devices/architecture/hidl-cpp/types#vect"" rel=""nofollow noreferrer"">HIDL data types</a> in lieu of normal C++ data types. Their functionality remains mostly the same, and this proxy code is for behind-the-scenes serialization and IPC which HIDL takes care of.</p>
<p>Now when I try to check if a HIDL vector is empty, I get the error that <code>empty</code> is not a member of <code>hidl_vec</code>. How then can I check this? Some other functions that work on a normal vector work with <code>hidl_vec</code> such as <code>foo.size()</code>, <code>foo.begin()</code>, <code>foo.end()</code> but I prefer to not use the size check for <a href=""https://stackoverflow.com/questions/3863282/checking-whether-a-vector-is-empty"">this</a> reason.</p>
<pre><code>#include &quot;gmock/gmock.h&quot;
using ::android::hardware::hidl_vec;
using ::android::hardware::hidl_string;

hidl_vec&lt;hidl_string&gt; foo;

ASSERT_FALSE(foo.empty());
</code></pre>
<p>Throws the error:</p>
<blockquote>
<p>error: no member named 'empty' in 'android::hardware::hidl_vecandroid::hardware::hidl_string'
ASSERT_FALSE(foo.empty());</p>
</blockquote>
",0,689,2021-09-15 8:52,,0,4,how
50028558,"In in moq unit test how to fix ""Object reference not set to an instance of an object""",<unit-testing><model-view-controller><boolean><nunit><moq>,"<p>Okay I am trying to create a test that checks that my badge method actually added a badge to PlayersBadge. It works but I don't know how to test properly. The main issue is my understanding of moq.</p>

<p>This is my method it takes in a PlayerID, BadgeID, and GameID.</p>

<pre><code> public bool Badge(int pID, int bID, int gID = 0)
    {
        var list = EliminationDbContext.PlayerBadges.Where(x =&gt; x.Badge.BadgeID.Equals(bID) &amp;&amp; x.Player.PlayerID.Equals(pID));
        if (list.Any() != true)
        {
            PlayerBadge b = new PlayerBadge { PlayerID = pID, BadgeID = bID, DateEarned = DateTime.Today, GameID = gID };
            _RepoManager.PlayerBadges.Add(b);
            _RepoManager.SaveDb();
            return true;
        }
        return false;
    }
</code></pre>

<p>Currently I am getting this error ""Object reference not set to an instance of an object"" I think it's because I'm not setting up a mock of PlayerBadge correctly but I'm not sure how to fix this</p>

<pre><code>        [Test]
        public void testing()
        {    //Arrange
            var mock = new Mock&lt;IRepoManager&gt;();
            var mockRequest = new Mock&lt;PlayerBadge&gt;();

            var dManager = new TestMoq(mock.Object);
            //set mockRequest to playerBadge
            mockRequest.Setup(x =&gt; x.Badge.PlayerBadges.Add(badge));

            //Act
            //Object reference not set to an instance of an object on this line 
            dManager._RepoManager.PlayerBadges.Add(mockRequest.Object);
            dManager._RepoManager.Badges.Badge(1, 2, 0);

            Assert.That(dManager._RepoManager.PlayerBadges.GetPlayerBadges().Count() &gt;= 1);
}
</code></pre>
",0,2232,2018-04-25 17:56,,0,7,how
57623096,Is it possible to use EasyMock/JMock for AWS Java SDKs mocking & code coverage?,<amazon-web-services><easymock>,"<p>I am using AWS Java SDKs to connect to multiple AWS services such as DynamoDB, API-Gateway,EC2,GlueJob,CloudWatch,SQS,S3 and etc. </p>

<p>Question: Is it possible to use EasyMock/JMock for AWS Java SDKs mocking &amp; code coverage? </p>

<p>NOTE: I know about Serverless mocking framweworks such as LocalStack, DynamoDbLocal, SAM CLI, DynamoDbLocal but i would like to know whether mocking can be completely achieved using EasyMock/JMock java libs???</p>

<p>Any one tried to mock AWS services using EasyMock/JMock?</p>

<p>Thanks,
Sundar</p>
",0,224,2019-08-23 9:09,,1,1,what
44803961,"MVC, MOQ Unit Testing Web API Method",<c#><asp.net><unit-testing><model-view-controller><moq>,"<p>I've been following a regular pattern for unit testing my Web API methods using MOQ.  This time I have a controller method that's a little different and I can't figure out why the test is failing.</p>

<p>Here's the standard look of one of our methods.  We make a call to the repository and return OK.</p>

<p><strong>API Method</strong></p>

<pre><code>    [HttpPost]
    public IHttpActionResult SampleMethod(SampleModel model)
    {
        var result= _myRepository.SampleMethod(model.Field1, model.Field2);

        return Ok();
    }
</code></pre>

<p>I usually use the following tests for something like this.</p>

<p><strong>Unit Tests</strong></p>

<pre><code>    /// &lt;summary&gt;
    /// Tests the SampleMethod is run
    /// &lt;/summary&gt;
    [TestMethod]
    public void SampleMethod_Is_Run()
    {
        //Arrange
        mockRepository
          .Setup(x =&gt; x.SampleMethod(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
          .Returns(It.IsAny&lt;EmailItem&gt;());  //forgot to add this the first time
        var controller = new MyController(mockRepository.Object);

        //Act
        controller.SampleMethod(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;());

        //Assert
        mockRepository.VerifyAll();
    }

    /// &lt;summary&gt;
    /// Tests the SampleMethod returns correct status code
    /// &lt;/summary&gt;
    [TestMethod]
    public void SampleMethod_Returns_OK()
    {
        //Arrange
        mockRepository
          .Setup(x =&gt; x.SampleMethod(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
          .Returns(It.IsAny&lt;EmailItem&gt;());  //forgot to add this the first time;
        var controller = new MyController(mockRepository.Object);
        controller.Request = new HttpRequestMessage();
        controller.Configuration = new HttpConfiguration();

        //Act
        var response = controller.SampleMethod(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;());

        //Assert
        Assert.IsInstanceOfType(response, typeof(OkResult));
    }
</code></pre>

<p>Now let's say I have a method like this, which calls off to another class for sending an email.  Why won't those unit tests work anymore?</p>

<p><strong>New API Method</strong></p>

<pre><code>    [HttpPost]
    public IHttpActionResult SampleMethod(SampleModel model)
    {
        var emailItem= _myRepository.SampleMethod(model.Field1, model.Field2);

        //With this additional code, the test will fail
        EmailSender emailSender = new EmailSender();
        emailSender.BuildEmail(emailItem.ToAddress, emailItem.Subject);

        return Ok();
    }
</code></pre>

<p>The error message on test fail I get is this, but there is no where to see extra exception information.</p>

<pre><code>    ""System.Web.Http.HttpResponseException: Processing of the HTTP request resulted in an exception.  Please see the HTTP response returned by 'Response' property of this exception for details.""
</code></pre>
",1,2007,2017-06-28 13:30,,1,0,why
60387764,python unit test test case for while loop with date constraint,<mocking><python-unittest>,"<p>I am trying to write a unit test for the scenario below. I'm unable to figure out how to mock the scenario to capture <code>clientdata.tcperror</code> raised in the while loop.</p>

<pre class=""lang-py prettyprint-override""><code>def allocate(self, clientname, testtime):
    client = clientdata.ClientInformation(clientdata.TO_Test)
    endtime = datetime + testtime
    while datetime.now &lt; endtime:
        try:
            output = client.getClientInfo(name, min=testtime)
            print(""client found resp"")
            if output is None:
                continue
            else:
                 return
         except clientdata.tcperror as e:
              time.sleep(10)
    raise ClientNotFoundError(""Attempt abort"")
</code></pre>
",0,66,2020-02-25 5:00,,0,2,how
36918186,NSubstitute returns first InlineData value for all tests,<c#><unit-testing><xunit><nsubstitute>,"<p>I am relatively new to testing. We use XUnit and NSubstitute as our testing frameworks and I am having trouble with what should be a simple test. I am using a Class library to interact with an external api and I need to be able to determine if the api is available before performing operations. (I should mention that the dll already works. We are retroactively adding tests.) </p>

<p>The problem I am encountering is that no matter what the InlineData is for the test, the substitute (client.Execute...) only ever returns the value for the first InlineData value. If the first value is HttpStatusCode.OK, then other InlineData values fail the test because the substitute only returns HttpStatusCode.OK. If I swap OK with Forbidden, then the HttpStatusCode.OK fails because the substitute only ever returns Forbidden as the StatusCode.</p>

<p>I could break these out into separate tests, but I would prefer to understand the behavior before doing so.</p>

<h2>The Test</h2>

<pre><code>[Theory]
[InlineData(HttpStatusCode.OK)]
[InlineData(HttpStatusCode.Forbidden)]
[InlineData(HttpStatusCode.BadRequest)]
[InlineData(HttpStatusCode.NotFound)]
public void ConnectionCheck(HttpStatusCode code)
{
    var d2lClient = new d2lClient(""userid"", ""userkey"", ""mappid"", ""mappkey"", ""serviceurl.com"", ""1"");
    var client = Substitute.For&lt;IRestClient&gt;();
    var authenticator = Substitute.For&lt;iITGValenceAuthenticator&gt;();

    client.Execute&lt;WhoAmIUser&gt;(Arg.Any&lt;IRestRequest&gt;()).ReturnsForAnyArgs(x =&gt; new RestResponse&lt;WhoAmIUser&gt;()
        {
            StatusCode = code
        });


    d2lClient.GetOrCreateRestClient(client);
    d2lClient.GetOrCreateAuthenticator(authenticator);

    if (code == HttpStatusCode.OK)
    {
        Assert.True(d2lClient.ConnectionCheck(), ""client.ConnectionCheck() should be true for "" + code);
    }
    else
    {
        Assert.False(d2lClient.ConnectionCheck(), ""client.ConnectionCheck() should be false for "" + code);
    }
}
</code></pre>

<h2>The Method</h2>

<pre><code>public bool ConnectionCheck()
{
    if (_userId == null || _userKey == null || _mAppId == null || _mAppKey == null)
        return false;

    try
    {
        var response = GetRestResponse&lt;WhoAmIUser&gt;(_userId, _userKey, d2lRoute.WhoAmI());

        return response.StatusCode == HttpStatusCode.OK;
    }
    catch (Exception ex)
    {
        return false;
    }
}

public IRestResponse&lt;T&gt; GetRestResponse&lt;T&gt;(string userId, string userKey, string url, List&lt;Parameter&gt; parameters = null, IRestRequest request = null, IRestClient client = null, iITGValenceAuthenticator authenticator = null) where T : new()
{
    /*
       Irrelevant code
    */
    return _client.Execute&lt;T&gt;(request);
}
</code></pre>
",0,567,2016-04-28 14:49,,1,1,other
28295625,Mockito - @Spy vs @Mock,<java><unit-testing><mocking><mockito><spy>,"<p>I understand a spy calls the real methods on an object, while a mock calls methods on the double object. Also spies are to be avoided unless there is a code smell.</p>
<p>However, how do spies work and when should I actually use them?
How are they different from mocks?</p>
",195,211232,2015-02-03 9:38,,9,0,how
4318784,Using Hamcrest matchers with JMock in Groovy,<java><groovy><jmock><hamcrest>,"<p>I'm new to Groovy (and to JMock too for that matter) and having some trouble building expectations that use matchers on the parameters of the methods being mocked.  When I try to do something like this:</p>

<pre><code>    Expectations e = new Expectations();
    e.allowing(mockObject).doSomething(Expectations.with(aNonNull(ImmutableCollection.class)))
    e.will(returnValue(someResponse))
</code></pre>

<p>It causes the following error when building the expectation:</p>

<pre><code>groovy.lang.MissingMethodException: No signature of method: static org.jmock.Expectations.with() is applicable for argument types: (org.hamcrest.core.IsNot) values: [not null]
Possible solutions: with(boolean), with(org.hamcrest.Matcher), with(byte), with(org.hamcrest.Matcher), with(char), with(org.hamcrest.Matcher)
</code></pre>

<p>aNonNull returns <code>Matcher&lt;T&gt;</code> (org.hamcrest.core.IsNot implements <code>Matcher&lt;T&gt;</code>) and there is an Expectations.with method that takes a Matcher so I'm not sure why Groovy is trying to find a version of with that takes the concrete class rather than the interface specified by aNonNull.  I've also tried casting the return value of aNonNull to both Matcher and <code>Matcher&lt;T&gt;</code> without any change in the error.  I'm not sure if there's something about the generics that's confusing Groovy or what else to check.  </p>
",1,938,2010-11-30 21:20,,1,1,why
37618681,What is a good way to mock database access in Python Impala,<python><dataframe><mocking><python-unittest><impala>,"<p>I am trying to mock the database access so that we don't connect to impala for unit-tests. I thought replacing the database tables returned with a Dataframe  object would do it, but tables have some more functionalities that dataframes don't support. Is there a way to create an object more similar to tables for testing?</p>
",0,294,2016-06-03 15:50,,0,2,what
47628073,Why do I get different results when calling gmock EXPECT_CALL with Times(n) on stack objects and heap objects?,<c++><googletest><googlemock>,"<p>
I want to use gmock EXPECT_CALL with Times(n) in my code. I wrote a sample test and <strong><em>got wrong results</em></strong> when calling on <em>objects created using new keyword.</em>  But it worked accurately with stack objects. <br/>Since I am planning to use heap objects in my real testing, I need to know what I am doing wrong here.<br/>Here is my sample code.</p>



<pre><code>#include &lt;gmock/gmock.h&gt;
#include &lt;gtest/gtest.h&gt;

class Point
{
private:
    int x;
    int y;

public:
    Point(int a, int b)
    {
        this-&gt;x = a;
        this-&gt;y = b;
    }

    virtual int getSum()
    {
        return x + y;
    }
};

class MockPoint :
        public Point
{
public:
    MockPoint(int a, int b):Point(a,b){}

    MOCK_METHOD0(getSum, int());
};

class PointTests :
        public ::testing::Test
{
};

TEST_F(PointTests, objectTest)
{
    MockPoint p(10, 20);
    EXPECT_CALL(p, getSum()).Times(10);
    p.getSum();
}

TEST_F(PointTests, pointerTest)
{
    MockPoint* p = new MockPoint(10,20);
    EXPECT_CALL(*p, getSum()).Times(10);
    p-&gt;getSum();
}
</code></pre>

<p>
I expect to fail both the tests because I call getSum() only one time.</p>

<p>
But here are the results I actually get when running the test.</p>

<pre><code>[ RUN      ] PointTests.objectTest
/home/lasantha/test/PointTests.cpp:44: Failure
Actual function call count doesn't match EXPECT_CALL(p, getSum())...
         Expected: to be called 10 times
           Actual: called once - unsatisfied and active
[  FAILED  ] PointTests.objectTest (0 ms)
[ RUN      ] PointTests.pointerTest
[       OK ] PointTests.pointerTest (0 ms)
[----------] 2 tests from PointTests (0 ms total)
</code></pre>
",1,430,2017-12-04 6:59,,1,2,why
64054333,Sinon - Can I mock a constructor?,<javascript><unit-testing><mocha.js><sinon><nock>,"<pre><code>class foo {
    constructor() {
        this._token = '';
}
</code></pre>
<p>I'm trying to mock an API call, and I want to inject a mocked value for <code>this._token</code>.  When a mocked value is hardcoded here, my mocked API call runs properly and my unit test passes.</p>
<p>I would like to somehow inject a value here.  Is this possible?</p>
",0,358,2020-09-24 20:59,,0,10,what
65135710,Mocking specific error types in golang unit tests,<unit-testing><go><testing><mocking>,"<p>I have been working on handling soft failures in some golang functions, and want to create some unit tests for the various failure scenarios. For example some of the checks include:</p>
<pre><code>        switch err := err.(type) {
        case net.Error:
                if err.(net.Error).Temporary() || err.(net.Error).Timeout() {
                        ...
                }
        case *url.Error:
                if err, ok := err.Err.(net.Error); ok &amp;&amp; err.Timeout() {
                        ...
                }
        case *net.OpError:
                if syscallErr, ok := err.Err.(*os.SyscallError); ok {
                        if syscallErr.Err == syscall.ECONNRESET {
                                ...
                        }
                }
        ...
</code></pre>
<p>I believe I just need my mock function to return errors compatible with those conditions. I see net.Error, net.OpError, url.Error, and os.SyscallError types exported. However I can't find any examples of anyone constructing a net.Error value and returning it - people put a lot of work into creating an external processes that fail in various ways but no examples of returning a net.Error with a Timeout function that returns true.</p>
<p>Likewise I could not find any examples of wrapping an error that wasn't produced with fmt.Errorf so I'm unsure if something more then errors.Wrap() is involved when not using the base builtin error type.</p>
",0,2275,2020-12-03 23:24,,2,0,what
65276048,why google mock returns error no matching function for call,<c++><googletest><googlemock>,"<p>In the code bellow I get the error on EXPECTED_CALL(..)</p>
<p>&quot;no matching function for call to 'dia::security::SecurityLevelMock::gmock_acceptEvent()'&quot;</p>
<p>which is weird since I have the method implemented.</p>
<p>Any hint would be appreciated.</p>
<pre><code>class SecurityLevelMock
{
public:
   virtual ~SecurityLevelMock( void ) {}
   MOCK_METHOD3( acceptEvent, resulttype( statemachine::stateevent event, void* pArg, resulttype initialErrorCode ) ); /*implemented by this class*/
   MOCK_METHOD2( acceptEvent, resulttype( statemachine::stateevent event, void* pArg ) );                              /*implemented by this class*/

};
  

class SecurityLevel : public SecurityLevelMock, public std::enable_shared_from_this&lt;SecurityLevel&gt;
{
//...code
}

TEST_F( SecurityLevelAccess_UT, mytest )
{
  auto security_level_access_obj = std::make_shared&lt;SecurityLevelAccess&gt;( &quot;val1&quot;, p1 , p2, &quot;val2&quot; );
  //...
  EXPECT_CALL(*(std::shared_ptr&lt;dia::security::SecurityLevelMock&gt;)security_level_access_obj, acceptEvent( ) ).Times( 1 );

}
//file.h
class SecurityLevelAccess : public security::SecurityLevel
{
//code
}
</code></pre>
",0,1687,2020-12-13 13:15,,0,2,why
57690211,Any alternative mock server which can migrate from postman example?,<python-2.7><mocking><postman><manjaro>,"<p>there!
Our team is developing api services and use postman to test/mock.
Since the mock api is out of limits, we are searching alternative mock app/package, which can mock from existing postman examples.</p>

<p>We found <a href=""https://github.com/czardoz/postman-mock-server"" rel=""nofollow noreferrer"">czardoz/postman-mock-server</a> but it not works even if I has solved gevent problem and run with py2. (My OS is manjaro with <code>python3.7</code>.)</p>

<p>OS: Manjaro (ArchLinux)
lang: python
target: mock httpapi from postman examples</p>
",0,484,2019-08-28 10:22,,2,0,what
44034716,Mock require(ed) service,<javascript><node.js><unit-testing><mocking><sinon>,"<p>I'm trying to mock a service used by my function using sinon, but I can't find a way to <em>inject</em> the mock into my function.</p>

<p>The service is acquired using <code>require</code></p>

<p>My function is like this:</p>

<pre><code>// something.js
const service = require('./service');
module.exports = {
    // do something using a service
    doSomething: function (options) {
        let results = [];
        return service.foo(option.param)
        // and return the value adding some logic
        .then(function(resultFromService){
            // want to test this flag
            if ( options.someFlag ) {
                results = resultFromService;
            }
        })
        .then(function(){
            /// more existing code here
            return results;
         });
    } 
}
</code></pre>

<p>I'm trying to mock <code>service.foo</code> like this:</p>

<pre><code>const something = require('../../something.js');
const sinon = require('sinon');  
...
it('should doSomething by calling foo in the service', function(done) {

     ///I'm getting this error here: Error: Trying to stub property 'foo' of undefined
     sinon.stub( something.service , 'foo' )
     .returns(when(function() {
         return ['bar', 'baz'];
     }));


     let promise = something.doSomething({param:'for service', someFlag:true});
});
</code></pre>

<p>And then check if my <code>doSomething</code> method is indeed executing the logic it is supposed to execute.</p>

<p>Q. How do I inject a mock service and/or a mock function for that service that is defined as a <em>private</em> closure scoped variable in my <code>something</code> function. </p>
",0,182,2017-05-17 21:02,,2,0,how
36761339,MOQ Mock void method that changes a field value,<c#><unit-testing><mocking><moq>,"<p>I am new to MOQ and Mocking.<br>
Assume I have a class like this, with a void method that changes a value:  </p>

<pre><code>public class Sample
{
    public virtual int Number { get; set; }

    public virtual void Check(int a)
    {
        this.Number = a &gt; 10 ? this.Number = 100 : this.Number = 200;
    }
}
</code></pre>

<p>I want to test the void method to make sure it is changing the local field <code>Number</code>.</p>

<pre><code>[Fact]
public void TestSampleClass()
{
    var sut = new Mock&lt;Sample&gt;();
    sut.Setup(s =&gt; s.Number).Returns(50);           

    sut.Setup(s =&gt; s.Check(It.IsAny&lt;int&gt;())).Callback(
        (int testNumber) =&gt;
        {
            if (testNumber &gt; 10)
            {
                sut.Setup(s =&gt; s.Number).Returns(100);
            }
            else
            {
                sut.Setup(s =&gt; s.Number).Returns(200);
            }                   
        });
}
</code></pre>

<p>It seems that the method doesn't change the value to 100 or 200... 
If I print <code>sut.Object.Number</code> it gives the initial value, not the updated one after void call.</p>
",4,7403,2016-04-21 6:29,,2,3,why
5761529,About with(any(Class.class))) with JMock,<java><testing><jmock>,"<p>With JMock:</p>

<pre><code>context.checking(new Expectations() {{
    // Other oneOf() will() statements ...

    oneOf(shopAccount).enter(100, with(any(String.class)));
    will(returnValue(true));

   // Other oneOf() will() statements ...
}});
</code></pre>

<p>The following exception will be raised during execution:</p>

<blockquote>
  <p>java.lang.IllegalArgumentException: not all parameters were given explicit matchers: either all parameters must be specified by matchers or all must be specified by values, you cannot mix matchers and values.</p>
</blockquote>

<p>Why i cannot do this way? using <code>with(any(Klass.class))</code> ?</p>
",19,8401,2011-04-23 1:33,,1,0,why
24852970,What is the best way to mock a java class alone with out JUNIT,<mocking><mockito>,"<p>i was asked to mock a java class so that testing team can test them but when i am trying to search the different types of mocking and all all i am getting is mocking along with junit</p>

<p>for example mockit with junit. can someone help me with out with this confusion</p>
",0,104,2014-07-20 17:18,,2,1,what
61527871,"Googletest (gtest) / googlemock (gmock): Why is ""interleav[ing] `EXPECT_CALL()`s and calls to the mock functions"" undefined behavior?",<c++><googletest><undefined-behavior><googlemock>,"<p>Despite writing</p>

<ul>
<li>this answer(<a href=""https://stackoverflow.com/questions/44034633/google-mock-can-i-call-expect-call-multiple-times-on-same-mock-object/60905880#60905880"">google mock - can I call EXPECT_CALL multiple times on same mock object?</a>)</li>
<li>this answer (<a href=""https://stackoverflow.com/questions/40089204/interleaving-expect-calls-and-calls-to-the-mock-functions/61467271#61467271"">Interleaving EXPECT_CALL()s and calls to the mock functions</a>)</li>
<li>and this issue (<a href=""https://github.com/google/googletest/issues/2828#issuecomment-620222796"" rel=""nofollow noreferrer"">Is interleaving <code>EXPECT_CALL()</code>s and calls to the mock function <em>really</em> undefined behavior?</a>)</li>
</ul>

<p>...I still don't know why Google says this is undefined behavior:</p>

<blockquote>
  <p>...otherwise the behavior is undefined. In particular, you mustn't interleave EXPECT_CALL()s and calls to the mock functions"" (<a href=""https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#using-mocks-in-tests"" rel=""nofollow noreferrer"">https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#using-mocks-in-tests</a>)</p>
</blockquote>

<p>They simply glossed over my issue above, restating it was in fact undefined behavior, but without explaining why.</p>

<p>Can anyone explain the details of why and how it is undefined behavior? </p>
",0,399,2020-04-30 16:10,,1,0,why
8773706,Can PowerMock be used without annotations?,<java><clojure><annotations><mocking><powermock>,"<p>I'm trying to use PowerMock as a library in another application. Is there a way to use it to mock a static method call without using annotations (I'm in Clojure which doesn't really do annotations)</p>
",3,1603,2012-01-07 22:40,,2,0,what
78209100,Context is undefined in Apollo RESTDataSource,<node.js><apollo><nock><restdatasource>,"<p>While upgrading from Apollo v2 to v3, I'm trying to make some external API calls to an auth server. Currently, I'm using nock to intercept the requests inside of a unit test.</p>
<p>The GET request keeps failing when I try to attach a token in the request header because the context is undefined. Why would the context be undefined here? This worked prior to upgrading.</p>
<p>server.js</p>
<pre><code>const {ApolloServer} = require('apollo-server-koa'),
CustomApi = require('../service/customapi'),
...;

const apolloServer = new ApolloServer({
    typeDefs: [DateTypeDefinition, root.typeDef, user.typeDef, ...],
    resolvers: [{Date: DateResolver}, root.resolvers, user.resolvers, ...],
    validationRules: [depthLimit(10)],
    plugins: [
        graphqlLogger
    ],
    dataSources: () =&gt; {
        return {
            customApi: new CustomApi()
        };
    },
    context: async (req) =&gt; {
        const user = await extract(req);
        return {
            user,
            ...
        }
    }
})

module.exports = apolloServer;
</code></pre>
<p>resolvers.js</p>
<pre><code>syncAccount: async (parent, _, context) =&gt; {
        allowed(context.user);
        const reviewer = await getReviewerByEmail(context.user.email);
        if (reviewer &amp;&amp; reviewer.status === 'INVITED') {
            const account = await context.dataSources.customApi.getAccount();
            ...
}
</code></pre>
<p>customapi.js</p>
<pre><code>const {RESTDataSource} = require('@apollo/datasource-rest'),
config = require('config')

class CustomAPI extends RESTDataSource {
        constructor() {
            super();
            this.baseURL = `${config.customapi.url}/path/api`;
        }

        willSendRequest(path, request) {
            //ERROR HERE
            console.log(&quot;willSendRequest - this.context: &quot;, this.context); // prints undefined
            request.headers.set('Authorization', this.context.user.token);
        }

        async getAccount() {
            return await this.get('account');
        }
        ...
}
</code></pre>
<p>package.json versions:</p>
<pre><code>&quot;@apollo/datasource-rest&quot;: &quot;^6.2.2&quot;,
&quot;@koa/cors&quot;: &quot;^3.1.0&quot;,
&quot;apollo-server&quot;: &quot;^3.13.0&quot;,
&quot;apollo-server-koa&quot;: &quot;^3.13.0&quot;,
&quot;dataloader&quot;: &quot;^2.0.0&quot;,
&quot;graphql&quot;: &quot;^16.8.1&quot;,
&quot;graphql-depth-limit&quot;: &quot;^1.1.0&quot;,
&quot;graphql-scalars&quot;: &quot;^1.22.4&quot;,
&quot;graphql-upload&quot;: &quot;^13.0.0&quot;,
&quot;koa&quot;: &quot;^2.13.0&quot;,
&quot;koa-bodyparser&quot;: &quot;^4.3.0&quot;,
&quot;koa-jwt&quot;: &quot;^4.0.0&quot;,
&quot;koa-router&quot;: &quot;^9.4.0&quot;,
...
</code></pre>
",0,80,2024-03-22 22:26,,1,1,why
9809398,Get object from container that was injected in dependency?,<c#><moq>,"<p>it is possible in Moq Framework this? </p>

<p>I properly configure the container and use it but it is possible to get an concrete instance of type that was injected? For example a injected an repository to my service and I would like to get the repository instance used in service, it is possible? </p>

<pre><code>_container.Configure(c =&gt;
{
c.For&lt;IUserApplicationService&gt;().Use&lt;UserApplicationService&gt;();
c.For&lt;IRepository&lt;LegalEntity&gt;&gt;().Use&lt;LegalEntityRepository&gt;();
c.For&lt;IRepository&lt;User&gt;&gt;().Use&lt;UserRepository&gt;();
c.For&lt;ILocalMembershipService&gt;().Use&lt;AspMembershipServiceAdapter&gt;();
c.For&lt;IEmailService&gt;().Use(emailStub);
});
</code></pre>

<p>now I do it that way that i use single single object for <code>IEmailService</code> dependency</p>

<p>and what i want is to get on the fly object created. it isnt possible probably</p>
",0,94,2012-03-21 17:04,,2,2,what
70243633,Re-direct requests to SideEffect Utility Classes,<java><spring-boot><unit-testing><mocking><spring-webclient>,"<p>for a spring boot application that needs to be tested below is my query.</p>
<pre><code>@CustomLog
@RestController
@RequestMapping(&quot;/my_path&quot;)
public class MyController {
    @GetMapping(path = &quot;**&quot;, produces = {MediaType.APPLICATION_JSON_VALUE})
    public ResponseEntity&lt;JsonNode&gt; fetchData(HttpServletRequest request){
      ... some code.....which also calls external apis.....
      }
    @PostMapping(path = &quot;**&quot;, produces = {MediaType.APPLICATION_JSON_VALUE})
    @ResponseBody
    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; createMOI(HttpServletRequest request){
          ... some code.....which also calls external apis.....
      }
    }
</code></pre>
<p>My application calls an external service which now needs to be mocked.</p>
<pre><code>this.webClient = WebClient.builder().baseUrl(&quot;http://localhost:9600/external_host_path&quot;)
                .defaultHeader(HttpHeaders.CONTENT_TYPE,MediaType.APPLICATION_JSON_VALUE)
                .build();
Mono&lt;Pojo&gt;responseMo = webClient.post().uri(&quot;/aGivenSubPath&quot;)
                       .accept(MediaType.APPLICATION_JSON).bodyValue(requestPoJo)
                       .retrieve().bodyToMono(Pojo.class).block();
</code></pre>
<p>I am calling my controller API with MVC as part of springtest</p>
<pre><code>@RunWith(SpringRunner.class)
@SpringBootTest
public class MyControllerTest {
  @Autowired
  MyController controller;
  @Before
  public void setup() throws Exception {
    this.mockMvc = standaloneSetup(this.controller).build();
  }
  @Test
  public void testControl() throws Exception {
    mockMvc
    .perform(post(&quot;http://localhost:9600/my_path&quot;)
    .contentType(MediaType.APPLICATION_JSON)
    .content(&quot;{'someData':'[]'}&quot;))
    .andExpect(status().isAccepted())
  .andReturn();
  }
}
</code></pre>
<p>What I am looking for is to somehow proxy or side effect</p>
<pre><code>http://localhost:9600/external_host_path
</code></pre>
<p>and redirect all calls made for this host to a custom Utility class which provides response based on the request params to the external host programatically.</p>
<p>I have seen multiple examples for mockito, wireMock, mockwebserver, mockserver etc
But most of them work on a given(static path)-when(static path called)-then(give static response).
I have many calls through out the flow and I already have the logic of the utility class to generate responses for provided request arguments.</p>
",0,105,2021-12-06 9:57,,1,0,how
54371181,Unit Tests and IoC Autofac - Should We Use Mocks or IoC in Unit Tests,<unit-testing><mocking><moq><autofac><ioc-container>,"<p>I use Autofac IoC in my app but I am trying to write some unit tests and in order to instantiate some of my view models, I need to provide some dependencies to them.</p>

<p>For example, my <code>Car</code> class has dependency on some <code>ISession</code> object which could be our own implementation or a 3rd party:</p>

<pre><code>public class Car
{
  public Car(ISession session) {...}
}
</code></pre>

<p>In real code, Autofac takes care for this by registering <code>ISession</code> and <code>Car</code> with Autofac container and then resolving it.  That is all fine.</p>

<p>But for unit tests, it feels wrong to me to use Autofac and register and resolve these like in app code.  </p>

<p>My understanding of unit tests is that:</p>

<ol>
<li>I think that unite tests should do this by using mocks instead of using IoC.  So, instead of registering and resolving ISession and Car, ISession should be mocked and passed to Car subject under test (sut) object.</li>
<li>Unit tests should not use IoC such as Autofac or any other at all but rather mock dependencies.  This is to isolate unit tests.  If we use IoC, we would be doing integration test, not a unit test. </li>
<li>Unit tests should be written by developer, integration tests should be written by testers/qa</li>
</ol>

<p>Is this correct?</p>
",1,141,2019-01-25 18:45,,0,3,what
15230050,Can a mock be reused for multiple expected calls with different return values in Hippo Mocks?,<c++><visual-studio-2010><mocking><hippomocks>,"<p>I'm using Hippo Mocks to great success, but I have a situation that I can't quite figure out how to set up properly. The code under test looks sorta like this:</p>

<pre><code>auto firstName = record.at(""firstName"").getValue();
auto lastName = record.at(""lastName"").getValue();
</code></pre>

<p>Where <code>IRecord::at()</code> returns a <code>IColumn&amp;</code>, which has a pure virtual <code>getValue()</code> method. I'm trying to test my code with mocked versions of <code>Irecord</code> and <code>IColumn</code>:</p>

<pre><code>auto mockRec = mocks.InterfaceMock&lt;IRecord&gt;();
auto mockCol = mocks.InterfaceMock&lt;IColumn&gt;();
</code></pre>

<p>I can set up the expectations for <code>firstName</code> just fine:</p>

<pre><code>mocks.OnCall(mockRec, IRecord::at).With(""firstName"").Return(std::ref(*mockCol));
mocks.OnCall(mockCol, IColumn::getValue).Return(std::string(""John"")));
</code></pre>

<p>But I would like to reuse the <code>IColumn</code> mock for the next expectation for <code>lastName</code>.</p>

<pre><code>mocks.OnCall(mockRec, IRecord::at).With(""lastName"").Return(std::ref(*mockCol));
mocks.OnCall(mockCol, IColumn::getValue).Return(std::string(""Doe"")));
</code></pre>

<p>But when I run this, Hippo Mocks returns ""John"" for both <code>getValue()</code> calls.</p>

<p>Following along with the <a href=""https://www.assembla.com/spaces/hippomocks/wiki/Tutorial_3_0"" rel=""nofollow"">tutorial</a>, I tried to restrict the order of ""firstName"" and ""lastName"" calls:</p>

<pre><code>auto&amp; firstCall = mocks.OnCall(mockRec, IRecord::at).With(""firstName"").Return(std::ref(*mockCol));
mocks.OnCall(mockCol, IColumn::getValue).After(firstCall).Return(std::string(""John"")));

auto&amp; lastCall = mocks.OnCall(mockRec, IRecord::at).With(""lastName"").Return(std::ref(*mockCol));
mocks.OnCall(mockCol, IColumn::getValue).After(lastCall).Return(std::string(""Doe"")));
</code></pre>

<p>But I still get ""John"" for both <code>getValue()</code> calls.</p>

<p><strong>Q:</strong> Is it possible to reuse the <code>IColumn</code> interface and tell Hippo Mocks to return different values with each <code>getValue()</code> call like I need, or am I stuck creating a separate <code>IColumn</code> mock for each parameter? Note: My actual implementation will have more than two parameters, so reusing the <code>IColumn</code> mock reduces a lot of setup for each unit test.</p>
",1,1473,2013-03-05 17:14,,1,3,what
35444453,Using python mocking library on sqlalchemy,<python><unit-testing><sqlalchemy><mocking><python-mock>,"<p>I'm using sqlalchemy to query my databases for a project. Side-by-side, I'm new to unit testing and I'm trying to learn how can I make unit tests to test my database. I tried to use mocking library to test but so far, it seems to be very difficult.</p>

<p>So I made a piece of code which creates a <code>Session</code> object. This object is used to connect to database.</p>

<pre><code>from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.exc import OperationalError, ArgumentError

test_db_string = 'postgresql+psycopg2://testdb:hello@localhost/' \
                   'test_databasetable'
def get_session(database_connection_string):
    try:
        Base = declarative_base()
        engine = create_engine(database_connection_string)
        Base.metadata.bind = engine
        DBSession = sessionmaker(bind=engine)
        session = DBSession()
        connection = session.connection()
        return session
    except OperationalError:
        return None
    except ArgumentError:
        return None
</code></pre>

<p>So I made a unit test case for this function:</p>

<pre><code>import mock
import unittest
from mock import sentinel
import get_session

class TestUtilMock(unittest.TestCase):

    @mock.patch('app.Utilities.util.create_engine')  # mention the whole path
    @mock.patch('app.Utilities.util.sessionmaker')
    @mock.patch('app.Utilities.util.declarative_base')
    def test_get_session1(self, mock_delarative_base, mock_sessionmaker,
                         mock_create_engine):
        mock_create_engine.return_value = sentinel.engine
        get_session('any_path')
        mock_delarative_base.called
        mock_create_engine.assert_called_once_with('any_path')
        mock_sessionmaker.assert_called_once_with(bind=sentinel.engine)
</code></pre>

<p>As you see in my unit test, I cannot test code in <code>get_session()</code> starting from line <code>session = DBSession()</code>. So far after googling, I cannot find out if mock value returned can be also used to mock function calls - something like, I mock <code>session</code> object and verify if I called <code>session.connection()</code></p>

<p>Is the above method of writing unit test case the right way? Is there a better method to do this?</p>
",7,16182,2016-02-16 22:42,,1,0,what
54737577,"correctly import modules, expose function for packaging and development",<python><python-3.x><mocking><pytest><setuptools>,"<h3>Objectives</h3>

<p><strong>I'm trying to configure a project to make it work during development and after packaging.</strong> I need to achieve several objectives and I don't seem to be able to deal with them separately, making it right for one will fail some others.</p>

<ol>
<li>being able to run tests from command line, possibly after setting up environment variable PYTHONPATH</li>
<li>being able to run/debug tests from IDE, possibly defining environment variable PYTHONPATH</li>
<li>run test during CI (Travis)</li>
<li>do not expose anything else than desired function</li>
<li>expose a function</li>
<li>being callable as a command line interface</li>
</ol>

<h3>Context</h3>

<p>Here is my project structure. I like it that way but I'll gladly change it to satisfy above requirements. But I'd really prefer not to mix tests and sources or resources and code.</p>

<pre><code>.
├── LICENSE
├── README.md
├── mysql_tracer
│   ├── __init__.py
│   ├── __main__.py
│   ├── chest.py
│   ├── cursor_provider.py
│   ├── query.py
│   └── writer.py
├── requirements.txt
├── setup.py
└── tests
    ├── assets
    │   ├── sample-query-executed.csv
    │   ├── sample-query-executed.sql
    │   ├── sample-query.sql
    │   └── sample-template-query.sql
    └── python
        ├── __init__.py
        ├── conftest.py
        ├── test_query.py
        └── test_writer.py

4 directories, 18 files
</code></pre>

<h3>Development</h3>

<p>During development, I set up 1, 2 and 3. I had a hard time doing it because import between modules, import from tests and mocking modules all seem to work differently. I managed a working solution with the following:</p>

<ul>
<li>module query.py imports module writer.py using <code>import writer</code></li>
<li>module query.py imports class CursorProvider from module cursor_provider.py using <code>from cursor_provider import CursorProvider</code></li>
<li>module test_query.py imports query using <code>import query</code></li>
<li>function test_result from module test_query.py mocks module CursorProvider imported from module query.py using <code>@mock.patch('query.CursorProvider')</code></li>
<li>.travis.yml defines test as: </li>
</ul>

<pre><code>script:
- export PYTHONPATH=mysql_tracer
- pytest
</code></pre>

<p>That last piece was especially counter intuitive as previous setups I tried would make locale tests running from terminal without setting the environment variable and Idea would always manage to work somehow. The working setup required to set it for both Travis and the local terminal.</p>

<p>One could search my git history and see that I had to try many things before making it working:</p>

<pre><code>$ git log 1e5338dfab429d894a109a287f2a087c5d945a90..39c6e093e3bdb4470f374c4eb50d02ec52cb878a --pretty=format:""%h%x09%ad%x09%s""
39c6e09 Mon Feb 11 01:15:04 2019 +0100  travis, just do it please
544e540 Mon Feb 11 01:00:17 2019 +0100  mark it work locally... we'll see for CI later
a38caaa Mon Feb 11 00:10:50 2019 +0100  combine regexes with or
7a1eb88 Sun Feb 10 23:43:35 2019 +0100  travis, you're the last one, just f* works please
042f7c3 Sun Feb 10 23:08:14 2019 +0100  travis, mock, pytest, I changed everything, are you happy now ?
79e45c9 Sun Feb 10 22:54:35 2019 +0100  travis, get your shit together please
17eafaa Sun Feb 10 22:48:39 2019 +0100  another way to expose and import module to please both travis and mock
ea93558 Sun Feb 10 22:39:05 2019 +0100  test
4956d5a Sun Feb 10 21:34:31 2019 +0100  another way to expose Query...
98ff216 Sun Feb 10 21:22:33 2019 +0100  import differently
2426a6d Sun Feb 10 21:20:30 2019 +0100  expose Query
851ea43 Sun Feb 10 21:17:09 2019 +0100  setup.py
</code></pre>

<h3>Packaging</h3>

<p>But now that development is about to reach conclusion, I've set up the package configuration to support 5 &amp; 6. Unfortunately, I didn't manage to set up 4 correctly and I broke 1, 2 and 3.</p>

<p>I had to change the imports between modules because otherwise using my package, after installing it locally or from pypi, would not work.</p>

<ul>
<li>Rather than doing <code>import writer</code> I would do <code>from . import writer</code></li>
<li>Rather than doing <code>from cursor_provider import CursorProvider</code> I would do <code>from .cursor_provider import CursorProvider</code> (mind the dot before the module name)</li>
</ul>

<p>This made my cli interface work. After that I could use </p>

<pre><code>$ mysql_tracer -h
... skipped output ...
$ mysql_tracer --host 127.0.0.1 --user aho --database company --destination /home/aho/Downloads /home/aho/sources/sql-test-tools/people.sql
</code></pre>

<p>At this point, importing the module mysql_tracer would work but it exposes nothing. However adding the following line to the <code>mysql_tracer/__init__.py</code> file will expose the class Query:</p>

<pre><code>from .query import Query
</code></pre>

<p>But so are all modules defined within package mysql_tracer (end of list):</p>

<pre><code>&gt;&gt;&gt; import mysql_tracer
&gt;&gt;&gt; dir(mysql_tracer)
['Query', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__', 'chest', 'cursor_provider', 'query', 'writer']
</code></pre>

<p>While it is not bothering too much, it is undesired. I only meant the attribute Query to be available. <strong>chest, cursor_provider, query and writer should be hidden</strong>. Please notice they were not available before my tentative to expose class Query.</p>

<p>But now, the import statements that made the package features work make the tests fail:</p>

<pre><code>    from . import writer
E   ImportError: attempted relative import with no known parent package
</code></pre>

<p><strong>So, How can I keep the features (5 &amp; 6) working while restoring development requirements (1,2 &amp; 3) ? And possibly also the feature 4 ?</strong></p>

<p>I hope I provided necessary and sufficient information but if you need more, please visit <a href=""https://github.com/AdrienHorgnies/py-mysql-tracer/tree/2985f23063f120b18ef697f2bf8aaf9c2e29582e"" rel=""nofollow noreferrer"">my project</a>, <a href=""https://pypi.org/project/mysql-tracer/1.0.3/"" rel=""nofollow noreferrer"">package</a> or <a href=""https://travis-ci.com/AdrienHorgnies/py-mysql-tracer/builds/101235238"" rel=""nofollow noreferrer"">CI page</a> or comment and ask for clarification.</p>
",3,451,2019-02-17 20:51,,0,6,how
40762628,How to return the actual object from a mocked object with Moq,<c#><moq>,"<p>Let's say I have this method which has been mocked:</p>

<pre><code>public Comfirmation AddCustomer(Customer customer)
{ 
   // add customer to the Database
   return confirmation;
}
</code></pre>

<p>And the my mock is like this:</p>

<pre><code>_service
.Setup(x =&gt;x.AddCustomer(It.IsAny&lt;Customer&gt;))
.Returns(new Confirmation());
</code></pre>

<p>How can I get the confirmation object / state from the actual method?
I know that the purpose of mocking is to isolate the external factors affecting the code behavior but I really need to get the computed result of the actual method. Because this result will be used in some other part of the test.</p>
",2,1411,2016-11-23 11:01,,1,1,how
38049959,c# WCF Testing EntityDescriptor,<c#><wcf><unit-testing><wcf-data-services><nsubstitute>,"<p>I have a WCF client where I get data via OData. I want to unit test my client and already made an interface for the DataServiceContext:</p>

<pre class=""lang-cs prettyprint-override""><code>internal interface ODataServiceContext
{

    DataServiceResponse SaveChanges(SaveChangesOptions options);

    ReadOnlyCollection&lt;LinkDescriptor&gt; Links { get; }

    ...

}
</code></pre>

<p>For my test currently I need to fake the <code>Links</code> property. I need to return at least one LinkDescriptor. Does anybody has an idea how to achieve this?</p>

<p>For now I use NSubstitute for faking the interface:</p>

<pre><code>var context = Substitute.For&lt;ODataServiceContext&gt;();
var list = new List&lt;LinkDescriptor&gt;();
var links = new ReadOnlyCollection&lt;LinkDescriptor&gt;(list);
context.Links.Returns(links);
</code></pre>

<p>This works for testing against an empty <code>Links</code>property. But how can I achive to add a link descriptor to the collection as the class LinkDescriptor does not have a public constructor and is sealed?</p>
",4,117,2016-06-27 9:10,,1,0,how
43442873,Mock a return value of a method with PHPUnit,<php><unit-testing><mocking>,"<p>I want to mock a method of a class to return specific value:</p>

<pre><code>$this-&gt;mock
    -&gt;method('method')
    -&gt;willReturn($this-&gt;returnValue('foo'))
;
</code></pre>

<p>This method will be invoked internally by another method which will use it's result. The method is actually being mocked but it returns this:</p>

<pre><code>class PHPUnit_Framework_MockObject_Stub_Return#471 (1) {
  protected $value =&gt;
  string(3) ""foo""
}
</code></pre>

<p>instead of a string. And the code which uses this method internally breaks.</p>

<p>How can I make a mock return a real string instead of this object?</p>

<p>I tried the <code>returnCallback</code> but it returns something even more weird...</p>

<p><code>PHPUnit</code> v5.7.19</p>

<p><code>PHP</code> v7.1.4</p>
",0,2449,2017-04-16 22:35,,1,0,how
53352036,Do mock files get bundled in the build?,<reactjs><webpack><mocking><jestjs><create-react-app>,"<p>I'm using <code>create-react-app</code>.</p>

<p>To test React components I'm using Jest and with that mock files.</p>

<p>I place the test file and the adhering mock file next to the component, like this file structure:</p>

<pre><code>components
- account
-- Account.js
-- Account.test.js
-- __mocks.js
- another-feature
....
</code></pre>

<p>When I run <code>yarn build</code>, will the mock files be bundled as well?</p>
",1,997,2018-11-17 14:13,,1,1,what
72281482,How to Unit Test a Protected Method with database connection inside a public method in C#?,<c#><unit-testing><fakeiteasy>,"<p>I have the following scenario:</p>
<pre><code>public class Child : Parent
{

private int _eventTypeId;
 public override Dictionary&lt;string, dynamic&gt; Execute(IDynamicDatabaseConnection dbConn, IDbTransaction dbTrans)
        {
_eventTypeId = GetEventType(dbConn, dbTrans);
}
}
</code></pre>
<pre><code>public abstract class Parent : ParentInterface
    {
protected int GetEventType(IDynamicDatabaseConnection dbConn, IDbTransaction dbTrans) =&gt; GetItemId(&quot;EventType&quot;, &quot;User Initiated&quot;, dbConn, dbTrans);

 protected int GetItemId(string param1, string param2, IDynamicDatabaseConnection dbConn, IDbTransaction dbTrans) =&gt;
            dbConn.Query&lt;int&gt;(
                $@&quot;myQuery&quot;,
                dbTrans).FirstOrDefault();


public abstract Dictionary&lt;string, dynamic&gt; Execute(IDynamicDatabaseConnection dbConn, IDbTransaction dbTrans);
}
</code></pre>
<pre><code>    public interface ParentInterface
    {
        Dictionary&lt;string, dynamic&gt; Execute(IDynamicDatabaseConnection dbConn, IDbTransaction dbTrans);
    }
</code></pre>
<p>How should I be mocking the <code>GetEventType</code> method from my child class?</p>
<p>I use mocking in the following way.</p>
<pre><code>            var connMock = A.Fake&lt;IDynamicDatabaseConnection&gt;();
            var transMock = A.Fake&lt;IDbTransaction&gt;();
            A.CallTo(() =&gt; connMock.BeginTransaction()).Returns(transMock);
A.CallTo(() =&gt; dbConnMock.Query&lt;string&gt;(null, null, null, A&lt;bool&gt;._, null, null)).WithAnyArguments().Returns(new List&lt;string&gt;() { &quot;AfterSaveSPName&quot; });
</code></pre>
<p>Update:
Adding the Child Class Test Method which I am testing.</p>
<pre><code>        [TestMethod]
        public void Initiate_Intake_Should_Insert_FormMode_Initiate()
        {
            // Arrange
            Dictionary&lt;string, dynamic&gt; childParameters = new Dictionary&lt;string, dynamic&gt;
            {
                 {Key, -1}
            };
            var dynamicAssembly = A.Fake&lt;IDynamicAssembly&gt;();
            var connMock = A.Fake&lt;IDynamicDatabaseConnection&gt;();
            var transMock = A.Fake&lt;IDbTransaction&gt;();
            var fakeInitiateIntake = A.Fake&lt;InitiateBase&gt;(options =&gt; options.Implements&lt;IInitiateBase&gt;());
            
A.CallTo(() =&gt; connMock.BeginTransaction()).Returns(transMock);
            A.CallTo(fakeInitiateIntake).Where(call =&gt; call.Method.Name == &quot;GetEventType&quot;)
                .WithReturnType&lt;int&gt;()
                .Returns(197);

            // Act
            var child = new Child(childParameters, dynamicAssembly);
            child.Execute(connMock, transMock);

            // Assert
            initiateParameters[&quot;Key&quot;].Equals(1234);
        }
</code></pre>
",0,134,2022-05-17 22:50,,1,12,how
76856328,Can Aspecktmock used in Codeception API testing?,<php><mocking><phalcon><codeception><web-api-testing>,"<p>We use Codeception with Phalcon.</p>
<p>We are trying to add testing around an API. This API has DB saves and other application logic. Assume our requirement is to receive 403 HTTP status If the DB save has failed (part of an error handling we do).</p>
<p>Now we want to mock that DB save (which is in our application) so that we can verify that our endpoint returns the correct HTTP status code, in case an application function has failed.</p>
<p>Our API endpoint’s code looks something like</p>
<pre><code>if(!Model::dbSave()){
    return 403;
}
return 200;
</code></pre>
<p>Our testcase: When the DB Save failed I would see a 403.</p>
<pre><code>test::double({Model name in the Application}, ['dbSave' =&gt; false ]);
$I-&gt;sendGet(&quot;uri&quot;);
$I-&gt;seeResponseCodeIs(403);
</code></pre>
<p>We are having trouble mocking the application function this way. How could we mock application functions via API tests?</p>
",1,45,2023-08-08 3:29,,0,2,how
69808112,How to mock class method for whole application when testing?,<laravel><mocking><phpunit><guzzle>,"<p>I have ServiceApi.php - in constructor it have guzzle client with defaults:</p>
<pre><code>$this-&gt;client = new Client($options);
</code></pre>
<p>else it have method:</p>
<pre><code>public function fetch()
{
return $this-&gt;client-&gt;get('http://......')-&gt;getBody()-&gt;getContents();
}
</code></pre>
<p>Another class ServiceUser.php - has method which using ServiceApi:</p>
<pre><code>public function fetchFromApi()
{
return (new ServiceApi())-&gt;fetch();
}
</code></pre>
<p>When I run test I want <code>(new ServiceUser())-&gt;fetchFromApi()</code> - don't call real api and return predefined answer which I hardcoded in test.</p>
<p>Tried to mock ServiceApi in test but it working only in test method, when calling via ServiceUser it going to real api.</p>
<p>Does it real to do this?
Or I trying to do something impossible or this code structure does't meet testing purposes?</p>
",1,3511,2021-11-02 9:30,,2,1,what
74289626,Use mock or create real instance with workaround while testing,<python><unit-testing><mocking>,"<p>I have defined the class <code>MyClass</code> in the file <code>main.py</code> as follows:</p>
<pre class=""lang-py prettyprint-override""><code>class MyClass:
    def __init__(self, a=1, b=2, c=3):
        self.a = a
        self.b = b
        self.c = c
    
        self.d = None
        self.e = None
        self.f = None
    
    def method_1(self):
        return self.a + self.b
    
    def method_2(self):
        return self.d + 4
    
    def method_3(self):
        return self.e + 10
    
    def run(self):
        self.d = self.method_1()
        self.e = self.method_2()
        self.f = self.method_3()
        # a lot more stuff here that takes time
</code></pre>
<p>In the file <code>test_file.py</code> I have written the following test methods:</p>
<pre class=""lang-py prettyprint-override""><code>import unittest
from unittest.mock import patch
    
from main import MyClass
    
class TestMyClass(unittest.TestCase):
    def test_method_2_v1(self):
        # This test creates a real instance, but the attribute d is created
        # manually in the test, while in the production code is created
        # by the method run()
        instance = MyClass()
        instance.d = instance.method_1()
        instance.e = instance.method_2()
        assert instance.e == 7
    
    def test_method_2_v2(self):
        # As in the version 1 this test creates a real instance and the attribute
        # d is created manually in the test, but  This case does not run method_1
        # and gives an explicit value to attribute d
        instance = MyClass()
        instance.d = 3
        instance.e = instance.method_2()
        assert instance.e == 7
    
    @patch('main.MyClass', spec=True)
    def test_method_2_v3(self, my_class_mock):
        # This test uses a mock and verify the correctness of method_2()
        # directly on the mock object 
        mock_instance = my_class_mock()
        mock_instance.configure_mock(d=3)
        assert MyClass.method_2(mock_instance) == 7
</code></pre>
<p>The differences between the three test methods are explained by the code and comments inside the code.</p>
<p>Which one is the best practice and why?
Is there a better solution?</p>
",0,75,2022-11-02 13:03,,1,1,what
31506003,Using a variable as an object and a function,<javascript><function><object><mocking>,"<p>I am trying to mock the <code>times</code> function from the JavaScript library <a href=""http://underscorejs.org/#times"">Underscore.js</a>.</p>

<p>This function accepts two syntaxes :</p>

<pre><code>_.times(3, function(n) {
    console.log(""hello "" + n);
});
</code></pre>

<p>and</p>

<pre><code>_(3).times(function(n) {
    console.log(""hello "" + n);
});
</code></pre>

<p>So far I succeeded to mock the first one by creating an <code>_</code> object like this :</p>

<pre><code>var _ = {
    times: function(reps, iteratee) {
        // a loop
    }
};
</code></pre>

<p>And the second syntax by creating an <code>_</code> function which returns an object :</p>

<pre><code>function _(n) {
    return {
        times: function(iteratee) {
            // a loop
        }
    };
}
</code></pre>

<p>But I can't use these 2 methods together. I need to find a way that will allow both syntaxes.
Do you have any idea how I could use the <code>_</code> character as an object as well as a function ?</p>
",10,86,2015-07-19 21:15,,3,0,how
38989858,sinon spy as callback not being called,<node.js><unit-testing><mocha.js><sinon><nock>,"<p>I have my source file for which i have written test cases for</p>

<pre><code>var debug = require('debug')('kc-feed:source:fb');
var request = require('request');
var config = require('../../config').root;


exports.source = function fetchFeed (callback) {
  var params = {
      headers: {'content-type' : 'application/jsons'},
      url: config.host + ""v1/social/fb/sync_feed"", 
      method: 'GET'
  };

  request(params, function(err, body, response) {
    if(err) {
      callback(err);
    }
    else {
      var raw_data = JSON.parse(response);
      callback(null, raw_data);
    }
  });
};
</code></pre>

<p>This is my mocha test case</p>

<pre><code>var chai = require('chai'),
    expect = chai.expect,
    app = require('../app'),
    rewire = require('rewire'),
    fbfeed = rewire('../src/feed/source/fb_feed'),
    supertest = require('supertest'),
    sinon = require('sinon'),
    nock = require('nock');

describe('test cases for fb feed file', function() {
    var callback;
    beforeEach(function(){
        callback = sinon.spy();     
    });

    after(function(){
        nock.cleanAll();
    });

    it('callback should be called with the response', function(done) {
        nock('http://localhost:3000/')
            .get('/v1/social/fb/sync_feed') 
            .reply(200, {});
            callback = sinon.spy();
        fbfeed.source(callback);
        sinon.assert.calledOnce(callback);
        done();
    }); 

    it('callback should be called with the error', function(done) {
        nock('http://localhost:3000/')
            .get('/v1/social/fb/sync_feed') 
            .replyWithError(new Error('err'));
        fbfeed.source(callback);
        sinon.assert.calledOnce(callback);
        done();
    }); 
</code></pre>

<p>Both my test cases fail as it says that callback is called 0 times. But the callback is always called. Please help.</p>
",0,633,2016-08-17 6:47,,1,0,how
20398120,Mock a single static method using PowerMock and TestNG,<java><mocking><testng><powermock>,"<pre><code>class StaticClass {
  public static String a(){ return ""a""; }
  public static String ab(){ return a()+""b""; }
}
</code></pre>

<p>I want to mock <code>StaticClass::a</code> so that it returns <code>""x""</code> and the call to <code>StaticClass.ab()</code> results in <code>""xb""</code>...</p>

<p>I find it very hard in PowerMock and TestNG...</p>

<hr>

<p>the exact code I am testing righ now:</p>

<pre><code>class StaticClass {
    public static String A() {
        System.out.println(""Called A"");
        throw new IllegalStateException(""SHOULD BE MOCKED AWAY!"");
    }

    public static String B() {
        System.out.println(""Called B"");
        return A() + ""B"";
    }
}

@PrepareForTest({StaticClass.class})
public class StaticClassTest extends PowerMockTestCase {

    @Test
    public void testAB() throws Exception {
        PowerMockito.spy(StaticClass.class);
        BDDMockito.given(StaticClass.A()).willReturn(""A"");
        assertEquals(""AB"", StaticClass.B()); // IllegalStateEx is still thrown :-/
    }

}
</code></pre>

<hr>

<p>I have Maven dependencies on:</p>

<pre><code>&lt;artifactId&gt;powermock-module-testng&lt;/artifactId&gt;
and
&lt;artifactId&gt;powermock-api-mockito&lt;/artifactId&gt;
</code></pre>
",5,12532,2013-12-05 10:56,,2,4,other
21314672,How to mock SoapException using Moq to unit test error handling,<c#><unit-testing><soap><error-handling><moq>,"<p>I've inherited a small console application that makes calls to a SOAP web service. It's a tragic mess of nested try-catches that log exceptions in various ways, and I'd like to wrap some test coverage around how it behaves when a SoapException gets thrown.</p>

<p>Question: How can I mock a class like SoapException using Moq when I can't mock an interface and I can't make properties or methods ""virtual""?</p>

<p>A little more explanation:</p>

<p>To test this error handling, I need to control the <code>Actor</code> property of the SoapException object, as well as the <code>Detail</code> property in order to verify the error handling.</p>

<p>A snippet of my unit test code:</p>

<pre><code>[TestMethod]
public void MyTestMethod()
{
    Mock&lt;SoapException&gt; soapMock = new Mock&lt;SoapException&gt;(MockBehavior.Strict);

    soapMock.SetupGet&lt;string&gt;(ex =&gt; ex.Actor).Returns(""Test Actor"");
</code></pre>

<p>Since I'm mocking a concrete class, and the <code>Actor</code> property is not marked ""Virtual"", Moq is throwing this exception when executing the <code>SetupGet(...)</code> line during the test run:</p>

<blockquote>
  <p>System.NotSupportedException: Invalid setup on a non-virtual (overridable in VB) member: ex => ex.Actor</p>
</blockquote>

<p>After some reading, the ideal answer is to mock an interface, which I am unable to do in this case. Since this is a class baked in to the .NET framework, I also can't magically mark the <code>Actor</code> property as virtual.</p>

<p>How can I mock a SoapException, or is there a different way I can verify the error handling?</p>

<p>As an aside, I first dove into creating an actual SoapException with some XML nodes inside it, but I quickly fell down the rabbit hole of programmatically creating an XML document tree. I <em>can</em> do it, but it would require many more lines of test setup code, which I'd like to avoid if possible.</p>
",4,1235,2014-01-23 17:00,,2,0,how
14942409,Mocking a generic repository method,<asp.net-mvc-3><linq><lambda><mocking><moq>,"<p>for unit-testing my asp.net MVC web application, I'd like to mock my IGenericRepository (I'm using Moq).</p>

<p>The method that has to be mocked looks like this:</p>

<pre><code>IEnumerable&lt;TEntity&gt; Get(Expression&lt;Func&lt;TEntity, bool&gt;&gt; filter = null, 
        Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt; orderBy = null, string includeProperties = """");
</code></pre>

<p>I've already mocked the repository without any problems:</p>

<pre><code>useraccountRepository = new Mock&lt;IGenericRepository&lt;Useraccount&gt;&gt;();
</code></pre>

<p>Now I'd like to tell Moq that when the Get method of my interface is called, a list of useraccounts should be returned:</p>

<pre><code>useraccountRepository.Setup(r =&gt; r.Get(u =&gt; u.Email == useraccount.Email &amp;&amp; u.Password == useraccount.Password)).Returns(useraccounts);
</code></pre>

<p>I think there is a mistake in my second lambda because this one works:</p>

<pre><code>useraccountRepository.Setup(r =&gt; r.Get(null, null, """")).Returns(useraccounts);
</code></pre>

<p>But where's my error?</p>

<p>What also works:</p>

<pre><code>useraccountRepository.Setup(r =&gt; r.Get(u =&gt; u.Email == useraccount.Email 
            &amp;&amp; u.Password == useraccount.Password, null, """")).Returns(useraccounts);
</code></pre>

<p>It looks like the default parameter values don't apply in my mock. Why is that?</p>

<p>If I use </p>

<pre><code>useraccountRepository.Setup(r =&gt; r.Get(u =&gt; u.Email == useraccount.Email 
            &amp;&amp; u.Password == useraccount.Password, null, """")).Returns(useraccounts);
</code></pre>

<p>anyway, then the method in my controller throws an exception when the Get message is called:</p>

<pre><code>private bool validateUser(Useraccount useraccount)
    {
        try
        {
            Useraccount useraccountLogin = UnitOfWork.UseraccountRepository.Get(
                u =&gt; u.Email == useraccount.Email &amp;&amp; u.Password == useraccount.Password).Single&lt;Useraccount&gt;();

            return (useraccountLogin != null);
        }
        catch (Exception exc)
        {
            return false;
        }            
    }
</code></pre>

<p>Where are my mistakes?</p>

<p>Thank you in advance.
Michael</p>
",1,479,2013-02-18 17:54,,1,2,what
15820760,Simulate a delay in execution in Unit Test using Moq,<c#><unit-testing><moq><mstest>,"<p>I'm trying to test the following:</p>

<pre><code>protected IHealthStatus VerifyMessage(ISubscriber destination)
{
    var status = new HeartBeatStatus();

    var task = new Task&lt;CheckResult&gt;(() =&gt;
    {
        Console.WriteLine(""VerifyMessage(Start): {0} - {1}"", DateTime.Now, WarningTimeout);
        Thread.Sleep(WarningTimeout - 500);
        Console.WriteLine(""VerifyMessage(Success): {0}"", DateTime.Now);
        if (CheckMessages(destination))
        {
            return CheckResult.Success;
        }

        Console.WriteLine(""VerifyMessage(Pre-Warning): {0} - {1}"", DateTime.Now, ErrorTimeout);
        Thread.Sleep(ErrorTimeout - 500);
        Console.WriteLine(""VerifyMessage(Warning): {0}"", DateTime.Now);
        if (CheckMessages(destination))
        {
            return CheckResult.Warning;
        }

        return CheckResult.Error;
    });

    task.Start();

    task.Wait();
    status.Status = task.Result;

    return status;
}
</code></pre>

<p>with the following unit test:</p>

<pre><code>public void HeartBeat_Should_ReturnWarning_When_MockReturnsWarning()
{
    // Arrange
    var heartbeat = new SocketToSocketHeartbeat(_sourceSubscriber.Object, _destinationSubscriber.Object);
    heartbeat.SetTaskConfiguration(this.ConfigurationHB1ToHB2_ValidConfiguration());

    // Simulate the message being delayed to destination subscriber.
    _destinationSubscriber.Setup(foo =&gt; foo.ReceivedMessages).Returns(DelayDelivery(3000, Message_HB1ToHB2()));

    // Act
    var healthStatus = heartbeat.Execute();

    // Assert
    Assert.AreEqual(CheckResult.Warning, healthStatus.Status);
}
</code></pre>

<p>Message_HB1ToHB2() just returns a string of characters and the ""Delay Delivery"" method is</p>

<pre><code>private List&lt;NcsMessage&gt; DelayDelivery(int delay, string message)
{
    var sent = DateTime.Now;
    var msg = new NcsMessage()
    {
        SourceSubscriber = ""HB1"",
        DestinationSubscriber = ""HB2"",
        SentOrReceived = sent,
        Message = message
    };

    var messages = new List&lt;NcsMessage&gt;();
    messages.Add(msg);

    Console.WriteLine(""DelayDelivery: {0}"", DateTime.Now);
    Thread.Sleep(delay);
    Console.WriteLine(""DelayDelivery: {0}"", DateTime.Now);

    return messages;
}
</code></pre>

<p>I'm using Moq as the mocking framework and MSTest as the testing framework. Whenever I run the unit test, I get the following output:</p>

<pre><code>DelayDelivery: 04/04/2013 15:50:33
DelayDelivery: 04/04/2013 15:50:36
VerifyMessage(Start): 04/04/2013 15:50:36 - 3000
VerifyMessage(Success): 04/04/2013 15:50:38
</code></pre>

<p>Beyond the obvious ""code smell"" using the Thread.Sleep in the methods above, the result of the unit test is not what I'm trying to accomplish. </p>

<p>Can anyone suggest a better/accurate way to use the Moq framework to simulate a delay in ""delivery"" of the message. I've left out some of the ""glue"" code and only included the relevant parts. Let me know if something I've left out that prevents you from being able to understand the question.</p>
",29,39014,2013-04-04 20:09,,6,1,what
77328072,How to test that the method of an instance has been called?,<python><unit-testing><testing><mocking>,"<p>Let's say I have the following piece of code:</p>
<pre class=""lang-py prettyprint-override""><code>class MyClass:
    def __init__(self, value=1):
        self.value = value
        self.destructive_stuff()

    def destructive_stuff(self):
        print(&quot;Running destructive commands on the host...&quot;)

    def compute_value(self):
        return self.value * 10

def main():
    sample = MyClass(value=5)
    print(f&quot;Computed value: {sample.compute_value()}&quot;)

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<p>I want to test the <code>main()</code> function. Specifically, I want to check that the <code>compute_value()</code> method has been called. I'm using a Mock since I don't want a real instance of <code>MyClass</code> initialized, because it would run <code>destructive_stuff()</code>:</p>
<pre class=""lang-py prettyprint-override""><code>import unittest
from unittest.mock import patch
import my_sample

class TestPieq(unittest.TestCase):
    @patch(&quot;my_sample.MyClass&quot;)
    def test_called(self, mock_myclass):
        my_sample.main()
        mock_myclass.compute_value.assert_called()
</code></pre>
<p>When I run this, though, it fails:</p>
<pre><code>$ python3 -m unittest tests.py
Computed value: &lt;MagicMock name='MyClass().compute_value()' id='140298914799936'&gt;
F
======================================================================
FAIL: test_called (tests.TestSample)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/usr/lib/python3.10/unittest/mock.py&quot;, line 1379, in patched
    return func(*newargs, **newkeywargs)
  File &quot;/tmp/pieq/tests.py&quot;, line 9, in test_called
    mock_myclass.compute_value.assert_called()
  File &quot;/usr/lib/python3.10/unittest/mock.py&quot;, line 898, in assert_called
    raise AssertionError(msg)
AssertionError: Expected 'compute_value' to have been called.

----------------------------------------------------------------------
Ran 1 test in 0.002s

FAILED (failures=1)
</code></pre>
<p>If I target the method directly in the <code>patch</code> directive, my test passes... but it uses the real class, so it calls the <code>destructive_stuff()</code> method!</p>
<pre><code>class TestSample(unittest.TestCase):
    @patch(&quot;my_sample.MyClass.compute_value&quot;)
    def test_called(self, mock_myclass_compute):
        my_sample.main()
        mock_myclass_compute.assert_called()
</code></pre>
<pre><code>$ python3 -m unittest tests.py
Running destructive commands on the host...
Computed value: &lt;MagicMock name='compute_value()' id='140289139827584'&gt;
.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</code></pre>
<p>How to achieve what I want?</p>
",0,49,2023-10-20 2:51,,2,0,how
18428652,Abusing Moq to test an if condition,<c#><unit-testing><moq>,"<p>Considering the following class:</p>

<pre><code>public class test
{
    public void start()
    {
        if (true)
            called();
    }

    internal protected virtual void called()
    {

    }
}
</code></pre>

<p>I want to bring the <code>if (true)</code> under test. My initial idea was to use Moq to Verify that <code>called()</code> was invoked. I ended up with this test:</p>

<pre><code>[TestFixture]
public partial class TestMethodInvocation
{
    [Test]
    public void TestWithMoqVerify()
    {
        var mock = new Mock&lt;test&gt;() {CallBase = true};
        mock.Object.start();
        mock.Verify(t =&gt; t.called());
    }
}
</code></pre>

<p>I had some troubles getting this to work and posted <a href=""https://stackoverflow.com/questions/18425163/assert-that-a-method-is-called-to-bring-an-if-condition-under-test"">this question</a> where I was adviced not to use Moq to mock the class under test.</p>

<p>So I added a subclass and used a property to test whether the method was called:</p>

<pre><code>public class test2 : test
{
    public bool WasCalled { get; set; }

    internal protected override void called()
    {
        WasCalled = true;
    }
}

public partial class TestMethodInvocation
{
    [Test]
    public void TestWithSubclassProperty()
    {
        var test = new test2();
        test.start();
        Assert.IsTrue(test.WasCalled);
    }
}
</code></pre>

<p>Both approaches work but the Moq implementation is effectively half the amount of testing code as I don't need to create a subclass. Is it very bad to use Moq like this, or should I use another framework to do this kind of testing? Or is this the result of a problem in the design of my code?</p>
",1,1774,2013-08-25 11:48,,3,4,what
64660830,How to unit test with mocked Uri,<c#><unit-testing><mocking>,"<p>I have the following code and I want to unit test it, as below</p>
<pre><code>  public class MarketLiability : IMarketLiability
    {
        private readonly string serviceAddress;

        private readonly ILogger&lt;MarketLiability&gt; logger;

        private readonly string marketLiabilityAddress

        private readonly string clientId;

        private readonly string secret;

        public MarketLiability(ILogger&lt;MarketLiability&gt; logger, IEnvironmentVariableRetriever varRetriever) 
        {
            this.logger = logger;
            this.marketLiabilityAddress = varRetriever.GetEnvironmentVariable(&quot;baseUrl&quot;);
            this.serviceAddress = varRetriever.GetEnvironmentVariable(&quot;ServiceAddress&quot;);
            this.clientId = varRetriever.GetEnvironmentVariable(&quot;ClientId&quot;);
            this.secret = varRetriever.GetEnvironmentVariable(&quot;Secret&quot;);
        }
        public async Task&lt;Quotes&gt; GetMarketQuotes()
        {
            this.logger.LogInformation(&quot;Fetching all market quotes&quot;);

            var uri = &quot;quotes&quot;;

        var token = GetAccessToken();

            var client = new HttpClient();

            var request = new HttpRequestMessage(HttpMethod.Get, $&quot;{this.marketLiabilityAddress}/{uri}&quot;);

            request.Headers.Add(&quot;Authorization&quot;, $&quot;Bearer {token}&quot;);

            var response = await client.SendAsync(request);

            var content = await response.Content.ReadAsStringAsync();

            var result = JsonConvert.DeserializeObject&lt;Quotes&gt;(content);

            return result;
        }
}
    public interface IMarketLiability
    {
        Task&lt;Quotes&gt; GetMarketQuotes();
    }
</code></pre>
<p>I have an integration test that works, but I need to unit test it with fake Urls, clientid, secret</p>
<pre><code>[Fact]
public void TestMockConnection()
{
// Arrange
    environmentVariableRetrieverMock = new Mock&lt;IEnvironmentVariableRetriever&gt;();
    this.environmentVariableRetrieverMock
        .Setup(x =&gt; x.GetEnvironmentVariable(&quot;baseUrl&quot;))
        .Returns(&quot;some actual url&quot;);

    this.environmentVariableRetrieverMock
        .Setup(x =&gt; x.GetEnvironmentVariable(&quot;ServiceAddress&quot;))
        .Returns(&quot;some actual url&quot;);

    this.environmentVariableRetrieverMock
        .Setup(x =&gt; x.GetEnvironmentVariable(&quot;ClientId&quot;))
        .Returns(&quot;ClientId&quot;); 

    this.environmentVariableRetrieverMock
        .Setup(x =&gt; x.GetEnvironmentVariable(&quot;Secret&quot;))
        .Returns(&quot;Secret&quot;); 

    var marketLiability = new MarketLiability(this.loggerMock.Object, this.environmentVariableRetrieverMock.Object);

    // Act
    var response = await marketLiability.GetMarketQuotes();

    // Assert
    response.Should().NotBeNull();
    response.Should().BeOfType&lt;Quotes&gt;();
}  
</code></pre>
<p>How can I unit test this without having to put the actual Url. I tried a fake Url and when it come to the line <code>var response = await marketLiability.GetMarketQuotes();</code>it fails with an invalid Url error.</p>
<p>Any ideas?</p>
<p>Thanks</p>
",1,2154,2020-11-03 10:16,,0,7,how
76603909,Mockery: Chaining properties and methods,<php><laravel><mocking><phpunit>,"<p>The goal is to create a test that validates the correct data is send to an external API without actually making the request.</p>
<p>I am trying to mock a chain a mix of properties and a method. Partly because it is how the <a href=""https://github.com/klaviyo/klaviyo-api-php/tree/main#subscribe-profiles"" rel=""nofollow noreferrer"">Klaviyo API</a> works and because of my custom ApiClient.</p>
<p><a href=""https://docs.mockery.io/en/latest/reference/demeter_chains.html"" rel=""nofollow noreferrer"">Demeter Chains And Fluent Interfaces</a> doesn't work for me and it seems that it only works for methods. I have also tried to various combinations of <code>set()</code> e.g. <code>-&gt;set('request, Klaviyo::class)</code> with no luck.</p>
<p>So the chain looks like this:</p>
<pre><code>$client
    -&gt;request // Public property (could be amethod, but wouldn't address the &quot;Profiles&quot; property)
    -&gt;Profiles // Public property - Klaviyo SDK
    -&gt;subscribeProfiles($body) // Public method - Klaviyo SDK
</code></pre>
<p>How Klaviyo initialize <a href=""https://github.com/klaviyo/klaviyo-api-php/blob/3fe06e5d1056dd28bc08f13b39c70460420a766d/lib/KlaviyoAPI.php#L112-L116"" rel=""nofollow noreferrer"">Profiles</a>.</p>
<p>Code examples:</p>
<pre class=""lang-php prettyprint-override""><code>use KlaviyoAPI\KlaviyoAPI;

class ApiClient
{
    public readonly KlaviyoAPI $request;

    public function __construct(
        string $apiKey,
        private int $retries = 3,
        private int $waitSeconds = 3,
        private array $guzzleOptions = [],
    )
    {
        $this-&gt;request = new KlaviyoAPI(
            $apiKey,
            $this-&gt;retries,
            $this-&gt;waitSeconds,
            $this-&gt;guzzleOptions,
        );
    }
}
</code></pre>
<pre class=""lang-php prettyprint-override""><code>use ApiClient;

class Newsletter
{
    public function resubscribe(ApiClient $client, string $listId, string $email)
    {
        $body = [
            'data' =&gt; [
                'type'       =&gt; 'profile-subscription-bulk-create-job',
                'attributes' =&gt; [
                    'list_id'       =&gt; $listId,
                    'custom_source' =&gt; 'Resubscribe user',
                    'subscriptions' =&gt; [
                        [
                            'channels' =&gt; [
                                'email' =&gt; [
                                    'MARKETING',
                                ],
                            ],
                            'email' =&gt; $email,
                        ],
                    ],
                ],
            ],
        ];

        return $client-&gt;request-&gt;Profiles-&gt;subscribeProfiles($body);
    }
}
</code></pre>
<pre class=""lang-php prettyprint-override""><code>use ApiClient;
use Newsletter;
use Mockery;

public function testSubscribeUser(): void
{
    $apiKey = 'api_key_12345';
    $listId = 'list_id_12345';
    $email = 'test@test.com';

    $body = [
        'data' =&gt; [
            'type'       =&gt; 'profile-subscription-bulk-create-job',
            'attributes' =&gt; [
                'list_id'       =&gt; $listId,
                'custom_source' =&gt; 'Resubscribe user',
                'subscriptions' =&gt; [
                    [
                        'channels' =&gt; [
                            'email' =&gt; [
                                'MARKETING',
                            ],
                        ],
                        'email' =&gt; $email,
                    ],
                ],
            ],
        ],
    ];

    // This does not validate that &quot;$body&quot; is correct and still makes a request to the Klaviyo API
    $client = Mockery::mock(ApiClient::class, [$apiKey]);

    $response = resolve(Newsletter::class)-&gt;resubscribe($client, $listId, $email);
    static::assertNull($response); // When succesful &quot;null&quot; is returned

    // I am trying to use Demeter Chains And Fluent Interfaces
    // but it doesn't work since I am mixing properties and methods
    // and I get the error &quot;ErrorException: Undefined property: Mockery\CompositeExpectation::$request&quot;
    $client = Mockery::mock(ApiClient::class, [$apiKey]);
    $client-&gt;shouldReceive('request-&gt;Profiles-&gt;subscribeProfiles')
         -&gt;with($body) // I assume this is how I validate &quot;$body&quot;
         -&gt;once()
         -&gt;andReturnNull();

    $response = resolve(Newsletter::class)-&gt;resubscribe($client, $listId, $email);
    static::assertNull($response); // When succesful &quot;null&quot; is returned

}
</code></pre>
",0,128,2023-07-03 10:33,,1,1,other
1925724,Help in using Moq,<moq>,"<p>I have a class that takes in a db factory.</p>

<pre><code>public class ArticleManager
{
     private IDAOFactor _factory;

     public ArticleManager(IDAOFactory factory)
      {
            this._factory = factory;
       }

}
</code></pre>

<p>Using moq, how do I create an instance of ArticleManager?</p>

<p>I tried:</p>

<pre><code>var mockFactory = new Mock&lt;IDAOFactory&gt;();
ArticleManager am = new ArticleManager(mockFactory);
</code></pre>

<p>But that isn't compiling.</p>
",0,205,2009-12-18 1:21,,1,1,how
74370722,Moq Dapper - Multi-map error: splitOn column 'Id' was not found,<c#><moq><dapper>,"<p>I'm running into this problem, let me describe it with my code: <a href=""https://github.com/UnoSD/Moq.Dapper/issues/20"" rel=""nofollow noreferrer"">https://github.com/UnoSD/Moq.Dapper/issues/20</a></p>
<hr>
<p>I'm trying to mock a QueryAsync call using Moq.Dapper library and hitting the error:</p>
<blockquote>
<p>Multi-map error: splitOn column 'Id' was not found</p>
</blockquote>
<p>Here is the multi mapping query and code that works perfect:</p>
<pre><code>var query = $@&quot; SELECT * FROM [{nameof(Dashboard)}] dashboard 
                left join [{nameof(DashboardUser)}] dusers on dashboard.DashboardId = dusers.DashboardId
                left join [Users] users on dusers.UserId = users.Id
                WHERE dashboard.{nameof(accountId)} = @{nameof(accountId)} AND dashboard.{nameof(dashboardId)} = @{nameof(dashboardId)}&quot;;

Dashboard? dashboardEntity = null;
using (var connection = _context.CreateConnection())
{
    var result = await connection.QueryAsync&lt;Dashboard, DashboardUser, User, Dashboard?&gt;(query,
        (dashboard, dashboardUser, user) =&gt;
        {
            if (dashboard == null) return null;
            if (dashboardEntity == null)
            {
                dashboardEntity = dashboard;
                dashboardEntity.Users = new List&lt;DashboardUser&gt;();
            }
            if (dashboardUser != null)
            {
                dashboardEntity.Users.Add(dashboardUser);
                if (user != null) dashboardUser.User = user;
            }

            return dashboardEntity;
        }, splitOn: $@&quot;{nameof(Dashboard.DashboardId)},{nameof(Dashboard.DashboardId)},Id&quot;, param: new { accountId, dashboardId });
}
</code></pre>
<p>When Mocking the <code>QueryAsync</code> call I'm hitting the same problem as everyone else in the GitHub thread:</p>
<pre><code>Func&lt;Dashboard, DashboardUser, User, Dashboard?&gt; funMap = (Dashboard, DashboardUser, User) =&gt; Mock.Of&lt;Dashboard&gt;();


public async Task Should_Get_Dashboard()
{
// Arrange
var connection = new Mock&lt;DbConnection&gt;();
IEnumerable&lt;Dashboard&gt; expected = GenFu.ListOf&lt;Dashboard&gt;(1);

connection.SetupDapperAsync(c =&gt; c.QueryAsync(It.IsAny&lt;string&gt;(), funMap, It.IsAny&lt;object&gt;(), It.IsAny&lt;IDbTransaction&gt;(),It.IsAny&lt;bool&gt;(), 
 &quot;DashboardId,DashboardId,Id&quot;, // &lt;-- SplitOn defined but error is *Multi-map error: splitOn column 'Id' was not found*
 It.IsAny&lt;int?&gt;(), It.IsAny&lt;CommandType?&gt;()))
.ReturnsAsync(expected);

_context.Setup(x =&gt; x.CreateConnection()).Returns(connection.Object);
var dashboardRepository = new DashboardRepository(_context.Object, null, null);
CommonResult&lt;Dashboard?&gt; actual = new();

// Act
actual = await dashboardRepository.GetDashboard(3, 1);
}
</code></pre>
<p><strong>Does anyone have a solution for this?</strong> It's the final thing for my Unit Test code coverage.</p>
<p><strong>UPDATE:</strong></p>
<p>I don't need to specify the mapping. See how the code TFirst, TSecond, TThird, TResult is faint/dimmed and I get the same problem even with it explicitly mapped:</p>
<p><a href=""https://i.sstatic.net/RG6v6.png"" rel=""nofollow noreferrer""><img src=""https://i.sstatic.net/RG6v6.png"" alt=""enter image description here"" /></a></p>
<p>I did try this method:</p>
<pre><code>connection.SetupDapperAsync(c =&gt; c.QueryAsync&lt;Dashboard&gt;(It.IsAny&lt;string&gt;(), It.IsAny&lt;Type[]&gt;(), GetFunc, It.IsAny&lt;object&gt;(), It.IsAny&lt;IDbTransaction&gt;(), It.IsAny&lt;bool&gt;(), $@&quot;{nameof(Dashboard.DashboardId)},{nameof(Dashboard.DashboardId)},Id&quot;, It.IsAny&lt;int?&gt;(), It.IsAny&lt;CommandType?&gt;()))
        .ReturnsAsync(expected);
</code></pre>
<p>and got the error:</p>
<blockquote>
<p>System.ArgumentException : When using the multi-mapping APIs ensure you set the splitOn param if you have keys other than Id (Parameter 'splitOn')</p>
</blockquote>
<p>I checked the Dapper code and tried * for the SplitOn and that made no difference.</p>
<p><strong>UPDATE 2:</strong></p>
<p>The problem is the MultiMapAsync method and I can't mock it because its scope is <code>private</code>:</p>
<p><a href=""https://i.sstatic.net/MBs5f.png"" rel=""nofollow noreferrer""><img src=""https://i.sstatic.net/MBs5f.png"" alt=""enter image description here"" /></a></p>
<p><strong>UPDATE 3:</strong></p>
<p>I changed the Dapper method to Public to see if I could Mock it:</p>
<pre><code>Func&lt;Dashboard, DashboardUser, User, Dashboard?&gt; funMap = (Dashboard, DashboardUser, User) =&gt; Mock.Of&lt;Dashboard&gt;();
private class DontMap { /* hiding constructor */ }

public async Task Should_Get_Dashboard()
{    
    // Arrange
    var connection = new Mock&lt;DbConnection&gt;();
    IEnumerable&lt;Dashboard&gt; expected = GenFu.ListOf&lt;Dashboard&gt;(1);

    connection.SetupDapperAsync(c =&gt; c.MultiMapAsync&lt;Dashboard, DashboardUser, User, DontMap, DontMap, DontMap, DontMap, Dashboard?&gt;(new CommandDefinition(It.IsAny&lt;string&gt;(), It.IsAny&lt;object&gt;(), It.IsAny&lt;IDbTransaction&gt;(), It.IsAny&lt;int&gt;(),It.IsAny&lt;CommandType&gt;(), CommandFlags.None, default), funMap, $@&quot;{nameof(Dashboard.DashboardId)},{nameof(Dashboard.DashboardId)},Id&quot;)).ReturnsAsync(expected);
</code></pre>
<p>I get the error:</p>
<blockquote>
<p>Specified method is not supported</p>
</blockquote>
",0,1894,2022-11-09 6:28,,1,0,how
7724556,NSubstitute received string mismatch,<nsubstitute>,"<pre><code>NSubstitute.Exceptions.CallNotReceivedException: Expected to receive call:   
  PromptForYesNo(""Sums insured business interruption period is 653 month(s) longer than fire indemnity period."", any String)   
Actually received (non-matching arguments indicated with '*' characters):   
  PromptForYesNo(*""Sums insured business interruption period is 653 month(s) longer than fire indemnity period.
""*, ""Do you want to save?"")
</code></pre>

<p>Can anyone see what the problem is?
To me the strings looks identical and they are, they come from the same object property. </p>

<p>I would appreciate some info on why this fails, thanks. </p>
",0,308,2011-10-11 10:25,,1,2,what
78091324,How to mock a static method written in Java with bounded type parameters in a unit test written in Kotlin using MockK?,<java><kotlin><unit-testing><mockk>,"<p>I'm trying to write some unit tests in Kotlin where I need to mock a static method from a Java class (let's call it A). The tricky part is that this method has <a href=""https://docs.oracle.com/javase/tutorial/java/generics/bounded.html"" rel=""nofollow noreferrer"">bounded type parameters</a>. Here's the method signature (C is a class, I is an interface):</p>
<pre class=""lang-java prettyprint-override""><code>public class A {
    @NonNull
    public static &lt;T extends C &amp; I&gt; A doSomething(T thing) {}
}
</code></pre>
<p>In my Kotlin test class, I'm attempting to use the MockK library to mock this static method. I want to capture the thing parameter passed to the <code>doSomething</code> method in a slot, but I'm not sure how I can do this/if this is even possible due to the bounded type parameters.</p>
<p>Here's the essence of what I'm trying to do:</p>
<pre><code>class Test {

    @Test
    fun test() {
        mockkStatic(A::class)
        val thingSlot = slot&lt;T extends C &amp; I&gt;()
        every { A.doSomething(capture(thingSlot)) } answers { ... }
        ...
    }
}
</code></pre>
<p>Is there a way to achieve this in Kotlin using MockK? If not, what alternatives or workarounds could I consider?</p>
<p>The only way I could get something like this to work so far is by defining an explicit type that extends C and I, but I want this to be able to work for any type matching the generic constraint.</p>
",1,93,2024-03-02 3:03,,0,0,how
51979710,How can I do Jest API test for this code?,<javascript><reactjs><unit-testing><mocking><jestjs>,"<p>I have tried several ways for mocking this unit of my code but still, it doesn't work. I'm using create-react-app and jest for testing.</p>

<p>I have a function in admin <strong>adminSignup.js</strong> for sending data to my server(Node.js and Mongoose) for creating account:</p>

<pre><code>/* eslint-disable no-undef */
 function signup(user, cb) {
 return fetch(`signup`, {
  headers: {""Content-Type"": ""application/json""},
  method: ""POST"",
  body:JSON.stringify({
    username: user.username,
    email: user.email,
    password: user.password,
    picode: user.pincode,
    building: user.building,
    city: user.city,
    state: user.state
        }),
})
  .then(checkStatus)
  .then(parseJSON)
  .then(cb)
  .catch(err =&gt; console.log(err));
}

function checkStatus(response) {
 if (response.status &gt;= 200 &amp;&amp; response.status &lt; 300) {
  return response;
}
const error = new Error(`HTTP Error ${response.statusText}`);
error.status = response.statusText;
error.response = response;
console.log(error); // eslint-disable-line no-console
throw error;
}

function parseJSON(response) {
return response.json();
}

const adminSignup = { signup };
export default adminSignup;
</code></pre>

<p>and I have called this in my component(<strong>RegisterPage.jsx</strong>) :</p>

<pre><code>adminSignup.signup( user, response =&gt; {
                         this.setState({response: response});
                         console.log(response);
                   });
</code></pre>

<p>Now I want to write a mock for my signup call(<strong>adminSignup.js</strong>). But just wonder how can I do this?</p>

<p>I have tried <strong><a href=""https://github.com/jefflau/jest-fetch-mock#simple-mock-and-assert"" rel=""nofollow noreferrer"">Jest Fetch Mock</a></strong> for mock testing(it doesnt need to create mock file) and it's working but I'm not quite sure is it correct or no :</p>

<pre><code>describe('testing api', () =&gt; {
beforeEach(() =&gt; {
  fetch.resetMocks();
});

it('calls signup and returns message to me', () =&gt; {
  expect.assertions(1);
  fetch.mockResponseOnce(JSON.stringify('Account Created Successfully,Please Check Your Email For Account Confirmation.' ));

  //assert on the response
  adminSignup.signup({
    ""email"" : ""sample@yahoo.com"",
    ""password"" : ""$2a$0yuImLGh1NIoJoRe8VKmoRkLbuH8SU6o2a"",
    ""username"" : ""username"",
    ""pincode"" : ""1"",
    ""city"" : ""Sydney"",
    ""building"" : ""1"",
    ""state"" : ""NSW""
}).then(res =&gt; {
    expect(res).toEqual('Account Created Successfully,Please Check Your Email For Account Confirmation.');
  });

  //assert on the times called and arguments given to fetch
  expect(fetch.mock.calls.length).toEqual(1);
});
});
</code></pre>

<p>I really like to create a mock file and test with that but reading jest website is not working for me.</p>

<p>Thanks in advance.</p>
",0,8614,2018-08-23 6:39,,1,0,how
57073358,Unable to remove interceptors using nock,<node.js><nock>,"<p>I am using nock and I'm trying to remove interceptors for certain hostname.</p>

<p>I have tried using:</p>

<pre><code>nock.removeInterceptor({
      hostname: 'somehostname.com',
      proto: 'https',
      path: '/',
    }),
</code></pre>

<p>When I print the result of this, it actually gives me <em>true</em></p>

<p>I have also tried:</p>

<pre><code>const mock = nock(somehostname.com)
    .persist()
    .post('/endpoint')
    .reply(200);

nock.removeInterceptor(mock)
</code></pre>

<p>But this gives me <em>false</em> somehow.</p>

<p>The way I'm checking if this is working is by printing the activeMocks:
<code>nock.activeMocks()</code>
And it still has the interceptors that I'm trying to remove.</p>

<p>Does anyone know what happens?</p>
",2,2926,2019-07-17 10:04,,3,1,what
46085380,Python mock psycopg2 from base class,<python><mocking><psycopg2>,"<p>Hi I am having troubles with mocking cursor object from inherited class.
Here is some part of my code:</p>

<pre><code># classa.py
class ClassA(ClassB):
    def __init__(self, params):
        ClassB.__init__(params)
        # other params

    def get_current_attr(self):
        sql = ""SELECT max(attr) FROM {};"".format(self.table_name)
        self.rs_cursor.execute(sql)
        current_attr = self.rs_cursor.fetchone()[0]
        return current_attr

# classb.py
import psycopg2

class ClassB:
    def __init__(self, params):
        self.redshift_conn = self.open_redshift_connection()
        self.redshift_conn.set_isolation_level(
            psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT)
        self.rs_cursor = self.redshift_conn.cursor()
</code></pre>

<p>Now I want to mock psycopg2 cursor in get_current_attr() function from ClassA. I tried to do it like this:</p>

<pre><code>@mock.patch(""mypackage.classa.classb.psycopg2.connect"")
def test_get_current_attr(self, mock_connect):
    mock_con = mock_connect.return_value
    mock_cur = mock_con.cursor.return_value
    mock_cur.fetch_one.return_value = 1
    result = self.gap_load_instance.get_current_batch_id()
    mock_cur.execute.assert_called_with(
        ""SELECT max(attr) FROM tablename""
    )
</code></pre>

<p>And I am getting:</p>

<blockquote>
  <p>raise AssertionError('Expected call: %s\nNot called' % (expected,))</p>
</blockquote>

<p>Can anyone help me with this?</p>
",1,3321,2017-09-06 22:46,,1,1,how
71559470,Should we mock models?,<testing><mocking>,"<p>We are having a debate at work and cannot find anything in the internet:</p>
<p>Is it a good practice to mock models? And why?</p>
<p>(Just clarifying, models as in per clean architecture definition)</p>
<p>Thanks</p>
",0,72,2022-03-21 14:44,,0,2,what
22378286,"MOQ Error Expected invocation on the mock once, but was 0 times",<unit-testing><moq>,"<p>I am new to MOQ and I have read the Quickstart <a href=""https://github.com/Moq/moq4/wiki/Quickstart"" rel=""noreferrer"">here</a>. I am using MOQ v4.2.1402.2112. I am trying to create a unit test for updating a person object. The <code>UpdatePerson</code> method returns the updated person object. Can someone tell me how to correct this?</p>

<p>I am getting this error:</p>

<pre><code>Moq.MockException was unhandled by user code 
HResult=-2146233088
Message=Error updating Person object
Expected invocation on the mock once, but was 0 times: svc =&gt; svc.UpdatePerson(.expected)
Configured setups: svc =&gt; svc.UpdatePerson(It.IsAny&lt;Person&gt;()), Times.Never
No invocations performed.
  Source=Moq
  IsVerificationError=true
</code></pre>

<p>Here's my code:</p>

<pre><code>    [TestMethod]
    public void UpdatePersonTest()
    {
        var expected = new Person()
        {
            PersonId = new Guid(""some guid value""),
            FirstName = ""dev"",
            LastName = ""test update"",
            UserName = ""dev@test.com"",
            Password = ""password"",
            Salt = ""6519"",
            Status = (int)StatusTypes.Active
        };

        PersonMock.Setup(svc =&gt; svc.UpdatePerson(It.IsAny&lt;Person&gt;())) 
            .Returns(expected) 
            .Verifiable();

        var actual = PersonProxy.UpdatePerson(expected);

        PersonMock.Verify(svc =&gt; svc.UpdatePerson(It.IsAny&lt;Person&gt;()), Times.Once(), ""Error updating Person object"");

        Assert.AreEqual(expected, actual, ""Not the same."");
    }
</code></pre>
",5,19850,2014-03-13 12:11,,1,1,how
66242005,Using dependency injection and mocking it with gmock,<c++><dependency-injection><googlemock>,"<p>I have implemented a Dependency Injection pattern in my code. I did that to be able to mock a service using gmock. The DI implementation works in production code, however, I am having trouble with my test setup. When using the EXPECT_CALL macro, I get &quot;expression must have class type&quot; error. I believe this is related to the way I designed the dependency, but I can't find an alternative solution (lack of experience). I have browsed previous threads on similar issues, but none helped. Would you be kind to take a look at the code below and hint possible workarounds (simplified code example using a Car-Engine interface)?</p>
<pre><code>// Engine interface class with pure virtual functions
class IEngine
{
public:
    virtual ~IEngine() = default;
    virtual void start() = 0;
    virtual void stop() = 0;
};


// A V8Engine class implementing this interface
class V8Engine : public IEngine
{
public:
    void start() override { std::cout &lt;&lt; &quot;V8 Engine started\n&quot;; };
    void stop() override { std::cout &lt;&lt; &quot;V8 Engine stopped\n&quot;; };
};


// Car.h file
class Car
{
public:
    Car(IEngine *engineService);
    void Drive();
private:
    IEngine* mEngine = nullptr;
};


// Car.cpp file
Car::Car(IEngine* engineService)
    : mEngine(engineService)
{
    if (mEngine == nullptr)
    {
        throw std::invalid_argument(&quot;service must not be null&quot;);
    }
}

void Car::Drive()
{
    mEngine-&gt;start();
    mEngine-&gt;stop();
}
</code></pre>
<p>I would like to be able to mock the engine implementation and instead of using a &quot;real V8Engine&quot;, utilize the mock. Here is how I set up my test:</p>
<pre><code>class MockEngine : public IEngine
{
public:
    MOCK_METHOD(void, start, (), (override));
    MOCK_METHOD(void, stop, (), (override));
};

TEST(TestCarClass, TestCarWithMockEngine)
{
    IEngine *mockEngine = new MockEngine;
    Car carUnderTest(mockEngine);
    carUnderTest.Drive();

    EXPECT_CALL(mockEngine, start()); // This is the part where I get the error due to invalid mockEngine setup
}
</code></pre>
",0,707,2021-02-17 12:29,,1,3,what
4255188,"Is using ""out"" bad practice",<c#><lambda><moq><anti-patterns>,"<p>I have just added an <strong>out</strong> bool parameter to a method I've written in order to get a warning in to my UI. I've used an out rather than getting the method itself to return false/true as that would imply the <em>DoSomething</em> failed/succeeded. My thinking was that the <strong>warnUser</strong> would indicate what the warning actually was without having to look at the implementation of the method.</p>

<p><strong>Original Code</strong></p>

<pre><code>public void DoSomething(int id, string input);
</code></pre>

<p><strong>New Code</strong></p>

<pre><code>public void DoSomething(int id, string input, out bool warnUser);
</code></pre>

<p>I'm using Moq to test this code, but it doesn't support out/ref parameters because they're not supported by Lambda expressions</p>

<p><strong>Test Code</strong></p>

<pre><code>mockService.Verify(It.IsAny&lt;int&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;bool&gt;());
</code></pre>

<p>So, is using <strong>out</strong> parameters bad practise and if so what do I do instead?</p>
",12,5090,2010-11-23 10:42,,7,2,what
35152129,Mocking members of immutable classes in Python,<python><unit-testing><sqlite><mocking>,"<p>I have a class which uses a sqlite3 database and want to write a test suite for it. In particular, I want to check that <code>sqlite3.Cursor.execute</code> is called with the correct SQL command. However, I have run into trouble with mocking this method since <code>sqlite3.Cursor</code> seems to be written in C and thus the class is immutable. This means I can't just patch the execute method, but if I try to patch the whole class, the assert fails, saying that execute was never called.</p>

<p>Below is my best attempt so far, but the assert fails, saying that there was no call. I would appreciate some suggestions as to what I'm doing wrong. Thanks.</p>

<h2>myclass.py</h2>

<pre><code>import sqlite3
class MyClass:
    def __init__(self):
        self.db = sqlite3.connect('somedb.db')

    def query(self, sql_squery):
        c = self.db.cursor()
        c.execute(sql_query)
</code></pre>

<h2>test_myclass.py</h2>

<pre><code>import unittest
import mock
import myclass

class MyClassTestCase(unittest.TestCase):
    @patch('myclass.sqlite3.Cursor')
    def test_query(self, mock_sql_cursor):
        mc = myclass.MyClass()
        mc.query('test')
        mock_sql_cursor.execute.assert_called_with('test')
</code></pre>
",1,1146,2016-02-02 11:25,,2,1,what
12204291,How to mock web service call with Moq?,<c#><unit-testing><moq>,"<p>The <code>using</code> below hits an external resource that I do not want to actually hit.  I want to test <code>someResult</code> and the code that uses it, but every time I run my unit test, this code still tries to hit the real web service.  How do I use moq to fake the real call to the web service, but not mock the rest of the code within the using?</p>

<pre><code>public IMyInterface.SomeMethod()
{    
     // hits a web service
     using ( mySoapClient client = new mySoapClient() )
     {
          var someResult = client.DoSomething();
       ...
       ...
     }
}


[TestMethod()]
public void SomeMethodTest()
{
    IMyInterface target = new MyInterface();
    target.SomeMethod();

    // Assert....
}
</code></pre>
",8,22827,2012-08-30 19:42,,3,0,how
26633422,Basic mocking techniques,<unit-testing><mocking><private-methods>,"<p>I am new to mocking and stubbing.  I have to write unit tests to a class, which I cannot redesign.  It is what it is.
The class has public methods that have to be tested.  These public methods use private methods to perform external calls to web services.  The class under the test is not designed for easy dependency injection.  The private methods use <code>System.Net.WebRequest</code> to perform web service calls.<br>
I need to mock these private methods.  What is the best mocking framework for the task?   What is the technique to mock these private methods?</p>
",1,268,2014-10-29 14:47,,1,6,what
20660983,Unit test success of multiple file delete method,<c#><unit-testing><dependency-injection><nunit><moq>,"<p>I recently asked a question but but did not get an answer that I could act on. I think this was due to the long code sample included. I have decided to post another question with a much smaller code sample. I want to unit test the below method to make sure that it does work and to make sure that it deletes all .xml files in a specified directory.</p>

<pre><code>private static void DeleteXmlFiles(string XmlFileDirectory)
{
    foreach (var file in Directory.GetFiles(XmlFileDirectory, ""*.Xml""))
    {
        File.Delete(file);
    }
}
</code></pre>

<p>Does anybody have any unit testing code snippet that I can look at which would help me in this case?</p>

<p>The below is all i have in the Test method which basically is not much:</p>

<pre><code>[Test]
public void can_delete_all_files_from_specified_directory()
{
    string inputDir = @""C:\TestFiles\"";
    var sut = new FilesUtility();
    var deleteSuccess = sut.
}
</code></pre>
",2,2615,2013-12-18 14:36,,3,0,what
8959132,Function mocking (for testing) in C?,<c><unit-testing><linker><mocking>,"<p>I would like to write tests for a C library, in C.  I'd like to mock out some functions for the test.</p>

<p>Suppose my library is compiled from the following source:</p>

<pre><code>/* foo.h */
int myfunction(int x, int y);

/* foo.c */
#include ""foo.h""

static int square(int x) { return x * x; }

int myfunction(int x, int y) {
    return square(x) + square(y);
}
</code></pre>

<p>I want to write a test like this:</p>

<pre><code>/* foo_test.c */
#include ""foo.h""

static int square(int x) { return x + 1; }

int main(void) {
    assert(myfunction(0, 0) == 2);
    return 0;
}
</code></pre>

<p>Is there any way I can compile so that <code>myfunction</code> will use the definition of <code>square</code> in <code>foo_test.c</code>, instead of the one in <code>foo.c</code>, only when linking the executable <code>foo_test</code>?  That is, I want to compile <code>foo.c</code> into a library (let's call it <code>libfoo.so</code>), and then compile <code>foo_test.c</code> with <code>libfoo.so</code> and some magic so that I'll get an executable <code>foo_test</code> which uses the different implementation of <code>square</code>.</p>

<p>It would be helpful to hear solutions for when <code>square</code> is not declared <code>static</code>, but solving the above case would be even better.</p>

<p>EDIT: It seems hopeless, but here's an idea: Suppose I compile with <code>-O0 -g</code> so it's unlikely that <code>square</code> will get inlined and I should have symbols showing where the call was resolved.  Is there a way to sneak into the object file and swap out the resolved reference?</p>
",19,21136,2012-01-22 5:11,,6,8,what
43021740,Invalid verify on a non-virtual on an interface,<c#><unit-testing><moq><nservicebus>,"<p>The following code is raising and exception, MOQ is complaining about: </p>

<blockquote>
  <p>""Invalid verify on a non-virtual""</p>
</blockquote>

<p>but I am mocking an interface. I must have done these sort of tests a good few times but I'm not being able to figure what the issue is this time.</p>

<pre><code>[TestFixture]
public class RegisterDeviceCommandHandlerTests
{
    private RegisterDeviceCommandHandler _handler;
    private readonly Mock&lt;IClientRepository&gt; _clientRepositoryMock = new Mock&lt;IClientRepository&gt;();
    private readonly Mock&lt;IMessageHandlerContext&gt;  _busMock = new Mock&lt;IMessageHandlerContext&gt;();
    private readonly Mock&lt;IClientEncryptionProvider&gt; _clientEncryptionProviderMock = new Mock&lt;IClientEncryptionProvider&gt;();


    [Test]
    public async Task GivenAnUnregisteredDeviceWhenTheDeviceIsAddedThenADeviceRegistrationCompletedEventShouldBePublished()
    {
        _clientRepositoryMock.Setup(x =&gt; x.RegisterClient(It.IsAny&lt;byte[]&gt;(), It.IsAny&lt;string&gt;(),
                It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
            .Returns(RegistrationClientOperationResult.Registered);

        var clientIdentity = new ClientIdentity
        {
            HostName = ""HostName"",
            MacAddress = ""MacAddress"",
            MachineId = ""MachineId""
        };

        _clientEncryptionProviderMock.Setup(x =&gt; x.DecryptIdentity(It.IsAny&lt;byte[]&gt;())).Returns(clientIdentity);

        _handler = new RegisterDeviceCommandHandler(_clientEncryptionProviderMock.Object, _clientRepositoryMock.Object)
        {
            Bus = _busMock.Object
        };

        await _handler.HandleAsync(new RegisterDeviceCommand
        {
            Identity = new byte[] { 1, 2 }
        });

        _busMock.Verify(x =&gt; x.Publish(It.IsAny&lt;DeviceRegistrationCompletedEvent&gt;()));
    }
}
</code></pre>
",1,633,2017-03-25 20:41,,1,3,what
53271844,"Operator '==' cannot be applied to operands of type 'Task<(IEnumerable<Item>, int)>' and 'Task<IEnumerable<Item>>'",<c#><visual-studio><msbuild><moq>,"<p>I had the following function to be mocked.</p>

<pre><code>public interface IRepository
{
    Task&lt;IEnumerable&lt;Item&gt;&gt; GetItems(int total);
}
</code></pre>

<p>And my mocking code was</p>

<pre><code>private readonly IEnumerable&lt;Item&gt; stubList = new List&lt;Item&gt; { new Item { } };

mockRepository = Mock.Of&lt;IRepository&gt;(r =&gt; r.GetItems(50) == Task.FromResult(stubList));
</code></pre>

<p>It worked on both my desktop (Visual studio 2017) and msbuild (<code>MSBuild auto-detection: using msbuild version '15.8.169.51996' from 'C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\MSBuild\15.0\bin'</code>) on Jenkin server.</p>

<p>Now the method has been changed to</p>

<pre><code>public interface IRepository
{
    Task&lt;(IEnumerable&lt;Item&gt;, int)&gt; GetItems(int total);
}
</code></pre>

<p>And the mocking code was changed to</p>

<pre><code>private readonly IEnumerable&lt;Item&gt; stubList = new List&lt;Item&gt; { new Item { } };

var m = (stubList, 1);
mockRepository = Mock.Of&lt;IRepository&gt;(r =&gt; r.GetItems(50) == Task.FromResult(m));
</code></pre>

<p>It still works on my desktop (visual studio 2017). But msbuild failed with the following error message?</p>

<p><code>error CS0019: Operator '==' cannot be applied to operands of type 
   'Task&lt;(IEnumerable&lt;Item&gt;, int)&gt;' and 'Task&lt;IEnumerable&lt;Item&gt;&gt;'</code></p>

<p>build.log:</p>

<blockquote>
  <p>CoreResGen:
    ""C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin\Resgen.exe"" /useSourcePath /r:""D:\Jenkins\workspace...\packages\DocumentFormat.OpenXml.2.8.1\lib\net35\DocumentFormat.OpenXml.dll"" /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\Microsoft.JScript.dll /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\mscorlib.dll /r:""C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.5\System.Core.dll"" /r:""C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.5\System.Data.DataSetExtensions.dll"" /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Data.dll /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Design.dll /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.dll /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Drawing.dll /r:""C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.0\System.Runtime.Serialization.dll"" /r:""C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.0\System.ServiceModel.dll"" /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Web.Services.dll /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Windows.Forms.dll /r:C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Xml.dll /r:""C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.5\System.Xml.Linq.dll"" /r:""C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.0\WindowsBase.dll"" /compile Components\CheckedComboBox\PopupComboBox.resx,obj\Release\PresentationControls.PopupComboBox.resources Components\DGV\DgvDesignerColumnList.resx,obj\Release\Infrastructure.DgvDesignerColumnList.resources Components\DGV\frmGridColumnsExt.resx,obj\Release\Infrastructure.frmGridColumnsExt.resources Components\DGV\dgv.resx,obj\Release\Infrastructure.DGV.resources Components\DGV\frmChangeGridState.resx,obj\Release\Infrastructure.frmChangeGridState.resources Components\DGV\frmGridColumns.resx,obj\Release\Infrastructure.frmGridColumns.resources Components\UserControl_Folder.resx,obj\Release\Infrastructure.UserControl_Folder.resources frmDropDownBox.resx,obj\Release\Infrastructure.frmDropDownBox.resources frmUsersChangeHistory.resx,obj\Release\Infrastructure.frmUsersChangeHistory.resources frmUserPermissions.resx,obj\Release\Infrastructure.frmUserPermissions.resources frmUserRegProdGroups.resx,obj\Release\Infrastructure.frmUserRegProdGroups.resources frmErrorBox.resx,obj\Release\Infrastructure.frmErrorBox.resources frmGridBox.resx,obj\Release\Infrastructure.frmGridBox.resources frmInputBox.resx,obj\Release\Infrastructure.frmInputBox.resources frmLongTask.resx,obj\Release\Infrastructure.frmLongTask.resources frmNoteBox.resx,obj\Release\Infrastructure.frmNoteBox.resources Components\MonthPicker.resx,obj\Release\Infrastructure.MonthPicker.resources frmUserGroups.resx,obj\Release\Infrastructure.frmUserGroups.resources frmUsers.resx,obj\Release\Infrastructure.frmUsers.resources Properties\Resources.resx,obj\Release\Infrastructure.Properties.Resources.resources Reports\frmEditReports.resx,obj\Release\Infrastructure.frmEditReports.resources Reports\frmJobsMaintenance.resx,obj\Release\Infrastructure.frmJobsMaintenance.resources Reports\frmRunReports.resx,obj\Release\Infrastructure.frmRunReports.resources Reports\frmSelectReport.resx,obj\Release\Infrastructure.frmSelectReport.resources Reports\frmShowReportLog.resx,obj\Release\Infrastructure.frmShowReportLog.resources</p>
</blockquote>
",-1,1273,2018-11-12 23:58,,2,2,other
60517635,How to mock a parameter that being passed into a constructor,<java><unit-testing><mocking><mockito><powermockito>,"<p>I have a class as below</p>

<pre><code>public Class CLZA {

     private Object obj1;
     private Object obj2;
     private StringBuilder strBuilder;

     public CLZA (CLZB objB) {
          obj1 = objB.fetchValueOfObj(Request.type1);
          obj2 = objB.fetchValueOfObj(Request.type2);
          strBuilder = new StringBuilder();
     } 

     public double computeValue(...) {
          if (this.obj1 == 1.0) {
              ...
          }
          if (this.obj2 == 2.0) {
              ...
          }
          strBuilder.append(""This is the line I got NPE now"");
     }
}
</code></pre>

<p>Right now, I am trying to do something like this.</p>

<pre><code>@RunWith(PowerMockRunner.class)
@PrepareForTest({CLZA.class, StringBuilder.class})
public class ClzATest {

    private CLZA objA;

    @Mock
    private CLZB objB;

    @Before
    public void setUp() throws Exception {
        objA = new CLZA(objB);
        when(objB.fetchValueOfObj(any(Request.class))).thenAnswer(
                invocation -&gt; {
                    Object argument = invocation.getArguments()[0];
                    if (argument.equals(Request.type1)) {
                        return 1.0;
                    } else if (argument.equals(Request.type2)) {
                        return 2.0;
                    } else {
                        return 0.0;
                    }
                });

    }

    @Test
    public void testComputeValue() {
        double value = objA.computeValue(...);
        assertEquals(2.0, value);
    }
}
</code></pre>

<p>I have following questions/issues: </p>

<ol>
<li><p>As you can see, I want to mock the value of the objB returned. Can I
pass the mocked objB to the constructor when I instantiate the Class
CLZA? should I mock CLZA also? If I need to mock CLZA, how can I
related it to my mocked objB?</p></li>
<li><p>Right now, I keep getting NullPointerException at the line
<code>strBuilder.append(""This is the line I got NPE now"");</code>. It seems strBuilder is not instantiated. Can anyone
help on how to test in this scenario?</p></li>
</ol>

<p>Appreciate it.</p>
",0,215,2020-03-04 0:55,,1,4,how
39490881,Jest manual mock doesn't return correct value,<javascript><reactjs><mocking><jestjs><manual>,"<p>I have an issue with jest manual mocking after upgraing to 15.1.1 (react is 15.3.1)</p>

<p>When I set a mock result inside the test, when the mocked method is called the actual result is not the one expected, but the initial one when the variable was created.</p>

<p>It was working just fine before I upgared react and jest.</p>

<p>Here's my mock : </p>

<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>'use strict';

const psMock = jest.genMockFromModule('../ProcessService');
import clone from 'lodash/clone'

var _resultDeOuf = [];

function __setMockResult(result) {
    _resultDeOuf = result;
}

psMock.getRelatedProcessesByGroupingId = jest.fn(() =&gt; {
    return {
        then: (callback) =&gt; callback(_resultDeOuf);
    }
});

psMock.__setMockResult = __setMockResult;

export default psMock`</code></pre>
</div>
</div>
</p>

<p>Here's my test :</p>

<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>jest.unmock('../SuperProcessRow');
jest.unmock('../ProcessRow');

import React from ""react"";
import ReactDom from ""react-dom"";
import TestUtils from ""react-addons-test-utils"";
import processService from 'ProcessService'

import SuperProcessRow from '../SuperProcessRow'

const defaultSuperProcess = {
    ""processId"": ""97816"",
    ""executionId"": null,
    ""cancelExecutionId"": null
}

describe('SuperProcessRow', () =&gt; {

    beforeEach(() =&gt; {
        processService.getRelatedProcessesByGroupingId.mockClear()
    });

    it('load sub processes on super process click ', () =&gt; {

        let responseSubProcesses = {
            processes : subProcesses,
            totalCount : 5
        };

        processService.__setMockResult(responseSubProcesses);

        let superProcessRow = TestUtils.renderIntoDocument(
        &lt;table&gt;&lt;SuperProcessRow process={defaultSuperProcess}/&gt;&lt;/table&gt;);

        superProcessRow = ReactDom.findDOMNode(superProcessRow);

        let icon = superProcessRow.querySelector('i');
        TestUtils.Simulate.click(icon);

        expect(processService.getRelatedProcessesByGroupingId.mock.calls.length).toEqual(1);
    })
});</code></pre>
</div>
</div>
</p>

<p>And In the actual production code, I have a call to getRelatedProcessGroupingId and I handle the response inside a .then method. And instead of retrieving data set on the test, I got the intial value: [].</p>

<p>does someone have an idea ?</p>

<p>Thank you
Vincent</p>
",1,836,2016-09-14 12:49,,1,2,why
58115060,mock ldap call always returns True,<python><mocking><python-unittest>,"<p>I mocked a method inside my login function so i don't use my lpdap connection.
Now i can't set the mock to false, he always returns true. Even if i insert invalid credentials it always returns me a token, while i want to get the return message ""invalid credentials""
Any help?</p>

<p>Login function:</p>

<pre><code>def login():

    user = request.form['user']
    passwd = request.form['passwd']

    test = ldap.bind_user(user, passwd)
    if test is None or passwd == '':
        response = jsonify(message='Invalid Credentials')
        return response ,401

    access_token = create_access_token(identity=user)
    return jsonify(access_token=access_token), 200
</code></pre>

<p>The test case:</p>

<pre><code>
    #Test to check if we get a token when the user logs in
    @patch('dev_maintenance.active_directory.ldap.bind_user')
    def test_token_return(self, bind_user):

        bind_user.verify.return_value = True
        tester = app.test_client(self)
        with tester as client:

            response = client.post(
                '/login',
                data =dict(user=""hermes"", passwd =""hermes""),
                follow_redirects=True)
            self.assertIn(b'Invalid Credentials, response.data)
</code></pre>

<p>Now if i changed this line to False:</p>

<pre><code>bind_user.verify.return_value = False

</code></pre>

<p>It should do the work, but it doesn't, it returns true and therefore accepts any credentials.</p>

<p>test output:</p>

<pre><code>E           AssertionError: b'Invalid Credentials' not found in b'{\n  ""access_token"": ""eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1Njk1MDU5OTQsIm5iZiI6MTU2OTUwNTk5NCwianRpIjoiOTg2YjQwNTYtODQyNC00ZDhjLTg2N2YtM2E3ODc4OWE4MTZjIiwiZXhwIjoxNTY5NTA2ODk0LCJpZGVudGl0eSI6Ik5vdXNlciIsImZyZXNoIjpmYWxzZSwidHlwZSI6ImFjY2VzcyJ9.RFKW2mSmqHbLtX8jBlxj9w1waug1wAe0uExPtAMkhkg""\n}\n'

</code></pre>
",0,175,2019-09-26 10:43,,1,0,how
41246413,NUnit testing of Async Task fails in C#,<c#><nunit><task-parallel-library><task><moq>,"<p>I have the following class and the interface</p>

<pre><code>public interface IService
{
    Task&lt;double&gt; GetAccDetails(int personId);
}

public class Person
{
    private int _personId;
    private IService _service;

    public Person(int personId, IService service)
    {
        _personId= personId;
        _service = service;
    }

    public double Amount {get; set;}

    public async void UpdateBanckingAcc()
    {
        Amount = await _service.GetAccDetails(_personId);
    }
}
</code></pre>

<p>I am trying to write nunit test for it:</p>

<pre><code>[Test]
public async void Test1([Values(200)]int personId)
{
    const double expectedResult = 20;    
    var serviceMock = new Mock&lt;IAccountService&gt;();

    //Here I tried both options:
    //serviceMock.Setup(s =&gt;  s.GetAccDetails(It.Is&lt;int&gt;(id =&gt; id == personId)))
    //    .ReturnsAsync(() =&gt; expectedResult);
    //And:
    serviceMock.Setup(s=&gt;  s.GetAccDetails(It.Is&lt;int&gt;(id =&gt; id == personId)))
    .Returns(() =&gt; Task.FromResult&lt;double&gt;(personId));

    var person = new Person(personId, serviceMock.Object);

    person.UpdateBanckingAcc();

    double res = person.Amount;
    Assert.AreEqual(expectedResult, res);
}
</code></pre>

<p>And the test fails. For some strange reason I can not debug it.<br>
So the issue I see here is the call :  </p>

<pre><code>person.UpdateBanckingAcc();
</code></pre>

<p>it should be  </p>

<pre><code>await person.UpdateBanckingAcc();
</code></pre>

<p>but it does not like if I use <code>await</code> keyword.</p>

<p>Please advise.</p>

<p>Also one more question: is there something specific in terms of nunit testing for async methods I should test, like task status testing, etc?</p>
",2,539,2016-12-20 15:58,,2,1,what
25878867,Testing Django Commands with Mock,<python><django><unit-testing><mocking>,"<p>I have a command that I would like to test. It hits external services and I would like to mock out the function calls that hit these external services, only check that they were called with the proper arguments. The code looks like this:</p>

<pre><code>import mock
from django.core.management import call_command
from myapp.models import User

class TestCommands(TestCase):

    def test_mytest(self):
        import package

        users = User.objects.filter(can_user_service=True)

        with mock.patch.object(package, 'module'):
            call_command('djangocommand', my_option=True)
            package.module.assert_called_once_with(users)
</code></pre>

<p>When I run it however I keep getting <code>AssertionError: Expected to be called once. Called 0 times.</code> I assume this is because I am not actually calling the module within the context, I am calling it in <code>call_command('djangocommand', my_option=True)</code>, but shouldn't all calls to this module be mocked out while the context is active? If not, does anyone have suggestions for how such a test could be conducted? </p>
",5,3292,2014-09-16 21:40,,1,1,how
22010063,Moq a retrieve of particular list item,<c#><unit-testing><moq>,"<p>I currently have such a Moq expression</p>

<pre><code>repo.Setup(r =&gt; r.GetProjectConfigurationById(It.Is&lt;int&gt;(s =&gt; s == response.Id))) 
    .Returns(response); // return response only if id matches setup one
</code></pre>

<p>As one can see, response is an object that has its own Id field.
Now I have a <code>List&lt;responses&gt;</code> and would like to transfer this expression into something that behaves as such:</p>

<ul>
<li>get any integer <code>Id</code> </li>
<li>if <code>Id</code> is mathcing a <code>response.Id</code>, return that element of a list.</li>
<li>optionally, if match is not found, return <code>null</code></li>
</ul>

<p>How I could do that with Moq?</p>
",2,1331,2014-02-25 9:39,,1,0,how
73158343,JavaScript/Node - Why isn't my jest mock being called?,<javascript><typescript><jestjs><mocking>,"<p>I am writing a unit test for a pubsub component in my service. My directory structure looks like this:</p>
<pre><code>src
|
|-- common
|    |
|    |-- pubsub
|        |
|        |-- publish_to_topic.ts
|-- publishers
    |
    |-- publish_event.ts

tests
|
|-- publishers
    |
    |-- publish_event.test.ts
</code></pre>
<p>The file <code>publish_to_topic.ts</code> looks like this</p>
<pre><code>export default async publishToTopic&lt;T&gt;(
    pubSubClient,
    topic,
    data) {
    ...
}
</code></pre>
<p>And is called by <code>publish_event.ts</code> like so:</p>
<pre><code>import { pubSub } from './../common/pubsub_client';
import publishToTopic from './../common/pubsub/publish_to_topic';

export async function publishEvent(
   event,
   time,
   metadata = {}) {
  return publishToTopic(
    pubSub,
    'my-topic',
    { data: event, timestamp: time, metadata });
}
</code></pre>
<p>Lastly in my test file <code>publish_event.test.ts</code>, I set up a mock:</p>
<pre><code>import { publishEvent } from './../../src/publishers/avoidance_area_change_event';

describe(&quot;test publisher&quot;, () =&gt; {
  let mockPublishToTopic;

  beforeEach(() =&gt; {
    mockPublishToTopic = jest.fn();
    jest.mock('./../../src/common/pubsub/publish_to_topic', () =&gt; mockPublishToTopic);
  });

  it(&quot;test1&quot;, async () =&gt; {
    const data = ...;
    const time = new Date();
    const metadata = {};

    publishEvent(event, time, metadata);

    expect(mockPublishToTopic).toBeCalled();
  });
})
</code></pre>
<p>Alas, my test fails:</p>
<pre><code>Expected number of calls: &gt;= 1
Received number of calls:    0
</code></pre>
<p>Can anyone explain where I've gone wrong? Thank you.</p>
",0,257,2022-07-28 19:38,,1,0,what
78117869,How to write a google mock matcher to match a void pointer argument?,<c++><c++14><googlemock>,"<p>I have a function that takes a const void* that I'm mocking. I want to have matchers based on the value of pointee that's being passed into the function.</p>
<p>For example:</p>
<pre><code>#include &lt;vector&gt;
#include &quot;gmock/gmock.h&quot;
#include &quot;gtest/gtest.h&quot;


class A
{
    public:
        A(std::vector&lt;uint32_t&gt; data) : m_data(data) {}
        void doSomething()
        {
            for (auto x : data)
                writeData(&amp;x, sizeof(x))
                
        }
        void writeData(const void* val, size_t size)
        {
            //More complicated than that obviously
            std::cout &lt;&lt; &quot;Writing data&quot; &lt;&lt; std::endl;
        }
    private:
        std::vector&lt;uint32_t&gt; m_data;
    
};


class MockA : public A
{
    public: 
        MOCK_METHOD(void, writeData, (const void* val, size_t size));
        
}


TEST(TestA, writeData)
{
    std::vector&lt;uint32_t&gt; testData{1,2,3,4};
    MockA myMockObj (testData);
    
    uint32_t expVal1 = 1;
    uint32_t expVal2 = 2;
    uint32_t expVal3 = 3;
    uint32_t expVal4 = 4;
    
    //The problem is the matcher won't work because writeData takes const void*
    //Pointer comparison doesn't work because the pointers dont't point to the same obj
    //for example &amp;testData[1] != m_data[1] and also (void*)&amp;expVal2 != val
    
    EXPECT_CALL(myMockObj, writeData(expVal4, 4)).Times(1);
    EXPECT_CALL(myMockObj, writeData(expVal3, 4)).Times(1);
    EXPECT_CALL(myMockObj, writeData(expVal2, 4)).Times(1);
    EXPECT_CALL(myMockObj, writeData(expVal1, 4)).Times(1);
    
    
    
    
    myMockObj.doSomething();
}
</code></pre>
<p>I would like to have a matcher that matches based on the value of both arguments as shown in the example above.
The problem is that the first argument is a void* and not a uint32_t.</p>
<p>I can't do pointer comparison because the argument and what I'm matching against are in different memory locations.</p>
<p>I found <a href=""https://groups.google.com/g/googlemock/c/sWBP2q8VZaA"" rel=""nofollow noreferrer"">this discussion</a> which seems to suggest I'm not going to be able to use SaveArgPointee side effect. I did try something along the lines of:</p>
<pre><code>uint32_t testData = 50;
uint32_t actualData;
EXPECT_CALL(myMockObj, writeData(testing::_, 4)).Times(1).WillOnce(testing::SaveArgPontee&lt;0&gt;(&amp;actualData));
</code></pre>
<p>That complained about <code>const void* is not a pointer-to-oject type</code></p>
<p>I then tried writing my own action like this</p>
<pre><code>ACITON_P(AssignVoidPtr, param) {param = * (const_cast&lt;uint32_t*&gt;(static_cast&lt;const unit32_t*&gt;(arg0))); }
</code></pre>
<p>Just to find that parameters are not writable</p>
<p>I tried using indirection an returning the value of the pointer with another custom action:</p>
<pre><code>ACITON(AssignVoidPtr) { return * (const_cast&lt;uint32_t*&gt;(static_cast&lt;const unit32_t*&gt;(arg0))); }

class MockA : public A
{
    public: 
        MOCK_METHOD(uint32_t, dummy, (const void* val, size_t size));
        
        void writeData(conts void* val, size_t size)
        {
            dummy(val, size)
        }
        
        
}


TEST(TestA, writeData)
{
    std::vector&lt;uint32_t&gt; testData{1,2,3,4};
    MockA myMockObj (testData);
    
    uint32_t expVal1 = 1;
    uint32_t expVal2 = 2;
    uint32_t expVal3 = 3;
    uint32_t expVal4 = 4;
    
    uint32_t actVal1;
    uint32_t actVal2;
    uint32_t actVal3;
    uint32_t actVal4;
    
    //In the actual test I can differentiate between the expect calls so the correct value is assigned to each var
    actVal4 = EXPECT_CALL(myMockObj, dummy(testing::_, 4)).Times(4).WillOnce(AssignVoidPtr());
    actVal3 = EXPECT_CALL(myMockObj, dummy(testing::_, 4)).Times(1).WillOnce(AssignVoidPtr());
    actVal2 = EXPECT_CALL(myMockObj, dummy(testing::_, 4)).Times(1).WillOnce(AssignVoidPtr());
    actVal1 = EXPECT_CALL(myMockObj, dummy(testing::_, 4)).Times(1).WillOnce(AssignVoidPtr());
    
    ASSERT_EQ(data[0], actVal1);
    
    
    myMockObj.doSomething();
}
</code></pre>
<p>But the above gave an error that it can't convert between fake_type and uint32_t</p>
<p>Any idea how can I achieve this?</p>
",-2,184,2024-03-06 22:54,,1,3,how
69563231,pytest mock variable calling the actual method,<python><mocking><pytest>,"<p>I have two files foo.py and bar.py</p>
<p>foo.py</p>
<pre><code>
NAME  = os.getenv('NAME').lower()
</code></pre>
<p>bar.py</p>
<pre><code>from foo import NAME

def helper():
    print (NAME)
</code></pre>
<p>I have a test file test/test_name.py</p>
<pre><code>import bar
@mock.patch('bar.NAME', &quot;Alice&quot;)
def test__get_file(monkeypatch):
  
    print(bar.NAME)
    
</code></pre>
<p>Giving an error:</p>
<pre><code>../bar.py:6: in &lt;module&gt;
    from foo import NAME
../foo.py:17: in &lt;module&gt;
 

 NAME = os.getenv('NAME').lower()
E   AttributeError: 'NoneType' object has no attribute 'lower'
</code></pre>
<p>What I am missing?</p>
",1,274,2021-10-13 22:55,,1,1,other
23533752,Unable to pass test with Mock,<php><testing><laravel><mocking>,"<p>i'm testing laravel controller.
Here's the respective route</p>

<pre><code>Route::get('categories', array('as'=&gt;'categories', 'uses'=&gt;'CategoryController@getCategory'));
</code></pre>

<p>Here's the controller:</p>

<pre><code>&lt;?php 

// app/controllers/CategoryController.php

class CategoryController extends BaseController {

    //Loading  Category model instance in constructor 
    public function __construct(Category  $category){
        $this-&gt;category = $category;
    }

    public function getCategory(){
        $categories = $this-&gt;category-&gt;all();
        return View::make('dashboard.showcategories')-&gt;with('categories', $categories);
    }

}
</code></pre>

<p>In the view <code>dashboard.showcategories</code>, i have used foreach to loop through the <code>$categories</code> variable and have then used it.</p>

<p>Now i was trying to test this controller.</p>

<pre><code>&lt;?php
// app/tests/controllers/CategoryControllerTest 

class CategoryControllerTest extends TestCase {
    public function __construct(){
        $this-&gt;mock = Mockery::mock('Eloquent', 'Category');
    }

    public function tearDown(){
        Mockery::close();
    }

    public function testGetCategory(){
        $this-&gt;mock
            -&gt;shouldReceive('all')
            -&gt;once();


        $this-&gt;app-&gt;instance('Category', $this-&gt;mock);

        $response = $this-&gt;call('GET', 'categories');
        $categories = $response-&gt;original-&gt;getData()['categories'];

        $this-&gt;assertViewHas('categories');
        $this-&gt;assertInstanceOf('Illuminate\Database\Eloquent\Collection', $categories);
    }
}
</code></pre>

<p>But it's showing an error</p>

<pre><code>There was 1 error:

1) CategoryControllerTest::testGetCategory
ErrorException: Invalid argument supplied for foreach() (View: /var/www/Hututoo/app/views/dashboard/showcategories.blade.php)
</code></pre>

<p>However, if i delete following code from the test, it passes.</p>

<pre><code>$this-&gt;mock
        -&gt;shouldReceive('all')
        -&gt;once();

$this-&gt;app-&gt;instance('Category', $this-&gt;mock);
</code></pre>

<p>How to make this test pass with mockery?</p>

<p>In case you need <code>Category model</code></p>

<pre><code>&lt;?php
// app/models/Category.php

use Jenssegers\Mongodb\Model as Eloquent;

class Category extends Eloquent {
    protected $table = 'category';
    protected $fillable = array('category_name', 'options');
}
</code></pre>
",0,454,2014-05-08 5:53,,1,0,how
5834416,PHPUnit mock with multiple expects() calls,<mocking><phpunit><expectations>,"<p>Using PHPUnit, I wonder how we can have multiple expectation from the same stub/mock.</p>

<p>For example, I want to test that the mock will have the method <code>display()</code> called and return NULL. I also want to test that the method <code>process()</code> will be called.</p>

<p>In fact my test is called <code>testProcessIsCalledIfDisplayReturnNull()</code>.</p>

<p>So I need to setup 2 expectations on the same mock object, and the manual doesn't really help about that :(</p>
",7,19107,2011-04-29 16:02,,2,0,how
6139824,Specflow with MVC Model Validation Issue,<asp.net-mvc-2><nunit><moq><specflow>,"<p>I am using Specflow, nunit and moq to test the default MVC2 application registration as I learn SpecFlow.</p>

<p>I have the following steps for checking if the username and password have not been entered.</p>

<p><strong>Steps</strong></p>

<pre><code>[Given(@""The user has not entered the username"")]
        public void GivenTheUserHasNotEnteredTheUsername()
        {   
            _registerModel = new RegisterModel
            {
                UserName = null,
                Email = ""test@dummy.com"",
                Password = ""test123"",
                ConfirmPassword = ""test123""
            };      
        }

[Given(@""The user has not entered the password"")]
        public void GivenTheUserHasNotEnteredThePassword()
        {
            _registerModel = new RegisterModel
            {
                UserName = ""user"" + new Random(1000).NextDouble().ToString(),
                Email = ""test@dummy.com"",
                Password = string.Empty,
                ConfirmPassword = ""test123""
            };  
        }

[When(@""He Clicks on Register button"")]
        public void WhenHeClicksOnRegisterButton ()
        {
            _controller.ValidateModel(_registerModel);
            _result = _controller.Register(_registerModel);
        }

[Then(@""He should be shown the error message """"(.*)""""  """"(.*)"""""")]
        public void ThenHeShouldBeShownTheErrorMessage(string errorMessage, string field)
        {
            Assert.IsInstanceOf&lt;ViewResult&gt;(_result);
            var view = _result as ViewResult;
            Assert.IsNotNull(view);
            Assert.IsFalse(_controller.ModelState.IsValid);
            Assert.IsFalse(view.ViewData.ModelState.IsValidField(field));
            Assert.IsTrue(_controller.ViewData.ModelState.ContainsKey(field));          

            Assert.AreEqual(errorMessage,
            _controller.ModelState[field].Errors[0].ErrorMessage);
        }
</code></pre>

<p>Extension method to force validation</p>

<pre><code>public static class Extensions
    {
        public static void ValidateModel&lt;T&gt; ( this Controller controller, T modelObject )
        {
            if (controller.ControllerContext == null)
                controller.ControllerContext = new ControllerContext();

            Type type = controller.GetType();
            MethodInfo tryValidateModelMethod =
                type.GetMethods(BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance).Where(
                    mi =&gt; mi.Name == ""TryValidateModel"" &amp;&amp; mi.GetParameters().Count() == 1).First();

            tryValidateModelMethod.Invoke(controller, new object[] { modelObject });
        }
    }`
</code></pre>

<p>I do not understand why the password missing test fails on the following lines.</p>

<pre><code>    Assert.IsFalse(view.ViewData.ModelState.IsValidField(field));
    Assert.IsTrue(_controller.ViewData.ModelState.ContainsKey(field));
</code></pre>

<p>I have noticed that the error message being returned is for the Password and ConfirmPassword not matching but I dont understand why for all the other tests, including the Missing Confirm Password test (Identical to the missing Password test) they work fine.</p>

<p>Any ideas?</p>

<p><strong>Features</strong></p>

<ul>
<li>Scenario: Register should return error if username is missing    </li>
<li>Given The user has not entered the username</li>
<li>When He Clicks on Register button</li>
<li><p>Then He should be shown the error
message ""The Username field is required.""  ""username""</p></li>
<li><p>Scenario: Register should return error if password is missing</p></li>
<li>Given The user has not entered the
password  </li>
<li>When He Clicks on Register button</li>
<li>Then He should be shown the error message ""'Password' must be at least
6 characters long.""  ""Password""</li>
</ul>

<p><strong>UPDATE</strong>
Ok seems the ValidatePasswordLengthAttribute in the Account Model couldn't initilise <code>Membership.Provider</code> as I did not have the connectionstring in my app.config. Is the Pembership.Provider connecting to the membership DB now?</p>

<p>I have added the connection string but now the test passes 50% of the time as it returns two errors:</p>

<ul>
<li>Password required</li>
<li>Password must be 6 chars long.</li>
</ul>

<p>The problem is that they are not returned in the same order every time so the test is flaky.
How can I rewrite my scenario and test to account for this? Can I still keep the one ""Then"" method or do I need to create a new method?</p>

<p>Thanks.</p>
",0,654,2011-05-26 14:02,,1,0,why
65250766,Mock a response in Python,<python><mocking>,"<p>I have two classes: RuleService and RuleRepository</p>
<p>In RuleService I get instance of RuleRepository.</p>
<pre><code>from domain.rule.rule_repository_mysql import get_rule_repository_mysql_instance

class RuleService:
    _instance = None
    rule_repository = get_rule_repository_mysql_instance()
    def get_rule_by_id(self, rule_id):
    
        rule = self.rule_repository.get_rule_by_id(rule_id)
    
        return rule.parameters
        
</code></pre>
<p>I don't know how to mock results of following call or mock all rule object</p>
<pre><code>self.rule_repository.get_rule_by_id(rule_id)
</code></pre>
<p>Thank you</p>
",0,27,2020-12-11 11:45,,1,0,how
77479204,Read Appsettings in test project,<c#><unit-testing><mocking><appsettings>,"<p>I have a test method that while executing calls a method in the class which has the following line</p>
<pre><code>_configuration.GetValue&lt;string&gt;(&quot;Root:Child&quot;);
</code></pre>
<p>The class has <code>IConfiguration</code> injected so this works fine in normal execution.</p>
<p>But it fails when the test method is executed</p>
<p>Edit 1: Test Class - complete</p>
<pre><code>public class MyClassTest
{
 private AutoMocker mock;
 private Mock&lt;IMyClient&gt; client;
 private IMyClass testobj;

 public void Initialize()
 {
     mock = new AutoMocker();
     myRepo = mock.GetMock&lt;IMyRepo&gt;();
     client = mock.GetMock&lt;IMyClient&gt;();
     testobj = mock.CreateInstance&lt;MyClass&gt;();
 }

 public async Task testMethod()
 {
     var result = testobj.MyUnitTestMethod();
     // Assert
 }
</code></pre>
<p>MyClass</p>
<pre><code>public class MyClass:IMyClass
{
 private readonly IMyClient _myClient;
 private readonly IConfiguration _config;
 
 //constructor
 public MyClass(IMyClient myClient, IConfiguration config)
 {
 }
 private async Task&lt;MyEntity&gt; MyMethod()
 {
  //some operation
  _config.GetValue&lt;string&gt;(&quot;Root:Child&quot;);
  //some operation
 }
}
</code></pre>
<p>I am trying to ensure when <code>MyUnitTestMethod</code> is called and in the flow when it reaches the <code>MyClass</code> method that has the line to read appsettings value (Root :Child) should get the value and not end up in error.</p>
<p>I tried adding a new config json in root test project and follow <a href=""https://stackoverflow.com/questions/58783736/configurations-in-core-xunit-test-project-the-configuration-file-appsettings-t"">Configurations in Core xUnit Test Project: The configuration file &#39;appsettings.test.json&#39; was not found</a></p>
",1,497,2023-11-14 8:41,,2,7,other
21783219,Mockito anyMapOf nested generics,<java><generics><mocking><mockito>,"<p>I am attempting to verify that a method with the following signature was called:</p>

<pre><code>public void process(Map&lt;String, Set&lt;String&gt;&gt; data) {
  ...
}
</code></pre>

<p>The nested parameterized Set is causing me difficulties.  I can get it to verify correctly with the any() matcher like so:</p>

<pre><code>verify(dataProcessor).process(Matchers.&lt;Map&lt;String, Set&lt;String&gt;&gt;&gt; any());
</code></pre>

<p>As described in <a href=""https://stackoverflow.com/questions/6175753/mockito-verifying-with-generic-parameters"">Mockito: Verifying with generic parameters</a> although annoyingly it doesn't work if I do a direct static import of Matchers.any and call it as just:</p>

<pre><code>verify(dataProcessor).process(&lt;Map&lt;String, Set&lt;String&gt;&gt;&gt; any())
</code></pre>

<p>But anyMapOf(clazz, clazz) seems the more appropriate matcher in this case.  Since you can't do Set.class I'm not sure how you would do this.  The following doesn't work because of the lack of generic:</p>

<pre><code>verify(dataProcessor).process(anyMapOf(String.class, Set.class));
</code></pre>

<p>Is it possible to verify this situation with anyMapOf or should I stick with Matchers.&lt;>any()?</p>
",15,19778,2014-02-14 15:26,,1,2,what
26367652,Not Call dependency in Mockito,<unit-testing><mocking><mockito>,"<p>I have below code, just putting one scenario here.</p>

<pre><code>  class A{
 public JSONObject m1(type1,type2,type3){
    callmethod2(type3);
 }
 public Map callmethod2(type3){
    //some jobs
    return myMap;
 }
}
@Test
assertequals(JSONObjectTest,m1(type1,type2,type3))
</code></pre>

<p>In my test, I am creating a mock with dummy data and passing them to actual function <strong>type1,type2,type3</strong> Now there is callmethod2(type3) as a dependency so i do not want to execute that method. so in my test case i written </p>

<pre><code> when(mockA.callmethod2(any(type3.class))).thenReturn(mockMap);
</code></pre>

<p>But i can see my callmethod2 is getting execute, how can i solve this and set some expected result for that method in my test case, so it will not execute.</p>
",0,32,2014-10-14 18:20,,1,2,how
20688164,A domain object created in a controller test does not end up in the database,<grails><controller><mocking>,"<p>I have been trying to follow the Grails in Action (GiA MEAP, 2nd edition), but every now and then I stumble on some issues that I cannot seem to figure out even after spending a lots of time. This is one of those. Sorry, this question is related to the example in the GiA (v13, ch6, PostControllerSpec in Listing 6.x, Pg. 144), but I will try to capture the issue with a stripped down but complete code. I have two domain models, <code>User</code> and <code>Post</code>.</p>

<pre><code>package grailstuts

class User {
    String loginId
    static hasMany = [ posts: Post ]

    static constraints = { loginId(blank: false, unique: true) }
}
</code></pre>

<hr>

<pre><code>package grailstuts

class Post {
    String content
    static belongsTo = [ user: User]

    static constraints = { content(blank: false) }
}
</code></pre>

<p>The <code>PostController</code> is as follows.</p>

<pre><code>package grailstuts

class PostController {
    static scaffold = true

    def timeline() {
        def user = User.findByLoginId(params.id)
        if (!user) {
            response.sendError(404)
        } else {
            [ user : user ]
        }
    }

    def addPost() {
        def user = User.findByLoginId(params.id)
        if (user) {
            def post = new Post(params)
            user.addToPosts(post)
            if (user.save()) {
                flash.message = ""Successfully created Post""
            } else {
                flash.message = ""Invalid or empty post""
            }
        } else {
            flash.message = ""Invalid User Id""
        }
        redirect(action: 'timeline', id: params.id)
    }
}
</code></pre>

<p>When I try unit testing the controller as follows (as given in the book), I have the issue.</p>

<pre><code>package grailstuts

import grails.test.mixin.Mock
import grails.test.mixin.TestFor
import spock.lang.Specification

@TestFor(PostController)
@Mock([User,Post])
class PostControllerSpec extends Specification {

    def ""Adding a valid new post to the timeline""() {
        given: ""A user with posts in the db""
        User chuck = new User(loginId: ""chuck_norris"").save(failOnError: true)

        and: ""A loginId parameter""
        params.id = chuck.loginId

        and: ""Some content for the post""
        params.content = ""Chuck Norris can unit test entire applications with a single assert.""

        when: ""addPost is invoked""
        def model = controller.addPost()

        then: ""our flash message and redirect confirms the success""
        flash.message == ""Successfully created Post""
        response.redirectedUrl == ""/post/timeline/${chuck.loginId}""
        Post.countByUser(chuck) == 1
    }
}
</code></pre>

<p>The test passes the first two tests <code>flash.message == ""Successfully created Post""</code> and <code>response.redirectedUrl == ""/post/timeline/${chuck.loginId}""</code>, but fails at the last line <code>Post.countByUser(chuck) == 1</code> (which is very puzzling and cannot figure out why that fails). I get the following:</p>

<pre><code>|  Condition not satisfied:
Post.countByUser(chuck) == 1
     |           |      |
     0           |      false
                 grailstuts.User : 1
</code></pre>

<p>My question is why does the above test fail, even though it successfully created the post? I have spent quite a bit of time trying to figure out the bug, but no luck yet.</p>
",3,1104,2013-12-19 17:35,,2,8,why
5409475,Rhino Mocks Last Call Return an IList?,<mocking><rhino-mocks>,"<p>When using Rhino mocks is it possible to make it return a new List</p>

<pre><code>        MockRepository mock = new MockRepository();
        IPersonRepository person = mock.Stub&lt;IPersonRepository&gt;();
        using(mock.Record())
        {
            person.GetPersonByFKId(1);
            IList&lt;Person&gt; people= new List&lt;Person&gt;();
            people.Add(new Person(100, ""Ted"", 200));
            LastCall.Return(people); 

        }
        Address add = new Address (person);
        person.GetPeopleWithAddressField(""Ted"");//FAIL it will try to ref people
        //list and it is always null
</code></pre>

<p>Is the Syntax above valid? I have tried it with both Stub and Dynamic Mock and people is always null. Not sure what I am doing wrong.</p>
",0,447,2011-03-23 17:51,,1,0,what
41053280,How to write mock for structs in Go,<unit-testing><go><mocking>,"<p>I want to write a unit test for the <code>Transport</code> function which will require mocking <code>CarFactory</code> and <code>Car</code> structs. See the following code:</p>

<pre><code>package main

type Car struct {
    Name string
}

func (h Car) Run() { ... }

type CarFactory struct {}

func (e CarFactory) MakeCar() Car {
    return Car{}
}

func Transport(cf CarFactory) {
    ...
    car := cf.MakeCar()
    car.Run()
    ...
}
</code></pre>

<p>In other OOP languages like Java, C# or C++, I can just define <code>CarFactoryMock</code> and <code>CarMock</code> that extend <code>CarFactory</code> and <code>Car</code> then override <code>MakeCar()</code> method to return a <code>CarMock</code> object</p>

<pre><code>class CarMock extends Car {
    public Run() {...}
}

class CarFactoryMock extends CarFactory {
    public Car MakeCar() { return new CarMock(); }                                                                                                                                                                                        
}

Transport(new CarFactoryMock())
</code></pre>

<p>How do I achieve this in Go?</p>

<p><strong>Note that I can change prototype and source code of <code>Transport</code> function, but must keep <code>CarFactory</code> and <code>Car</code> the same since they are taken from a 3rd package</strong></p>

<hr>

<p>The last code snippet was about Human and Employee, which lead to confusion`.</p>
",37,56532,2016-12-09 4:45,,2,0,how
38239642,GoogleTest how to use InvokeArgument With WithArg,<c++><googletest><googlemock>,"<p>I have a mock function:</p>

<pre><code>MOCK_METHOD4(my_func, int(double, double, void* (*cb) (int), int p1));
</code></pre>

<p>I want to invoke 2nd (0-based) argument of above function with the 3rd argument as parameter, i.e., invoke ""cb"" function with ""p1"" as parameter. How can I do that?</p>

<p>I can invoke ""cb"" with some custom value using InvokeArgument:</p>

<pre><code>ON_CALL(mockObj, my_func(_, _, _, _)).
                WillByDefault(DoAll(
                        IgnoreResult(InvokeArgument&lt;2&gt;(10)),
                        Return(0)));
</code></pre>

<p>But I want to invoke it with an actual parameter passed to the same mocked function call.</p>
",7,8258,2016-07-07 7:19,,3,0,how
34034432,Moq with IQueryable Extension Methods,<c#><linq><unit-testing><moq>,"<p>I'm new to Moq Framework and Unit Testing in general, I'm trying to create a unit test for my repository function below.</p>

<h3>Repository Method</h3>

<pre><code>public IQueryable&lt;Campaign&gt; AllIncluding(params Expression&lt;Func&lt;Campaign, object&gt;&gt;[] includeProperties)
{
    IQueryable&lt;Campaign&gt; query = _context.Campaigns;
    foreach (var includeProperty in includeProperties)
    {
        query = query.Include(includeProperty);
    }
    return query;
}
</code></pre>

<h3>Unit Test with Moq Setup</h3>

<pre><code>//Arrange
var data = new List&lt;Models.Campaign&gt;
{
    new Models.Campaign { Id = 1, Name = ""Campaign Past"", StartDate = DateTime.Now.AddDays(-10), EndDate = DateTime.Now.AddDays(-5) },
    new Models.Campaign { Id = 2, Name = ""Campaign Active"", StartDate = DateTime.Now.AddDays(-4), EndDate = DateTime.Now.AddDays(3) },
    new Models.Campaign { Id = 2, Name = ""Campaign Future"", StartDate = DateTime.Now.AddDays(4), EndDate = DateTime.Now.AddDays(10) }
}.AsQueryable();
var _moqSet = new Mock&lt;DbSet&lt;Models.Campaign&gt;&gt;();
_moqSet.As&lt;IQueryable&lt;Models.Campaign&gt;&gt;().Setup(m =&gt; m.Provider).Returns(data.Provider);
_moqSet.As&lt;IQueryable&lt;Models.Campaign&gt;&gt;().Setup(m =&gt; m.Expression).Returns(data.Expression);
_moqSet.As&lt;IQueryable&lt;Models.Campaign&gt;&gt;().Setup(m =&gt; m.ElementType).Returns(data.ElementType);
_moqSet.As&lt;IQueryable&lt;Models.Campaign&gt;&gt;().Setup(m =&gt; m.GetEnumerator()).Returns(data.GetEnumerator());
//_moqSet.As&lt;IQueryable&lt;Models.Campaign&gt;&gt;()
//    .Setup(m =&gt; m.Include(It.IsAny&lt;Expression&lt;Func&lt;Models.Campaign, object&gt;&gt;&gt;()))
//    .Returns((Expression&lt;Func&lt;Models.Campaign, object&gt;&gt; predicate) =&gt;
//    {
//        return _moqSet.Object.Include(predicate);
//    });
var _moqContext = new Mock&lt;Context.IPrizeSelectionContext&gt;();
_moqContext.Setup(m =&gt; m.Campaigns).Returns(_moqSet.Object);
Func&lt;IQueryable&lt;Models.Campaign&gt;, Expression&lt;Func&lt;Models.Campaign, object&gt;&gt;, IQueryable&lt;Models.Campaign&gt;&gt; includeMethod = (query, expression) =&gt;
{
    return query.Include(expression);
};
//Act
List&lt;Models.Campaign&gt; allResults = null;
using (var sut = new CampaignRepository(_moqContext.Object, includeMethod))
{
    allResults = sut.AllIncluding(o =&gt; o.Id, o =&gt; o.Name).OrderBy(o =&gt; o.Id).ToList();
}
//Assert
Assert.IsNotNull(allResults);
Assert.AreEqual(3, allResults.Count);
Assert.IsNull(allResults[0].StartDate);
</code></pre>

<p>I'm getting a null data after the <code>query.include(includeProperty)</code> I've tried to mock the include function but I get an <code>Expression references a method that does not belong to the mocked object: m =&gt; m.Include&lt;Campaign,Object&gt;(It.IsAny&lt;Expression'1&gt;())</code> exception when trying to setup the Mock DbSet. After some digging I've found that Moq has issues or can't mock extension methods, see <a href=""https://stackoverflow.com/questions/2295960/mocking-extension-methods-with-moq"">Question Mocking Extionsion Methods with Moq</a></p>

<p>Following the steps in <a href=""http://adventuresdotnet.blogspot.ca/2011/03/mocking-static-methods-for-unit-testing.html"" rel=""nofollow noreferrer"">This Blog</a> I've tried to execute the delegate pattern</p>

<h3>Repository Re-write</h3>

<pre><code>Func&lt;IQueryable&lt;Campaign&gt;, Expression&lt;Func&lt;Campaign, object&gt;&gt;, IQueryable&lt;Campaign&gt;&gt; _includeMethod = null;
...
public CampaignRepository(IPrizeSelectionContext context, Func&lt;IQueryable&lt;Campaign&gt;, Expression&lt;Func&lt;Campaign, object&gt;&gt;, IQueryable&lt;Campaign&gt;&gt; includeMethod)
    : this(context)
{
    _includeMethod = includeMethod;
}
...
public IQueryable&lt;Campaign&gt; AllIncluding(params Expression&lt;Func&lt;Campaign, object&gt;&gt;[] includeProperties)
{
    IQueryable&lt;Campaign&gt; query = _context.Campaigns;
    foreach (var includeProperty in includeProperties)
    {
        if (_includeMethod == null)
            query = query.Include(includeProperty);
        else
            query = _includeMethod(query, includeProperty);
    }
    return query;
}
</code></pre>

<p>Here is my Unit Test setup</p>

<pre><code>Func&lt;IQueryable&lt;Models.Campaign&gt;, Expression&lt;Func&lt;Models.Campaign, object&gt;&gt;, IQueryable&lt;Models.Campaign&gt;&gt; includeMethod = (query, expression) =&gt;
{
    return query.Include(expression);
};

List&lt;Models.Campaign&gt; allResults = null;
using (var sut = new CampaignRepository(_moqContext.Object, includeMethod))
{
    allResults = sut.AllIncluding(o =&gt; o.Id, o =&gt; o.Name).OrderBy(o =&gt; o.Id).ToList();
}
</code></pre>

<p>However this pattern also ends the same way, the <code>IQueryable&lt;Campaign&gt; query = _context.Campaigns;</code> returns the Mock type but I cant use the extension method.</p>

<p>Can anyone point me in the correct direction to test my repository method?</p>
",2,5788,2015-12-02 3:32,,1,0,what
46766673,Exception not being caught in try-except block during unit test,<python><exception><mocking>,"<p>I have this in my code:</p>

<pre><code>import api

def do_something():
    try:
        api = api.Api()
        api.call()
    except ParseException as e:
        logger.exception('Error occurred')
        raise ValidationError(detail=e.message)
</code></pre>

<p>Basically it calls an API and re-raises the exception with another type.
My test checks the case when the exception is thrown:</p>

<pre><code>@patch('code.api')
def test_exception(self, api_mock):
    api_mock.Api.side_effect = ParseException('General Error')
    self.assertRaises(
        ValidationError,
        do_something
    )
    api_mock.Api.assert_called_once()
</code></pre>

<p>However my test fails because <code>ParseException</code> gets thrown and not <code>ValidationError</code>. What is going on?</p>
",0,89,2017-10-16 9:09,,1,0,what
76558642,Testing a service by mocking repository with testify/mock fails,<unit-testing><go><mocking><testify>,"<p>I am new to Golang. I am trying to write unit tests for a service file. I am using testify and it's packages testify/mock and testify/assert. Looking at different articles indicates that the <code>MockCommentRepository</code> written below is correct. But, one of my test fails with following message</p>
<pre><code>--- FAIL: TestCommentServiceCreateForCreated (0.00s)
panic: 

mock: Unexpected Method Call
-----------------------------

Create(*domains.Comment)
                0: &amp;domains.Comment{Model:gorm.Model{ID:0x0, CreatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), UpdatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletedAt:gorm.DeletedAt{Time:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Valid:false}}, ID:0x7b, Title:&quot;Test Comment&quot;, Content:&quot;Test Content&quot;, PostID:0x7b, Post:domains.Post{Model:gorm.Model{ID:0x0, CreatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), UpdatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletedAt:gorm.DeletedAt{Time:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Valid:false}}, ID:0x0, Title:&quot;&quot;, Content:&quot;&quot;, Published:false}}

The closest call I have is: 

Create(*domains.Comment)
                0: &amp;domains.Comment{Model:gorm.Model{ID:0x0, CreatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), UpdatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletedAt:gorm.DeletedAt{Time:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Valid:false}}, ID:0x7b, Title:&quot;Test Comment&quot;, Content:&quot;Test Content&quot;, PostID:0x7b, Post:domains.Post{Model:gorm.Model{ID:0x0, CreatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), UpdatedAt:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletedAt:gorm.DeletedAt{Time:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Valid:false}}, ID:0x7b, Title:&quot;Test Post&quot;, Content:&quot;Test Content&quot;, Published:true}}

Difference found in argument 0:

--- Expected
+++ Actual
@@ -24,6 +24,6 @@
   },
-  ID: (uint) 123,
-  Title: (string) (len=9) &quot;Test Post&quot;,
-  Content: (string) (len=12) &quot;Test Content&quot;,
-  Published: (bool) true
+  ID: (uint) 0,
+  Title: (string) &quot;&quot;,
+  Content: (string) &quot;&quot;,
+  Published: (bool) false
  }

Diff: 0: FAIL:  (*domains.Comment=&amp;{{0 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC {0001-01-01 00:00:00 +0000 UTC false}} 123 Test Comment Test Content 123 {{0 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC {0001-01-01 00:00:00 +0000 UTC false}} 0   false}}) != (*domains.Comment=&amp;{{0 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC {0001-01-01 00:00:00 +0000 UTC false}} 123 Test Comment Test Content 123 {{0 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC {0001-01-01 00:00:00 +0000 UTC false}} 123 Test Post Test Content true}}) [recovered]
</code></pre>
<p>This is the service file I want to test.</p>
<pre><code>type CommentService struct {
    commentRepo domains.CommentRepositoryInterface
}

func NewCommentService(commentRepo domains.CommentRepositoryInterface) *CommentService {
    return &amp;CommentService{
        commentRepo: commentRepo,
    }
}

func (s *CommentService) Create(request *dtos.CreateCommentRequest) (*dtos.CreateCommentResponse, error) {
    post, err := s.commentRepo.FindPostByID(request.PostID)
    if err != nil {
        return nil, fmt.Errorf(&quot;failed to find post: %w&quot;, err)
    }

    if !post.Published {
        return nil, fmt.Errorf(&quot;post is not published&quot;)
    }

    comment := &amp;domains.Comment{
        ID:      123,
        Title:   request.Title,
        Content: request.Content,
        PostID:  request.PostID,
    }

    if err := s.commentRepo.Create(comment); err != nil {
        return nil, fmt.Errorf(&quot;failed to create comment: %w&quot;, err)
    }

    response := &amp;dtos.CreateCommentResponse{
        ID:      comment.ID,
        Message: &quot;Comment created successfully&quot;,
    }

    return response, nil
}
</code></pre>
<p>This is a mock of the CommentRepository</p>
<pre><code>package mocks

import (
    &quot;post_comment/domains&quot;

    &quot;github.com/stretchr/testify/mock&quot;
)

type MockCommentRepository struct {
    mock.Mock
}

func (m *MockCommentRepository) Create(comment *domains.Comment) error {
    args := m.Called(comment)

    if args.Get(0) == nil {
        return nil
    }

    return args.Error(0)
}

func (m *MockCommentRepository) FindPostByID(postID uint) (*domains.Post, error) {
    args := m.Called(postID)

    if args.Get(0) == nil {
        return nil, args.Error(1)
    }

    return args.Get(0).(*domains.Post), args.Error(1)
}
</code></pre>
<p>These are the tests for CommentService.</p>
<pre><code>// comment_service_test.go
func (s *CommentService) Create(request *dtos.Create) (*dtos.CreateCommentResponse, error) {
    post, err := s.commentRepo.FindPostByID(request.PostID)
    if err != nil {
        return nil, fmt.Errorf(&quot;failed to find post: %w&quot;, err)
    }

    if !post.Published {
        return nil, fmt.Errorf(&quot;post is not published&quot;)
    }

    comment := &amp;domains.Comment{
        ID:      123,
        Title:   request.Title,
        Content: request.Content,
        PostID:  request.PostID,
    }

    if err := s.commentRepo.Create(comment); err != nil {
        return nil, fmt.Errorf(&quot;failed to update comment: %w&quot;, err)
    }

    response := &amp;dtos.CreateCommentResponse{
        ID:      comment.ID,
        Message: &quot;Comment updated successfully&quot;,
    }

    return response, nil
}

// No problem here
func TestCommentCreateFailsWhenPostIsNotPublished(t *testing.T) {
    // create a mock of CommentRepository
    mockRepo := new(mocks.MockCommentRepository)

    // Create a mock post
    mockPost := &amp;domains.Post{
        Title:     &quot;Test Post&quot;,
        Content:   &quot;Test Content&quot;,
        Published: false,
    }

    var postId uint
    postId = 123

    // mockRepo.On(&quot;FindPostByID&quot;, postId).Return(mockPost, nil)
    mockRepo.On(&quot;FindPostByID&quot;, postId).Return(mockPost, nil)

    // create new comment service
    service := services.NewCommentService(mockRepo)

    // Create a valid request
    request := &amp;dtos.CreateCommentRequest{
        Title:   &quot;Test Comment&quot;,
        Content: &quot;Test Content&quot;,
        PostID:  postId,
    }

    comment, err := service.Create(request)

    // Assert that no error occurred
    assert.Error(t, err)
    assert.EqualError(t, err, &quot;post is not published&quot;)
    assert.Nil(t, comment)
}

// This tests is failing
func TestCreatesCommentSuccessfully(t *testing.T) {
    // create a mock of CommentRepository
    mockRepo := new(mocks.MockCommentRepository)

    var postId uint
    postId = 123

    // Create a mock post
    mockPost := &amp;domains.Post{
        ID:        postId,
        Title:     &quot;Test Post&quot;,
        Content:   &quot;Test Content&quot;,
        Published: true,
    }
    // mockRepo.On(&quot;FindPostByID&quot;, postId).Return(mockPost, nil)
    mockRepo.On(&quot;FindPostByID&quot;, postId).Return(mockPost, nil).Once()

    // create new comment service
    service := services.NewCommentService(mockRepo)

    // Create a valid request
    request := &amp;dtos.CreateCommentRequest{
        Title:   &quot;Test Comment&quot;,
        Content: &quot;Test Content&quot;,
        PostID:  postId,
    }

    mockComment := &amp;domains.Comment{
        ID:      123,
        Title:   request.Title,
        Content: request.Content,
        PostID:  postId,
        Post:    *mockPost,
    }

    mockRepo.On(&quot;Create&quot;, mockComment).Return(nil).Once()

    response, err := service.Create(request)

    // Assert that no error occurred
    assert.NoError(t, err)

    // // Assert the response values
    assert.NotNil(t, response)
    assert.NotNil(t, response.ID)
    assert.Equal(t, &quot;Comment created successfully&quot;, response.Message)

    mockRepo.AssertExpectations(t)
}
</code></pre>
<p>I am not sure what went wrong in the code. Can someone please guide me on resolving this issue? Thank you in advance</p>
",1,248,2023-06-26 16:38,,0,0,what
3812082,Generating fake instances at runtime,<asp.net-mvc><entity-framework><entity-framework-4><mocking>,"<p>I'm looking for an utility class to generate fake entity instances at runtime.
I'm implementing a ASP.NET MVC3 website using EF4 with a <strong>code-first</strong> approach, so I'd like to run the site before creating any database. The fake instances should contain valid data (hopefully reflecting the various DataAnnotation attributes used in each class definition).</p>
",0,239,2010-09-28 11:08,,3,0,what
3594558,looking for a C# mocking framework that allows mocking static methods,<c#><mocking>,"<p>i am required to quickly learn a mocking framework that allows mocking static methods and write test cases for an application written in C#. which framework would you recommend?</p>
",6,2005,2010-08-29 11:36,,1,0,what
78719704,Mock constructor arguments of inherited classes which differ from parent class costructor arguments,<c#><asp.net-core><moq>,"<p>I'm writing tests for controllers actions of ASP.Net Core application. All controllers of my app inherited from base controller, let's call it <code>MyBaseController</code>. Constructor of this class looks like this:</p>
<pre><code>public MyBaseController(ServiceA serviceA, ServiceB serviceB)
{
 m_serviceA = serviceA;
 m_serviceB = serviceB;
}
</code></pre>
<p>So any inherited class can be mocked with this:</p>
<pre><code>protected TController MockedController&lt;TController&gt;() where TController: MyBaseController
{
var moqController = new Mock&lt;TController&gt;(serviceAMock, serviceBMock);

return moqController.Object;
}
</code></pre>
<p>This works fine until we have class which inherited from <code>MyBaseController</code> and require <code>ServiceC serviceC</code> additional argument.</p>
<p>When I tried to run tests for such controllers with extra arguments I've got an error: &quot;Could not find a constructor that would match given arguments&quot;. Situation seems prety clear, but I have no idea how to write general costructor mock to avoid creation of specific methods for such classes (there are a lot of them with different constructor arguments).</p>
<p>Are any ways to achieve my goal? Or the best way is to write individual methods to mock classes with different arguments?</p>
",1,73,2024-07-08 7:57,,2,8,what
42577392,How to test a RestClientException with MockRestServiceServer,<java><spring><mocking><mockserver>,"<p>While testing a RestClient-Implementation I want to simulate a RestClientException that may be thrown by some RestTemplate-methods in that implementation f.e. the delete-method:
</p>

<pre><code>@Override
public ResponseEntity&lt;MyResponseModel&gt; documentDelete(String id) {
    template.setErrorHandler(new MyResponseErrorHandler());
    ResponseEntity&lt;MyResponseModel&gt; response = null;
    try {
        String url = baseUrl + ""/document/id/{id}"";
        response = template.exchange(url, DELETE, null, MyResponseModel.class, id);
    } catch (RestClientException ex) {
        return handleException(ex);
    }
    return response;
}
</code></pre>

<p>How can I achieve this?</p>

<p>I define the mock-server in this way:</p>

<pre><code>@Before
public void setUp() {
    mockServer = MockRestServiceServer.createServer(template);
    client = new MyRestClient(template, serverUrl + "":"" + serverPort);
}
</code></pre>
",17,33303,2017-03-03 11:13,,5,0,how
60556317,How to mock two axios call in same endpoint,<node.js><mocking><jestjs><axios><ava>,"<p><strong>Example:</strong></p>

<p>In my test I need to mock the two calls to the external apis.
I can't mock on the second call. With the library 'axios-mock-adapter' and ava I could only mock the first call.</p>

<pre><code>const read = async (req, res) =&gt; {
  try {
    const responseOne = await axios({
      method: 'get',
      url: 'https://api.example.com/search/repositories',
      params: {
        q: 'example',
      },
    })
    const resultOne = responseOne.data
    if (resultOne) {
      let aux = []
      const itemsOne = resultOne.items.slice(0, 10)
      return Promise.all(
        itemsOne.map((p, indexOne) =&gt; {
          aux = [...aux, { id: p.id, name: p.name, arr: [] }]
          return axios({
            headers: { Authorization: `Bearer ${SECRET_KEY}` },
            method: 'get',
            url: 'https://api.example2.com/search/things',
            params: { q: p.name },
          })
            .then(responseTwo =&gt;
              responseTwo.data.array.map(i =&gt; {
                aux[indexOne].arr.push({
                  id: i.id,
                  created_at: i.created_at,
                  text: i.text,
                })
              })
            )
            .catch(err =&gt; res.status(500).json(err))
        })
      )
        .then(() =&gt; res.json({ result: aux }))
        .catch(err =&gt; res.status(500).json(err))
    } else res.status(404).json({ message: 'Example not found' })
  } catch (err) {
    res.status(500).json(err)
  }
}
</code></pre>

<h3>TEST</h3>

<p>This is my test read.test.js.
Now I am dealing with the 'ava' and 'axios-mock-adapter' libraries. But the second axios call does not working the mock.</p>

<pre><code>import axios from 'axios'
import MockAdapter from 'axios-mock-adapter'
import test from 'ava'
import read from '../read'

var mock = new MockAdapter(axios)


test('GET - /examples', async t =&gt; {
  mock
    .onGet('https://api.example.com/search/repositories, {
      params: {
        q: 'example',
      },
    })
    .reply(200, {
      total_count: 2,
      incomplete_results: false,
      items: [
        {
          id: 555,
          name: 'exampleOne',
        },
        {
          id: 666,
          name: 'exampleTwo',
        },
      ],
    })
    .onGet('https://api.example2.com/search/things', {
      params: { q: 'name' },
      headers: { Authorization: `Bearer ${SECRET_KEY}` },
    })
    .reply(200, {
      statuses: [
        {
          id: 123,
          created_at: 'Thu Feb 27 22:54:02 +0000 2020',
          text: 'Example one.',
        },
        {
          id: 456,
          created_at: 'Wed Feb 26 13:40:20 +0000 2020',
          text: 'Example Two',
        },
      ],
    })

  try {
    const res = await read()
    t.assert(res.result[0].id.test(555))
  } catch (err) {
    console.log(`ERROR::: ${err}`)
  }
</code></pre>
",0,3537,2020-03-06 1:24,,1,2,how
21463557,Mockito test DAO with mocked objects,<java><junit><mocking><mockito><dao>,"<p>I would like to test this DAO method</p>

<pre><code>//in GrabDao.java
public WrapperProject getChildren(Integer entityId, String entityType){

    EntityDao entityDao = new EntityDao();
    UserDao userDao = new UserDao();

    EntityBase entity = entityDao.getEntityById(entityId, entityType);
    Date dateProjet = userDao.getOrganismeFromSession().getExercice().getDateProjet();

    return new Wrapper(dateProjet, entity);
}
</code></pre>

<p>This is what I've tried so far</p>

<pre><code>    //in GrabDaoTest.java
    Integer paramEntityId = 1; 
    String paramEntityType = ""type"";

    EntityBase entityBase = Mockito.mock(EntityBase.class);

    EntityDao entityDao = Mockito.mock(EntityDao.class);
    when(entityDao.getEntityById(paramEntityId, paramEntityType)).thenReturn(entityBase);

    UserDao userDao = Mockito.mock(UserDao.class);
    Organisme organisme = Mockito.mock(Organisme.class);
    Exercice excercice = Mockito.mock(Exercice.class);

    when(userDao.getOrganismeFromSession()).thenReturn(organisme);
    when(organisme.getExercice()).thenReturn(excercice);
    when(userDao.getOrganismeFromSession().getExercice().getDateProjet()).thenReturn(new GregorianCalendar(2000, 01, 01).getTime());
</code></pre>

<p>Now I would like to test that the <strong>getChildren</strong> with fake params <strong>paramEntityId</strong> and <strong>paramEntityType</strong> will correctly return a WrapperProject 1 and 01/01/2000 <strong>using the mocked methods</strong> but I can't figured out how to launch the read method telling her to use the mocked dao</p>
",3,6193,2014-01-30 17:36,,1,0,how
36664276,How to record stub-code for mocked objects,<unit-testing><visual-studio-2015><mocking><tdd>,"<p>Im using NSubstitute for creating mocked objects, basically I am mocking the DAL methods that is used in each unittest (response objects).</p>

<p>I have some great testscenarios in the database that I would like to reproduce as mocked representations (since the data might change).</p>

<p>Is there any way (framework? add-in?) to record/generate code for creating stubbed representations of these calls to the database, to be used in unit tests?</p>

<p>Thanks!</p>
",1,29,2016-04-16 12:37,,1,0,what
46411134,Phoenix Elixir: mock internal functions,<testing><mocking><elixir><phoenix-framework><ecto>,"<p>I'm currently testing controller that uses the function create_zone that depends on a function that retrieves a user to associates said user to a zone and then creates a participant entry that is only an association table of both entries. </p>

<pre><code>  def create_zone(attrs \\ %{}, user_id) do
    user = Accounts.get_user!(user_id)

    with{:ok, %Zone{} = zone} &lt;- %Zone{}
    |&gt; Zone.changeset(attrs,user)
    |&gt; Repo.insert()
    do
    create_participant(zone,user)
   end
  end
</code></pre>

<p>And I would like to test it using ExUnit but the problem is that the testing framework tries to search a non existent record in the database. </p>

<pre><code>** (Ecto.NoResultsError) expected at least one result but got none in query:
   from u in Module.Accounts.User,
   where: u.id == ^1
</code></pre>

<p>How could I mock or create it just for testing purposes?</p>
",1,946,2017-09-25 17:43,,2,1,how
9544039,Test using fake if a method logs an error when an exception is thrown within that method,<unit-testing><fakeiteasy>,"<p><code>enter code here</code>I have a method that logs errors when an exception is thrown within that method.
The method is non-static inside a singleton.</p>

<pre><code>    public object MethodA()
    {
        try
        {
            //code
                             SomeObj.Print(); //updated
        }
        catch (Exception ex)
        {
            log.Error(ex);
        }
    }
</code></pre>

<p>The unit test code below throws NullreferenceException:</p>

<pre><code>                    var fakeLogger = A.Fake&lt;ILog&gt;();

        MySingleton.Instance.Initialize(fakeLogger);

        A.CallTo(() =&gt; MySingleton.Instance.MethodA()
            .Invokes((x) =&gt; { throw new Exception(); });
               //.Throws(new Exception()); --even this doesnt work
        A.CallTo(() =&gt; fakeLogger.Error(A&lt;object&gt;.Ignored)).MustHaveHappened();


Stack trace:
at FakeItEasy.Creation.CastleDynamicProxy.CastleDynamicProxyInterceptionValidator.GetReasonForWhyMethodCanNotBeIntercepted(MethodInfo method)
at FakeItEasy.Creation.CastleDynamicProxy.CastleDynamicProxyInterceptionValidator.MethodCanBeInterceptedOnInstance(MethodInfo method, Object callTarget, String&amp; failReason)
at FakeItEasy.Creation.CastleDynamicProxy.CastleDynamicProxyGenerator.MethodCanBeInterceptedOnInstance(MethodInfo method, Object callTarget, String&amp; failReason)
at FakeItEasy.Creation.ProxyGeneratorSelector.MethodCanBeInterceptedOnInstance(MethodInfo method, Object callTarget, String&amp; failReason)
at FakeItEasy.Configuration.DefaultInterceptionAsserter.AssertThatMethodCanBeInterceptedOnInstance(MethodInfo method, Object callTarget)
at FakeItEasy.Configuration.FakeConfigurationManager.AssertThatMemberCanBeIntercepted(LambdaExpression callSpecification)
at FakeItEasy.Configuration.FakeConfigurationManager.CallTo(Expression`1 callSpecification)
at FakeItEasy.A.CallTo(Expression`1 callSpecification)
</code></pre>

<p>Solution:
I had to make my non-fake method throw an exception and this is how I did.</p>

<pre><code>var fakeLogger = A.Fake&lt;ILog&gt;();
var someObject = A.Fake&lt;SomeObject&gt;();
MySingleton.Instance.Initialize(fakeLogger);
A.CallTo(() =&gt; someObject.Print()).Throws(new Exception()); //key
MySingleton.Instance.MethodA();
A.CallTo(() =&gt; fakeLogger.Error(A&lt;object&gt;.Ignored)).MustHaveHappened();
</code></pre>
",0,1214,2012-03-03 6:23,,2,0,other
26401686,MOQ - Why is below not mocking?,<c#><mocking><moq>,"<p>Anyone have any idea why below still calls YesService?</p>

<p>It almost seems like IYesService is considered separate to YesService..</p>

<p>Any ideas?</p>

<pre><code>public interface IYesService
{
    string Hello();
}
public class YesService : IYesService
{
    public string Hello()
    {
        return ""Yes"";
    }

}

class Program
{

    static void Main(string[] args)
    {
        var _mock = new Mock&lt;IYesService&gt;();
        _mock.Setup(x =&gt; x.Hello()).Returns(""No"");

        var service = new YesService();
        var result = service.Hello();

        Console.Write(result);
        Console.ReadLine();
    }
}
</code></pre>
",0,322,2014-10-16 10:08,,2,0,why
9191636,Asp.Net Mvc HtmlHelper testing VeiwContext.Writer.WriteLine,<asp.net-mvc-3><razor><moq><html-helper><xunit.net>,"<p>I have a HtmlHelper which is used to output some accordion style functionality. This helper is going to be used extensively throughout the site. </p>

<p>The code used to create this functionality makes extensive use of <code>TagBuilder</code> and of course we are outputting the html using:</p>

<pre><code>htmlHelper.ViewContext.Writer.WriteLine(someTag.ToString(TagRenderMode.StartTag));
</code></pre>

<p>We have a few helpers which use this pattern and it's working great. </p>

<p>All good so far - it does exactly what I want. However - testing this is proving to be a nightmare. how do i test <code>htmlHelper.ViewContext.Writer.WriteLine</code> ?</p>

<p>we're using xUnit and Moq if it matters</p>
",2,871,2012-02-08 10:36,,2,5,how
28544252,"Trying to swap a model in my controller test with IoC Container, but object not swapper",<php><laravel><mockery>,"<p>I'm trying to use IoC Container to swap out my Question model when testing. Although I've created a mock model, and using App::instance() to attempt to swap the dependency during my test, I can see from <code>var_dump</code> that it isn't working. What is wrong with my code?</p>

<pre><code>&lt;?php

class QuestionsControllerTest extends TestCase {

    protected $mock;

    public function __construct()
    {
        // This is how Net tuts tutorial instructed, but 
        // I got Eloquent not found errors
        // $this-&gt;mock = Mockery::mock('Eloquent', 'Question');

        // so I tried this instead, and it created the mock
        $this-&gt;mock = Mockery::mock('App\Question'); 
    }

    public function tearDown()
    {
        Mockery::close();
    }

    public function testQuestionIndex()
    {
        // var_dump(get_class($this-&gt;mock)); exit; // outputs: Mockery_0_App_Question
        // var_dump(get_class($this-&gt;app)); exit; // outputs: Illuminate\Foundation\Application

       $this-&gt;mock
           -&gt;shouldReceive('latest')
           -&gt;once()
           -&gt;andReturnSelf();

        $this-&gt;mock
            -&gt;shouldReceive('get') //EDIT: should be get
            -&gt;once()
            -&gt;andReturn('foo');

    $this-&gt;app-&gt;instance('App\Question', $this-&gt;mock);


        // dispatch route

        $response = $this-&gt;call('GET', 'questions');

        $this-&gt;assertEquals(200, $response-&gt;getStatusCode());
    }
}
</code></pre>

<p>So far so good? Below is my QuestionsController:</p>

<pre><code>class QuestionsController extends Controller {

    protected $question;

    public function index(Question $question)
    {
        // var_dump(get_class($question)); exit; // Outputs App\Question when testing too

        $questions = $question
            -&gt;latest()
            -&gt;get();

        return view('questions.index', compact('questions'));
    }
    ...
</code></pre>

<p>So, without the object being swapped, it doesn't register anyway call to the methods:</p>

<pre><code>Mockery\Exception\InvalidCountException: Method latest() from Mockery_0_App_Question should be called
 exactly 1 times but called 0 times.
</code></pre>

<p>By the way, I've installed Mockery ~0.9, Laravel 5.0, and PHPUnit ~4.0. Would really really appreciate any help on this.</p>
",3,1201,2015-02-16 15:00,,2,2,what
7878773,How to assert block of a mock in mocha,<ruby><unit-testing><mocking><ruby-mocha>,"<p><em>This example is contrived, please don't take it verbatim as my code.</em></p>

<p>I have the need to assert something like the following:</p>

<pre><code>def mymethod
    Dir.chdir('/tmp') do
        `ls`
    end
end
</code></pre>

<p>In the end I want to assert that:</p>

<ol>
<li>Dir.chdir is invoked with the appropriate parameters.</li>
<li>` is invoked with the appropriate parameters</li>
</ol>

<p>I started off with...</p>

<pre><code>Dir.expects(:chdir).with('/tmp')
</code></pre>

<p>but after that I'm not sure how to invoke the block passed to Dir.chdir.</p>
",5,2540,2011-10-24 16:28,,1,0,how
58030610,NSubstitute method called multiple times with specific sequence of args?,<c#><mocking><nsubstitute>,"<p>I want to check that a specific method is called N times, first with arg x1, then x2, then x3, etc. and finally with arg xN. I know it could be done like this:</p>

<pre><code>Received.InOrder(() =&gt; {
    subst.MyMethod(x1);
    subst.MyMethod(x2);
    subst.MyMethod(x3);
    // ...
    subst.MyMethod(xN);
});
</code></pre>

<p>But can it be done in some way that simply lists the sequence of arguments? </p>

<p>Something like this (conceptual):</p>

<pre><code>int[] args = {x1, x2, x3, /*...*/ xN};
subst.Received(N).MyMethod(Arg.Is(args));
</code></pre>

<p>Here's an implementation with <code>InOrder</code> but I consider it a workaround:</p>

<pre><code>int[] args = {x1, x2, x3, /*...*/ xN};
Received.InOrder(() =&gt; {
    foreach (int i in args)
        subst.MyMethod(i);
});
</code></pre>
",2,1341,2019-09-20 14:44,,1,3,what
28510694,Test a nested method call on a mocked class using ScalaMock,<scala><unit-testing><mocking><scalatest><scalamock>,"<p>I am new to both ScalaMock and mocking in general. I am trying to test a method which calls a method in another (mocked) class and then calls a method on the returned object.</p>

<p><strong>Detailed information:</strong></p>

<p>So I am using ScalaTest and there are five classes involved in this test...</p>

<p>SubInstruction which I am testing</p>

<pre><code>class SubInstruction(label: String, val result: Int, val op1: Int, val op2: Int) extends Instruction(label, ""sub"") {

  override def execute(m: Machine) {
    val value1 = m.regs(op1)
    val value2 = m.regs(op2)
    m.regs(result) = value1 - value2
  }
}

object SubInstruction {
  def apply(label: String, result: Int, op1: Int, op2: Int) =
    new SubInstruction(label, result, op1, op2)
}
</code></pre>

<p>Machine which must be mocked for the test</p>

<pre><code>case class Machine(labels: Labels, prog: Vector[Instruction]) {
  private final val NUMBEROFREGISTERS = 32
  val regs: Registers = new Registers(NUMBEROFREGISTERS)

  override def toString(): String = {
    prog.foldLeft("""")(_ + _)
  }

  def execute(start: Int) =
    start.until(prog.length).foreach(x =&gt; prog(x) execute this)
}

object Machine extends App {
  if (args.length == 0) {
    println(""Machine: args should be sml code file to execute"")
  } else {
    println(""SML interpreter - Scala version"")

    val m = Translator(args(0)).readAndTranslate(new Machine(Labels(), Vector()))

    println(""Here is the program; it has "" + m.prog.size + "" instructions."")
    println(m)
    println(""Beginning program execution."")
    m.execute(0)
    println(""Ending program execution."")
    println(""Values of registers at program termination:"")
    println(m.regs + ""."")
  }
}
</code></pre>

<p>Registers which is required to construct a Machine object</p>

<pre><code>case class Registers(size: Int) {
  val registers: Array[Int] = new Array(size)

  override def toString(): String =
    registers.mkString("" "")

  def update(k: Int, v: Int) = registers(k) = v
  def apply(k: Int) = registers(k)
}
</code></pre>

<p>MockableMachine which I have created as the original Machine class does not have an empty constructor and therefore (as I understand) can not be mocked</p>

<pre><code>class MockableMachine extends Machine(Labels(), Vector()){

}
</code></pre>

<p>and finally my test class SubInstructionTest which compiles but throws the exception below.</p>

<pre><code>class SubInstructionTest extends FlatSpec with MockFactory with Matchers {

  val label1 = ""f0""
  val result1 = 25
  val op1_1 = 24
  val op2_1 = 20
  val sub1 = SubInstruction(label1, result1, op1_1, op2_1)

  ""A SubInstruction"" should ""retrieve the operands from the correct registers in the given machine "" +
    ""when execute(m: Machine) is called, and perform the operation saving the "" +
    ""result in the correct register."" in {
    val mockMachine = mock[MockableMachine]

    inSequence {
      (mockMachine.regs.apply _).expects(op1_1).returning(50)
      (mockMachine.regs.apply _).expects(op2_1).returning(16)
      (mockMachine.regs.update _).expects(result1, 34)
    }
    sub1.execute(mockMachine)

  }

}
</code></pre>

<p><strong>Throws:</strong></p>

<p><strong>java.lang.NoSuchMethodException: Registers.mock$apply$0()</strong></p>

<p>-</p>

<p>I have been searching for a straightforward way to mock this class for hours, but have found nothing. For the time being I have settled on the workaround detailed below, but I was under the impression that mocking would offer a less convoluted solution to the problem of testing my SubInstruction class. </p>

<p><strong>The workaround:</strong></p>

<p>Delete the MockableMachine class and create a CustomMachine class which extends Machine and replaces the registers value with mockedRegisters provided at construction time. </p>

<pre><code>class CustomMachine (mockedRegister: Registers) extends Machine(Labels(), Vector()) {
  override
  val regs: Registers = mockedRegister
}
</code></pre>

<p>a MockableRegisters class which I have created as the original does not have an empty constructor and therefore (as I understand) can not be mocked</p>

<pre><code>class MockableRegisters extends Registers(32) {

}
</code></pre>

<p>and the SubInstructionTest class written in a slightly different way </p>

<pre><code>class SubInstructionTest extends FlatSpec with MockFactory with Matchers {

  val label1 = ""f0""
  val result1 = 25
  val op1_1 = 24
  val op2_1 = 20
  val sub1 = SubInstruction(label1, result1, op1_1, op2_1)

  ""A SubInstruction"" should ""retrieve the operands from the correct registers in the given machine "" +
    ""when execute(m: Machine) is called, and perform the operation saving the "" +
    ""result in the correct register."" in {
    val mockRegisters = mock[MockableRegisters]
    val machine = new CustomMachine(mockRegisters)

    inSequence {
      (mockRegisters.apply _).expects(op1_1).returning(50)
      (mockRegisters.apply _).expects(op2_1).returning(16)
      (mockRegisters.update _).expects(result1, 34)
    }
    sub1.execute(machine)

  }

}
</code></pre>

<p><strong>As indicated, this feels like a workaround to me, is there not a simpler way to do this (perhaps similar to my original attempt)?</strong></p>

<p>I have just included the essential code to ask the question, but you can find the full code on my <a href=""https://github.com/BBK-SDP-2015-ahormo01/individual"" rel=""nofollow"">GitHub account</a>. </p>
",0,1699,2015-02-13 23:49,,1,0,what
24730882,Can Mocking/Stubbing happen without the actual class file?,<php><mocking><phpunit><stubbing>,"<p>I was wondering if Mocking/Stubbing can be done without the original class file that has to be mocked/stubbed?</p>
",0,42,2014-07-14 6:45,,1,2,what
36549657,mocking and testing a single method in the class (MagicMock/py.test),<python><unit-testing><mocking><pytest>,"<p>I want to write a test for a single method in class (let's say it is a 'str' class):</p>

<pre><code>   mocked_str = mock.MagicMock(str)
   str.__len__(mocked_str)
</code></pre>

<p>But it fails:</p>

<pre><code>TypeError: descriptor '__len__' requires a 'str' object but received a 'MagicMock'
</code></pre>

<p>How can I mock whole class except a single function from it (for testing)? Thanks.</p>
",0,302,2016-04-11 13:08,,1,1,how
61462492,"Actual function call count doesn't match EXPECT_CALL(mockImplClass, receive(_, _))",<c++11><googletest><googlemock>,"<p>I am facing problem while running gtest for the following code sample.
ignore header includes as its compilable and running fine.</p>

<pre><code>Error:
GMOCK WARNING:
Uninteresting mock function call - returning default value.
    Function call: receive(0x7ffcee4fc990, 0x7ffcee4fc900)
          Returns: 0
NOTE: You can safely ignore the above warning unless this call should not happen.  Do not suppress it by blindly adding an EXPECT_CALL() if you don't mean to enforce the call.  See https://github.com/google/googletest/blob/master/googlemock/docs/CookBook.md#knowing-when-to-expect for details.
/data/home/sipadhy/unit_test_research/gTest/ImplClassTest.cpp:174: Failure
Actual function call count doesn't match EXPECT_CALL(mockImplClass, receive(_, _))...
         Expected: to be called at least once
           Actual: never called - unsatisfied and active
</code></pre>

<p>Sample Code:</p>

<p>// Main Class where function to be mocked</p>

<pre><code>class ImplClass
{
public:
    virtual int receive(structX* x, structY* y){ // some logic }
};
</code></pre>

<p>// An intermidiate class which calls the main class</p>

<pre><code>class IntermidiateClass
{
    std::shared_ptr&lt;ImplClass&gt; implClassPtr = nullptr;
public:
    setImplClassptr(std::shared_ptr&lt;ImplClass&gt; ptr)
    {
        implClassPtr  = ptr;
    }
    int getValue()
    {
        structX x;
        structY y;
        return(implClassPtr-&gt;receive(x, y));
    }
};
</code></pre>

<p>// Mock Class</p>

<pre><code>class MockImplClass: public ImplClass
{
public:
    MOCK_METHOD2(receive, int(structX, structY));
}
</code></pre>

<p>// Test case</p>

<pre><code>TEST(MyTest, TEST1)
{
    MockImplClass mockImplClass;
    IntermidiateClass intermidiateObj;
    intermidiateObj.setImplClassptr(std::make_shared&lt;MockImplClass&gt;());

    EXPECT_CALL(mockImplClass, receive(_, _))
    .Times(AtLeast(1))
    .WillRepeatedly(Return(1));

    int retVal = intermidiateObj.getValue();
}
</code></pre>

<p>Thanks,
Siva</p>
",1,470,2020-04-27 15:32,,1,0,other
77029328,Checking for Add method in mocked DbContext not working with NSubstitute,<nsubstitute>,"<p>I'm trying to verify that the <code>Add</code> method was called on the database context, so I tried this:</p>
<pre class=""lang-cs prettyprint-override""><code>var context = Substitute.For&lt;LampContext&gt;();

// Call code the results in a context.Add being made

_context.ReceivedWithAnyArgs(1).Add(Arg.Any&lt;ChangeLog&gt;);
</code></pre>
<p>That's saying that no matching call was made, but if I debug the test and step through the code, I do see the <code>Add</code> call happening. What's the proper way to make this check?</p>
",0,30,2023-09-02 17:28,,0,4,what
69230853,Sequelize findAll not returning expected output on sequelize-mock,<mysql><node.js><unit-testing><mocking><sequelize.js>,"<p>I'm trying to do unit testing on my nodejs-express method with sequelize-mock.</p>
<p><strong>Controller</strong></p>
<pre><code>const getDetailsByUserId = async (id) =&gt; {
        try {
            const userId = id ?? 0;
            const details = await Model.findAll(
                {
                    raw: true,
                    where: { user_id: userId  }
                }
            );
            
            if (details &amp;&amp; details .length &gt; 0) {
                return {
                    status: 200,
                    success: true,
                    message: 'details found.',
                    data: details 
                }
            }
    
            return {
                status: 404,
                success: false,
                message: 'details not found',
                data: []
            }
        } catch (error) {
            return {
                status: 500,
                success: false,
                message: error.message || &quot;An error occurred while getting details.&quot;,
                data: null
            }
        }
    }
</code></pre>
<p><strong>Test</strong></p>
<pre><code>jest.mock('../models/details', () =&gt; () =&gt; {
    const SequelizeMock = require(&quot;sequelize-mock&quot;);
    const dbMock = new SequelizeMock();
    return dbMock.define('users', [
        {
            id: 1,
            user_id: 123
            name: 'John Doe 1'
        },
        {
            id: 2,
            user_id: 456
            name: 'John Doe 2'
        },
        {
            id: 3,
            user_id: 789
            name: 'John Doe 3'
        }
    ]);
});

test('should return 404 and an empty array', async () =&gt; {
            const userId = 147;
            const details = await controller.getDetailsByUserId(userId);

            expect(details.status).toEqual(404);
        });
</code></pre>
<p>I always get the status of 200 instead of 404 here. I checked the returned data and it's returning the records of the defined mocked model.</p>
<p><strong>Actual Result:</strong></p>
<pre><code>[
      fakeModelInstance {
        options: {
          timestamps: true,
          paranoid: undefined,
          createdAt: undefined,
          updatedAt: undefined,
          deletedAt: undefined,
          isNewRecord: true
        },
        _values: {
          '0': [Object],
          '1': [Object],
          '2': [Object],
          user_id: 147,
          id: 1,
          createdAt: 2021-09-18T00:55:25.976Z,
          updatedAt: 2021-09-18T00:55:25.976Z
        },
        dataValues: {
          '0': [Object],
          '1': [Object],
          '2': [Object],
          user_id: 147,
          id: 1,
          createdAt: 2021-09-18T00:55:25.976Z,
          updatedAt: 2021-09-18T00:55:25.976Z
        },
        hasPrimaryKeys: true,
        __validationErrors: []
      }
    ]
</code></pre>
<p><strong>QUESTIONS:</strong></p>
<ol>
<li>Is there something I can do to get the expected result (empty array) for this scenario?</li>
<li>the <code>raw: true</code> seems to be not working when it is mocked. Is there a way could log the result on raw object?</li>
</ol>
<p><strong>NOTE:</strong> This only happens on the unit testing. When accessing the endpoint on postman it returns the expected result.</p>
",1,1299,2021-09-18 1:19,,2,1,what
5777782,Mocking EJB injection in tests,<java><junit><ejb><easymock>,"<p>Whenever I want to test a class which uses resource injection I end up including a constructor that will only be used within the test:</p>

<pre><code>public class A {

    @EJB
    B b;

    // Used in tests to inject EJB mock
    protected A(B b) {
        this.b = b;
    }

    public A() {}

    // Method that I wish to test
    public void foo() {
        b.bar();
    }

}
</code></pre>

<p>Is there another way of mocking resource injection or this is the correct pattern to follow?</p>
",5,7914,2011-04-25 11:15,,4,0,what
15213739,When Condition Method in Moq,<c#><unit-testing><mocking><nunit><moq>,"<p>I am trying to figure how to use When method for my use. </p>

<pre><code>When(Func&lt;bool&gt; condition);
</code></pre>

<p>Another post here has one example of usa of When method</p>

<pre><code>var mockedService = new Mock&lt;IFormatProvider&gt;();

mockedService.When(() =&gt; DateTime.Now.Hour &lt; 12).Setup(x =&gt; x.GetFormat(typeof(string))).Returns(null);
</code></pre>

<p>What I am trying to do is I have a variable called x. I want to use When method so it performs action only when X is not Null.</p>

<p>for example</p>

<pre><code>      mockedService.When(()=&gt; !null x).Returns(x)
      or
      mockedService.When(condition =&gt; x).Returns(x);
</code></pre>

<p>Both of the above lines of code are not working syntex is not correct. 
Any idea how to write it correctly. Thanks </p>
",0,4322,2013-03-05 0:32,,1,0,how
75613515,Cannot see log from unit test in Android Studio,<android><kotlin><unit-testing><logging><mockk>,"<p>I'm working on an Android app written in Kotlin. I would like to use Log.* to see the output of some very simple logic in a unit test, rendered as string. I'm using <a href=""https://mockk.io/"" rel=""nofollow noreferrer"">mockk</a> as suggestested in <a href=""https://stackoverflow.com/a/55251961"">this other question</a>.</p>
<p>I don't get any errors, the test works fine; however, not even a single line is printed in the Logcat of Android Studio. I checked filters and current device with no avail.</p>
<p>Here is my simplified code:</p>
<pre><code>// UnitTest.kt
class MyUnitTest {
  @Before
  fun setup() {
    mockkStatic(Log::class)
    every { Log.d(any(), any()) } returns 0
  }

  @Test
  fun do_test() {
    // ... some logic
    Log.d(&quot;TEST_TAG&quot;, &quot;Test string&quot;)
  }
}
</code></pre>
<p>I also tried to:</p>
<ul>
<li>put the Log in a function marked as <code>@JvmStatic</code> into a companion object</li>
<li>adding the following to app level <code>build.gradle</code> as suggested <a href=""https://stackoverflow.com/a/57958441/3861701"">here</a> (though unrecommended)</li>
</ul>
<pre><code>testOptions {
  unitTests.returnDefaultValues = true
} 
</code></pre>
<ul>
<li>get rid of everything and use a kotlin implementation of the <a href=""https://stackoverflow.com/a/46793567"">main answer</a>. Something like this:</li>
</ul>
<pre><code>// app/src/test/android/util/MyLog.kt
package android.util

class MyLog {
  companion object {
    @JvmStatic
    fun d(tag: String, msg: String): Int {
      println(&quot;DEBUG: $tag: $msg&quot;)
      return 0
    }
}
</code></pre>
<p>Unfortunately none of these worked (with any of the Log levels).</p>
<p>I don't have great experience in writing tests, am I missing something?</p>
<p><strong>Edit (about solution):</strong></p>
<p>I was targeting Logcat, which is wrong, because unit tests run on a local machine.</p>
",2,2488,2023-03-02 9:29,,1,0,what
10054845,How to set expectation to params passed to void methods using EasyMock,<easymock>,"<p>I am using EasyMock and EasyMock CE 3.0 to mock dependent layers and test my classes. Below is the scenario for which I am not able to find any solution</p>

<p>I have class to be tested, which calls a dependent class <strong>void method that takes an input param, and alters the same param</strong>. The method that I am testing is doing some operations based on the altered param, which I have to test now for various scenarios</p>

<p>Consider the below sample, where I have tried to put the same scenario</p>

<pre><code>public boolean voidCalling(){
    boolean status = false;
    SampleMainBean mainBean = new SampleMainBean();
    dependentMain.voidCalled(mainBean);
    if(mainBean.getName() != null){
        status = true; 
    }else{
        status = false;
    }
    return status;
}
</code></pre>

<p>And the dependentMain class the below method</p>

<pre><code>public void voidCalled(SampleMainBean mainBean){
    mainBean.setName(""Sathiesh"");
}
</code></pre>

<p>To have full coverage, I need to have 2 test cases to test both the scenarios where true and false are returned, but I always get false as I am not able to set the behaviour of the void method to alter this input bean. How can I get a true as result in this scenario using EasyMock</p>

<p>Thanks in advance for any help.</p>
",4,6489,2012-04-07 13:20,,2,0,how
69125235,Mock issue - Value cannot be null. (Parameter 'source'),<c#><testing><moq>,"<p>I am trying to test an API service using Moq and am getting the error message:</p>
<blockquote>
<p>Value cannot be null. (Parameter 'source').</p>
</blockquote>
<p>Below is the code [Which is already working fine in the real world, the Mock is a retrospective project.]</p>
<pre><code>models = new List&lt;MyModel&gt; {
    new MyModel
    {
    Id = 1,
    Name = &quot;John Smith&quot;,
    Status = &quot;Engineer&quot;,
    Centre = 9999
    },
    new MyModel
    {
    Id = 2,
    Name = &quot;Jane Doe&quot;,
    Status = &quot;Manager&quot;,
    Centre = 9999
    } };

var mockDbSet = new Mock&lt;DbSet&lt;MyModel&gt;&gt;();
mockDbSet.As&lt;IQueryable&lt;MyModel&gt;&gt;().Setup(m =&gt; m.Provider).Returns(models.AsQueryable().Provider);
mockDbSet.As&lt;IQueryable&lt;MyModel&gt;&gt;().Setup(m =&gt; m.Expression).Returns(models.AsQueryable().Expression);
mockDbSet.As&lt;IQueryable&lt;MyModel&gt;&gt;().Setup(m =&gt; m.ElementType).Returns(models.AsQueryable().ElementType);
mockDbSet.As&lt;IQueryable&lt;MyModel&gt;&gt;().Setup(m =&gt; m.GetEnumerator()).Returns(models.GetEnumerator());
mockDbSet.Setup(m =&gt; m.Add(It.IsAny&lt;MyModel&gt;())).Callback&lt;MyModel&gt;(models.Add);

mockContext = new Mock&lt;LiveDbContext&gt;();
mockContext.Setup(m =&gt; m.Add(models)).Callback&lt;DbSet&lt;MyModel&gt;&gt;(mockDbSet.Object.AddRange);

myService = new LiveService(mockContext.Object);            
var result = myService.GetStaffByCentre(9999).Result.ToList();

//Assert
Assert.AreEqual(1, result.Count);            
</code></pre>
<p>The line that appears to be causing the error is the</p>
<pre><code>var result = myService.GetStaffByCentre(9999).Result.ToList();
</code></pre>
",0,1336,2021-09-09 22:14,,2,1,other
42887057,Dart Angular replacing provider with mock in unit testing,<unit-testing><angular><mocking><dart><mockito>,"<p>How can I replace the provider <code>QuizService</code> to <code>QuickServiceMock</code> in Angular Dart unit testing?</p>

<p>I tried using <code>addProviders</code> method but that didn't replace <code>QuizService</code> with <code>QuizkServiceMock</code>.</p>

<p>It seems <code>MultipleChoiceQuizComponent</code> is still using the original class <code>QuizkService</code> and not <code>QuizServiceMock</code> like I want it to.</p>

<pre><code>import 'dart:html';
import 'package:angular2/angular2.dart';
import 'package:angular_test/angular_test.dart';
import 'package:test/test.dart';
import 'package:mockito/mockito.dart';

import '...quiz_service.dart';
import '...multiple_choice_quiz_component.dart';
import '...multiple_choice_quiz.dart';

class MockQuizService extends Mock implements QuizService {}

@AngularEntrypoint()
void main()
{
    group('$MultipleChoiceQuizComponent', () {
        MockQuizService quizServiceMock;
        setUp(() async {
            quizServiceMock = new MockQuizService();
            List&lt;String&gt; mockChoiceList = [
                ""incorrect1"",
                ""incorrect2"",
                ""correct answer"",
                ""incorrect3""
            ];
            when(quizServiceMock.getQuiz())
                .thenReturn(
                    new MultipleChoiceQuiz(
                        mockChoiceList,
                        ""correct answer"",
                        'test question description'
                )
            );
        });

        test('should add ""incorrect"" css class to incorrect answer', () async {
            NgTestBed bed = new NgTestBed&lt;MultipleChoiceQuizComponent&gt;().addProviders([
                provide(QuizService, useValue: quizServiceMock)
            ]);
            NgTestFixture fixture = await bed.create();
            Element answer = fixture.rootElement.querySelector('.quiz-choice:nth-child(2)');
            answer.dispatchEvent(new MouseEvent('click'));
            bool hasClass = answer.classes.contains('incorrect');
            expect(hasClass, true);
        });
    });

}
</code></pre>

<p><strong>multiple_choice_quiz_component.dart:</strong></p>

<pre><code>import 'package:angular2/core.dart';
import 'package:angular2/common.dart';
import 'package:angular2_components/angular2_components.dart';

import '.../quiz/quiz.dart';
import '.../service/quiz_service.dart';

@Component
(
    selector: 'multiple-choice-quiz-component',
    directives: const [materialDirectives, NgFor],
    providers: const [materialProviders, QuizService],
    templateUrl: 'multiple_choice_quiz_component.html',
    styleUrls: const['/app_component.css', 'quiz.css']
)

class MultipleChoiceQuizComponent
{
    String selectedAnswer;
    String description;
    bool correctAnswer = false;
    Quiz quiz;

    MultipleChoiceQuizComponent(QuizService quizService)
    {
        this.quiz = quizService.getQuiz();
    }

    void onSelect(String answer)
    {
        selectedAnswer = answer;
        this.correctAnswer = this.quiz.isAnswer(answer);
    }
}
</code></pre>

<p>What am I missing?</p>
",0,481,2017-03-19 13:20,,1,9,how
21614741,"Easiest way to ""Mock"" out an object implementing a property-only protocol",<ios><objective-c><mocking><protocols>,"<p>Excuse me for my crazy needs, but I'm creating a bunch of property-only protocols in a framework I'm writing.</p>

<pre><code>@protocol SomePropertiesOfAnObjectThing &lt;NSObject&gt;

@property (nonatomic, strong) NSString *larry;
@property (nonatomic, strong) NSString *curly;
@property (nonatomic, strong) NSString *moe;

@end
</code></pre>

<p>Is there a way, more importantly an easy way, to ""mock"" out an object that implements this protocol?</p>

<pre><code>id&lt;SomePropertiesOfAnObjectThing&gt; thingy = [ProtocolObject fromProtocol:@protocol(SomePropertiesOfAnObjectThing)];

thingy.larry = @""fizz"";
thingy.curly = @""buzz"";
thingy.moe = @""bar"";
</code></pre>

<p>The 2 things I'm trying to avoid:</p>

<ol>
<li>Explicitly creating a new class</li>
<li>3rd party dependencies (such as OCMock)</li>
</ol>

<p>I will shower anyone who can show me a clean and easy way with up votes (well, 1 at least).</p>
",0,74,2014-02-06 21:46,,2,0,what
42536191,MVC controller unit testing - entity framework,<asp.net-mvc><entity-framework><unit-testing><asp.net-mvc-5><mocking>,"<p>I would like to test GetTaskToDo() controller method(i.e check if there is any return result) that take some data from db.</p>

<p>In Unit Test project I added app.config file with connection strings, but after invoking GetTaskToDo() method i get error:</p>

<blockquote>
  <p>System.Data.Entity.Core.EntityException : The underlying provider
  failed on Open.   ----> System.Data.SqlClient.SqlException : Cannot
  attach the file
  'aspnet-test-20170222081336.mdf'
  as database 'aspnet-test-20170222081336'.</p>
</blockquote>

<p><strong>MVC Controller:</strong></p>

<pre><code>public class HomeController : Controller
    {
        public ActionResult Index()
        {
            return View();
        }

        public JsonResult GetTasksToDo()
        {
            var tasks = new List&lt;Tasks&gt;();
            using (Entities dc = new Entities())
            {
                tasks = dc.Tasks.Where(a =&gt; a.State == ""ToDo"").ToList();
                tasks = tasks.OrderBy(a =&gt; a.Order).ToList();
            }
            return new JsonResult { Data = tasks, JsonRequestBehavior = JsonRequestBehavior.AllowGet };
        }
</code></pre>

<p><strong>Simple Unit test:</strong></p>

<pre><code>        [Test]
        public void Test_GetTasksToDo()
        {
            var sut = new HomeController();

            var test = sut.GetTasksToDo();
        }
</code></pre>

<p>How should I test this? Should I somehow mock entity framework which is used by that method? I'm quite new in this, I would be very grateful for every hint.</p>
",2,476,2017-03-01 15:49,,0,2,how
65327875,Mockito - returning null,<java><unit-testing><mocking><mockito>,"<p>I have the following implementation of class A, using spring boot.
A is an abstraction over restTemplate to make GET/POST/PUT RestAPI calls.
Tests are written using Mockito.</p>
<pre><code>Class A {

@Bean
RestTemplate restTemplate;

public class A(RestTemplate restTemplate){
    this.restTemplate = restTemplate;
}

public ResponseEntity perform(String endPoint, String requestBody, String auth, HttpMethod httpMethod){
    ...code to create parameters to pass to the exchange method
    ResponseEntity responseEntity = restTemplate.exchange(url, httpMethod, requestEntity, String.class)
    return responseEntity;
 }

}
</code></pre>
<p><strong>Unit Test With Mockito:</strong></p>
<pre><code>class ATest{
    A a;

    @Spy
    RestTemplate restTemplate;

    @Before
    public void setUp() {
        a = Mockito.spy(new A(restTemplate));
    }
    
      @Test
    public void testHttpUtil(){
        ResponseEntity responseEntity = new ResponseEntity(HttpStatus.OK);
        HttpHeaders headers = new HttpHeaders();
        headers.set(&quot;Authorization&quot; , &quot;testAuth&quot;);
        HttpEntity&lt;String&gt; requestEntity = new HttpEntity&lt;String&gt;(&quot;testPayload&quot;, headers);
        Mockito.doReturn(responseEntity).when(restTemplate).exchange(Mockito.any(),Mockito.eq(HttpMethod.POST), Mockito.any(HttpEntity.class), Mockito.eq(String.class));
        ResponseEntity responseEntity1 = a.perform(&quot;https://example.com/v1/testapi&quot;, &quot;testpayload&quot;, &quot;testauthinfo&quot;, MediaType.APPLICATION_JSON_VALUE, HttpMethod.POST );
        Assert.assertNotNull(responseEntity1);
        Mockito.verify(restTemplate, Mockito.atMost(1)).exchange(Mockito.any(),Mockito.eq(HttpMethod.POST), Mockito.any(HttpEntity.class), Mockito.eq(String.class));

    }
}
</code></pre>
<p>My thought behind this implementation is to mock the restTemplate's exchange method, and return a response, upon calling A's perform method.
Right now null is being returned upon A's perform method.
Looks like I am doing something wrong. Can someone pls assist me on this?</p>
<p>To circumvent this, I mocked the RestTemplate and used</p>
<p><code>Mockito.verify(restTemplate, Mockito.atMost(1)).exchange(Mockito.any(),Mockito.eq(HttpMethod.POST), Mockito.any(HttpEntity.class), Mockito.eq(String.class));</code>
to find out how many times restTemplate.exchange method has been called. Tests are passing now. But still want to know what's wrong with the implementation posted in the question</p>
",0,482,2020-12-16 17:07,,1,4,how
28268602,Mocking a random return value in ASP.NET MVC for SpecFlow,<c#><asp.net-mvc><mocking><ui-automation><specflow>,"<p>I am using Specflow and WebDriver to test my ASP.Net MVC application. </p>

<p>I would like to use mocks with ASP.Net MVC in my high level Specflow tests. This would be used to set the app into a known state. </p>

<p>Within the ASP.Net app, there is a class, with a method that returns a random value. I would like to mock this class so that I know what value will be returned, and I know what to expect in the tests.</p>

<p>Note this can't be done through the use of database data. The randomness is not effected by the database.    </p>

<p>I understand this can be done in lower level tests (like controller tests, and other unit tests) however I would like to know how can I do this from Specflow. Some form of Dependency Injection would be good. </p>

<p>I have read about Deleporter, but that project seems to be inactive. If it's not, then please correct me. </p>

<p>Do you have any pointers for me? </p>

<p>Thanks</p>
",1,1674,2015-02-01 22:20,,2,3,how
59014713,How to mock objects in C# using Visual Studio Unit Testing framework or NUnit framework?,<c#><visual-studio><unit-testing><mocking><nunit>,"<p>I have moved to developing applications in C# from Java. I came across the Visual Studio unit testing framework provided by Visual Studio, and another framework called NUnit. </p>

<ol>
<li>Which of these frameworks support mocking objects, or something similar to returning specific response to a method in another project whose source code is not available?</li>
</ol>

<p>I'm using Visual Studio Pro, so Microsoft Fakes is not applicable to me. Also, I came across moq, and rhinomocks but I'm not sure about these. </p>

<ol start=""2"">
<li>I was wondering if I can use a unit testing framework like the one provided by Visual Studio or NUnit without having to add additional dependency.</li>
</ol>
",-1,4421,2019-11-24 4:38,,1,3,how
56243977,Calling 'created' method inside Jest tests on Vue.js,<javascript><unit-testing><vue.js><mocking><jestjs>,"<p>I'm testing my <code>Activity.vue</code> component on Vue.js with Jest.</p>

<p>My <code>Activity.vue</code> component calls the <code>initializeTable()</code> method inside <code>created()</code> in order to initialize my <code>tableRows</code> property.</p>

<p>The problem is, when I run my tests, Jest does not call 'created()' method and, for that reason, it does not initialize my <code>tableRows</code> property, then the test says that my <code>tableRows</code> property is equal to <code>[]</code> (original state).</p>

<p>How could I call <code>created()</code> method when I'm testing with Jest?</p>

<p>I've already tried to call it explicitly inside the test (i.e. <code>wrapper.vm.$created()</code>), but to no avail.</p>

<p>Would anyone know how to solve it?</p>

<p>I give my code below.</p>

<p>Thank you in advance.</p>

<p><strong>Activity.spec.js</strong></p>

<pre class=""lang-js prettyprint-override""><code>import { shallowMount } from '@vue/test-utils'
import Activity from '@/views/Activity.vue'
import api from '@/assets/js/api'

const expectedTableRows = [...]

const $t = () =&gt; {}

api.getActivity = jest.fn(
  () =&gt; Promise.resolve({
    data: [...]
  })
)

describe('Activity.vue', () =&gt; {
  it('renders vm.tableRows in created()', () =&gt; {
    const wrapper = shallowMount(Activity, {
      mocks: { $t }
    })
    // wrapper.vm.$created()
    expect(wrapper.vm.tableRows).toEqual(expectedTableRows)
  })
})
</code></pre>

<p><strong>Activity.vue</strong></p>

<pre class=""lang-js prettyprint-override""><code>import api from '@/assets/js/api'

export default {
  data () {
    return {
      tableRows: []
    }
  },
  created () {
    this.initializeTable()
  },
  methods: {
    initializeTable () {
      this.loading = true

      api.getActivity().then(response =&gt; {
        this.tableRows = response.data
      }).catch(error =&gt; {
        this.errorBackend = error
      }).finally(() =&gt; {
        this.loading = false
      })
    }
  }
}
</code></pre>

<p><strong>EDIT 1: Solution</strong></p>

<p>As Husam Ibrahim described, the function is asynchronous, because of that, I needed to refactor the test using the following <a href=""https://vue-test-utils.vuejs.org/guides/testing-async-components.html#testing-asynchronous-behavior"" rel=""nofollow noreferrer"">tips</a> and now I was able to fix it.</p>

<p>I give the correct code below:</p>

<pre class=""lang-js prettyprint-override""><code>import flushPromises from 'flush-promises'    // &lt;--

...

describe('Activity.vue', () =&gt; {
  it('renders wm.tableRows after created()', async () =&gt; {    // &lt;--
    const wrapper = shallowMount(Activity, {
      mocks: { $t }
    })

    await flushPromises()    // &lt;-- 

    expect(wrapper.vm.tableRows).toEqual(expectedTableRows)
  })
})
</code></pre>
",4,2894,2019-05-21 17:57,,0,2,how
59278328,Python Mock Class instance variable from another Class,<python><unit-testing><mocking><pytest><python-unittest>,"<p>I want to write unit test case for <code>foo_method</code>. What's the best way of writing unit test for this? How can I mock <code>Bar</code> object ?</p>

<p>code1.py</p>

<pre><code>from code2 import Bar

class Foo:
    bar_instance = Bar(init1='nothing',init2='nothing')

    @classmethod
    def foo_method(cls):
        Foo.bar_instance.bar_method()
</code></pre>

<p>code2.py</p>

<pre><code>class Bar:
   def __init__(self,init1,init2):
      self.init1 = init1
      self.init2 = init2
   def bar_method(self):
       # do something
       pass;

</code></pre>

<p>test_code1.py</p>

<pre><code>def test_foo_method_shouldCallBarInstanceBarMethod():

#### how to write this unit test ####

</code></pre>
",1,1452,2019-12-11 3:03,,1,2,how
8514448,Moq.Mock<T> setting up expressions into a Mock using MOQ results in mock setups not being matched,<c#><unit-testing><entity-framework><mocking><moq>,"<p>I am trying to mock out a data service context, as part of this I have a method which takes in </p>

<ul>
<li>an expression (predicate), </li>
<li>an optional string parameter</li>
<li>a params with an array of predicates.</li>
</ul>

<p>when I try to mock this method out, MOQ always returns a </p>

<p>All invocations on the mock must have a corresponding setup.
TearDown : Moq.MockException : The following setups were not matched:
IContext m => m.Retrieve(It.IsAny() })</p>

<p>code below of the interface/implementation</p>

<pre><code>public interface IContext
{
    IQueryable&lt;T&gt; Retrieve&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; predicate,
                                string entitySetName = null,
                                params Expression&lt;Func&lt;T, object&gt;&gt;[] eagerProperties);
}

public class Context : IContext
{
    private readonly DataServiceContext _context;

    public Context(DataServiceContext context)
    {
        this._context = context;
    }

    public IQueryable&lt;T&gt; Retrieve&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; predicate,
                                        string entitySetName = null,
                                        params Expression&lt;Func&lt;T, object&gt;&gt;[] eagerProperties)
    {
        DataServiceQuery&lt;T&gt; query = _context.CreateQuery&lt;T&gt;(entitySetName ?? ""Default"");
        return eagerProperties.Aggregate(query, (current, e) =&gt; current.Expand(e.ToString())).Where(predicate);
    }
}
</code></pre>

<p>The below is a test class that calls the above context method</p>

<pre><code>public class Test
{
    public string Prop1 { get; set; }
    public string Prop2 { get; set; }
    public string Prop3 { get; set; }
}

public class SomeController
{
    private IContext _context = new Context(
        new DataServiceContext(new Uri(""http://whatever/someservice.svc/"")));

    public IContext ServiceContext
    {
        get
        {
            return _context ??
                   (_context = new Context(new DataServiceContext(new Uri(""http://whatever/someservice.svc/""))));
        }
        set
        {
            _context = value;
        }
    }

    public Test RetrieveSomeInformation()
    {
        IQueryable&lt;Test&gt; tests = _context.Retrieve&lt;Test&gt;
                                                (
                                                    //Param 1
                                                    t =&gt; t.Prop1 == ""test"" &amp;&amp; 1 == 1,

                                                    //Param 2
                                                    ""Test"",

                                                    //Param 3
                                                    t =&gt; t.Prop1,
                                                    t =&gt; t.Prop2,
                                                    t =&gt; t.Prop3
                                                  );
        return tests.First();
    }
}
</code></pre>

<p>Below is the actual test that MOQ fails with a ""All invocations on the mock must have a corresponding setup.""  Can't see why on earth the setup wont be matched! any help would be appreciated.</p>

<pre><code>[TestFixture]
public class ControllerTests
{
    public MockRepository Repository { get; set; }
    protected Mock&lt;IContext&gt; MockContext { get; set; }
    public SomeController Controller;

    public List&lt;Test&gt; Tests;
    public Test Test;

    [SetUp]
    public void SetUp()
    {
        Test = new Test { Prop1 = ""1"", Prop2 = ""2"", Prop3 = ""3"" };
        Tests = new List&lt;Test&gt; { Test };

        Repository = new MockRepository(MockBehavior.Strict);

        MockContext = Repository.Create&lt;IContext&gt;();

        Controller = new SomeController { ServiceContext = MockContext.Object };
    }

    [TearDown]
    public void TearDown()
    {
        Repository.VerifyAll();
    }

    [Test]
    public void DetailProgramme_Test()
    {
        MockContext.Setup(m =&gt; m.Retrieve&lt;Test&gt;
                            (
                                //Param 1
                                It.IsAny&lt;Expression&lt;Func&lt;Test, bool&gt;&gt;&gt;(),

                                //Param 2
                                It.IsAny&lt;string&gt;(),

                                //Param 3
                                It.IsAny&lt;Expression&lt;Func&lt;Test, object&gt;&gt;&gt;()
                            )
                          ).Returns(Tests.AsQueryable());

        Test info = Controller.RetrieveSomeInformation();


        //myMock.Setup(r =&gt; r.Find(It.IsAny&lt;Expression&lt;Func&lt;Person, bool&gt;&gt;&gt;())).Returns(new List&lt;Person&gt;() { new Person() }.AsQueryable());
        Assert.IsTrue(info == Test);
    }
}
</code></pre>
",2,6624,2011-12-15 2:38,,3,0,why
42482021,How to mock <ModelClass>.query.filter_by() in Flask-SqlAlchemy,<python><flask><sqlalchemy><mocking><python-unittest>,"<h2>In brief</h2>

<p>When testing a model class in Flask-SqlAlchemy, how can we mock the method <code>.query.filter_by()</code> so as to return the list of mocked model objects?</p>

<h2>Full details</h2>

<p>Let's say we have a model class as below code</p>

<pre><code>from flask.ext.sqlalchemy import SQLAlchemy
db = SQLAlchemy()
class SomeModel(db.Model):
    # more column mapping and methods go here
</code></pre>

<p>Then in our Flask code we call</p>

<pre><code>SomeModel.query.filter_by(...)
</code></pre>

<p>In our testing code, using <a href=""https://docs.python.org/2/library/unittest.html"" rel=""noreferrer"">Python unittest</a> model with <a href=""https://www.toptal.com/python/an-introduction-to-mocking-in-python"" rel=""noreferrer"">mocking</a>, we want to mock the <code>filter_by()</code> call so that it returns a list of model objects under our designed test case.</p>

<p>How can we get to that?</p>

<p>p.s. </p>

<p>My google search only found <a href=""https://stackoverflow.com/a/28194452/248616"">this related post</a>; though applying <code>@patch(""flask_sqlalchemy.SignallingSession"", autospec=True)</code> at the beginning of the class not work for me.</p>

<p>I also tried to mock the function as below code snippet</p>

<pre><code>@patch('app.model.some_model.SomeModel.query.filter_by')
def test_some_case(self, filterbyMOCK):
    # more test logic goes here
</code></pre>

<p>and the code get immediate error when started</p>

<pre><code>RuntimeError: application not registered on db instance and no application bound to current context
</code></pre>

<p>The full error from PyCharm IDE as snapshot below.</p>

<pre><code>Traceback (most recent call last):
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/mock/mock.py"", line 1297, in patched
    arg = patching.__enter__()
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/mock/mock.py"", line 1353, in __enter__
    self.target = self.getter()
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/mock/mock.py"", line 1523, in &lt;lambda&gt;
    getter = lambda: _importer(target)
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/mock/mock.py"", line 1210, in _importer
    thing = _dot_lookup(thing, comp, import_path)
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/mock/mock.py"", line 1197, in _dot_lookup
    return getattr(thing, comp)
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/flask_sqlalchemy/__init__.py"", line 428, in __get__
    return type.query_class(mapper, session=self.sa.session())
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/sqlalchemy/orm/scoping.py"", line 78, in __call__
    return self.registry()
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/sqlalchemy/util/_collections.py"", line 990, in __call__
    return self.registry.setdefault(key, self.createfunc())
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/flask_sqlalchemy/__init__.py"", line 136, in __init__
    self.app = db.get_app()
  File ""/home/namgivu/NN/code/someproject-cloud/venv/local/lib/python2.7/site-packages/flask_sqlalchemy/__init__.py"", line 809, in get_app
    raise RuntimeError('application not registered on db '
RuntimeError: application not registered on db instance and no application bound to current context
</code></pre>
",21,22080,2017-02-27 9:26,,2,0,how
77820437,Test that a function imported into different namespaces is never called,<python><testing><mocking>,"<p>Suppose I have</p>
<p>foo.py</p>
<pre><code>def my_func():
    print('hello world!')
</code></pre>
<p>bar.py</p>
<pre><code>from foo import my_func
</code></pre>
<p>I want to write tests to ensure that <code>my_func</code> is never called.  I have this:</p>
<pre><code>from unittest import mock

import foo
import bar

@mock.patch.object(foo, 'my_func', wraps=foo.my_func)
class TestMyFunc:
    def test_from_foo(self, wrapped_my_func):
        foo.my_func()
        wrapped_my_func.assert_not_called()
        
    def test_from_bar(self, wrapped_my_func):
        bar.my_func()
        wrapped_my_func.assert_not_called()
</code></pre>
<p>Written this way, I would like both tests to fail.  However, run with <code>pytest</code>, <code>test_from_bar</code> passes.  From <a href=""https://stackoverflow.com/questions/16134281/python-mocking-a-function-from-an-imported-module"">this question</a> I gather that that is because <code>mock</code> works on the name spaces so does not know that <code>foo.my_func</code> and <code>bar.my_func</code> are the same thing.  So is there a way I can write this test without writing patches and asserts for both modules?</p>
<p><strong>Edit</strong>: from <a href=""https://stackoverflow.com/a/76637961/3501128"">this answer</a> I was hoping I could combine <code>mock</code> with <code>monkeypatch</code> to get what I want, but this version of <code>test_from_bar</code> still passes:</p>
<pre><code>from unittest.mock import MagicMock
import pytest

import foo
import bar

class TestMyFunc:
    @pytest.fixture
    def mock_my_func(self, monkeypatch):
        _mock = MagicMock(wraps=foo.my_func)
        monkeypatch.setattr(foo, foo.my_func.__name__, _mock)
        return _mock 

    def test_from_foo(self, mock_my_func):
        foo.my_func()
        mock_my_func.assert_not_called()
        
    def test_from_bar(self, mock_my_func):
        bar.my_func()
        mock_my_func.assert_not_called()
</code></pre>
<h4>Context</h4>
<p>My real use-case is to test a function that uses <a href=""https://docs.dask.org/en/stable/index.html"" rel=""nofollow noreferrer""><code>dask</code></a>.  I want to make sure that <a href=""https://github.com/dask/dask/blob/3e9ae492934e133547e5eaec5020186fad39898a/dask/base.py#L603"" rel=""nofollow noreferrer"">dask.base.compute</a> is never inadvertently called.  However it may be called as <a href=""https://github.com/dask/dask/blob/3e9ae492934e133547e5eaec5020186fad39898a/dask/__init__.py#L7"" rel=""nofollow noreferrer"">dask.compute</a> or <a href=""https://github.com/dask/dask/blob/3e9ae492934e133547e5eaec5020186fad39898a/dask/array/__init__.py#L264C34-L264C34"" rel=""nofollow noreferrer"">dask.array.compute</a> or possibly others that I haven't stumbled on yet.</p>
",2,79,2024-01-15 14:22,,1,4,what
41654478,How to Mock a method with dynamic type in c#,<c#><dynamic><mocking><moq>,"<p>Hi I've a method in an interface</p>

<pre><code>dynamic SendCancelRequest(dynamic request, string contentType = ""application/json"");
</code></pre>

<p>I want to mock it, I am using moq</p>

<pre><code>var inputModel = new
{
   id = consumerId,
   userip = getUserIp(),
   Source = ""x-source""
};
var result = new
{
   Name = ""Acknowledge""
};

_mock.Setup(c =&gt; c.SendCancelRequest(inputmodel,""application/json"")).Returns(result);
</code></pre>

<p>When I debug the actual line, I see the value that I want to return is always null.</p>

<pre><code>dynamic message = MyRepository.SendCancelRequest(inputModel);
</code></pre>

<p>The value of message is null. Also the value of input model also not reflected, rightnow I just need the value of message 
What am I missing how should I fix it ?</p>
",0,1808,2017-01-14 20:09,,1,2,how
31022713,How to mock an attribute of a callable instance in Python?,<python><mocking>,"<p>I have the following code, which I need to test:</p>

<pre><code>uploader = AjaxFileUploader(backend=XLSXFileUploadBackend, obj=obj)
response = uploader(request)
...
response.content
</code></pre>

<p>I'd like to mock AjaxFileUploader and replace the <code>response.content</code> with some value.</p>

<p>I do the following:</p>

<pre><code>@patch('guinness.apps.home.views.AjaxFileUploader')
def test_import_asset_to_bucket(self, mock_file_uploader):
    test_content = 'a:""1""'
    mock_file_uploader.return_value = MagicMock(return_value=MagicMock(content=test_content))
</code></pre>

<p>Is there more elegant way to do it?
Thanks!</p>
",3,5939,2015-06-24 9:25,,1,0,what
53928584,How to mock activatedRoute.data in angular for getting data?,<angular><unit-testing><mocking><angular-activatedroute>,"<p>I am reading data from the activatedRoute.data as below
Not able to mock the ActivatedRoute.
Please some one suggest me.</p>

<p>import { BehaviorSubject } from ""rxjs"";</p>

<p>export class MockActivatedRoute {
    data: BehaviorSubject;</p>

<pre><code>constructor(){
    this.data = of({
        ""projectdata"": {data: ""data""}
    });
}

private paramsSubject = new BehaviorSubject(this.testParams);
private _testParams: {};

params  = this.paramsSubject.asObservable();

get testParams() {
    return this._testParams;
}
set testParams(newParams: any) {
    this._testParams = newParams;
    this.paramsSubject.next(newParams);
}
</code></pre>

<p>}</p>

<p>I have tried like this </p>

<p>but unable to resolve the issue. the above code is used for mocking paramaters i want to mock the data..</p>

<p>Any suggestions Please let me know.</p>
",0,251,2018-12-26 7:04,,0,2,how
19704059,Mocked HttpRequest loses the QueryString,<c#><asp.net><unit-testing><mocking><httprequest>,"<p>I need to test an helper class which manage complex querystring.</p>

<p>I use this helper method to mock the <code>HttpContext</code>:</p>

<pre><code>public static HttpContext FakeHttpContext(string url, string queryString)
{
    var httpRequest = new HttpRequest("""", url, queryString);
    var stringWriter = new StringWriter();
    var httpResponse = new HttpResponse(stringWriter);
    var httpContext = new HttpContext(httpRequest, httpResponse);

    var sessionContainer = new HttpSessionStateContainer(""id"", new SessionStateItemCollection(),
                                            new HttpStaticObjectsCollection(), 10, true,
                                            HttpCookieMode.AutoDetect,
                                            SessionStateMode.InProc, false);
    SessionStateUtility.AddHttpSessionStateToContext(httpContext, sessionContainer);

    return httpContext;
}
</code></pre>

<p>The problem is that the <code>HttpRequest</code> loses the querystring:</p>

<pre><code>HttpContext.Current = MockHelpers.FakeHttpContext(""http://www.google.com/"", ""name=gdfgd"");
</code></pre>

<p><code>HttpContext.Current.Request.Url</code> is <code>""http://www.google.com/""</code> and not <code>""http://www.google.com/?name=gdfgd""</code>as expected.</p>

<p>If I debug I see that just after the HttpRequest constrctor the querystring is lost.</p>

<p>The workaround I'm using is to pass the url with querystring to the HttpRequest constructor:</p>

<pre><code>HttpContext.Current = MockHelpers.FakeHttpContext(""http://www.google.com/?name=gdfgd"","""");
</code></pre>
",2,3569,2013-10-31 10:31,,2,2,other
16541220,Workflow Services Testing and Moq,<unit-testing><moq><workflow-foundation-4><workflowservice>,"<p>I'm trying to unit test a Workflow Service by using <a href=""http://wf.codeplex.com/wikipage?title=Microsoft.Activities.UnitTesting%20Overview&amp;referringTitle=Home"" rel=""nofollow"">Microsoft.Activities.UnitTesting</a>
The goal is to mock the service's extensions in order to ensure that all steps are executed. </p>

<p>The mock objects don't seem to get called even though the extensions are registered in the Host. As expected, if the extensions are not registered an exception is thrown.</p>

<pre><code>        WorkflowServiceTestHost host = null;

        try
        {
            Mock&lt;ISubscriber&gt; publisher = new Mock&lt;ISubscriber&gt;();
            Mock&lt;IWebWorker&gt; webWorker = new Mock&lt;IWebWorker&gt;();

            var voucher = new Voucher();

            using (host = new WorkflowServiceTestHost(workflowServiceFile, serviceAddress))
            {
                host.WorkflowExtensions.Add&lt;ISubscriber&gt;(() =&gt; publisher.Object);
                host.WorkflowExtensions.Add&lt;IWebWorker&gt;(() =&gt; webWorker.Object);

                host.Open();
                using (var factory = new ChannelFactory&lt;IServiceInterface&gt;(clientBinding, serviceAddress))
                {
                    var proxy = factory.CreateChannel() as IServiceInterface;

                    proxy.Process(voucher);
                }
            }

            **//These validations fail...**

            publisher.Verify(m =&gt; m.Push(It.IsAny&lt;Voucher&gt;()), Times.Once(), ""ISubscriber.Push was not called."");
            webWorker.Verify(m =&gt; m.Done(It.IsAny&lt;Voucher&gt;()), Times.Once(), ""IWebWorker.Done was not called."");

            // The host must be closed before asserting tracking
            // Explicitly call host.Close or exit the using block to do this.
        }
        finally
        {
            if (host != null)
            {
                host.Tracking.Trace(TrackingOptions.All);
            }
        }
</code></pre>

<p>The workflow runs as expected in IIS.</p>

<p>Thanks!</p>

<p>Edit: This error is being written in the Workflow Host output:</p>

<pre><code>WorkflowInstance ""Sequential Service"" Unhandled Exception Source ""Receive Process Message"" 
Exception &lt;System.NotSupportedException: Expression Activity type 'CSharpReference`1' requires compilation in order to run.  
Please ensure that the workflow has been compiled.
at System.Activities.Expressions.CompiledExpressionInvoker.InvokeExpression(ActivityContext activityContext)
at Microsoft.CSharp.Activities.CSharpReference`1.Execute(CodeActivityContext context)
at System.Activities.CodeActivity`1.InternalExecuteInResolutionContext(CodeActivityContext context)
at System.Activities.Runtime.ActivityExecutor.ExecuteInResolutionContext[T](ActivityInstance parentInstance, Activity`1 expressionActivity)
at System.Activities.OutArgument`1.TryPopulateValue(LocationEnvironment targetEnvironment, ActivityInstance targetActivityInstance, ActivityExecutor executor)
at System.Activities.RuntimeArgument.TryPopulateValue(LocationEnvironment targetEnvironment, ActivityInstance targetActivityInstance, ActivityExecutor executor, Object argumentValueOverride, Location resultLocation, Boolean skipFastPath)
at System.Activities.ActivityInstance.InternalTryPopulateArgumentValueOrScheduleExpression(RuntimeArgument argument, Int32 nextArgumentIndex, ActivityExecutor executor, IDictionary`2 argumentValueOverrides, Location resultLocation, Boolean isDynamicUpdate)
at System.Activities.ActivityInstance.ResolveArguments(ActivityExecutor executor, IDictionary`2 argumentValueOverrides, Location resultLocation, Int32 startIndex)
at System.Activities.Runtime.ActivityExecutor.ExecuteActivityWorkItem.ExecuteBody(ActivityExecutor executor, BookmarkManager bookmarkManager, Location resultLocation)&gt;
</code></pre>
",0,1086,2013-05-14 10:49,,1,5,other
54614732,How to get my Unit Tests to bypass the Authorize tag on my .NET Web Controller,<unit-testing><moq><authorize-attribute>,"<p>I have a Web API in .NET 4.6.1 and my controllers are Azure B2C protected.
Hence, they have the [Authorize] tag.</p>

<p>I wrote a Unit Test to ensure that I can hit the route and test some business logic. However, I cannot figure out how to bypass the [Authorize] tag and I do not want to authorize with B2C for each unit test that runs.</p>

<p>I am assuming that mocking the Controller Context would be a good start but I am having trouble figuring out the syntax.</p>

<p>There are a few articles about mocking the ControllerContext and then setting the <code>HttpContext.Request.IsAuthenticated</code> but this applies to MVC.</p>

<p>I get an error converting from <code>System.Web.MVC.ControllerContext</code> to <code>System.Web.Http.Controllers.HttpControllerContext</code>.</p>

<p>Cannot implicitly convert type error:  </p>

<p><a href=""https://i.sstatic.net/IXxHN.png"" rel=""nofollow noreferrer""><img src=""https://i.sstatic.net/IXxHN.png"" alt=""Cannot implicitly convert type error""></a></p>

<p>I am hoping that someone can help me figure out how to bypass the <code>[Authorize]</code> tag for my unit tests?</p>
",1,1126,2019-02-10 8:38,,2,5,how
78801378,Why is this React Testing Library and Jest test failing arbitrarily?,<jestjs><react-testing-library><nock><msw>,"<p>I am creating a test suite that simulates login and navigation for different types of users, making assertions about what they see for their default page and what pages they can navigate to. My underlying framework is Jest, with React Testing Library for clicks and assertions, and <code>nock</code> for API mocking (though please note I was experiencing the exact same problem with <code>msw</code>).</p>
<p>Hello, I have lurked on this site and benefited for many, many years, but this is finally the problem I'm frustrated enough to ask for help on. I have 10 unit tests that simulate a login with some fake API data (all data is contained in <code>beforeAll</code>), and then assert the default page for that type of user and what else they can navigate to. They each work individually, and they ought to, because I don't think I'm trying to do anything crazy--I'm not even trying to change the endpoints for each test, which I was doing before and which proved to be extremely finicky. I've isolated a stable subset of the fake API for each set of tests because I banged my head against the wall for a day with nonsensical failures when attempting to define different responses to the same endpoints within each <code>it(...)</code> block (for example, in one run there's one transaction, and in the next that endpoint returns <code>[]</code> and the app should display <code>No transactions found.</code>) I have some inkling to watch out for Jest test parallelization, so I've tried <code>--runInBand</code> to no avail. I have been berated by warnings about how I have to wrap state changes in <code>act()</code>, so I've tried doing that; at first it seemed like it helped, but then it just went back to failing. I figured somewhere I should be using <code>waitFor</code>, but RTL documentation says that using the <code>find...</code> queries has that built in automatically. Interestingly, I can get the &quot;problem test&quot; to succeed by skipping the test before it, and I can change which test fails by moving them around, as if just the 5th or 6th test is doomed to fail. I'm struggling to reason about why this is acting so erratically. Please help me.</p>
<p>&quot;Problem test&quot;, which always works on its own but rarely when run with the other 9:</p>
<pre><code>  it('should navigate to customers page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Customers&quot;));

    expect(await screen.findByText('test@customer-email.com')).toBeInTheDocument();
  });
</code></pre>
<p>It works if I skip the test before it (<strong>not</strong> the failing test itself):</p>
<pre><code>  xit('should not navigate to create-transaction page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(screen.queryByText(&quot;Create Transaction&quot;)).toBeNull();
  });

  it('should navigate to customers page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Customers&quot;));

    expect(await screen.findByText('test@customer-email.com')).toBeInTheDocument();
  });
</code></pre>
<p>I can get the test after it to fail if I move the test block up to be after <code>it('should not navigate to create-transaction page', ...)</code></p>
<pre><code>  it('should not navigate to create-transaction page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(screen.queryByText(&quot;Create Transaction&quot;)).toBeNull();
  });

  it('should navigate to agents page', async () =&gt; { // &lt;== the 5th test tends to fail
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(()=&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Agents&quot;));

    expect(await screen.findByText('TestAgent OnAdminPage')).toBeInTheDocument();
  });
</code></pre>
<p>The full test suite, with mock API using <code>nock</code> (I moved from <code>msw</code> because I thought it was the problem, but I'm experiencing the exact same problems so I'm pretty sure the problem is with React Testing Library):</p>
<pre><code>import {renderWithProviders} from &quot;./render-utils&quot;;
import {act, cleanup, screen} from &quot;@testing-library/react&quot;;
import {UserApp} from &quot;../UserApp&quot;;
import userEvent from &quot;@testing-library/user-event&quot;;
import nock from &quot;nock&quot;;

const user = userEvent.setup();

describe('navigation and default pages for Tryula Admin', () =&gt; {
  beforeAll(() =&gt; {
    const scope = nock('http://localhost:3000')
      .defaultReplyHeaders({
        'access-control-allow-origin': '*',
        'access-control-allow-credentials': 'true'
      });
    scope
      .persist()
      .post('/login/')
      .reply(200, {
          user: {
            user_type: 'TryulaAdmin',
          }
        }
      );
    scope
      .persist()
      .get('/privacy_check/invalid/')
      .reply(200, {privacy_policy_consent_required: true});
    scope
      .persist()
      .get('/any_admin_stats/')
      .reply(200, {});
    scope
      .persist()
      .get('/service_areas/')
      .reply(200, [{name: 'Fakerton'}]);
    scope
      .persist()
      .get('/languages/')
      .reply(200, [{name: 'Engl-ish'}]);
    scope
      .persist()
      .get('/agents/')
      .reply(200, [
        {first_name: 'TestAgent', last_name: 'OnAdminPage', service_areas: []}
      ]);
    scope
      .persist()
      .get('/agents/1/')
      .reply(200, {
        bio: 'I am the real fake agent',
        first_name: 'TestFirstName',
        last_name: 'TestLastName',
        languages: [],
        service_areas: []
      });
    scope
      .persist()
      .get('/transactions/')
      .reply(200, [{
        agent_id: 1,
        agent_name: 'Test Agent',
        customer_name: 'Test Customer'
      }]);
    scope
      .persist()
      .get('/customers/')
      .reply(200, [{
        email: 'test@customer-email.com'
      }]);
  });

  afterEach(cleanup);

  it('should go to /dashboard and see stats after login from agent search', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login?return_url=/'});

    await act(()=&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(await screen.findByTestId('num-gt45d-transactions')).toBeInTheDocument();
  });

  it('should go to /dashboard and see stats after login from agent profile', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login?return_url=/agent/1'});

    await act(()=&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(await screen.findByTestId('num-gt45d-transactions')).toBeInTheDocument();
  });

  it('should navigate to stats after seeing transactions', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(()=&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Transactions&quot;));
    expect(await screen.findByText(&quot;Test Agent&quot;)).toBeInTheDocument();
    await user.click(await screen.findByText(&quot;Dashboard&quot;));

    expect(await screen.findByTestId('num-active-transactions')).toBeInTheDocument();
    expect(await screen.findByTestId('num-pending-transactions')).toBeInTheDocument();
    expect(await screen.findByTestId('num-closed-transactions')).toBeInTheDocument();
    expect(await screen.findByTestId('num-gt45d-transactions')).toBeInTheDocument();
  });

  it('should not navigate to create-transaction page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(screen.queryByText(&quot;Create Transaction&quot;)).toBeNull();
  });

  it('should navigate to agents page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(()=&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Agents&quot;));

    expect(await screen.findByText('TestAgent OnAdminPage')).toBeInTheDocument();
  });

  it('should navigate to customers page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Customers&quot;));

    expect(await screen.findByText('test@customer-email.com')).toBeInTheDocument();
  });

  it('should navigate to create-agent page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(()=&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));
    await user.click(await screen.findByText(&quot;Create Agent&quot;));

    expect(await screen.findByText('First Name')).toBeInTheDocument();
    expect(await screen.findByText('Last Name')).toBeInTheDocument();
    expect(await screen.findByText('Email')).toBeInTheDocument();
    expect(await screen.findByText('Phone')).toBeInTheDocument();
    expect(await screen.findByText('Powerform URL')).toBeInTheDocument();
    expect(await screen.findByText('Referral Agreement')).toBeInTheDocument();
    expect(await screen.findByText('Powerform ID')).toBeInTheDocument();
  });

  it('should not navigate to tryula-admins page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(screen.queryByText(&quot;Tryula Admins&quot;)).toBeNull();
  });

  it('should not navigate to super-admins page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(screen.queryByText(&quot;Super Admins&quot;)).toBeNull();
  });

  it('should not navigate to Site Settings page', async () =&gt; {
    renderWithProviders(&lt;UserApp/&gt;, {path: '/login'});

    await act(() =&gt; user.click(screen.getByDisplayValue(&quot;Log In&quot;)));

    expect(screen.queryByText(&quot;Site Settings&quot;)).toBeNull();
  });
});
</code></pre>
<p>Final note: I don't know if this is relevant, but I'm using persist to store login and Redux to hold data from my queries. Neither seem to me to be involved but just trying to see this from all angles.</p>
",-1,37,2024-07-27 12:27,,0,1,why
25829410,PHPUnit and Laravel: Call to undefined method stdClass::isEmpty(),<php><laravel><phpunit><mockery>,"<p>I'm trying to test this controller method.</p>

<pre><code>public function handleCreate()
    {
        $offer = new Offer();

        $offer-&gt;key_word = $key_word;
        $offer-&gt;url = $url;

        $offer-&gt;save();

        return Redirect::action('OffersController@index');
    }
</code></pre>

<p>Here is the test.</p>

<pre><code>public function testCreate(){
        Input::replace($input = array('key_word' =&gt; 'foo', 'url' =&gt; 'http://bar.com'));

        $this-&gt;mock-&gt;shouldReceive('create')-&gt;once()-&gt;with($input);

        $this-&gt;app-&gt;instance('Offer', $this-&gt;mock);

        $this-&gt;call('POST', 'create');

        $this-&gt;assertRedirectedToRoute('/');
    }
</code></pre>

<p>I'm getting this error when running the test.</p>

<blockquote>
  <p>PHP Fatal error:  Call to undefined method stdClass::isEmpty()</p>
</blockquote>

<p>Here is the part of the view that is messing it up.</p>

<pre><code>@if($offers-&gt;isEmpty())
    &lt;p&gt;No offers found.&lt;/p&gt;
@else
    ...
@endif
</code></pre>

<p>I cannot figure out how to add the isEmpty() method to my mock model to get past this error.</p>

<p>I have tried mocking the isEmpty() method with this but it still gave the same error.</p>

<pre><code>$this-&gt;mock-&gt;shouldReceive('isEmpty')-&gt;once()-&gt;andReturn(false);
</code></pre>
",0,3379,2014-09-14 1:56,,1,2,how
53223316,XUnit how to mock IMemoryCache ASP.NET Core,<c#><unit-testing><mocking><moq><xunit>,"<p>I understand IMemoryCache.Set is an extension method so it can not be mocked. People have provided workarounds to such situation e.g as one by the NKosi <a href=""https://stackoverflow.com/questions/38318247/mock-imemorycache-in-unit-test/38319045"">here</a>. I am wondering how I can achieve that for my data access layer where my MemoryCache returns a value and when not found it gets data from the db, set it to the MemoryCache and return the required value.</p>

<pre><code>    public string GetMessage(int code)
    {
        if(myMemoryCache.Get(""Key"") != null)
        {
            var messages= myMemoryCache.Get&lt;IEnumerable&lt;MyModel&gt;&gt;(""Key"");
            return messages.Where(x =&gt; x.Code == code).FirstOrDefault().Message;
        }

        using (var connection = dbFactory.CreateConnection())
        {
            var cacheOptions = new MemoryCacheEntryOptions { SlidingExpiration = TimeSpan.FromHours(1) };
            const string sql = @""SELECT Code, Message FROM MyTable"";

            var keyPairValueData = connection.Query&lt;KeyPairValueData&gt;(sql);

            myMemoryCache.Set(""Key"", keyPairValueData, cacheOptions );

            return keyPairValueData.Where(x =&gt; x.Code == code).FirstOrDefault().Message;
        }
    }
</code></pre>

<p>Following is my Unit Test - And off course it is not working as I can't mock IMemoryCache</p>

<pre><code>    [Fact]
    public void GetMessage_ReturnsString()
    {
        //Arrange
        // Inserting some data here to the InMemoryDB

        var memoryCacheMock = new Mock&lt;IMemoryCache&gt;();

        //Act
        var result = new DataService(dbConnectionFactoryMock.Object, memoryCacheMock.Object).GetMessage(1000);

        //assert xunit
        Assert.Equal(""Some message"", result);
    }
</code></pre>
",5,8268,2018-11-09 9:46,,1,5,how
46357756,How is Jmockit different from EasyMock? Which is better to use?,<unit-testing><junit><mocking><easymock><jmockit>,"<p>I have for long worked on EasyMocking in JUnits. I am pretty much comfortable with this but now I want to know how EasyMocks are different from Jmockits. I tried going through their documentation and I found out that the syntax is a bit different. But yet I could not figure out if there is any difference in their performances. 
Can anyone help me figure out what are the points that make either of them better than the other? Is there any special element in JMockit that is not found in the other?
Thanks in advance...</p>
",0,625,2017-09-22 5:56,,2,0,what
27123618,"c# mock object with private constructor, initialized via a static factory method",<c#><unit-testing><mocking><moq>,"<p>I am testing the following controller:</p>

<pre><code>public class MyController : ApiController
{
    private readonly IUserManager _users;
    private int num = 0;

    public MyController(IUserManager users)
    {
        _users = users;
    }

    public User GetByCredentials(string username, string pass)
    {
        var account = new Account(username, pass);          
        User u = _users.GetByCredentials(num, account);
        return u;
    }
</code></pre>

<p>I was thinking to mock the <em>IUserManager.GetByCredentials</em> method, as I only want to see that <em>MyController.GetByCredentials</em> method works as expected. The problem is that the <em>User</em> class cannot be instantiated directly, so I cannot mock a User object, because the constructor is private:</p>

<pre><code>public class User
{
    // private attributes here

    protected User()
    {
        // do a lot of stuff here, call other objects to initialize attributes
    }

    private User(int num, string id, string userid, Account account)
        : this()
    {
       // do other stuff here with the params
    }


    public static User CreateUser(int num, string id, string userid, Account account)
    {
        return new User(num, id, userid, account);
    }
    // and so on

}
</code></pre>

<p>I am using the Moq framework, but I am open to different solutions. I would prefer to avoid the creation of test data in this case, because it depends on database the initialization, servers and so on - and then it would not be a unit test anymore. Have you ever had an issue like this? How do you deal with it? Thanks. </p>
",1,4314,2014-11-25 9:58,,2,0,how
9494609,Rhino mock AAA ExpectationViolationException,<c#><unit-testing><mocking><rhino-mocks>,"<p>Getting Error while running rhinomock test method : Test method TestProject1.UnitTest2.TestMethod1 threw exception: 
Rhino.Mocks.Exceptions.ExpectationViolationException: ITestInterface.Method1(5); Expected #1, Actual #0.</p>

<p>My code looks like:-</p>

<pre><code>namespace ClassLibrary1
{
    public interface ITestInterface
    {
        bool Method1(int x);

        int Method(int a);
    }

    internal class TestClass : ITestInterface
    {

        public bool Method1(int x)
        {
            return true;
        }

        public int Method(int a)
        {
            return a;
        }
    }
}
</code></pre>

<p>And my test looks something like:-</p>

<pre><code>using ClassLibrary1;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Rhino.Mocks;

namespace TestProject1
{
    [TestClass]
    public class UnitTest2
    {
        [TestMethod]
        public void TestMethod1()
        {
            ITestInterface mockProxy = MockRepository.GenerateMock&lt;ITestInterface&gt;();

            TestClass tc = new TestClass();
            bool result = tc.Method1(5);           

            Assert.IsTrue(result);


            mockProxy.AssertWasCalled(x =&gt; x.Method1(5));

        }
    }
}
</code></pre>

<p>Any help appreciated.</p>
",2,629,2012-02-29 6:36,,1,2,how
6619272,MVC Rhino Mocks for Request.Files,<unit-testing><model-view-controller><mocking><rhino-mocks>,"<p>I'm trying to get my controller in a unit test to return a mock file when <code>Request.Files[0]</code> is called</p>

<p>From other posts on this site I've put together:</p>

<pre><code>[TestMethod]
        public void CreateFileInDatabase()
        {
            var repository = new MocRepository();
            var controller = GetController(repository);

            HttpContextBase mockHttpContext = MockRepository.GenerateMock&lt;HttpContextBase&gt;();
            HttpRequestBase mockRequest = MockRepository.GenerateMock&lt;HttpRequestBase&gt;();
            mockHttpContext.Stub(x =&gt; x.Request).Return(mockRequest);

            mockRequest.Stub(x =&gt; x.HttpMethod).Return(""GET"");

            var filesMock = MockRepository.GenerateMock&lt;HttpFileCollectionBase&gt;();
            var fileMock = MockRepository.GenerateMock&lt;HttpPostedFileBase&gt;();
            filesMock.Stub(x =&gt; x.Count).Return(1);
            mockRequest.Stub(x =&gt; x.Files).Return(filesMock);
            var t = mockHttpContext.Request;

            var automobile = new Automobile{ automobileNumber = ""1234"" };
            controller.ControllerContext = new ControllerContext(mockHttpContext, new RouteData(), controller);
            controller.Create(automobile);
        }
</code></pre>

<p>When I'm in the controller during a test and call <code>Request.Files</code> I get the filesMock great.</p>

<p>However I want to be able to call <code>Request.Files[0]</code> and get a mock File which I can pass as a parameter to a method.</p>

<p>I haven't done much mocking before so any help would be appreciated!</p>
",0,675,2011-07-08 2:15,,2,0,how
8834094,How do I mock a jQuery plugin?,<jquery><unit-testing><jquery-ui><mocking>,"<p>I am writing a plugin which uses an existing plugin which I would like to mock out.</p>

<p>The plugin I'm writing looks sort of like this:</p>

<pre><code>(function($){
  $.widget(""myPlugin"",{
    _create: function(){
      var otherControl = $(""&lt;div&gt;&lt;/div&gt;"");
      otherControl.pluginWhichShouldBeMocked({foo: ""bar""});
      this.element.append(otherControl);
    }
  });
})(jQuery);
</code></pre>

<p>And I have a Jasmine test which sort of looks like this:</p>

<pre><code>describe(""When creating"", function(){
  var element;
  var passedOptions;
  beforeEach(function(){
    jQuery.pluginWhichShouldBeMocked = function(options){
      passedOptions = options;
    }
    element = $(""&lt;div&gt;&lt;/div&gt;"");
    element.myPlugin();
  });

  it(""should create the other plugin and pass 'bar' to it as the foo parameter"", function(){
    expect(passedOptions.foo).toEqual(""bar"");
  });
});
</code></pre>

<p>This line is where I have tried to mock the plugin:</p>

<pre><code>jQuery.pluginWhichShouldBeMocked = function(options){
  passedOptions = options;
}
</code></pre>

<p>The actual plugin instance is still called though.</p>
",7,2331,2012-01-12 11:10,,2,0,how
27153177,"Moq with Ninject Mocking, Kernel.GetMock<T> is not allowing multiple Setups on the same Mock object",<unit-testing><ninject><moq>,"<p>I'm building out Unit Test for our web application.  I'm starting with the service layer and mocking the repositories and services.  Our application uses Ninject IoC for pretty much everything...its neat and clean.  I'm having an issue using a second Setup on the same mock instance from the service.  Basically is not seeing it and the parameters/return values are not working like the others when debugging.  Please see the code for details.</p>

<pre><code>    private MoqMockingKernel Kernel; //Ninject Mocking
    private Mock&lt;IClaimRepository&gt; MoqClaimRepository{
        get
        {
            if (Kernel==null)
                throw new InstanceNotFoundException(""MoqClaimRepository, MockingKernel has not been initialized.  [TestFixtureSetup] failed."");
            return Kernel.GetMock&lt;IClaimRepository&gt;();
        }
    }
    private Mock&lt;IContactRepository&gt; MoqContactRepository
    {
        get
        {
            if (Kernel == null)
                throw new InstanceNotFoundException(""MoqContactRepository, MockingKernel has not been initialized.  [TestFixtureSetup] failed."");
            return Kernel.GetMock&lt;IContactRepository&gt;();
        }
    }
    private IClaimService MoqClaimService{
        get
        {
            if (Kernel == null)
                throw new InstanceNotFoundException(""MoqClaimService, MockingKernel has not been initialized.  [TestFixtureSetup] failed."");
            return Kernel.Get&lt;IClaimService&gt;();  
        }
    }

    [SetUp]
    public void Init(){
        Kernel = new MoqMockingKernel();
        Kernel.Bind&lt;IClaimService, IDataService&gt;().To&lt;ClaimService&gt;();
    }





    [Test]
    public void the_Export_should_return_results(){
        //Arrange

        MoqClaimRepository.Setup(x =&gt; x.Search(It.IsAny&lt;IClaimSearchCriteria&gt;()))
            .Returns(ClaimObjectsSetup.ClaimSearchResultsSetup);
        MoqClaimRepository.Setup(x =&gt; x.GetExportData(It.IsAny&lt;string[]&gt;()))
            .Returns(ClaimObjectsSetup.ClaimExportDataResultsSetup);        //NOT SEEING THIS SETUP INSIDE THE SERVICE
        MoqContactRepository.Setup(x =&gt; x.Get(It.IsAny&lt;ContactCriteria&gt;()))
            .Returns(ClaimObjectsSetup.ClaimSearchContactResultsSetup);
        //Act
        MoqClaimService.Export(new ClaimSearchCriteria());
        //Assert
        MoqClaimRepository.VerifyAll();
    }
</code></pre>
",1,705,2014-11-26 15:39,,0,1,other
69936939,pyspark rdd.map function mock scope,<python><apache-spark><pyspark><mocking>,"<p>Some of these transform functions respect the mock and others don't and I don't know why.</p>
<p>Here's a file called <code>etl_job.py</code>. It contains various transform functions that use <code>rdd.map</code> to add a column to a <code>DataFrame</code> using the <code>get_random_bool</code> function imported from <code>dependencies.utils</code>.</p>
<pre><code># etl_job.py

from dependencies.utils import get_random_bool

def transform_data1(df):
    return df.rdd.map(lambda row: row+(get_random_bool(),)).toDF()

def transform_data2(df):
    g = lambda row: row+(get_random_bool(),)
    return df.rdd.map(lambda row: g(row)).toDF()

def transform_data3(df):
    g = lambda row: row+(get_random_bool(),)
    h = lambda row: g(row)
    return df.rdd.map(lambda row: h(row)).toDF()

def transform_data4(df):
    return df.rdd.map(lambda row: f(row)).toDF()

def transform_data5(df):
    g = lambda row: f(row)
    return df.rdd.map(lambda row: g(row)).toDF()

def f(row):
    return row+(get_random_bool(),)

</code></pre>
<p>This test file tries to patch the <code>get_random_bool</code> function that is imported in <code>jobs.etl_job.py</code>.</p>
<pre><code>from pyspark.sql import SparkSession
from unittest.mock import patch
from jobs.etl_job import transform_data1, transform_data2, transform_data3, transform_data4, transform_data5

# Create SparkSession
spark = SparkSession.builder \
        .master('local[1]') \
        .appName('Time Tests') \
        .getOrCreate()
spark.sparkContext.setLogLevel(&quot;WARN&quot;)
df = spark.createDataFrame([[&quot;1&quot;],[&quot;2&quot;]])
print('original dataframe')
df.show()

with patch('jobs.etl_job.get_random_bool') as f:
    f.return_value = 'notabool'
    df_t = transform_data1(df)
    print('with transform_data1')
    df_t.show()
    df_t = transform_data2(df)
    print('with transform_data2')
    df_t.show()
    df_t = transform_data3(df)
    print('with transform_data3')
    df_t.show()
    df_t = transform_data4(df)
    print('with transform_data4')
    df_t.show()
    df_t = transform_data5(df)
    print('with transform_data5')
    df_t.show()

</code></pre>
<p>Here's the output.</p>
<pre><code>original dataframe
+---+
| _1|
+---+
|  1|
|  2|
+---+

with transform_data1
+---+--------+
| _1|      _2|
+---+--------+
|  1|notabool|
|  2|notabool|
+---+--------+

with transform_data2
+---+--------+
| _1|      _2|
+---+--------+
|  1|notabool|
|  2|notabool|
+---+--------+

with transform_data3
+---+--------+
| _1|      _2|
+---+--------+
|  1|notabool|
|  2|notabool|
+---+--------+

with transform_data4
+---+----+
| _1|  _2|
+---+----+
|  1|true|
|  2|true|
+---+----+

with transform_data5
+---+-----+
| _1|   _2|
+---+-----+
|  1|false|
|  2|false|
+---+-----+
</code></pre>
<p>The first three transforms work fine--adding the mocked column where all values are <code>notabool</code>--but the fourth and fifth don't--they add a column of booleans instead of the mocked value. If the mocked function is called within the transform function, or if the mocked function is called by an inner function of the transform function, then it works; but if the transform function calls a function outside which calls the mocked function, then the actual non-mocked function is used.</p>
<p>Can anyone explain this behavior?</p>
",2,389,2021-11-12 1:33,,1,0,why
1525395,Mocking / Testing a core object in my system,<java><unit-testing><mocking>,"<p>I've been asked to work on changing a number of classes that are core to the system we work on. The classes in question each require 5 - 10 different related objects, which themselves need a similiar amount of objects. </p>

<p>Data is also pulled in from several data sources, and the project uses EJB2 so when testing, I'm running without a container to pull in the dependencies I need!</p>

<p>I'm beginning to get overwhelmed with this task. I have tried unit testing with JUnit and Easymock, but as soon as I mock or stub one thing, I find it needs lots more. Everything seems to be quite tightly coupled such that I'm reaching about 3 or 4 levels out with my stubs in order to prevent NullPointerExceptions.</p>

<p>Usually with this type of task, I would simply make changes and test as I went along. But the shortest build cycle is about 10 minutes, and I like to code with very short iterations between executions (probably because I'm not very confident with my ability to write flawless code).</p>

<p>Anyone know a good strategy / workflow to get out of this quagmire? </p>
",3,199,2009-10-06 12:52,,3,0,what
30216933,Why does this simple MSpec test return inconclusive?,<integration-testing><mspec><fakeiteasy>,"<p>I am using Mspec with FakeItEasy and I keep getting inconclusive test results. I tried commenting out my fake setup code and even the actual invocation of the method under test. I'm also unable to debug the test. I also just tried a simple test like this:</p>

<pre><code>private Then it_should_be_true = () =&gt; true.ShouldBeTrue();
</code></pre>

<p>What is the cause of inconclusive tests?</p>

<p><img src=""https://i.sstatic.net/A4vpM.png"" alt=""enter image description here""></p>

<pre><code>[Tags(""IntegrationTest"")]
[Subject(typeof(AuthManager))]
public class When_a_login_is_performed_using_valid_credentials
{
    protected static string MemberUsername;
    protected static string MemberPassword;
    protected static SignInResponse Response;

    private Given context = () =&gt;
    {
        MemberUsername = ""User1"";
        MemberPassword = ""Pass1"";
    };

    private When test = () =&gt;
    {
        Response = AuthManager.Current.SignIn(MemberUsername, MemberPassword);
    };

    private Then It_should_return_a_successful_response = () =&gt; Response.Success.ShouldBeTrue();
    private Then It_should_not_contain_any_reported_errors = () =&gt; Response.Errors.ShouldBeEmpty();
    private Then It_should_have_an_Id_populated = () =&gt; Response.Id.ShouldNotBeEmpty();
}
</code></pre>

<p>I wrapped It to become Then to match BDD syntax using the below code. It has always worked in the past.</p>

<pre><code>using Machine.Specifications;

namespace Testing.MachineSpecifications
{
    /// &lt;summary&gt;
    /// Given
    /// &lt;/summary&gt;
    [SetupDelegate]
    public delegate void Given();

    /// &lt;summary&gt;
    /// When
    /// &lt;/summary&gt;
    [ActDelegate]
    public delegate void When();

    /// &lt;summary&gt;
    /// Then
    /// &lt;/summary&gt;
    [AssertDelegate]
    public delegate void Then();
}
</code></pre>
",3,468,2015-05-13 13:51,,1,8,why
44650835,Mocking static method,<java><unit-testing><mocking><mockito><powermock>,"<p>I want to mock static method which is called within other static method.</p>

<pre><code>public class MyClass
{
    public static void methodA(String s)
    {
        ...
        methodB(s);
        ...
    }
    public static void methodB(String s)
    {
        ...
    }
}
</code></pre>

<p>So, I want to mock <code>methodA</code>, but I want to skip calling <code>methodB</code>.
I tried almost all solutions that I was able to find, without any success. Every time <code>methodB</code> is called.</p>

<p>Some solutions that I used:</p>

<pre><code>PowerMockito.suppress(method(MyClass.class, ""methodB""));
MyClass.methodA(""s"");
</code></pre>

<p>_</p>

<pre><code>PowerMockito.stub(method(MyClass.class, ""methodB""));
MyClass.methodA(""s"");
</code></pre>

<p>_</p>

<pre><code>PowerMockito.mockStatic(MyClass.class);
doNothing().when(MyClass.class, ""methodB"", anyString());
MyClass.methodA(""s"");
</code></pre>

<p>And many others...
Anyone have an idea how to solve this problem?</p>
",3,267,2017-06-20 10:41,,1,4,how
62005531,"Using Moq, why can't I raise and verify an event in my Windows Forms app?",<c#><winforms><unit-testing><events><moq>,"<p>I have a Windows Form app and in the Form_Load EventHandler it sets a checkbox's checkstate, which works fine when I run the app. But I also want a unit test to verify that the event sets the checkbox to match the database value as expected. However in my unit test the moq framework's <code>.Raise</code> does not appear to trigger the event as I cannot get any verify method at all to pass.</p>

<p>Here is the code:</p>

<p>IForm1</p>

<pre><code>public interface IForm1
{
    event EventHandler Load; //Assuming this exposes the Form's normal Load event to Test code
    void Form1_Load(object sender, EventArgs e);
    DataSet LoadData();
    CheckState MyCheckboxValue{ get;  set; }
}
</code></pre>

<p>Form1</p>

<pre><code>public partial class Form1 : Form, IForm1
{
    public CheckState MyCheckboxValue
    {
        get =&gt; checkBox1.CheckState;
        set =&gt; checkBox1.CheckState = value;
    }

    public Form1()
    {
        InitializeComponent();

        this.Load += new System.EventHandler(this.Form1_Load);
    }

    public void Form1_Load(object sender, EventArgs e)
    {
        DataSet ds = LoadData();

        checkBox1.CheckState = ds.Tables[0].Rows[0][""IndicatorName""] == ""Y"" ? CheckState.Checked : CheckState.Unchecked;
    }

    public DataSet LoadData()
    {
        //Dumbing down real-world scenario of reading a value from database
        //For this demo code, lets dummy load 1 in-memory value
        var dt = new DataTable("""");
        dt.Columns.Add(""IndicatorName"", typeof(string));
        dt.Rows.Add(""Y"");

        DataSet ds = new DataSet();
        ds.Tables.Add(dt);

        return ds;
    }
}
</code></pre>

<p>The Test</p>

<pre><code>public class Form1Should
{
    [Fact]
    public void SetCheckboxCheckedWhenDatasetIndicatorIsY()
    {
        // Arrange
        var dt = new DataTable("""");
        dt.Columns.Add(""CheckState"", typeof(string));
        dt.Rows.Add(""Y"");

        DataSet m_ds = new DataSet();
        m_ds.Tables.Add(dt);

        var mockForm1 = new Mock&lt;IForm1&gt;();

        // Various attempts to do setups related to the event so verify tests below will work
        mockForm1.SetupAdd(m =&gt; m.Load += new System.EventHandler(mockForm1.Object.Form1_Load));
        mockForm1.Setup(x =&gt; x.Form1_Load(this, EventArgs.Empty)).Verifiable(); // I think Verifiable() is required to verify this method is called further below?
        mockForm1.Setup(x =&gt; x.LoadData()).Returns(m_ds);

        // Act 
        mockForm1.Raise(x =&gt; x.Load += null, this, EventArgs.Empty);

        //Assert - I can't get any of these to work:
        mockForm1.Verify(x =&gt; x.Form1_Load(It.IsAny&lt;object&gt;(), It.IsAny&lt;EventArgs&gt;()));
        mockForm1.Verify(x =&gt; x.LoadData());
        mockForm1.VerifyAdd(x =&gt; x.Load += It.IsAny&lt;EventHandler&gt;());
        mockForm1.VerifySet(x =&gt; x.MyCheckboxValue = CheckState.Checked, Times.Once);
    }
}
</code></pre>

<p>What am I doing wrong? Why does <code>.Raise</code> have no effect?</p>
",0,300,2020-05-25 15:20,,0,4,why
77149213,I copied a unit test almost exactly the same but in mine when I asset_call_once_with I get an extra `bind` argument?,<python><unit-testing><mocking>,"<p>The first of the unit tests below passes, but the second one fails.</p>
<pre><code># unit test passes
def test_fetch_display_name(self, rows, expected_display_name, index):
    &quot;&quot;&quot;SQL is executed and the display name is returned.&quot;&quot;&quot;
    index.object_id = 100
    mock_fetchall = mock.MagicMock(return_value=rows)
    mock_result = mock.MagicMock(fetchall=mock_fetchall)
    mock_session = index._db_session
    mock_session.execute = mock.MagicMock(return_value=mock_result)
    mock_bind = mock.MagicMock()
    mock_session.get_bind = mock.MagicMock(return_value=mock_bind)
    expected_param_dict = {
        &quot;id&quot;: 100,
        &quot;fid&quot;: 998,
    }

    assert index._fetch_display_name() == expected_display_name
    mock_session.execute.assert_called_once_with(
        SQL.GET_STATIC_VAL, expected_param_dict, bind=mock_bind
    )

# unit test fails
def test_has_constituents(self, index):
    mock_fetchall = mock.MagicMock(return_value=[['True']])
    mock_result = mock.MagicMock(fetchall=mock_fetchall)
    mock_session = index._db_session
    mock_session.execute = mock.MagicMock(return_value=mock_result)
    mock_bind = mock.MagicMock()
    mock_session.get_bind = mock.MagicMock(return_value=mock_bind)
    expected_param_dict = {
        &quot;fid&quot;: 4633,
        &quot;clid&quot;: 136,
        &quot;ident&quot;: &quot;cboe-buk100p-O&quot;
    }

    assert index._has_constituents()
    mock_session.execute.assert_called_once_with(
        SQL.FETCH_INDEX_HAS_CONSTITUENTS, expected_param_dict, bind=mock_bind
    )
</code></pre>
<p>They are almost identical, but when I run the second one, I get:</p>
<pre><code>    E           AssertionError: expected call not found.
E           Expected: execute('select val from sval where fid = :fid and id = (select id from id where clid = :clid and ident = :ident);', {'fid': 4633, 'clid': 136, 'ident': 'cboe-buk100p-O'}, bind=&lt;MagicMock id='140712726575856'&gt;)
E           Actual: execute('select val from sval where fid = :fid and id = (select id from id where clid = :clid and ident = :ident);', {'fid': 4633, 'clid': 136, 'ident': 'cboe-buk100p-O'})
E           
E           pytest introspection follows:
E           
E           Kwargs:
E           assert {} == {'bind': &lt;Mag...12726575856'&gt;}
E             Right contains 1 more item:
E             {'bind': &lt;MagicMock id='140712726575856'&gt;}
E             Use -v to get more diff

../../anaconda3/envs/jobserveee/lib/python3.8/site-packages/pytest_mock/plugin.py:455: AssertionError
</code></pre>
<p>In the second unit test, for some reason it picks up <code>bind</code> as an argument. But in the first it doesn't.</p>
<p>Any ideas if it is to do with the way I set it up, or if I missed something?</p>
",0,25,2023-09-21 10:04,,0,1,what
68794385,Mocking an API route in a spy service (with Jasmine),<angular><typescript><mocking><jasmine><spy>,"<p>I'm attempting to mock out an API route in a spy service using Jasmine.</p>
<p>I'm very new to Angular, Typescript, and Jasmine, so I can't tell what I'm missing in my code, if I should insert the code within the <code>beforeEach</code> or in its own <code>it('should do xyz...')</code>, etc.</p>
<p>I <em>believe</em> I should be running the mock within <code>beforeEach</code>, but I'm running into an error with the payload (see notes below).</p>
<p><strong>spec.ts</strong>:</p>
<pre class=""lang-js prettyprint-override""><code>providers: [
   { provide: MyService, useValue: CommonServiceSpies.createHttpClientSpy()},
]

beforeEach(() =&gt; {
    fixture = TestBed.createComponent(ManagerComponent);

    const myVar = TestBed.inject(MyService) as jasmine.SpyObj&lt;MyService&gt;;
    
    const payload = 123 // I'd had an object that resembled the payload from the component.ts file, but it's not working with how the service was set up // Error received was: &quot;Account of type Observable&lt;{}&gt; is not assignable to param of type 'Observable&lt;number&gt;'&quot;

    myVar.GetRemainingAmount.and.returnValue(of(payload)); // Testing window err: &quot;cannot read property 'and' of undefined&quot;

    fixture.detectChanges();
});

it('should create', () =&gt; {
    expect(component).toBeTruthy();
});

</code></pre>
<p><strong>service.ts:</strong></p>
<pre class=""lang-js prettyprint-override""><code>export class MyService {
    constructor(
        private http: HttpClient
    ) { }

    GetRemainingAmount(request: RemainingAmountRequest): Observable&lt;number&gt; {
        return this.http.post&lt;number&gt;('/some-route', request);
    }

</code></pre>
<p><strong>manager-component.ts:</strong></p>
<pre class=""lang-js prettyprint-override""><code>constructor(
    public myService: MyService
  ) { } 

 hasRemainingSpend() : void {
    const payload: RemainingAmountRequest = {
      accountId: this.account.id,
      otherId: this.xyz?.id
    }

    this.myService.GetRemainingAmount(payload).subscribe((response: number) =&gt; {
      this.warningSpend = response;

      if (this.warningSpend &lt; this.rate.value || this.warningSpend == null) {
        // call another func
        // this is working as expected
      }
    })

  }
</code></pre>
",0,1057,2021-08-15 18:38,,1,0,what
66640989,how to test function with Fuse.js dependency,<node.js><jestjs><mocking><fuse>,"<p>I want to implement .test file for the following function:</p>
<pre><code>import Fuse from 'fuse.js';
import data from '../dal/data';
async function search(searchedData) {
  // In case searched name is null
  if (!searchedData) {
    return [];
  }

  // load data
  const dataload = await data();
  // set options to filter data
  const options = {
    includeMatches: true,
    // Search in `name'
    keys: ['name'],
  };
  const fuse = new Fuse(dataload, options);
  const matchedList = fuse.search(searchedData)
    .map((element) =&gt; element.item);

  return { matchedList };
}

export default search;
</code></pre>
<p>How to do for Fuse.js, shall I implement a mock data?</p>
",0,809,2021-03-15 15:32,,1,2,how
73661383,C# mocked property has value in Debugger but causes null reference,<c#><mocking><moq><dbcontext>,"<p>Why might this be the case?:</p>
<ul>
<li>hovering over the container class (<code>DbContext</code>) shows that the Persons property has a value (<code>Castle.Proxies.</code>) and the <code>Results View</code> shows a List with an item in (as expected).</li>
<li>hovering over the property when referenced shows NULL and referencing property causes <code>NullReferenceException</code></li>
</ul>
<p><strong>The Container Class is <code>BrokerContext</code></strong></p>
<pre><code>public interface IBrokerContext : IDisposable
        {
            DbSet&lt;Agents&gt; Agents { get; set; }
            
            IDbContextTransactionProxy BeginTransaction();
        }

        public class BrokerContext : ApplicationDbContext, IBrokerContext
        {
            public new DbSet&lt;Agents&gt; Agents { get; set; }
      ...
     }
</code></pre>
<p>The purpose of BrokerContext is to be a proxy/adapter for the ApplicationDbContext so that I can mock <code>BeginTransaction()</code>.</p>
<p>My code uses a <code>_db</code> of type <code>ApplicationDbContext</code> which has the Sets declared in BrokerContext. In my test, <strong>I am trying to construct a mock of type BrokerContext and pass that object into the class being tested to override the ApplicationDbContex</strong>t. That way I can control what happens when <code>BeginTransaction()</code> is called.</p>
<p>However, despite doing this:</p>
<pre><code>mockDb.Object.Agents = mockAgentSet.Object;
</code></pre>
<p>And passing that mock object into my class being tested, and seeing the property _db.Agents has a value in the debug view: any reference to <code>await _db.Agents</code> returns null!</p>
<p><strong>The DbContext being overriden:</strong></p>
<pre><code>    public class ApplicationDbContext : IdentityDbContext&lt;ApplicationUser&gt;
        {
            public virtual DbSet&lt;Agents&gt; Agents { get; set; }
...
}
    
        
</code></pre>
",0,174,2022-09-09 11:22,,0,5,why
74087441,"How can we mock several exception in Pytest, Mock_Response?",<python><pytest><pytest-mock>,"<p>We're revising our pytest script, according to parent 'executor' method revision -- added retry logic, to retry 3 times until get response and raise error on 4th.attempt.</p>
<p>Used to be, we test to raise socket error exception as follows, now we need to raise that exception after 3 times retry (below pytest code encountered the test error now).</p>
<pre><code>-- original code
def test_socketerror(monkeypatch, requests_mock):

    monkeypatch.setenv('ENV_ID', 'Local')
    requests_mock.post(&quot;http://localhost:8080/samplejob&quot;, exc=socket.error)

    with pytest.raises(CommunicationError) as ce:
        job_id = 'JOB_ID'
        executor = parentjob()
        executor.samplejob(job_id, None, None, None, None)
    assert str(ce.value.args[0]) == &quot;same error message on parent method&quot;
</code></pre>
<p>On the other hand, we can revise the other retry test as expected, to add mock_response with multiple response.</p>
<pre><code>-- other test revise (seems working fine)
def test_retry(monkeypatch, requests_mock):

monkeypatch.setenv('ENV_ID', 'Local')
headers = {'content-type': 'application/json'}
mock_response = [
    {'json': {'status': None}, 'status_code': None},
    {'json': {'status': None}, 'status_code': None},
    {'json': {'status': None}, 'status_code': None},
    {'json': {'status': None}, 'status_code': None}
]
requests_mock.post(&quot;http://localhost:8080/samplejob&quot;, headers=headers, json=mock_response)

with pytest.raises(CommunicationError) as ce:
    job_id = 'JOB_ID'
    executor = parentjob()
    executor.samplejob(job_id, None, None, None, None)
assert str(ce.value.args[0]) == &quot;same error message on parent method&quot;
</code></pre>
<p>But for Socket Error exception, can't apply multiple mock_response.</p>
<p>Let me also add the parent job:</p>
<pre><code>class parent
    
    def parentjob(self, job_id, date, subject, fromDate, toDate):

        for error_count in range(self.error_retry_times):
            try:
                request_url = 'http://' + self.hostname + '/samplejob'
                headers = {'content-type': 'application/json'}
                response = requests.post(request_url, data=json.dumps(payload), timeout=self.timeout, headers=headers)
            except Timeout as te:
                error_message = 'access batch api timeout.jobId=%s, count=%d' % (job_id, error_count)
            except Exception as e:
                error_message = 'failed to access batch api.jobId=%s, count=%d' % (job_id, error_count)

            if response is None:
                time.sleep(self.error_retry_inerval)
            else:
                break

        if response is None or response.status_code != 202:
            error_message = &quot;error message on parent method&quot;
            raise CommunicationError(error_message)

        return response
</code></pre>
",0,852,2022-10-16 13:19,,2,0,how
64691825,Thread.sleep is not getting mocked with PowerMockito,<java><multithreading><junit><mocking><powermockito>,"<p>Here's my setup which is not working:</p>
<p><strong>SomeclassTest.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@RunWith(PowerMockRunner.class)
@PowerMockIgnore(&quot;javax.management.*&quot;)
@PrepareForTest({SomeclassTest.class, Someclass.class})
public class SomeclassTest{

@InjectMocks
private Someclass someclass;

@Test(expected=None.class)
public void testRun() throws Exception{     
    PowerMockito.mockStatic(Thread.class);
    PowerMockito.doThrow(new RuntimeException()).when(Thread.class);
    Thread.sleep(Matchers.anyLong());        
    try {
            Thread.sleep(5L);
    }catch(Exception ex) {
            System.out.println(&quot;working&quot;); // this is working
    }    
    WhiteboxImpl.invokeMethod(someclass, &quot;run&quot;); // not working in someclass
    PowerMockito.verifyStatic();
}
</code></pre>
<p><strong>Someclass.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Named(&quot;Someclass&quot;)
public class Someclass extends Thread{

@Override
public void run() {
    while (true) {
        try {
            // clear interruption
            interrupted(); 
            
            long noOfRec= 0;
            if (noOfRec&gt; 0) {
                Thread.sleep(shortInterval);
            } else {
                Thread.sleep(longInterval);
            }
        } catch (InterruptedException ex) {
            Thread.currentThread().interrupt(); 
        } catch (Exception ex) {
        }
    }
}
</code></pre>
<p>My issue is PowerMockito isn't mocking <code>Thread.sleep()</code> when it's actually called in <code>Someclass</code> but weirdly working when <code>Thread.sleep()</code> is called inside the JUnit itself.</p>
<p>I am aware that wrapping <code>Thread.sleep()</code> in another method will solve my issue but I just want to know the correct method of mocking <code>Thread.sleep()</code> with PowerMockito.</p>
",11,4490,2020-11-05 5:45,,1,0,how
33828012,NSubstitute does not print out NUnit assertion,<c#><unit-testing><nsubstitute>,"<p>I have just started using <code>NSubstitute</code>. I mostly worked with <code>Moq</code>, and this is what i was doing:</p>

<pre><code>// In my unit test on menter code herey mock:
HasLogMessage(Is.EqualTo(""expected value""));

private void HasLogMessage(EqualConstraint s)
{
    log.Verify(y =&gt; y.Error(It.Is&lt;string&gt;(v =&gt; Verify(v, s))));
}

private bool Verify(string s, EqualConstraint equalConstraint)
{
    Assert.That(s, equalConstraint);
    return true;
}
</code></pre>

<p>Output when unit test is run. Note that it tells what expected and real value is:</p>

<pre><code>Expected string length 14 but was 116. Strings differ at index 0.
Expected: ""expected value""
But was:  ""real value...""
-----------^
 at NUnit.Framework.Assert.That(Object actual, 
</code></pre>

<p>IResolveConstraint expression, String message, Object[] args)</p>

<p>I want to be able to use that with <code>NSubstitute</code> mocks, and here's my attempt at this:</p>

<pre><code>HasLogMessage(Is.EqualTo(""Expected value""));

private void HasLogMessage(EqualConstraint s)
{
    log.Received().Log(LogLevel.Error, Arg.Is&lt;Func&lt;string&gt;&gt;(x =&gt; Verify(x, 
}

private bool Verify(Func&lt;string&gt; s, EqualConstraint equalConstraint)
{
    Assert.That(s(), equalConstraint);
    return true;
}
</code></pre>

<p>But this does not output <code>NUnit</code> assertion error</p>

<pre><code>NSubstitute.Exceptions.ReceivedCallsException : Expected to receive a call matching:
    Log(Error, x =&gt; value(IdentityServer3.Saml2Bearer.Tests.Saml2BearerGrantValidatorTest)
.Verify(x, value(IdentityServer3.Saml2Bearer.Tests.Saml2BearerGrantValidatorTest+&lt;&gt;c__DisplayClass21_0).s), &lt;null&gt;, )
Actually received no matching calls.
Received 2 non-matching calls (non-matching arguments indicated 
with '*' characters)
</code></pre>

<p>Am I missing something here?</p>
",0,384,2015-11-20 13:33,,1,0,what
72984593,GoogleMock trying to set a function argument to a specific value using EXPECT_CALL,<c++><testing><googlemock>,"<p>I have the following function prototype</p>
<pre><code>std::int16_t Driver::ListDevices( struct BoardInfo devInfo[], size_t len, int* pCount )

struct BoardInfo
{
    int iBoardNum;
    WORD wSlot;
    char cSite;
};
</code></pre>
<p>I have created a Mock for it as follows</p>
<pre><code>MOCK_METHOD3( ListDevices, std::int16_t( struct BoardInfo devInfo[], size_t   len, int* pCount ) );
</code></pre>
<p>When I call the function using my mock object I want it to return the value 0 and to set the value pointed to by the third parameter pCount to the value 1</p>
<p>The following partial solution successfully compiles and returns the value 0 when the EXPECT_CALL gets invoked</p>
<pre><code>EXPECT_CALL( *m_pMockObject, ListDevices( testing::_, testing::_, testing::_ ) ).Times( 1 ).WillOnce( testing::Return( 0 ) );
</code></pre>
<p>However if add to it in an attempt set the 3rd parameter to value 1 with the following</p>
<pre><code>EXPECT_CALL( *m_pMockObject, ListDevices( testing::_, testing::_, testing::_ ) ).WillOnce( testing::SetArgPointee&lt;2&gt;( 1 ) ).Times( 1 ).WillOnce( testing::Return( 0 ) );
</code></pre>
<p>It no longer compiles giving the following errors</p>
<pre><code>1&gt;------ Build started: Project: Test_Units_TTVC_MPU_ControlPad, Configuration: UnitTest_Debug x64 ------
1&gt;  UnitTestTTVC_MPU_ControlPad.cpp
1&gt;c:\workspace\mpu\controlpad-per-994\libs\googlemock\v1_7_0\bin\include\gmock\gmock-actions.h(446): error C2440: 'return': cannot convert from 'void' to 'short'
1&gt;  c:\workspace\mpu\controlpad-per-994\libs\googlemock\v1_7_0\bin\include\gmock\gmock-actions.h(446): note: Expressions of type void cannot be converted to other types
1&gt;  c:\workspace\mpu\controlpad-per-994\libs\googlemock\v1_7_0\bin\include\gmock\gmock-actions.h(445): note: while compiling class template member function 'short testing::PolymorphicAction&lt;testing::internal::SetArgumentPointeeAction&lt;2,int,false&gt;&gt;::MonomorphicImpl&lt;F&gt;::Perform(const std::tuple&lt;A1,std::A2,A3&gt; &amp;)'
1&gt;          with
1&gt;          [
1&gt;              F=int16_t (BoardInfo *,std::size_t,int *),
1&gt;              A1=BoardInfo *,
1&gt;              A2=std::size_t,
1&gt;              A3=int *
1&gt;          ]
1&gt;  c:\workspace\mpu\controlpad-per-994\libs\googlemock\v1_7_0\bin\include\gmock\gmock-actions.h(433): note: see reference to class template instantiation 'testing::PolymorphicAction&lt;testing::internal::SetArgumentPointeeAction&lt;2,int,false&gt;&gt;::MonomorphicImpl&lt;F&gt;' being compiled
1&gt;          with
1&gt;          [
1&gt;              F=int16_t (BoardInfo *,std::size_t,int *)
1&gt;          ]
1&gt;  c:\workspace\mpu\controlpad-per-994\code\src_unit_test\test_units_ttvc_mpu_controlpad\unittestttvc_mpu_controlpad.cpp(142): note: see reference to function template instantiation 'testing::PolymorphicAction&lt;testing::internal::SetArgumentPointeeAction&lt;2,int,false&gt;&gt;::operator testing::Action&lt;F&gt;(void) const&lt;F&gt;' being compiled
1&gt;          with
1&gt;          [
1&gt;              F=int16_t (BoardInfo *,std::size_t,int *)
1&gt;          ]
1&gt;  c:\workspace\mpu\controlpad-per-994\code\src_unit_test\test_units_ttvc_mpu_controlpad\unittestttvc_mpu_controlpad.cpp(142): note: see reference to function template instantiation 'testing::PolymorphicAction&lt;testing::internal::SetArgumentPointeeAction&lt;2,int,false&gt;&gt;::operator testing::Action&lt;F&gt;(void) const&lt;F&gt;' being compiled
1&gt;          with
1&gt;          [
1&gt;              F=int16_t (BoardInfo *,std::size_t,int *)
1&gt;          ]
========== Build: 0 succeeded, 1 failed, 1 up-to-date, 0 skipped ==========
</code></pre>
<p>I'm not sure what I'm doing wrong any advice greatly appreciated</p>
",0,216,2022-07-14 17:38,,1,1,what
68269744,FakeItEasy in C# on a servicereference,<service-reference><fakeiteasy>,"<p>I have a servicereference with a method I need to use in a test.</p>
<p>The servicereference class is defined as:</p>
<pre class=""lang-cs prettyprint-override""><code>public class MyServiceReference : Clientbase&lt;IMyServiceReference&gt;, IMyServiceReference 
{
   public MyServiceReference()
   {
   }

    ..... methods is then defined
}
</code></pre>
<p>From my testmethod I have tried both</p>
<pre class=""lang-cs prettyprint-override""><code>private MyServiceReference myServiceReferenceFake = A.Fake&lt;MyServiceReference&gt;();
// And
private MyServiceReference myServiceReference = new MyServiceReference();
</code></pre>
<p>For both of these is crashes in the constructor with the message:</p>
<pre><code>System.InvalidOperationException: Could not find default endpoint element that references contract.
</code></pre>
<p>All I need is to have a callto definition from a method in that class.
How can this be solved?</p>
",0,252,2021-07-06 11:28,,1,0,how
50574383,Sinon: Mocking websockets/ws,<node.js><unit-testing><mocking><sinon>,"<p>How can I mock up websockets/ws using Sinon? I'm trying to test that my application behaves as expected when using WebSockets, without necessarily needing to connect each time (eg: testing event handlers, etc).</p>

<p>Coming from a C# background, I'd just mock out the whole interface using a library like Moq, and then verify that my application had made the expected calls. </p>

<p>However, when trying to do this with Sinon, I'm running into errors.</p>

<p>An example of a test:</p>

<pre><code>const WebSocket = require('ws');
const sinon = require('sinon');
const webSocket = sinon.mock(WebSocket);
webSocket.expects('on').withArgs(sinon.match.any, sinon.match.any);
const subject = new MyClass(logger, webSocket);
</code></pre>

<p>This class is then calling:</p>

<pre><code>this._webSocket.on(""open"", () =&gt; {
    this.onWebSocketOpen();
});
</code></pre>

<p>But when I try and run my tests, I get this error:</p>

<p><code>TypeError: Attempted to wrap undefined property on as function</code></p>

<p>What's the correct way to mock out an object like this using Sinon? </p>

<p>Thanks.</p>
",0,1698,2018-05-28 23:11,,1,0,how
65223748,How to mock URLconnection so that I can change the return value for getLastModified method in java?,<java><mocking><mockito>,"<p>How to mock URLconnection so that I can change the return value for getLastModified method? I've tried a few different approaches like</p>
<pre><code>  @Spy
    Watcher watcher;

    @Mock
    URLConnection connection;

    @Test
    void status() throws IOException {
        Mockito.mock(connection.getClass());
        doReturn(connection).when(watcher).create(any());
        doReturn((long) 3).when(connection).getLastModified();

        Watcher watcher = new Watcher();

        URL url = new URL(&quot;http://www.google.ats&quot;);
        ConcreteObserver obs1 = new ConcreteObserver(watcher, url);
}

</code></pre>
<p>In watcher class I would have</p>
<pre><code>public URLConnection create(URL url) throws IOException {
        URLConnection connect = url.openConnection();
        return connect;
    }
</code></pre>
<p>and also some method to check the LastModifiedDate. However my last modifiedDate always returns the value 0.</p>
",1,292,2020-12-09 19:39,,1,0,how
64242250,How To Mock a .equal() method using easyMock,<java><junit><easymock>,"<p>I have the following code segment to test inside if block</p>
<pre><code>   if(&quot;anyString&quot;.equals(&quot;anyString&quot;)){
      //body
    }
</code></pre>
<p>How can I test above using easy mock as follows</p>
<p>lets take Chair as base class and getName() method which returns it name</p>
<pre><code>expect(chair.getName()..eq(&quot;string&quot;)).andReturn(true);
</code></pre>
<p>it's throw an InvocationTargetException</p>
<p>Any Help Appreciated</p>
",1,507,2020-10-07 10:34,,1,1,how
58945013,Mocked method returning null when called from a different project,<c#><unit-testing><nunit><nsubstitute>,"<p>I have this test class:</p>

<pre><code>using NSubstitute;
using NUnit.Framework;
using System;
using System.Linq.Expressions;

namespace MyTests
{    
    public class Tests
    {
        [Test]
        public void Test()
        {
            var companyBL = Substitute.For&lt;ICompanyBL&gt;();

            companyBL.GetCompany(c =&gt; new { c.RegionID }).ReturnsForAnyArgs(new
            {
                RegionID = 4,
            });

            var company = companyBL.GetCompany(c =&gt; new { c.RegionID });

            var dataRetriever = new DataRetriever(companyBL);
        }
    }
}
</code></pre>

<p>and this code in another project:</p>

<pre><code>namespace MyTests
{
    using System;
    using System.Linq.Expressions;

    public interface ICompanyBL
    {
        T GetCompany&lt;T&gt;(Expression&lt;Func&lt;Company, T&gt;&gt; selector);
    }

    public partial class Company
    {
        public int RegionID { get; set; }
    }

    public class DataRetriever
    {
        public DataRetriever(ICompanyBL companyBL)
        {
            //This is null:
            var company = companyBL.GetCompany(c =&gt; new
            {
                c.RegionID
            });
        }
    }
}
</code></pre>

<p>The <code>company</code> var is <code>null</code>.
However, when the code is all contained in the same .cs file in the same project, the value is not <code>null</code>.</p>

<p>Why is the value <code>null</code> when used in another file in another project?</p>

<p>NSubstitute version = 1.10.0.0.</p>

<p>.NET Framework version = 4.5.2.</p>

<p>Issue submitted in Github:
<a href=""https://github.com/nsubstitute/NSubstitute/issues/598"" rel=""nofollow noreferrer"">https://github.com/nsubstitute/NSubstitute/issues/598</a></p>
",0,391,2019-11-20 0:47,,1,1,why
1452418,How do I mock the HttpContext in ASP.NET MVC using Moq?,<c#><asp.net-mvc><mocking><moq><httpcontext>,"<pre><code>[TestMethod]
public void Home_Message_Display_Unknown_User_when_coockie_does_not_exist()
{
    var context = new Mock&lt;HttpContextBase&gt;();
    var request = new Mock&lt;HttpRequestBase&gt;();
    context
        .Setup(c =&gt; c.Request)
        .Returns(request.Object);
    HomeController controller = new HomeController();

    controller.HttpContext = context; //Here I am getting an error (read only).
    ...
 }
</code></pre>

<p>my base controller has an overrride of the Initialize that get's this requestContext.  I am trying to pass this along but I am not doing something right. </p>

<pre><code>protected override void Initialize(System.Web.Routing.RequestContext requestContext)
{
    base.Initialize(requestContext);
}
</code></pre>

<p>Where can I get more information on mocking my RequestContext and HttpContext using Moq?  I am trying to mock cookies and the general context.</p>
",116,84100,2009-09-21 0:24,,6,0,what
3690033,Mockito Passes but Code Coverage still low,<java><mocking><mockito>,"<pre><code>package com.fitaxis.test;

import java.sql.SQLException;

import org.junit.Assert;
import org.junit.Test;
import org.mockito.Mockito;
import org.mockito.invocation.InvocationOnMock;
import org.mockito.stubbing.Answer;

import static org.mockito.Mockito.*;

import com.fitaxis.leaderboard.LeaderBoard;

public class LeaderBoardTests {


 @Test 
 public void TestThatDataIsSavedToTheDatabase()
 {
  LeaderBoard leaderBoard = mock(LeaderBoard.class);
  //doNothing().doThrow(new RuntimeException()).when(leaderBoard).saveData();

  when(leaderBoard.saveData()).thenReturn(true);

  boolean res = leaderBoard.saveData();

  verify(leaderBoard).saveData();

  Assert.assertTrue(res);
 }

}
</code></pre>

<p>I have used mockito to mock a class, but when I use code coverage it does not detect that the method as been called. Am I doing something wrong? Please help!</p>
",4,25454,2010-09-11 6:15,,3,2,what
55218377,mockito when any value then return fixed value,<mocking><mockito>,"<p>Is there any of writing the below line?
Mockito.when(""*.test"").thenReturn(""fixedval"");</p>

<p>My expectation is a randomNumber in the place of *  like below</p>

<p>Mockito.when(""123test"").thenReturn(""fixedval"");
Mockito.when(""787test"").thenReturn(""fixedval"");</p>

<p>for any value  expecting the same return value</p>
",0,396,2019-03-18 9:40,,1,3,other
43377069,method mocking and sqlalchemy (psycopg2),<python><unit-testing><sqlalchemy><mocking><psycopg2>,"<p>I have the method, which does some job, returns some value and passes it to sqlalchemy query.
In case of test, I try to mock this method, but got exception: <code>sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) can't adapt type 'MagicMock'</code></p>

<p>I have code, which looks like this:</p>

<pre><code>from mock import patch
from sqlalchemy import Integer, Column

from pr.core.model import Base
from pr.core.model import Session


class SomeModel(Base):
    __tablename__ = 'table'
    id = Column(Integer, primary_key=True)


class SomeObj(object):
    def some_method(self):
        return 1

    def call(self):
        return Session.query(SomeModel).filter(SomeModel.id == self.some_method()).all()


def main():
    with patch('__main__.SomeObj.some_method') as mocked:
        SomeObj().call()
        assert mocked.called
if __name__ == '__main__':
    main()
</code></pre>

<p>After calling such code, I got such traceback:</p>

<pre><code>Traceback (most recent call last):
  File ""/home/anton/Projects/pr/core/run/stuff.py"", line 26, in &lt;module&gt;
    main()
  File ""/home/anton/Projects/pr/core/run/stuff.py"", line 23, in main
    SomeObj().call()
  File ""/home/anton/Projects/pr/core/run/stuff.py"", line 18, in call
    return Session.query(SomeModel).filter(SomeModel.id == self.some_method()).all()
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/orm/query.py"", line 2613, in all
    return list(self)
  File ""/home/anton/Projects/pr/core/model/cachingquery.py"", line 74, in __iter__
    return Query.__iter__(self)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/orm/query.py"", line 2761, in __iter__
    return self._execute_and_instances(context)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/orm/query.py"", line 2776, in _execute_and_instances
    result = conn.execute(querycontext.statement, self._params)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/engine/base.py"", line 914, in execute
    return meth(self, multiparams, params)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/sql/elements.py"", line 323, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/engine/base.py"", line 1010, in _execute_clauseelement
    compiled_sql, distilled_params
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/engine/base.py"", line 1146, in _execute_context
    context)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/engine/base.py"", line 1341, in _handle_dbapi_exception
    exc_info
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/util/compat.py"", line 202, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/engine/base.py"", line 1139, in _execute_context
    context)
  File ""/home/anton/Projects/pr/.venv/lib/python2.7/site-packages/sqlalchemy/engine/default.py"", line 450, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) can't adapt type 'MagicMock' [SQL: 'SELECT ""table"".id AS table_id \nFROM ""table"" \nWHERE ""table"".id = %(id_1)s'] [parameters: {'id_1': &lt;MagicMock name='some_method()' id='140314377476560'&gt;}]
</code></pre>

<p>Is there any way to mock method properly?</p>
",0,1750,2017-04-12 18:30,,0,5,what
71431491,How do I test an inner function that is been looped over with jest,<javascript><jestjs><mocking><jsdom><jest-dom>,"<p>How do you test an inner function that is been looped over in jest?</p>
<p>Example I have:</p>
<p>index.js</p>
<pre><code>const innerFunc = (type) =&gt; document.querySelector(`input[name=&quot;${type}&quot;]`).value;
const anotherInnerFunc = (type) =&gt; document.querySelector(`input[name=&quot;${type}&quot;]`).value = '';

const mainFunc = () =&gt; {
  const resultArray = [];
  // the document.querySelector('input[type=&quot;1 of those arrayTypes&quot;]') on those inside functions
  const arrayTypes = ['name', 'email', 'card']

  for (const type of arrayTypes) {
    // innerFunc
    resultArray.push(innerFunc(type))
    // clearing the input fields
    anotherInnerFunc(type)
  }
  return resultArray;
}

module.exports = {
  mainFunc,
  innerFunc,
  anotherInnerFunc
}
</code></pre>
<p>and for index.test.js</p>
<pre><code>/**
 * @jest-environment jsdom
 */
const indexFile = require('./index');
const { JSDOM } = require('jsdom');
const html = require('./duphtml.js');

let dom, window, document, inputName, inputEmail, inputCard;
describe('Testing the HTML FORM from index.html using JSDOM', () =&gt; {

  beforeAll(() =&gt; {
    dom = new JSDOM(html);
    window = dom.window;
    document= window.document;
    inputName = document.querySelector(`input[name=&quot;name&quot;]`);
    inputName.value = 'FakeCC';
    inputEmail = document.querySelector(`input[name=&quot;email&quot;]`);
    inputEmail.value = 'test@email.com';
    inputCard = document.querySelector(`input[name=&quot;card&quot;]`);
    inputCard.value = '5457623898234113';
    // console.log(document.querySelector(`input[name=&quot;name&quot;]`).value)
  });

  it('how do I test those inner functions?', () =&gt; {

    // Im a bit lost here searched around cant find anything to help me find the solution and I am out of ideas
    const inputArray = [inputName, inputEmail, inputCard];

    // how can I reach this end goal so those inside functions do working
    expect(indexFile.mainFunc()).toEqual(inputArray)
  })

})
</code></pre>
<p>How can I reach the final expect? And how would I pass in the three values of inputs I have defined inside the <code>beforeAll</code> block to perhaps those inside functions?</p>
<p>As the inside functions are returning null:</p>
<pre><code>    TypeError: Cannot read property 'value' of null

      110 | // Tested WORKS! check index.test.js
      111 | /* ----------------------------------- FORM SUBMISSION -------------------------------------- */
    &gt; 112 | const newValue = (type) =&gt; document.querySelector(`input[name=&quot;${type}&quot;]`).value;
</code></pre>
<p>this line:</p>
<pre><code>dom = new JSDOM(html);
</code></pre>
<p><code>html</code> is from another file I pasted the <code>index.html</code> into it as a string to have access to it inside the test file</p>
<p>duphtml.js</p>
<pre><code>const html = `
&lt;!doctype html&gt;
  &lt;main class=&quot;flex&quot;&gt;
    &lt;h1&gt;Form&lt;/h1&gt;
    &lt;section class=&quot;modal-dialog&quot;&gt;
      &lt;form method=&quot;POST&quot; onsubmit=&quot;mainFunc().bind(this); return false&quot; class=&quot;flow&quot; action=&quot;&quot;&gt;
        &lt;div class=&quot;flex&quot;&gt;
          &lt;label for=&quot;name&quot;&gt;Name:&lt;/label&gt;
          &lt;!-- First and Surname (should have been specified on the user stories) --&gt;
          &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; placeholder=&quot;Enter Your Name&quot;/&gt;
          &lt;!-- &lt;p&gt;Enter a correct name&lt;/p&gt; --&gt;
        &lt;/div&gt;
        &lt;div class=&quot;flex&quot;&gt;
          &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;
          &lt;input pattern=&quot;[a-zA-Z0-9._%+-]+@[a-z0-9.-]+\.[a-zA-Z]{2,4}&quot; type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; placeholder=&quot;Enter Your Email&quot;/&gt;
          
        &lt;/div&gt;
        &lt;div class=&quot;flex&quot;&gt;
          &lt;label for=&quot;card&quot;&gt;Card:&lt;/label&gt;
          &lt;input type=&quot;text&quot; name=&quot;card&quot; onkeyup=&quot;luhnAlgorithm(this)&quot; id=&quot;card&quot; placeholder=&quot;Enter a Proxy Credit Card Number&quot;/&gt;
          &lt;img hidden src=&quot;./assets/other.png&quot; id=&quot;imgCard&quot; style=&quot;padding:5px;&quot; /&gt;
        &lt;/div&gt;
        &lt;div&gt;
          &lt;input id=&quot;submit&quot; type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
        &lt;/div&gt;
      &lt;/form&gt;
    &lt;/section&gt;
  &lt;/main&gt;
`

module.exports = html;
</code></pre>
",0,52,2022-03-10 22:23,,1,1,how
56366687,Java Mockito is hitting real method rather than using mocked method,<java><unit-testing><mocking><mockito><junit4>,"<p>My mockito method is hitting the real method rather than invoking the mocked method. Your inputs will be helpful</p>

<p>Java code.</p>

<pre><code>public class CheckUser {
    private final UserDao userDao;

    public CheckUser (final String domain){
        userDao = new UserDao(domain);
    }

    public IUser getExistingUser(){
            if (userDao == null) {
                throw new RuntimeException(""userDao is null"");
            }
            IUser existingUser = userDao.getExistingUser();
            if (existingUser == null) {
                throw new RuntimeException(""ExistingUser is null"");
            }
            return existingUser;
    }
}
</code></pre>

<p>This is my JUnit test code.</p>

<pre><code>    @Test
    public void testExistingUser() {
        UserDao mockUserDao = mock(UserDao.class);
        when(mockUserDao.getExistingUser()).thenReturn(getExistingTestUser());
    }

    private UserDao getExistingTestUser(() {
        return ExistingUserImpl.Builder(). //withfield methods. build();
    }
</code></pre>

<p>I  am creating this mock object for only testing purpose. This just return the mocked MockedExistingUserImpl  object which is implemented by IUser. </p>

<pre><code>public class MockedExistingUserImpl implements IUser {
    //fields
    //overriding getter methods for all fields
    //Builder for  ExistingUserImpl
}
</code></pre>

<p>When ever I call userDao.getExistingUser() in my code, I am expecting to return the mocked Existing user object but it is hitting the real method and failing the test due to domain connection. We don't establish a domain connection to run Junits. Any inputs are appreciated. Thank you !</p>
",2,1811,2019-05-29 18:39,,2,4,what
57157200,Controlling dependencies in Symfony tests,<php><symfony><testing><mocking><symfony4>,"<p>I have a number of edge to edge tests for my Symfony 4.2 application. By this I mean tests that use the test client to make web requests and then do assertions on the result. Example:</p>

<pre><code>public function testPageNotFound() {
    $client = $this-&gt;createClient();
    $client-&gt;request('GET', 'does-not-exist');
    $this-&gt;assertSame(404, $client-&gt;getResponse()-&gt;getStatusCode());
}
</code></pre>

<p>Is there a way to change specific services in the service container in such tests?</p>

<p>Example issue: I have services that makes web requests via an abstraction called <code>FileFetcher</code>. For my tests I want a <code>NullFileFetcher</code> to be used so no real web requests are made. How do I tell Symfony to use this test double?</p>

<p>Surprisingly there is no info on how to do this basic testing task in the main testing documentation <a href=""https://symfony.com/doc/current/testing.html"" rel=""nofollow noreferrer"">https://symfony.com/doc/current/testing.html</a>.</p>

<p>One approach I tried is configuration in <code>config/packages/test/services.yaml</code>. This did not work and as far as I can tell is caused by Symfony not allowing overriding of services.yaml, since it loads the main <code>config/services.yaml</code> last: <a href=""https://symfony.com/doc/current/configuration.html#configuration-environments"" rel=""nofollow noreferrer"">https://symfony.com/doc/current/configuration.html#configuration-environments</a></p>

<p>In the end all I want to do is follow some very basic testing best practices:</p>

<ol>
<li>Initialize the whole environment at the start of each test method execution</li>
<li>Possibly change specific services and configuration away from the default</li>
<li>Execute code under test and make assertions on the result</li>
</ol>

<p>Any examples of code doing that using Symfony would be much appreciated.</p>
",1,578,2019-07-23 5:26,,2,0,what
69373411,Specify method paramater class type in 'every' block,<spring><kotlin><mockk>,"<p>I have a problem when using any() statement inside the save() method (Spring Framework). I get the error:</p>
<blockquote>
<p>Type inference failed: Not enough information to infer parameter T in inline fun  any( ): T<br />
Please specify it explicitly.</p>
</blockquote>
<p>Is there any way to pass the method parameter so I wouldn't have the error? I tried to pass the object as a parameter but the save() method creates a new object which requires to use any().</p>
<pre><code>every { repository.save(any()) } returns classObject
</code></pre>
<p>Error while passing the object:</p>
<blockquote>
<p>io.mockk.MockKException: no answer found for:
Repository(#10).save(app.core.model.Class@734a4045)</p>
</blockquote>
",0,70,2021-09-29 9:02,,1,0,what
67722938,C++ Gmock - WillOnce - Can you do anything aside from return a value?,<c++><qt><googlemock>,"<p>I am learning gmock and wondering how I can make my mock object do something when one of the mocked methods is called.</p>
<p>I need to mock some interfaces that make use of Qt and I am trying to get Qt and Gmock to work together.</p>
<p>For example, I mocked a network socket interface class, gave it to a network client class via constructor based DI, and I want to tell the mock socket to call one of its methods to signal the client when connection completes, in order to pretend a connection was made.</p>
<p>I see there is <code>WillOnce</code> and it takes and &quot;action&quot; but the documentation I am reading doesn't really explain what kinds of things an &quot;action&quot; can be. All the examples simply return something or increment a global variable. Can you call methods belonging to the abstract class you are mocking?</p>
<p>If not, I see you can separately define a fake object and make it a member of the mock, and then delegate, but that seems like a hell of a lot of work to put into every test case that wants a different behavior.</p>
<ul>
<li>You have to define every single pure virtual in your interface whether you want to use it or not for that particular test case</li>
<li>It seems I will have to create different fakes and therefore different mocks local to each test case, when the fake behavior differs
... For example, maybe I want open to signal in one test case a and not to signal in another</li>
</ul>
<p>Here is a bit of example code:</p>
<pre><code>class MySocketInterface : QObject
{
    Q_OBJECT
    public:
   
       virtual void connect(std::string url) = 0;
       
    signal:    // Specific to Qt, but this is what I need to call
       // Notifies subscribers
       void connected();
 }

 class MyThingToTest
 {
 public:
     MyThingToTest(std::unique_ptr&lt;MySocketInterface&gt; &amp;&amp; socket);
     void connect(std::string url);
     State getState() const;
 private:
     std::unique_ptr&lt;MySocketInterface&gt; m_socket;
     // Changes state to connected
     void onConnected();
 }

 Test1:
 ) Make a mock socket
 ) Give it to MyThingToTest
 ) Call MyThingToTest::connect
 ) mock socket needs to send notification faking connecting by calling `emit connected`
 ) Check if MyThingToTest is in connected state

 Test2:
 ) Make a mock socket
 ) Give it to MyThingToTest
 ) Call MyThingToTest::connect
 ) mock socket needs to not send notification, and 30 seconds needs to elapse.
 ) Check if MyThingToTest is in an error state
</code></pre>
<p>I want to prevent having to define an entirely new fake class and mock that delegates to it every single unit test case where actions would differ.</p>
<p>Please note, I am not looking for QSignalSpy or to verify signals and slots. I want to verify the functionality of my classes that react to them and have those classes use mock dependencies so I don't have to talk across the real network.</p>
",0,735,2021-05-27 13:16,,1,8,what
57775164,SegFault when using gmock,<c++><ubuntu><googlemock>,"<p>I am using gmock 1.6 framework to code unit test.
the unit tests exit and work fine on windows.</p>

<p>The goal is to run them on linux.</p>

<p>on Linux dev env:</p>

<ul>
<li><p>when I used eclipse CDT, the test work fine.</p></li>
<li><p>but when I use command line command (cmake .. &amp;&amp; make), I get a segmentation fault while the execution.</p></li>
</ul>

<p>Software versions:</p>

<ul>
<li>GNU Make 4.1</li>
<li>gcc (Ubuntu 7.4.0-1ubuntu1~18.04.1) 7.4.0</li>
<li>cmake 3.10.2</li>
</ul>

<pre><code>class mockClass : puclic baseClass
{
   .....
   MOCK_METHOD1(function, void(const std::shared_ptr&lt;mmmm&gt;));
   .....

}

TEST(testSerie1, test1)
{
   mockClass attrb;
   ......
   EXPECT_CALL(attrb, function(_)).Times(AnyNumber()); // here code crahes
    ...
}
</code></pre>

<p>ERROR:</p>

<pre><code>Thread 2 ""m_thread"" received signal SIGSEGV, Segmentation fault.
[Switching to Thread  (LWP 20104)]
0x0123 in testing::internal::FunctionMocker&lt;void (std::shared_ptr&lt;mmmmmmm&gt;)&gt;::Invoke(std::shared_ptr&lt;mmmmmmm&gt;) ()
(gdb) 
(gdb) 
(gdb) backtrace 
#0  ... in testing::internal::FunctionMocker&lt;void (std::shared_ptr&lt;mmmmmmm&gt;)&gt;::Invoke(std::shared_ptr&lt;mmmmmmm&gt;) ()
#1  ... in MockIClass::function(std::shared_ptr&lt;mmmmmmm&gt;) ()
.....
.....
.....
#6  0x00007ffff72bb66f in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#7  0x00007ffff758e6db in start_thread (arg=0x7ffff664e700) at pthread_create.c:463
#8  0x00007ffff6d1688f in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95
(gdb) 


</code></pre>

<p>Any idea please to avoid this segmentation fault ?</p>
",0,1647,2019-09-03 15:59,,1,2,how
68764834,Jest mock of mssql connection and query,<node.js><typescript><jestjs><mocking>,"<p>Can't get following mock testing work, can anyone help?</p>
<p>following is the source code to be tested:</p>
<pre><code>import { ConnectionPool, Request, VarChar } from &quot;mssql&quot;;

export const handler = async (): Promise&lt;any&gt; =&gt; {

  let connectionPool: ConnectionPool;
  let config = {
    server: &quot;&quot;,
    port: 1433,
    database: &quot;db&quot;,
    user: &quot;user&quot;,
    password: &quot;password&quot;,
    trustServerCertificate: true
  };

  try {
    connectionPool = new ConnectionPool(config);
    connectionPool.connect();

  } catch (ConnectionError) {

    throw &quot;ConnectionError&quot;;
  }

  try {

    let request: Request = connectionPool.request();
    request.input('param1', VarChar, 'param1');
    request.input('param2', VarChar, 'param2');

    let insertQuery = &quot;INSERT INTO TEST_TABLE (column1, column2 ) VALUES (@param1, @param2) &quot;;

    return await request.query(insertQuery);

  } catch (InsertError) {

    throw &quot;InsertError&quot;;
  }
}
</code></pre>
<p>Following is the testing:</p>
<pre><code>import {ConnectionPool, Request} from &quot;mssql&quot;;
import { handler } from './mock';

const mockQuery = jest.fn().mockReturnValue(&quot;result&quot;);
const mockInput = jest.fn(() =&gt; ({ query: mockQuery }));
const mockRequest = jest.fn(() =&gt; ({ input: mockInput }));

jest.mock('mssql', () =&gt; ({
  ConnectionPool: jest.fn(() =&gt; ({
    request: mockRequest
  })) 
}));

describe('test handler', () =&gt; {
  it('should succeed', async () =&gt; {

    try {
      let res = await handler();
      expect(res).toBe(&quot;result&quot;);
    } catch (error) {
      expect(error).toBe(&quot;&quot;);
    }
  });
});
</code></pre>
<p>I need to mock the mssql connection and query and return something, not throw an error, but I always got error thrown, like following:</p>
<pre><code>expect(received).toBe(expected)  

 Expected: &quot;&quot;
 Received: [TypeError: request.query is not a function]
</code></pre>
<p>Not understand this TypeError, I chhecked mssql under @types, Request type does include query function:
public query(command: string): Promise&lt;IResult&gt;;</p>
",3,910,2021-08-12 22:30,,0,0,how
78258249,Micronaut Kotlin: real bean is not replaced by mock,<kotlin><micronaut><mockk>,"<p>I must mock a service in micronaut, but in my test I see that real bean is still used.</p>
<pre><code>@MicronautTest(startApplication = false)
class StatsCommandHandlerTest {


    @Inject
    lateinit var wordCountService: WordCountService


    @MockBean(WordCountService::class)
    fun wordCountService(): WordCountService{
        return mockk(relaxed = true)
    }

   
    @Test
    @Throws(Exception::class)
    fun statsHandlerExistsTest() {
        every {
            wordCountService.getWordStat(50)
        } returns mapOf(
            &quot;test&quot; to 2,
            &quot;test1&quot; to 3
        )
      //OTHER TEST CODE IS OMITTED 
    }
</code></pre>
<p>I read on the internet mockk is better than mockito -so I used it, but behaviour is the same. Chat GPT gives some fake data. Can someone help me with it?</p>
",0,39,2024-04-01 23:19,,0,0,how
60958796,GMock removing implicit conversion warning when using ReturnArg,<c++><visual-studio><visual-c++><googletest><googlemock>,"<p>Given the following mock method</p>
<pre><code>MOCK_METHOD2(send, int(const void* pBuffer, size_t szBuffer));
</code></pre>
<p>And the following usage</p>
<pre><code>EXPECT_CALL(socketMock, send(_, _))
    .Times(1)
    .WillOnce(ReturnArg&lt;1&gt;());
</code></pre>
<p>Will generate a warning in ReturnArg due to the implicit conversion of szBuffer into the return type of int.</p>
<p>Here's an example of code:</p>
<pre><code>#include &lt;cstddef&gt;
#include &lt;cstdint&gt;
#include &lt;gmock/gmock.h&gt;
#include &lt;gtest/gtest.h&gt;

class ISocket {
public:
    virtual int Send(const uint8_t* payload, const std::size_t payloadLength, std::size_t&amp; sentLength) = 0;
};

class SocketMock : public ISocket {
public:
    MOCK_METHOD3(Send, int(const uint8_t*, const std::size_t, std::size_t&amp;));
};

class MySender
{
public:
    static void Ping(ISocket&amp; socket)
    {
        std::size_t bytesSent;
        uint8_t payload[64];
        memset(payload, 0, sizeof(payload));

        socket.Send(payload, sizeof(payload), bytesSent);

        if (bytesSent != sizeof(payload))
            throw std::runtime_error(&quot;Socket transmission failed&quot;);
    }
};

TEST(SocketSend, ReturnsBytesTransmitted)
{
    SocketMock socket;

    EXPECT_CALL(socket,
        Send(
            ::testing::_, // payload
            ::testing::_, // payload length
            ::testing::_  // return by param, bytes sent
        )).Times(1)
        .WillOnce(::testing::ReturnArg&lt;1&gt;());

    MySender::Ping(socket);

    ::testing::Mock::VerifyAndClearExpectations(&amp;socket);
}

GTEST_API_ int main(int argc, char** argv)
{
    testing::InitGoogleTest(&amp;argc, argv);
    return RUN_ALL_TESTS();
}
</code></pre>
<p>Here's the compiler warning:</p>
<blockquote>
<p>googletest\googlemock\include\gmock/gmock-more-actions.h(165): warning C4267: 'return': conversion from 'size_t' to 'int', possible loss of data (compiling source file TestMain.cpp)</p>
</blockquote>
<p>Is there anyway to make GMock use a static_cast to change the return type to eliminate the type conversion warning?</p>
",2,1056,2020-03-31 19:53,,1,2,what
60747253,net core 2.0 xunit Controller with dependency injection using Mock is null,<c#><dependency-injection><moq><xunit>,"<p>I am doing an <code>Net Core 2.0 Rest Api</code> application. </p>

<p>I am using dependency injection with Interface <code>IContactBiz</code> and class <code>ContactBiz</code>.</p>

<p>IContactBiz is defined like this</p>

<pre><code>public interface IContactBiz
{
    ReturnModel Add(List&lt;ContactEntity&gt; lstContactEntity, ContactEntity contact); 
}
</code></pre>

<p>My ContactBiz class</p>

<pre><code>public class ContactBiz: IContactBiz
{   
    public ReturnModel Add(List&lt;ContactEntity&gt; lstContactEntity, ContactEntity contact)
    {
        contact.ID = Guid.NewGuid().ToString();
        lstContactEntity.Add(contact);
        return new ReturnModel()
        {
            Result = true,
        };
     }
}
</code></pre>

<p>It is set in startup.cs</p>

<pre><code>public void ConfigureServices(IServiceCollection services)
{  
    services.AddSingleton&lt;IContactBiz, ContactBiz&gt;();
}
</code></pre>

<p>I have a ContactController, defined like this</p>

<pre><code>public class ContactController : Controller
{
    private readonly IContactBiz _contactBiz;

    public ContactController(IContactBiz contactbiz)
    {
        _contactBiz = contactbiz;
    }

   //...
</code></pre>

<p>I have Post Method on my controller where i call Add() method from <code>ContactBiz</code> class</p>

<pre><code>[HttpPost]
public IActionResult Post([FromBody]ContactModel contact)
{
    ReturnModel errorModel = new ReturnModel();

    //...

    errorModel = _contactBiz.Add(lstContactEntity, contactEntity);

    //...
 }
</code></pre>

<p>When I run it with Postman, it works fine.. I reach Add() method from ContactBiz.cs and retrieve data.</p>

<p>But I have a <code>xUnit</code> project to test it, and I want to use Moq..</p>

<p>I have</p>

<pre><code>public class ContactControllerTest
{
    ContactController _controller;
    public ContactControllerTest()
    {
        Mock&lt;IContactBiz&gt; mockRepo = new Mock&lt;IContactBiz&gt;();
        _controller = new ContactController(contactbiz: mockRepo.Object);
    }

    [Fact]
    public void InsertContact()
    {
        ContactModel cm = new ContactModel()
        {
            Address = ""data"",
            City = ""data"",
            Company = ""data"",
            Email = ""data"",
            Name = ""data"",
            PhonePersonal = ""data"",
            PhoneWork = ""data"",
            State = ""data"",
            BirthDate = DateTime.Today.AddYears(-30)
        };
        var actionResult = _controller.Post(cm);
    }
}
</code></pre>

<p>I run it in debug mode... </p>

<p>When I reach the line 
<code>errorModel = _contactBiz.Add(lstContactEntity, contactEntity);</code> in Post() method.. is null...</p>

<p>Add() method from the class ContactBiz it is never called</p>

<p>I think i am missing to set which class has is mapped to <code>_contactBiz</code> interface </p>

<p>the line I have in startup.cs</p>

<p><code>services.AddSingleton&lt;IContactBiz, ContactBiz&gt;();</code> 
Do not have access to Add() method por ContactBiz class, and <code>errorModel</code> is null.</p>

<p>I think the problem is that I did not I assign <code>services.AddSingleton&lt;IContactBiz, ContactBiz&gt;();</code> in Moq?</p>

<p>Is there another problem?</p>

<p>Thanks</p>
",0,82,2020-03-18 20:45,,1,4,what
8433812,"IPhone unit testing OCMock, how to mock read only variables?",<unit-testing><mocking><readonly><ocmock>,"<p>We always use OCMock in the following way, but it seems doesn't work for some read only property variables, such as NavigationController and so forth, it is read only, set mock one doesn't take effect.  </p>

<p>Have you ever experienced this tough issue, how do you solve it? Any idea will be appreciated, thanks in advance you smart guys.  </p>

<pre><code>id mockWebView = [OCMockObject mockForClass:[UIWebView class]];
[[mockWebView expect] loadHTMLString:...];
object_setInstanceVariable(viewController, ""webView"", mockWebView);
</code></pre>
",3,2652,2011-12-08 15:59,,1,0,how
76564857,How to improve readabilty and maintainability of @patch and MagicMock statements (avoid long names and String identification)?,<python><mocking><pytest><magicmock>,"<p>In my test code I have a lot of boilerplate expressions &quot;Magic&quot;, &quot;return_&quot;. I also have lengthy strings to identify the paths of the functions to mock.
The strings are not automatically replaced during refactoring and I would prefer to directly use the imported functions.</p>
<p>Example code:</p>
<pre><code>from mock import patch, MagicMock
from pytest import raises

@patch(
    'foo.baa.qux.long_module_name.calculation.energy_intensity.intensity_table',
    MagicMock(return_value='mocked_result_table'),
)
</code></pre>
<p>Instead I would prefer:</p>
<pre><code>from better_test_module import patch, Mock, raises
from foo.baa.qux.long_module_name.calculation import energy_intensity

@patch(
    energy_intensity.intensity_table,
    Mock('mocked_result_table'),
)
</code></pre>
<p>or</p>
<pre><code>@patch(
    energy_intensity.intensity_table,
    'mocked_result_table',
)
</code></pre>
<p>I post my corresponding custom implementation as an answer below.</p>
<p>If you have other suggestions, please let me know. I am wondering why the proposed solution is not the default. I do not want to reinvent the wheel.
Therefore, if there is an already existing library I could use, please let me know.</p>
<p>Related:</p>
<p><a href=""https://stackoverflow.com/questions/17181687/mock-vs-magicmock"">Mock vs MagicMock</a></p>
<p><a href=""https://stackoverflow.com/questions/67580353/how-to-override-getitem-on-a-magicmock-subclass"">How to override __getitem__ on a MagicMock subclass</a></p>
",-2,110,2023-06-27 12:27,,1,0,why
9594397,Moq: Can I swap between mocked member/property behavior and unmocked member/property behavior?,<unit-testing><c#-4.0><tdd><moq><moq-3>,"<p>I want to use one instance of a mock library I am using in a test class, however, for some tests, I may want to mock one of the member functions to do/return mocked behavior/returned value; for other tests, I may want the unmocked (native) functionality of the library.  Is there a way to swap between Setup in one instance (mocked behavior), and ""UNSetup"" (unmocked behavior) in another?</p>
",1,482,2012-03-07 1:08,,2,0,what
58016254,"After mocking through autofac, actual implementation of service is getting called",<c#><unit-testing><moq><autofac><mstest>,"<p>Am writing unit test cases for the project,<br>
Service class is mocked and even after mocking actual implementation is getting called,Please suggest the way to mock properly. So that service method gets mocked properly.G</p>

<pre><code>


 [TestMethod]
    public void CustomerTest()
    {
      using (var mock = AutoMock.GetLoose())
      {
        //For testing,Created dummy object of customer having datatable dt
        var response = Task.FromResult(customer(dt))
        // Arrange - configure the mock
        mock.Mock&lt;ICustomerService&gt;().Setup(x =&gt; x.GetCustomerDetails(It.IsAny&lt;string&gt;(),It.IsAny&lt;string&gt;())).Returns(response);
        var sut = mock.Create&lt;CustomerViewModel&gt;();

        // Act
        var actual = sut.GetCustomerInfo(""12345"", ""Name"");

        // Assert - assert on the mock
        mock.Mock&lt;ICustomerService&gt;().Verify(x =&gt; x.GetCustomerDetails(It.IsAny&lt;string&gt;(),It.IsAny&lt;string&gt;(),Times.Once());
        Assert.AreEqual(response, actual);
      }
    }

</code></pre>

<p>I have to mock the service, so that actual method of service doesnt get invoked.</p>
",-1,268,2019-09-19 17:32,,2,4,what
60712223,How do I mock an AbstractValidator that is using rule sets?,<c#><moq><fluentvalidation>,"<p>I have an abstract validator, with the following structure:</p>

<pre><code>public abstract class RiskAssessmentServiceCreateRequestValidator&lt;T&gt;
    : AbstractValidator&lt;T&gt; where T
        : IRiskAssessmentServiceCreateRequest
{
    public RiskAssessmentServiceCreateRequestValidator(ApplicationContext context)
    {
        RuleSet(""modelBinding"", () =&gt;
        {
            RuleFor(x =&gt; x.ServiceProviderId).NotNull().GreaterThan(0);
        });

        RuleSet(""handler"", () =&gt;
        {
            //....
        });

    }
}
</code></pre>

<p>In my request handler I am calling a derived instance of this class like that:</p>

<pre><code>var validationResult = _validator.Validate(request, ruleSet: ""handler"");
</code></pre>

<p>How can I mock that particular call to Validate in my unit tests? If I would not use the rule sets, my Setup would look like this:</p>

<pre><code>_validator.Setup(x =&gt; x.Validate(It.IsAny&lt;CreateRequest&gt;()))
          .Returns(validationResult);
</code></pre>

<p>The following call is not allowed, since optional parameters are not allowed in an expression tree:</p>

<pre><code>_validator.Setup(x =&gt; x.Validate(
                It.IsAny&lt;CreateRequest&gt;(), 
                ruleSet: It.IsAny&lt;string&gt;()))
          .Returns(validationResult);
</code></pre>

<p>Theoretically I could set it up like this:</p>

<pre><code>_validator.Setup(x =&gt; x.Validate(
                It.IsAny&lt;CreateRequest&gt;(), 
                (IValidatorSelector)null,
                It.IsAny&lt;string&gt;()))
           .Returns(validationResult);
</code></pre>

<p>But this then results in: </p>

<pre><code>System.NotSupportedException : Unsupported expression: x =&gt; x.Validate&lt;CreateRequest&gt;(It.IsAny&lt;CreateRequest&gt;(), null, It.IsAny&lt;string&gt;())
    Extension methods (here: DefaultValidatorExtensions.Validate) may not be used in setup / verification expressions.
</code></pre>

<p>Except from using the real validator, which I want to avoid, how can I resolve this and setup Moq in a suitable way?</p>
",3,4185,2020-03-16 19:37,,2,3,how
78228624,Mocking FunctionContext in Azure blob trigger function unit tests in .net 8,<c#><moq><executioncontext><azure-functions-isolated>,"<p>I need help with below .net testing.</p>
<p>We have existing unit tests for blobtrigger functions.</p>
<p>I upgraded to .net 8 and FunctionContext had to be in place of ExecutionContext to allow using  RetryContext.
This upgrade meant replacing Microsoft.Azure.Webjobs with Microsoft.Azure.Function.Worker .</p>
<p>The current unit test for the above blob trigger execute method is creating a new ExecutionContext object and setting the RetryContext.retryCount and RetryContext.maxRetryCount as needed for the tests. These 2 variables are used in checking the below condition,</p>
<p>if RetryContext.retryCount = RetryContext.maxRetryCount
then file needs to be moved to a different folder that will later be handled.</p>
<p>The way our unit tests are written, all the test methods related to blobtrigger like fileUpload, executeInvalidFileName, etc., are setting a context object with these retrycontext properties and passing the context to execute method.</p>
<p>FunctionContext and Retrycontext are both abstract classes. RetryContext is a property of FunctionContext and it is a readonly property. I am unable to create an object and pass as context because FunctionContext is an abstract class.</p>
<p>I am not sure if mocking is the best way to handle this but I tried to mock the function context.</p>
<p>Please help me fix this to pass the context for my unit test.</p>
<p>My function is,</p>
<pre><code>public async Task Run(string blobname, blobcontent, ExecutionContext context)
{
    await this.controller.execute(name,blob,context);
}
</code></pre>
<p>FunctionContext mock I created:</p>
<pre><code>protected FunctionContext GetExecutionContextNotAtMaxRetry()
{
    var contextMoq = new Mock&lt;FunctionContext&gt;();
    contextMoq.Setup(X =&gt; X.RetryContext.RetryCount).Returns(1);
    contextMoq.Setup(X =&gt; X.RetryContext.MaxRetryCount).Returns(2);
    return contextMoq;
}
</code></pre>
<p>This is giving me an error as contextMoq is not same as FunctionContext.</p>
<p>Error is</p>
<pre><code>Cannot implicitly convert type
Moq.Mock&lt;Microsoft.Azure.Function.Worker.FunctionContext&gt; to
Microsoft.Azure.Function.Worker.FunctionContext.
</code></pre>
",0,288,2024-03-26 23:19,,1,0,how
1688951,How to mock abstract class with static members in Grails?,<unit-testing><grails><groovy><mocking>,"<p>I need to mock a GrailsControllerClass interface. Instance should have a static variable defined. The problem is that MockFor and StubFor don’t give you an option for adding static members.
So, I write my abstract class that extends GrailsControllerClass</p>
<pre><code>abstract class MyController implements GrailsControllerClass {
   static myDefinition  = [name:&quot;item1&quot;, action:&quot;action1&quot;]
}
</code></pre>
<p>Now, MockFor and StubFor raise an error: groovy.lang.MissingMethodException: No signature of method: groovy.util.ProxyGenerator.instantiateAggregateFromBaseClass() is applicable for argument types: (java.lang.Class, null) values… which seems to be a reported bug:
<a href=""http://jira.codehaus.org/browse/GROOVY-3720"" rel=""nofollow noreferrer"">https://issues.apache.org/jira/browse/GROOVY-3720</a>
Alas, grails comes with groovy 1.6.</p>
<p>I do not want to make MyController a huge concrete class with empty method declarations. Any alternatives?</p>
",0,1784,2009-11-06 17:04,,3,0,what
46528429,How to mock this class?,<java><testing><mocking><mockito><powermockito>,"<p>I'm a student who really needs help with how to mock this class or any part of it. I've tried the general way but it's not working. I think I'm lacking the knowledge and I need help from anyone who knows how to mock these in any way to help me.<br>
I have no idea how to do it</p>

<pre><code>package IT_chatbot;

import java.util.Properties;
import java.util.Scanner;

import javax.mail.Message;
import javax.mail.PasswordAuthentication;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;

public class request_remark {
private static Scanner scan = new Scanner(System.in);
public static String remark(String studentID){

    String courseCode="""";

    System.out.println(""Please enter course Code to be remarked:"");
    courseCode = scan.nextLine();
    System.out.println(""The message is sending..."");


    Properties props = new Properties();
    props.put(""mail.smtp.host"", ""smtp.gmail.com"");
    props.put(""mail.smtp.port"", ""587"");     
    props.put(""mail.smtp.auth"", ""true"");
    props.put(""mail.smtp.starttls.enable"", ""true"");
   Session session = Session.getInstance(props,new javax.mail.Authenticator()
   {
      protected PasswordAuthentication getPasswordAuthentication() 
      {
         return new PasswordAuthentication(""kmitl@gmail.com"",""2016mmm"");
      }
  });

  try
  {   
   MimeMessage message = new MimeMessage(session);
      message.setFrom(new InternetAddress(""kmitl@gmail.com""));
      message.addRecipient(Message.RecipientType.TO,new InternetAddress(""wn1apc@gmail.com""));
      message.setSubject(""Request a remark for a recent past of""+studentID);
      StringBuffer emailMessage = new StringBuffer(""Dear Hades"");
       emailMessage.append(""\r\n"");
       emailMessage.append(""We've recieved the remark request from student number "" + studentID+ "" subject "" + courseCode);
       emailMessage.append(""\r\n"");
       emailMessage.append(""\r\n"");
       emailMessage.append(""\r\n"");
       emailMessage.append(""Best regard,"");
       emailMessage.append(""\r\n"");
       emailMessage.append(""\r\n"");
      message.setText(emailMessage.toString());
      Transport.send(message);


   }
   catch(Exception e)
   {
     e.printStackTrace();
   }
return courseCode;
}
}
</code></pre>
",-3,483,2017-10-02 15:14,,1,0,how
2151827,How to test a ruby application which uses mechanize,<ruby><testing><mocking><mechanize>,"<p>I wrote a small program that uses Mechanize to traverse a site.</p>
<p>I want to write tests for it, but don't want it to actually go log onto the site every time I run the tests. I would like to mock the internet, so that when it goes to some site, it simply returns the stored results.</p>
<p>Here is a small example, pretend my code's purpose was to pull links off of the google homepage, so I write a test to ensure the first link my code finds has the text &quot;Images&quot;. I might write something like this:</p>
<pre><code>require 'rubygems'
require 'mechanize'
require 'test/unit'

def my_code_to_find_links
  google = WWW::Mechanize.new.get('http://www.google.com')
  # ...
  # some code to figure out which links it wants
  # ...
  google.links
end

class TestGoogle &lt; Test::Unit::TestCase
  def test_first_link_is_images
    assert_equal 'Images' , my_code_to_find_links.first.text
  end
end
</code></pre>
<p>How do I mock google.com so that I can test my_code_to_find_links without all the overhead of <em>actually</em> accessing the internet?</p>
<p>thanks
-Josh</p>
",19,3883,2010-01-28 2:06,,4,0,how
23676583,Testing non-virtual methods using GMock,<visual-c++><mfc><googletest><googlemock>,"<p>how to use Google mocking in VC++ with Google testing for non-virtual methods with out modifying original code. 
For MFC VC++ (Dialog boxes). Where and How i can Implement GMock to my legacy code.
Can any one provide a Detailed explanation for these things. </p>

<p>Thank you.</p>
",0,1187,2014-05-15 11:12,,1,4,how
1778744,"Using Mockito's generic ""any()"" method",<java><unit-testing><mocking><mockito>,"<p>I have an interface with a method that expects an array of <code>Foo</code>:</p>

<pre><code>public interface IBar {
  void doStuff(Foo[] arr);
}
</code></pre>

<p>I am mocking this interface using Mockito, and I'd like to assert that <code>doStuff()</code> is called, but I don't want to validate what argument are passed - ""don't care"".</p>

<p>How do I write the following code using <code>any()</code>, the generic method, instead of <code>anyObject()</code>?</p>

<pre><code>IBar bar = mock(IBar.class);
...
verify(bar).doStuff((Foo[]) anyObject());
</code></pre>
",237,435873,2009-11-22 13:50,,5,0,how
74062437,How to test code with Jest that uses readonly fields on mocks of libraries (such as ws socket.readyState)?,<javascript><unit-testing><testing><jestjs><mocking>,"<p>I want to unit test this <strong>JS</strong> code with <strong>Jest</strong>. It's using the ws websocket library:</p>
<p>Socket.js</p>
<pre><code>import WebSocket from &quot;ws&quot;;

export default class Socket {
    socket = undefined;

    connect(url): void {
        if (this.socket !== undefined &amp;&amp; this.socket.readyState === WebSocket.OPEN) {
            throw new Error(&quot;Socket is already connected&quot;);
        }

        this.socket = new WebSocket(url);
    }
}
</code></pre>
<p>I want to check the error is thrown. For that to happen, I create a mock for the socket and then need to set the <code>readyState</code> of the socket object to <code>CLOSED</code>. The issue is that this is impossible because it's a readonly field.</p>
<p>Test:</p>
<pre><code>import Socket from &quot;./Socket&quot;;
import WebSocket from &quot;ws&quot;;

jest.mock(&quot;ws&quot;);

it(&quot;can connect&quot;, () =&gt; {
    // Arrange
    const url = &quot;www.someurl.com&quot;;
    jest.spyOn(global, &quot;Promise&quot;).mockReturnValueOnce({} as Promise&lt;void&gt;);

    const sut = new Socket();

    // Act
    sut.connect(url);

    const webSocket = jest.mocked(WebSocket).mock.instances[0];

    // Set readystate of socket
    webSocket.readyState = WebSocket.CLOSED; // Error here: Cannot assign to 'readyState' because it is a read-only property. ts(2540)

    const action = () =&gt; sut.connect(url);

    // Assert
    expect(action).toThrowError(new Error(&quot;Socket is already connected&quot;));
});
</code></pre>
<p><strong>Question</strong>: How to test any code that uses readonly fields on mocks of libraries such as <code>socket.readyState</code>?</p>
<p><strong>Edit:</strong> Added the mvce on request above.</p>
",0,685,2022-10-13 22:24,,1,1,how
48557981,"Exception using mock library, python unit testing issue",<python><unit-testing><mocking>,"<ul>
<li>Windows 7 Professional (64 bit)</li>
<li>Python 2.7.14 (2.7.14150 64 bit)</li>
<li>mock 2.0.0</li>
</ul>

<p>When I just run <code>python -c ""import mock""</code> from command prompt (as an administrator) it yields Exception:</p>

<pre><code>Traceback (most recent call last):
  File ""&lt;string&gt;"", line 1, in &lt;module&gt;
  File ""C:\Python27\lib\site-packages\mock\__init__.py"", line 2, in &lt;module&gt;
    import mock.mock as _mock
  File ""C:\Python27\lib\site-packages\mock\mock.py"", line 71, in &lt;module&gt;
    _v = VersionInfo('mock').semantic_version()
  File ""C:\Python27\lib\site-packages\pbr\version.py"", line 461, in semantic_version
    self._semantic = self._get_version_from_pkg_resources()
  File ""C:\Python27\lib\site-packages\pbr\version.py"", line 448, in _get_version_from_pkg_resources
    result_string = packaging.get_version(self.package)
  File ""C:\Python27\lib\site-packages\pbr\packaging.py"", line 755, in get_version
    name=package_name))
Exception: Versioning for this project requires either an sdist tarball, or access to an upstream git repository. It's also possible that there is a mismatch between the package name in setup.cfg and the argument given t
o pbr.version.VersionInfo. Project name mock was given, but was not able to be found.
</code></pre>
",2,1493,2018-02-01 8:06,,2,0,other
67479341,Can I Easily Make DataTable data for Unit Tests?,<c#><unit-testing><debugging><datatable><mocking>,"<p>Thank you for reading.
I want to unit test some functions which is used Datatable as input parameter.</p>
<p>But, in program, DataTable was created by Database.
So, i want to make sample DataTable Data for unit test.</p>
<p>But, it is hard. because, there is 20 columns.
So, when i typing all the columns and each row, i feel it is really waste time.</p>
<p>Can I Easily Make DataTable data for Unit Tests?
for example, in debugging mode, there is a datatable with data.
i want to use feature like &quot;make datatable data as code&quot; button.
Then, datatable is created at that moment.</p>
<p>--------------add------------
when i debug program, there is a datatable created by real-database.
And i want to make unit test using sample data which is from real-database.
So, i typing all the columns and each row which is from debugging mode.
But, my datatable is consist of 20 columns, So it is hard to enter all data.
There is any other way to do it?</p>
",1,1464,2021-05-11 1:08,,1,4,what
37935855,Mock 3rd party API to test express API using nock,<node.js><mocha.js><nock>,"<p>I am trying to mock third part API which is called from my API which doesnt seem to be working.</p>

<pre><code>    describe('Smartvehicle API test', function() {
      it('should return vehicle info', function(done) {
       nock(""http://some.api.com"")
        .post('/test', '{""id"":""1234"",""responseType"":""JSON""}')          
        .reply(200, {
          ""status"": 200,
          ""message"": ""This is a mocked response""
       });
       request(url)
       .get('/vehicles/1234')
       .end(function(err, res) {
         console.log(res.text);
        res.status.should.be.equal(200);
        res.body.vin.should.be.equal(""22"");          
        done();
     });      
  })
});
</code></pre>

<p>The <strong>some.api.com</strong> is called from the controller.</p>

<pre><code>router.get('/vehicles/:id', function(req, res, next) {
  // Create an instance of our factory that makes vehicles
  var vehicle = vehicleFactory.getVehicle(req.params.id);
  var input = vehicle.vehicleInfo.parseInput(req.params.id);
  requestApi(input, vehicle.vehicleInfo.url, function(err, response) {
    if (err) { 
      next(err);
    } else { 
      res.json(vehicle.vehicleInfo.parseOutput(response));   
    } 
  });
});
</code></pre>
",0,506,2016-06-21 4:54,,0,5,other
65601806,Mock a method that raise an exception a number of times,<django><python-2.7><mocking>,"<p>I have looked for how to do this all day, without luck. I'm using Django 1.11 and Python 2.7 (no possibility to upgrade).</p>
<p>I have a method that calls an external API. This API sometimes fails with 504 or 502 errors. So, we decide to, in that case, retrieve the call some times (3 times for now). So, I wrote something like this.</p>
<pre><code>def call_external_api(arg_1, arg_2):
        attempts = 3
        data = None

        ext_api = ExternalAPI() # wrapper class, its method call the external api
        while attempts &gt; 0:
            try:
                data = ext_api.get_data_details(arg_1=arg_1, arg_2=arg_2)
            except Exception as exception:
                attempts -= 1
                log_message(exception)
                raise ExternalAPIError('Error calling EXT-API: %s' % str(exception))
        return data
</code></pre>
<p>So, I want to test this, but I do not know how to mock the exception. I know that it is possible to use <code>@patch(SomeClass, 'method_name')</code> to simulate the call to another class, but how to simulate the exception, so the code enters on the except branch and reduces &quot;attempt,&quot; repeating the cycle?</p>
<p>Notes: I thought that if I can mock the exception, I could test that log_message was called 3 times. What do you think about this approach?</p>
",1,225,2021-01-06 18:58,,1,0,how
710383,Mocking Entity Framework Context,<unit-testing><entity-framework><mocking>,"<p>I'm using the entity framework to access my database and I want to mock the database context inside my unit tests so that I can test my middle tier classes free of their dependency on real data. I know that I'm not the first to ask about this <a href=""https://stackoverflow.com/questions/604191/mocking-an-entity-framework-model"">(Mocking an Entity Framework Model)</a>, but after some googling I have an instinct that it might be possible to instantiate the context based on the model's metadata alone.</p>

<p>Has anyone been able to do this?</p>
",20,13136,2009-04-02 16:01,,2,2,what
66436775,Setup mock not working fine (returns exectuted repository method null value),<c#><unit-testing><asp.net-core><testing><moq>,"<p>I have some problem when I setup my mock for add entity. In case when I want get entity/entites my mock-setup is working fine, but when I want create(add). I setup method for create and it returned null in result.</p>
<p>P.S AddProductAsync in my suspicion, this method may not work, although I checked in the debug, there is a call to the method</p>
<pre><code> public class ProductServiceTests
{
    private Mock&lt;IProductRepository&gt; _productMockRepo = new Mock&lt;IProductRepository&gt;();
    private ProductService _sut;

    public ProductServiceTests()
    {
        _sut = new ProductService(_productMockRepo.Object);
    }
</code></pre>
<p>It's my test method</p>
<pre><code>[Fact]
    public async Task AddProduct_ShouldReturnProduct_WhenInputDataIsCorrect()
    {
        
        //Arrange
        var productId = Guid.NewGuid().ToString();
        var actualProduct = new ProductModel
        {
            Name = &quot;test&quot;,
            Price = 1,
            Category = Category.Foods,
            Quantity = 2
        };
        
        var addingProduct = new Product
        {
            Name = actualProduct.Name,
            Price = actualProduct.Price,
            Category = actualProduct.Category,
            Quantity = actualProduct.Quantity
        };
        
        _productMockRepo.Setup(x =&gt; x.AddProductAsync(addingProduct))
            .ReturnsAsync(addingProduct);
        
        //Act
        var result = await _sut.AddProductAsync(actualProduct);
        
        //Assert
        
        Assert.Equal(actualProduct.Name, result.Name);
        _productMockRepo.Verify(x =&gt; x.AddProductAsync(addingProduct), Times.Once);
        

    }
}
</code></pre>
<p>_sut is my service and _productMockRepo is my mock repository</p>
<p>For testing I use NuGet packadge &quot;Moq&quot;</p>
<p>Thanks)</p>
",1,1294,2021-03-02 9:36,,1,2,other
15349116,Google Mock: How to configure custom message to explain match failure,<c++><googlemock>,"<p>In case of match failure Google mock prints message like the following:</p>

<blockquote>
  <p>test.cpp:112: EXPECT_CALL(mock_obj, foo( <strong>MyMatcher</strong>( <strong>bar</strong> ) ))...<br>
  <strong>Expected arg #0</strong>: is equal to [1,2; 3,4]<br>
  <strong>Actual</strong>: { 1 }<br>
  Expected: to be called once<br>
  Actual: never called - unsatisfied and active</p>
</blockquote>

<p>Using custom matcher <strong>MyMatcher</strong> I'm able to define a description string which is used to generate the failure message when the match fails. But it defines only <strong>Expected arg #0</strong> part of message. Is there any way how I can customize how <strong>Actual</strong> is printed?</p>

<p>In my case I can't overload operator&lt;&lt; for class of <strong>bar</strong> as it already overloaded by third party code is not under my control (this library define class of <strong>bar</strong> and operator&lt;&lt; for it).</p>
",6,5982,2013-03-11 21:35,,1,1,how
20265895,Setting property Row to Mocked Microsoft.Office.Interop.Excel.Range with Mock,<c#><excel><unit-testing><nunit><moq>,"<p>I want to mock the Microsoft.Office.Interop.Excel.Range and after to be able to get property Row (index of first Row of Range). Moq v 4.1.1309.1617 / nunit.framework v 2.6.3.13283
In my unit test, I attempt to set up the behavior of the mock as follows:</p>

<pre><code>var moqRowSelected = new Mock&lt;Range&gt;();
const int row = 1;
moqRowSelected.SetupGet(x =&gt; x.Row).Returns(row);
moqSheetBase.SetupProperty(x =&gt; x.RowSelected, moqRowSelected.Object);
</code></pre>

<p>In the code being unit tested, I'm using the Range as follows:</p>

<pre><code>var iRow = PlanningSheet.RowSelected.Row;
Range row = sheet.Rows[iRow];
</code></pre>

<p>When the test runs, it produces the following exception:</p>

<blockquote>
  <p>Error: Missing method 'instance int32
  [My.Example.Implementation.MyClass]
  Microsoft.Office.Interop.Excel.Range::get_Row()' from class
  'Castle.Proxies.RangeProxy'.</p>
</blockquote>

<p>How can I implement this mocking successfully? Can any one help me, Thanks.</p>
",0,1251,2013-11-28 12:11,,1,0,how
42674971,Testing constructor using mock,<python><mocking>,"<p>I need to test that my class's constructor calls some method</p>

<pre><code>class ProductionClass:
   def __init__(self):
       self.something(1, 2, 3)

   def method(self):
       self.something(1, 2, 3)

   def something(self, a, b, c):
       pass 
</code></pre>

<p>This class is from 'unittest.mock — getting started'. As written there I can make sure that 'method' called 'something' as follows.</p>

<pre><code>real = ProductionClass()
real.something = MagicMock()
real.method()
real.something.assert_called_once_with(1, 2, 3)
</code></pre>

<p>But how to test the same for constructor?</p>
",5,13454,2017-03-08 15:11,,1,0,how
45682823,IntelliJ warning on Spock interactions when combining Mocking and Stubbing,<intellij-idea><groovy><mocking><spock><stub>,"<p>IntelliJ IDEA (2017.2) emits the following warning on Spock interactions that combine cardinality with a return value.</p>

<blockquote>
  <p>'multiply' in 'org.codehaus.groovy.runtime.DefaultGroovyMethods' cannot be applied to...</p>
</blockquote>

<p>...followed by the return type of the interaction.</p>

<p>Neither stubs nor mocks alone emit a warning, only the combination of the two.</p>

<ul>
<li><p><code>1 * mockDAO.deleteData()</code> is OK.</p></li>
<li><p><code>mockDAO.readData() &gt;&gt; myData</code> is OK.</p></li>
<li><p><code>1 * mockDAO.readData() &gt;&gt; myData</code> is a warning.</p></li>
</ul>

<p>Is there any setting or syntax to make IntelliJ understand the mock/stub combination?</p>
",5,1370,2017-08-14 20:48,,1,5,what
75852720,"Reading file stream multiple times causes ""stream not readable"" error",<c#><asp.net><azure-blob-storage><moq><filestream>,"<p>I'm trying to mock a read operation by using file stream in unit test. Below is the simplified code in application.</p>
<pre class=""lang-cs prettyprint-override""><code>using (var stream = await client.OpenReadAsync())
{
    using (StreamReader reader = new StreamReader(stream))
    {
        // read a line
        record = await reader.ReadLineAsync();
    }
}
</code></pre>
<p>This is the mock</p>
<pre><code>var client = new Mock&lt;Client&gt;();

//return file stream when read is performed on mocked client
client.setup( c =&gt; c.openReadAsync()).ReturnAsync(File.Open(&quot;c:\\testFile.txt&quot;, FileMode.Open, FileAccess.Read))
</code></pre>
<p>This works well when the stream is read for the first time. I have a logic where the same stream is read second time based on a condition. So the code above for reading stream is repeated in another place and it throws &quot;stream not readable&quot; error.</p>
<p>My understanding is whenever the client.OpenReadAsync() is called, a new file stream should be returned based on the mock condition. How do I fix this ? Can I use any other stream to overcome this ?</p>
<p><strong>Update</strong>:</p>
<p>Based on Matt's suggestion, the below code for first read makes the second read works well, but client.OpenReadAsync() and stream reader are not closed, which I'm not sure cause any issues</p>
<pre><code>  var stream = await client.OpenReadAsync()
  using (StreamReader reader = new StreamReader(stream,**leaveOpen: true**))
    {
             // read a line
             record = await reader.ReadLineAsync();
    }
</code></pre>
<p>The openReadAsync() reads from Azure storage. During the actual run everything works fine. In the actual run , the client returns this <a href=""https://github.com/Azure/azure-sdk-for-net/blob/e72578a830248ab524d614754010a3eb21a90d4d/sdk/storage/Azure.Storage.Blobs/src/BlobBaseClient.cs#L3148"" rel=""nofollow noreferrer"">stream</a>. Probably, if I find a way to mock the same stream, things might work.</p>
",1,1413,2023-03-27 6:34,,2,2,how
28392277,Mocking free function,<c++><unit-testing><tdd><googlemock>,"<p>I am stuck in a problem and can't seem to find the solution.</p>

<p>I am using VS2005 SP1 for compiling the code.</p>

<p>I have a global function:</p>

<pre><code>A* foo();
</code></pre>

<p>I have a mock class</p>

<pre><code>class MockA : public A {
public:
    MOCK_METHOD0 (bar, bool());
    ...
};
</code></pre>

<p>In the sources, it is accessed like this: <code>foo()-&gt;bar()</code>. I cannot find a way to mock this behavior. And I cannot change the sources, so the solution in google mock cook book is out of question.</p>

<p>Any help or pointers in the right direction will be highly appreciated. :)</p>
",26,58554,2015-02-08 9:02,,5,0,what
47081068,TypeError: argument of type 'Mock' is not iterable,<python><unit-testing><mocking>,"<p>How could I mock an iterable item?</p>

<p>In trying to test this method:</p>

<pre><code>    def convert_time_field(klass, field, default=None):
        time = GrapheneHelper.get_json_field(klass, field, default)

        if time is None:
            return None
        else:
            return iso8601.parse_date(time)
</code></pre>

<p>My first test returns this error: <code>TypeError: argument of type 'Mock' is not iterable</code></p>

<pre><code>    def test_convert_time_field(self):
        """""" Return YYYY-MM-DDTHH:MM:FF in iso8601 format """"""
        time = '2017-09-18T23:09:57Z'
        expected_time = '2017-09-18 23:09:57+00:00'
        mock_klass = Mock()
        self.assertEqual(GrapheneHelper.convert_time_field(mock_klass, time, default=None), expected_time)
</code></pre>

<p>What am I misunderstanding about mocks in this case?</p>
",3,5965,2017-11-02 17:15,,1,2,what
33859429,Wanting To Optionally Add JavaScript code using Gulp,<angularjs><node.js><mocking>,"<p>I've got a gulpfile.js that bundles using browserify and I want to be able to optionally add one line to one of my javascript files based on a variable like useMock.  Below is my GulpFile.js build step</p>

<pre><code>function bundle (bundler) {
return bundler
    .bundle()
    .pipe(source('app.js'))
    .pipe(gulp.dest('./dist'))
    .pipe(browserSync.stream());
}
</code></pre>

<p>The last line of the file below is the one I want to optionally include.</p>

<pre><code>module.exports = require('angular')
    .module('AngularUApp', [
        require('angular-ui-router'),
        require('angular-sanitize'),
        require('../../base'),
        require('./home'),
        require('./speaker'),
        require('./author')
    ])
    .config(enableHtml5Mode)
    .name;

enableHtml5Mode.$inject = ['$locationProvider'];
function enableHtml5Mode($locationProvider) {
    console.log('enableHtml5Mode');
    $locationProvider.html5Mode(true);
}

// I want to optionally include this from my gulpfile.js
require('../mock');
</code></pre>

<p>I want to be able to have a production and dev build where the dev includes the extra line and production does not. If there is a better more recommended way to  do this, please suggest.</p>
",0,20,2015-11-22 19:51,,1,0,what
58253545,Mock location not working on Android Pie and later,<android><unit-testing><testing><mocking><location>,"<p>I've written a unit test that use a mock location provider. The test passes when a location update is received, or fails when it times out.  </p>

<p>The test passes fine running on emulated Pixel 3's, Android M through Android O. It times out on Android P and on Q.  I also tested on a physical Pixel 3 with Q, still fails.</p>

<p>I've been beating my head against this for a while and can't figure out what's going on.</p>

<p>Test:</p>

<pre><code>import android.Manifest.permission.ACCESS_COARSE_LOCATION
import android.Manifest.permission.ACCESS_FINE_LOCATION
import android.location.Location
import android.location.LocationManager
import androidx.test.rule.GrantPermissionRule
import design.inhale.androidtestutils.InstrumentedTest
import design.inhale.datasource.observer.NullDataSourceListener
import design.inhale.testutils.Latch
import design.inhale.utils.locationManager
import design.inhale.utils.mock
import org.hamcrest.CoreMatchers.equalTo
import org.hamcrest.core.Is
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Rule
import org.junit.Test

class DeviceLocationSourceTest: InstrumentedTest() {
    private val mockProviderName = ""MockProvider""
    private val locationManager: LocationManager
    get() = appContext.locationManager

    @get:Rule
    val permissionRule: GrantPermissionRule = grant(ACCESS_FINE_LOCATION, ACCESS_COARSE_LOCATION)

    @Before
    fun init() {
        addMockLocationProvider()
    }

    @After
    fun deinit() {
        instrumentation.waitForIdleSync()
        removeMockLocationProvider()
    }

    @Test(timeout = 10_000)
    fun receiveLocationUpdate() {
        val latch = Latch()

        val listener = object: LocationSourceListener {

            override fun onDataUpdated(data: Location) {
                with(data) {
                    assertThat(latitude, Is(equalTo(0.0)))
                    assertThat(longitude, Is(equalTo(0.0)))
                }

                latch.release()
            }
        }

        mockLocationSource(listener).start()
        instrumentation.waitForIdleSync() // in case we're hitting race conditions?

        updateMockLocation(0.0, 0.0)

        latch.await()
    }

    @Suppress(""SameParameterValue"")
    private fun updateMockLocation(latitude: Double, longitude: Double) {
        val location = Location(mockProviderName).mock(latitude, longitude)
        locationManager.setTestProviderLocation(mockProviderName, location)
    }

    private fun mockLocationSource(listener: LocationSourceListener = NullDataSourceListener()) =
            DeviceLocationSource(appContext, mockProviderName, listener)

    private fun addMockLocationProvider() {
        with(locationManager) {
            try {
                addTestProvider(
                        mockProviderName,
                        false,
                        false,
                        false,
                        false,
                        true,
                        true,
                        true,
                        0,
                        5)
            } catch (e: IllegalArgumentException) {
                // If this is caught, the mock provider already exists
            }

            setTestProviderEnabled(mockProviderName, true)
        }
    }

    private fun removeMockLocationProvider() = locationManager.removeTestProvider(mockProviderName)
}
</code></pre>

<p>Manifest:</p>

<pre><code>&lt;manifest package=""design.inhale.locationapi""
    xmlns:android=""http://schemas.android.com/apk/res/android""&gt;

    &lt;uses-permission android:name=""android.permission.ACCESS_COARSE_LOCATION"" /&gt;
    &lt;uses-permission android:name=""android.permission.ACCESS_FINE_LOCATION"" /&gt;
&lt;/manifest&gt;
</code></pre>

<p>androidTest/Manifest:</p>

<pre><code>&lt;?xml version=""1.0"" encoding=""utf-8""?&gt;
&lt;manifest
    package=""design.inhale.locationapi""
    xmlns:android=""http://schemas.android.com/apk/res/android""&gt;

    &lt;uses-permission android:name=""android.permission.ACCESS_MOCK_LOCATION""/&gt;

&lt;/manifest&gt;
</code></pre>

<p>Location.mock():</p>

<pre><code>@SuppressLint(""ObsoleteSdkInt"")
fun Location.mock(latitude: Double = 0.0, longitude: Double = 0.0, accuracy: Float = 0f): Location {

    this.latitude = latitude
    this.longitude = longitude
    this.accuracy = accuracy
    this.time = currentTimeMillis()

    if (SDK_INT &gt; JELLY_BEAN) this.elapsedRealtimeNanos = elapsedRealtimeNanos()

    return this
}
</code></pre>
",1,945,2019-10-06 1:21,,1,0,what
55850607,Mocking classes with Jest,<class><ecmascript-6><mocking><jestjs>,"<p>Given I have a class that calls a function <code>doStuff</code> like so:</p>

<pre><code>
const myService = require(`./myService`),
    service = new myService();

exports.doStuff = async (callback) =&gt; {
    try {
        const data = await service.doOtherStuff(); //I want to mock this

        return callback(null, data);
    } catch (err) {
        callback(new Error(` &gt; feed failed for ${key}, error: ${err}`));
    }
};

</code></pre>

<p>my tests work like this:</p>

<pre><code>const myClass = require(`../index`);
jest.mock(`./../myService`, () =&gt; {
    return function() {
        return {
            doOtherStuff: () =&gt; {
                return 1;
            }
        };
    };
});

describe(`service-tests - index`, () =&gt; {
        test(`doStuff and test otherStuff`, async () =&gt; {
            const result = await myClass.doStuff((err, data) =&gt; {
                return data;
            });

            expect(result).toBe(1);
        });
});

</code></pre>

<p>And my service:</p>

<pre><code>class myService{
    constructor() {
        //Do constructor stuff
    }

    async doOtherStuff() {
        //Do other stuff
    }

</code></pre>

<p>This works but now I just have my mock on this file and not by test.
What I need is to have my mock be changable test by test but cannot seem to figure out how this works together with require.</p>

<p>I tried just doing <code>jest.mock('./../myService')</code> and have the <code>mockImplementation</code> on the <code>beforeAll</code> but that will keep my function in mocked as the automatic mock it seems, returning <strong>undefined</strong></p>

<p>Anyone ever done this before?</p>
",1,682,2019-04-25 13:37,,2,0,how
13671657,Stubbing dependencies in unit tests in node.js,<unit-testing><node.js><mocking><mocha.js><stub>,"<p>I am starting in node.js unit testing, and I have been investigating which was the most used framework for unit tests in node.js. I'd like to start with the most used framework just to makes things easier as there might be more information about it. According to many sites that could be Mocha. </p>

<p>While I understand this module for doing integration tests I don't really know how to work with it by using feautures like stubbing dependencies. I have seen mocha doesn't provide mock/stub functionalities, so I don't really know how people usually deal with these problems.</p>

<p>So I'd like to know what modules are the most popular nowadays for doing unit tests, stubbing dependencies... A short example would be great.</p>

<p>Thanks</p>
",1,960,2012-12-02 17:14,,1,0,how
66708482,Problem with mocking pathlib.Path.is_dir(),<python><mocking><pytest>,"<p>I have code that checks if specified file is a dir:</p>
<pre><code>from pathlib import Path

def simple_method():
    to_check = ['/tmp', '/tmp/test']
    print(&quot;&quot;)

    for element in to_check:
        path = Path(element)
        print(path)
        result = path.is_dir()
        print(f&quot;#MBB SC: {dir} -&gt; {result}&quot;)
        if result:
            print(f&quot;{element} is a dir&quot;)
        else:
            print(f&quot;{element} is not a dir&quot;)
</code></pre>
<p>I want to write test for it. In test scenario I want to mock pathlib.Path.is_dir() and set first call of is_dir (for /tmp) to True and second one (for /tmp/test) to False. This is how I wanted to solve it:</p>
<pre><code>import pytest
from unittest.mock import call, patch, MagicMock

import source_code

class TestSourceCode():
    def test(self):
        source_code.Path = MagicMock()
        source_code.Path.is_dir = MagicMock()

        source_code.Path.is_dir.side_effect = [True, False]

        source_code.simple_method()
        
        assert source_code.Path.call_args_list == [call('/tmp'), call('/tmp/test')]
        
        print(f&quot;\n&quot;)
        print(f&quot;source_code.Path&quot;)
        print(f&quot;source_code.Path.call_count {source_code.Path.call_count}&quot;)
        print(f&quot;source_code.Path.call_args {source_code.Path.call_args}&quot;)
        print(f&quot;source_code.Path.method_calls {source_code.Path.method_calls}&quot;)
        print(f&quot;source_code.Path.call_args_list {source_code.Path.call_args_list}&quot;)
        
        print(f&quot;\n&quot;)
        print(f&quot;source_code.Path.is_dir&quot;)
        print(f&quot;source_code.Path.is_dir.call_count {source_code.Path.is_dir.call_count}&quot;)
        print(f&quot;source_code.Path.is_dir.call_args {source_code.Path.is_dir.call_args}&quot;)
        print(f&quot;source_code.Path.is_dir.method_calls {source_code.Path.is_dir.method_calls}&quot;)
        print(f&quot;source_code.Path.is_dir.call_args_list {source_code.Path.is_dir.call_args_list}&quot;)
</code></pre>
<p>After running pytest I get output:</p>
<pre><code>test_code.py
&lt;MagicMock name='mock()' id='4278575696'&gt;
#MBB SC: &lt;built-in function dir&gt; -&gt; &lt;MagicMock name='mock().is_dir()' id='4278615568'&gt;
/tmp is a dir
&lt;MagicMock name='mock()' id='4278575696'&gt;
#MBB SC: &lt;built-in function dir&gt; -&gt; &lt;MagicMock name='mock().is_dir()' id='4278615568'&gt;
/tmp/test is a dir

source_code.Path
source_code.Path.call_count 2
source_code.Path.call_args call('/tmp/test')
source_code.Path.method_calls []
source_code.Path.call_args_list [call('/tmp'), call('/tmp/test')]


source_code.Path.is_dir
source_code.Path.is_dir.call_count 0
source_code.Path.is_dir.call_args None
source_code.Path.is_dir.method_calls []
source_code.Path.is_dir.call_args_list []
</code></pre>
<p>It recognize two mock calls for Path, but don't see mocked is_dir calls. What more it always set result as True. I know that's because result is a mock object. I'm wondering why result is not return value for this mock. What I'm doing wrong in this test?</p>
",0,622,2021-03-19 12:47,,1,0,what
30251218,Mocking/Unittesting when using Node serialport callbacks,<javascript><node.js><unit-testing><mocking>,"<p>I am working on a web-interface for a 3rd party device that connects via serial port. Example code below...</p>

<pre><code>var serialport = require(""serialport"");
var SerialPort = serialport.SerialPort;
var sp = new SerialPort(""/dev/ttyACM0"", {
    parser: serialport.parsers.readline(""\n"")
});

sp.on(""data"", function (rawData) {
...
</code></pre>

<p>My question is how can I mock/Unittest the sp ""data"" event...</p>
",1,635,2015-05-15 3:50,,1,0,how
56717148,Spring testing mocking findById not working,<java><spring><spring-boot><testing><mocking>,"<p>I'm trying to mock the process of finding an object from a service by an Id and it will return back the object. However, when trying to do so I get an error.</p>

<p><strong>Request method</strong></p>

<pre class=""lang-java prettyprint-override""><code>@PreAuthorize(""hasRole('ROLE_ADMIN') or @recipeRepository.findById(#id).get()?.owner.username == authentication.name"")
    @RequestMapping(path = ""/recipes/{id}/edit"", method = RequestMethod.GET)
    public String editRecipe(Model model, @PathVariable(""id"") Long id) {
        Recipe recipe = recipeService.findById(id);
        model.addAttribute(""task"", ""Edit recipe"");
        model.addAttribute(""buttonAction"", ""Save"");
        model.addAttribute(""action"", String.format(""/recipes/%d/edit"", id));

        if (!model.containsAttribute(""recipe"")) {
            model.addAttribute(""recipe"", recipe);
        }

        if (recipe.getPhoto() != null) {
            model.addAttribute(""photo"", true);
        }

        return ""edit"";
    }
</code></pre>

<p><strong>Test method</strong></p>

<pre class=""lang-java prettyprint-override""><code>@Test
    @WithUserDetails(""daniel"")
    public void editRecipePageLoadsWithRecipeOwner() throws Exception {
        Recipe recipe = recipeBuilder(1L);
        User user = userBuilder();
        recipe.setOwner(user);

        when(recipeService.findById(1L)).thenReturn(recipe);

        mockMvc.perform(get(""/recipes/1/edit""))
                .andExpect(status().isOk())
                .andExpect(model().attributeExists(""task"", ""buttonAction"", ""action"", ""recipe""));
    }
</code></pre>

<p><strong>Test setup</strong></p>

<pre class=""lang-java prettyprint-override""><code>@RunWith(SpringRunner.class)
@SpringBootTest(classes = Application.class)
@WebAppConfiguration
public class RecipeControllerTests {

    private MockMvc mockMvc;

    @Mock
    private RecipeService recipeService;

    @Mock
    private UserService userService;

    @Mock
    private IngredientService ingredientService;

    @Autowired
    WebApplicationContext wac;

    @InjectMocks
    private RecipeController recipeController;

    @Before
    public void setUp() throws Exception {
        MockitoAnnotations.initMocks(this);
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).apply(springSecurity()).build();
    }
</code></pre>

<p><strong>Service method</strong></p>

<pre class=""lang-java prettyprint-override""><code>@Override
    public Recipe findById(Long id) {
        Optional&lt;Recipe&gt; recipe = recipes.findById(id);
        if (recipe.isPresent()) {
            return recipe.get();
        }
        System.out.println(id + "" is not in db"");
        // TODO:drt - Create new exception to handle this
        throw new RuntimeException();
    }
</code></pre>

<p>I expect this process to be mocked correctly but instead I get this error (stack trace): </p>

<pre><code>org.springframework.web.util.NestedServletException: Request processing failed; nested exception is java.util.NoSuchElementException: No value present
    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1013)
    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:897)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
    at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:71)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
    at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:166)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:133)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:320)
    at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:127)
    at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:91)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:137)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:111)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:170)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:200)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:116)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:74)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:105)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:56)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:215)
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:178)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:133)
    at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:182)
    at com.danielturato.recipe.recipe.RecipeControllerTests.editRecipePageLoadsWithRecipeOwner(RecipeControllerTests.java:165)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
    at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
    at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
    at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
    at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
    at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
    at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
    at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
    at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
    at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
    at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
    at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: java.util.NoSuchElementException: No value present
    at java.util.Optional.get(Optional.java:135)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.springframework.expression.spel.support.ReflectiveMethodExecutor.execute(ReflectiveMethodExecutor.java:130)
    at org.springframework.expression.spel.ast.MethodReference.getValueInternal(MethodReference.java:138)
    at org.springframework.expression.spel.ast.MethodReference.getValueInternal(MethodReference.java:94)
    at org.springframework.expression.spel.ast.CompoundExpression.getValueRef(CompoundExpression.java:59)
    at org.springframework.expression.spel.ast.CompoundExpression.getValueInternal(CompoundExpression.java:89)
    at org.springframework.expression.spel.ast.OpEQ.getValueInternal(OpEQ.java:42)
    at org.springframework.expression.spel.ast.OpEQ.getValueInternal(OpEQ.java:32)
    at org.springframework.expression.spel.ast.SpelNodeImpl.getValue(SpelNodeImpl.java:185)
    at org.springframework.expression.spel.ast.OpOr.getBooleanValue(OpOr.java:56)
    at org.springframework.expression.spel.ast.OpOr.getValueInternal(OpOr.java:51)
    at org.springframework.expression.spel.ast.OpOr.getValueInternal(OpOr.java:37)
    at org.springframework.expression.spel.ast.SpelNodeImpl.getTypedValue(SpelNodeImpl.java:114)
    at org.springframework.expression.spel.standard.SpelExpression.getValue(SpelExpression.java:300)
    at org.springframework.security.access.expression.ExpressionUtils.evaluateAsBoolean(ExpressionUtils.java:26)
    at org.springframework.security.access.expression.method.ExpressionBasedPreInvocationAdvice.before(ExpressionBasedPreInvocationAdvice.java:59)
    at org.springframework.security.access.prepost.PreInvocationAuthorizationAdviceVoter.vote(PreInvocationAuthorizationAdviceVoter.java:72)
    at org.springframework.security.access.prepost.PreInvocationAuthorizationAdviceVoter.vote(PreInvocationAuthorizationAdviceVoter.java:40)
    at org.springframework.security.access.vote.AffirmativeBased.decide(AffirmativeBased.java:63)
    at org.springframework.security.access.intercept.AbstractSecurityInterceptor.beforeInvocation(AbstractSecurityInterceptor.java:233)
    at org.springframework.security.access.intercept.aopalliance.MethodSecurityInterceptor.invoke(MethodSecurityInterceptor.java:65)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
    at com.danielturato.recipe.recipe.RecipeController$$EnhancerBySpringCGLIB$$5886067f.editRecipe(&lt;generated&gt;)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:104)
    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:892)
    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797)
    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1039)
    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
    ... 69 more
</code></pre>

<p>I'm only guessing that the no value present is from the findById service method, so what did I do wrong? Can anyone help? Thanks</p>

<p><strong>Update</strong></p>

<p>After some help, it was discovered there was a problem with the @PreAuthorize annotation on my request method which I will fix but after removing the annotation I've discovered that there are further problems. Here is the stack trace:</p>

<pre><code>org.springframework.web.util.NestedServletException: Request processing failed; nested exception is java.lang.RuntimeException

    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1013)
    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:897)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
    at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:71)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
    at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:166)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:133)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:320)
    at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:127)
    at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:91)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:137)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:111)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:170)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:200)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:116)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:74)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:105)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:56)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334)
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:215)
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:178)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:133)
    at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:182)
    at com.danielturato.recipe.recipe.RecipeControllerTests.editRecipePageLoadsWithRecipeOwner(RecipeControllerTests.java:165)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
    at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
    at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
    at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
    at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
    at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
    at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
    at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
    at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
    at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
    at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
    at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: java.lang.RuntimeException
    at com.danielturato.recipe.recipe.RecipeServiceImpl.findById(RecipeServiceImpl.java:45)
    at com.danielturato.recipe.recipe.RecipeController.editRecipe(RecipeController.java:80)
    at com.danielturato.recipe.recipe.RecipeController$$FastClassBySpringCGLIB$$80b87c21.invoke(&lt;generated&gt;)
    at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:684)
    at com.danielturato.recipe.recipe.RecipeController$$EnhancerBySpringCGLIB$$e4bb9424.editRecipe(&lt;generated&gt;)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:104)
    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:892)
    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797)
    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1039)
    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
    ... 69 more
</code></pre>
",1,2014,2019-06-22 16:22,,1,7,other
33669722,Why does using an non-inlined It.IsAny<T> in Moq not work correctly?,<c#><moq>,"<p>Assigning <code>It.IsAny&lt;T&gt;()</code> to a variable for use in a <code>Setup</code> on a mocked object does not work as expected: the test shown below fails.</p>

<p>However, if I inline the <code>anyString</code> variable the test passes. What's going on here?</p>

<pre><code>public class MyService
{
    private readonly IDependency _dependency;

    public MyService(IDependency dependency)
    {
        _dependency = dependency;
    }

    public string UseTheDependency(string input)
    {
        return _dependency.GetValue(input);
    }
}

public interface IDependency
{
    string GetValue(string input);
}

public class Tests
{
    [Test]
    public void TestTheTestClass()
    {
        var mockDependency = new Mock&lt;IDependency&gt;();
        var anyString = It.IsAny&lt;string&gt;();
        mockDependency.Setup(x =&gt; x.GetValue(anyString)).Returns(""expected value"");
        var service = new MyService(mockDependency.Object);
        var result = service.UseTheDependency(""something random"");
        Assert.That(result, Is.EqualTo(""expected value""));
    }
}
</code></pre>
",2,146,2015-11-12 10:49,,1,0,why
60686796,Verify a private method gets call Unit Test,<c#><unit-testing><moq>,"<p>I have an interface with a method like this:</p>

<pre><code>public string GetImageSrc(string input);
</code></pre>

<p>The implementation of this is below:</p>

<pre><code>    public string GetImageSrc(string input)
    {
        if (input.ContainsImage())
        {
               DoWork();
        }
        return input;
    }
</code></pre>

<p>My string extension for ConatinsImage is:</p>

<pre><code>    public static bool ContainsImage(this string input)
    {
        if (!string.IsNullOrEmpty(input))
        {
            return input.Contains(""img"");
        }
        return false;
    }
</code></pre>

<p>DoWork is a private method in the class.  I am writing Unit Tests for the class - I am passing null to the method and doing an assert that null is returned.  However is there a way I can Assert the invocation of the DoWork private method is None for a null input?</p>
",0,251,2020-03-14 19:59,,1,1,what
59773418,NSubstitute.Exceptions.ReceivedCallsException: Expected to receive a call matching error while unit testing,<c#><unit-testing><nsubstitute>,"<p>I am getting a below error while unit testing the piece of code</p>

<blockquote>
  <p>NSubstitute.Exceptions.ReceivedCallsException: Expected to receive a call matching error while unit testing
  NSubstitute.Exceptions.ReceivedCallsException
    HResult=0x80131500
    Message=Expected to receive a call matching:
      enrollWithHelper("""", """")
  Actually received no matching calls.</p>
  
  <p>Source=NSubstitute
    StackTrace:
     at NSubstitute.Core.ReceivedCallsExceptionThrower.Throw(ICallSpecification callSpecification, IEnumerable<code>1 matchingCalls, IEnumerable</code>1 nonMatchingCalls, Quantity requiredQuantity)
     at NSubstitute.Routing.Handlers.CheckReceivedCallsHandler.Handle(ICall call)
     at NSubstitute.Routing.Route.Handle(ICall call)
     at NSubstitute.Proxies.CastleDynamicProxy.CastleForwardingInterceptor.Intercept(IInvocation invocation)
     at Castle.DynamicProxy.AbstractInvocation.Proceed()
     at Castle.DynamicProxy.AbstractInvocation.Proceed()
     at Castle.Proxies.ObjectProxy_1.enrollWithHelper(String name, String type)
     at MyProject.MyTest.processing_test_pass() in C:\MyProject\MyTest.cs:line 75</p>
</blockquote>

<p><strong>Framework</strong>: .NET Core</p>

<p><strong>Unit Testing</strong>: NSubstitute</p>

<p>Here is my class under test</p>

<pre><code> public class MyService: IMysService
 {
   private readonly IRepository _repository;
   Private readonly IIoTHelper _iotHelper;  
   Private readonly HttpClient _httpClient;
   private Configuration _configuration; 

   public MyService(IRepository repository, IIoTHelper iotHelper, HttpClient httpClient )
   {
        _repository = repository;
        _iotHelper =iotHelper;
        _httpClient = httpClient ;
   }

   public bool CallService(JObject reqObj, out Status status)
   {
        bool provisioningSuccess = false;
        return PreProcessing(reqObj,out Status status); //private method
   }
}
</code></pre>

<p>Here is my private method</p>

<pre><code>    private PreProcessing(JObject JosnObj, out Status status)
    {
        if (_configuration== null)
        {
            _configuration= _repository.GetConfigurations()                 
        }

       using (var client = this._httpClient)
       {
            var request = new {_configuration.Number,_configuration.Type};
            var response = client.PostAsJsonAsync(""api/preprocess"", request).Result;

            if (response.IsSuccessStatusCode)
            {
                  _iotHelper.enrollWithHelper(_configuration.Number,_configuration.Type);
            }
       }
    }
</code></pre>

<p>Here is my Configuration class</p>

<pre><code>   public class Configuration 
   {
     public Configuration (string number, string type)
     {
        Number= number;
        Type= type;
     }      
     public string Number { get;}

     public string Type { get; }

   }
</code></pre>

<p>Here is my unit test code, where I want to make sure it reaches the <code>private</code> method </p>

<pre><code>    protected override void InitializeTest()
    {
        this._repository = Substitute.For&lt;IRepository&gt;();
        this._iotHelper = Substitute.For&lt;IIotHelper&gt;();
    }

    [TestMethod]
    public void processing_test_pass()
    {
          //Arrange
        var messageHandler = new MockHttpMessageHandler(""TEST VALUE"", HttpStatusCode.OK);
        var httpClient = new HttpClient(messageHandler);


          JObject reqobj= new JObject(
          new JProperty(""user"", ""username""),
          new JProperty(""pass"", ""password""));

        Status status = new Status();

        //act
        var t = new MyService(this._repository,this._iotHelper, httpClient );
        bool success = t.CallService(reqobj, out status);
        //assert
        this._iotHelper.Received().enrollWithHelper("""","""");

    }
</code></pre>

<p>How would I test <code>enrollWithHelper</code> is called?</p>

<p>Also I am stuck due to error!</p>
",0,4911,2020-01-16 15:54,,0,10,how
74589364,How to mock a custom async React hook including useRef() with jest and react-testing-library to access result.current in Typescript,<reactjs><typescript><jestjs><mocking><react-testing-library>,"<p>I have a custom hook which includes a reference. How do I properly test such a hook and how do I mock the useRef()?</p>
<pre><code>const useCustomHook = (
  ref: () =&gt; React.RefObject&lt;Iref&gt;
): {
  initializedRef: boolean
} =&gt; {
  const [initializedRef, setInitializedRef] = useState&lt;boolean&gt;(false)

  useEffect(() =&gt; {
    if (ref) {
      const { current } = ref()
      // here comes your ref code
      console.log({ refCurrent: current })
    }
    setInitializedRef(true)
  }, [ref])

  return { initializedRef }
}
</code></pre>
",0,391,2022-11-27 10:49,,1,0,how
41749431,Django Rest Framework: Test serializers,<python><django><unit-testing><mocking><django-rest-framework>,"<p>In my project <a href=""https://github.com/be-ndee/coach-server"" rel=""noreferrer"">coach</a> I have a problem with testing the Information serializer. I have the following serializer classes in the file <code>running/serializes.py</code>:</p>

<pre><code>class Velocity(serializers.ModelSerializer):
    class Meta:
        model = VelocityModel
        fields = (""id"", ""minimum"", ""average"", ""maximum"")


class Information(serializers.ModelSerializer):
    heart_beat = HeartBeat(read_only=True)
    velocity = Velocity(read_only=True)

    class Meta:
        model = InformationModel
        fields = (""id"", ""distance"", ""velocity"", ""heart_beat"", ""calories"")
</code></pre>

<p>In my test I have this:</p>

<pre><code>from running import models, serializers

@patch(""running.serializers.Velocity"")
def test_contains_id(self, mock_velocity):
    # mocking stuff
    returned_data = {}
    mock_velocity.data = PropertyMock(return_value=returned_data)

    # creating instances of the models
    self.velocity = models.Velocity(minimum=8, average=10, maximum=12)
    self.velocity.save()
    self.heart_beat = models.HeartBeat(minimum=120, average=130, maximum=140)
    self.heart_beat.save()
    self.information = models.Information(distance=3.7, velocity=self.velocity, heart_beat=self.heart_beat, calories=132)
    self.information.save()

    # create the actual serializer
    self.information_serializer = serializers.Information(self.information)

    self.assertEqual(self.information_serializer.data[""velocity""], returned_data)
</code></pre>

<p>So I want to test, that the data returned by the InformationSerializer (<code>self.information_serializer.data</code>), has a key <code>""velocity""</code>, which points on the data returned by the VelocitySerializer (<code>mock_velocity.data</code>).</p>

<p>But <code>self.information_serializer.data[""velocity""]</code> just contains the data, saved in the models (<code>OrderedDict([('id', 1), ('minimum', 8.0), ('average', 10.0), ('maximum', 12.0)])</code>. I don't know where is my fault...</p>

<p>Also another question would be, do I really need to test this? Because I'm questioning myself, if I'm testing more the Django Rest Framework than my serializers?!</p>

<p>So how to go on? Thanks in advance!</p>
",7,16928,2017-01-19 18:46,,1,3,what
55876026,How does the 'from' style import treat the imported module's dependencies?,<python><import><module><mocking><pytest>,"<p>I'm trying to figure out the python import system aliases the dependencies of a module imported using the 'from' keyword. </p>

<p>In particular, my use-case is writing unittest.mock.patch statements for mocking attributes of an object that is imported using ""from"", and  that object uses something imported from another module. However, more broadly I just want to understand how the import system works.</p>

<p>My question may make more sense with an example:</p>

<p>Assume we have some class A in some module a, that uses a class from module b</p>

<pre><code>a.py:

from b import B

class A:
    def __init__(self):
        B.use_some_static_method()

        # OR

        self.b_instance = B()
</code></pre>

<p>Then, for example, in some test code we want to mock B when testing  our A object. How would I write a patch statement? </p>

<pre><code>test_a.py:

from a import A


def test_a(mocker):
    # Mock with pytest-mock's mocker
    mock_b = mocker.patch('&lt;some path&gt;')

    a = A()
    a.do_something_with_B()

</code></pre>

<p>What path would I put in place of ? I realize that I could simply use <code>import a</code> instead, and then mock <code>a.B</code>, but I'm more interested in understanding the import system and how this works and why it works that way.</p>
",0,157,2019-04-26 23:37,,0,5,how
43532649,Database mocking in Clojure tests,<postgresql><testing><clojure><mocking><korma>,"<p>How can I mock my postgres database for testing?</p>

<p>My application is very simple, but I cannot find a good way to mock my database for tests. In Java I usualy use HSQLDB, but there is a solution in Clojure?</p>

<p>This is my project file.</p>

<pre><code>  (defproject account-manager ""0.1.0-SNAPSHOT""
            :description ""Account Manager""
            :url ""http://example.com/FIXME""
            :license {:name ""Eclipse Public License""
                      :url ""http://www.eclipse.org/legal/epl-v10.html""}
            :dependencies [[org.clojure/clojure ""1.8.0""]
                           [compojure ""1.5.2""]
                           [cheshire ""5.7.0""]
                           [ring/ring-core ""1.5.1""]
                           [ring/ring-json ""0.4.0""]
                           [ring/ring-jetty-adapter ""1.5.1""]
                           [korma ""0.4.3""]
                           [org.clojars.amit/postgresql ""8.0.1""]
                           [com.h2database/h2 ""1.4.188""]
                           [ragtime ""0.7.1""]
                           [environ ""1.1.0""]
                           [org.clojure/data.json ""0.2.6""]
                           [buddy/buddy-hashers ""1.2.0""]
                           [clj-time ""0.13.0""]]
            :plugins [[lein-ring ""0.11.0""]]

            :ring {:handler account-manager.handler/app
                   :nrepl {:start? true
                           :port 9998}}

            :profiles
            {:dev {:dependencies [[javax.servlet/servlet-api ""2.5""]
                                  [ring-mock ""0.1.5""]]
                   :env {:bank-db ""bank_db""
                         :bank-db-user ""bank_db""
                         :bank-db-pass ""-""}}
             :test {:env {:bank-db ""bank_db""
                          :bank-db-user ""bank_db""
                          :bank-db-pass ""-""}}})
</code></pre>

<p>And this is how I'm configuring my database. In the future I will use configuration files.</p>

<pre><code>(ns bank-account-manager.db
  (:use korma.db)
  (:require [environ.core :refer [env]]))

(defdb db (postgres {:db (get env :bank-db ""bank_db"")
                     :user (get env :bank-db-user ""bank_db"")
                     :password (get env :bank-db-pass ""-"")
                     :host (get env :bank-db-host ""localhost"")
                     :port (get env :bank-db-port 5432)}))
</code></pre>

<p>There is a good way to mock?</p>
",3,1139,2017-04-21 1:55,,1,5,how
15536225,"jMock ""unexpected invocation"" for a method that I have a oneOf(instance).method() expected",<java><jmock>,"<p>I can't seem to figure out what I'm doing wrong here:</p>

<p>This is the method I'm testing:</p>

<pre><code>public List&lt;Mo&gt; filterDuplicatesByName(List&lt;Mo&gt; dbMos) {
    List&lt;String&gt; names = Lists.newArrayList();
    for(Mo mo : dbMos) {
        try {
            String name = mo.getName();
            if(names.contains(name)) {
                dbMos.remove(mo);
            } else {
                names.add(name);
            }
        } catch (DataLayerException ex) {
            dbMos.remove(mo);
        }
    }
    return dbMos;
}
</code></pre>

<p>And this is my test class:</p>

<pre><code>package com.rondavu.wt.service.recommendations;

import com.google.common.collect.Lists;
import com.rondavu.data.api.Mo;
import org.jmock.Expectations;
import org.jmock.Mockery;
import org.jmock.lib.legacy.ClassImposteriser;
import org.junit.Before;
import org.junit.Test;

import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertEquals;

public class RecommendationsUtilsTest  {

    Mockery context = new Mockery();

    RecommendationsUtils recommendationsUtils = new RecommendationsUtils();

    final Mo mo = context.mock(Mo.class);

    @Test
    public void testFilterDuplicatesByName_oneMo() throws DataLayerException {
        List&lt;Mo&gt; input = Lists.newArrayList(mo);
        List&lt;Mo&gt; expected = Lists.newArrayList(mo);

        context.checking(new Expectations() {{
            oneOf (mo).getName(); will(returnValue(""Mo 1""));
        }});

        List&lt;Mo&gt; actual = recommendationsUtils.filterDuplicatesByName(input);

        context.assertIsSatisfied();

        assertEquals(expected, actual);
    }
}
</code></pre>

<p>When I run the test I get this output:</p>

<pre><code>unexpected invocation: mo.getName()
no expectations specified: did you...
 - forget to start an expectation with a cardinality clause?
 - call a mocked method to specify the parameter of an expectation?
what happened before this: nothing!
    [stack trace]
</code></pre>

<p>I'm pretty new to jMock, and Java is not my strongest language in general but I thought that my <code>oneOf (mo).getName()</code> would make it expect that invocation. What am I doing wrong here?</p>
",1,7109,2013-03-20 22:44,,1,0,what
60976411,Check the instance of a Mocked method called once,<python><django><mocking><python-unittest><django-unittest>,"<p>My function looks for a <code>Actor</code> object in the database and calls its <code>do_something()</code> method with a passed argument.</p>

<pre><code>from my_app.models import Actor

def my_function(id, stuff):
    actor = Actor.objects.get(id=id)
    return actor.do_something(stuff)
</code></pre>

<p>I want my unit test to check two things :<br>
 1. <code>my_function</code> finds the <code>Actor</code> I want.<br>
 2. <code>my_function</code> calls the actor's <code>do_something</code> method as expected.</p>

<pre><code>from unittest import mock
from django.test import TestCase
from my_app.models import Actor
from my_app.views import my_function


class ViewsTestCase(TestCase):

    @classmethod
    def setUpTestData(cls):
        self.actor = Actor.objects.create(id=42, name='John')

    def test_my_function(self):
        with mock.patch.object(Actor, 'do_something') as mock_do:
            my_function(id=42, stuff='a-short-string')
            mock_do.assert_called_once_with('a-short-string')
</code></pre>

<p>This works to make sure <code>my_function</code> called <code>do_something</code> like I wanted but I don't know how to be sure it found the Actor I asked him to find. This test would pass even if <code>my_function</code> found the wrong actor. Is there any way to check that ? </p>
",0,914,2020-04-01 17:05,,1,0,what
69284408,Typesafe way to use Mockk and extension functions,<kotlin><mocking><mockk>,"<p>It seems that <a href=""https://blog.kotlin-academy.com/mocking-is-not-rocket-science-mockk-advanced-features-42277e5983b5"" rel=""nofollow noreferrer"">a recommended way to mock extensions with Mockk</a> is to define a <code>@file:JvmName</code> and refer to it with <code>mockkStatic(&quot;&lt;jvm-name&gt;&quot;)</code>, which is not type safe: In case of refactoring (e.g. rename or package change), the tests might break inadvertently. Is there a more type safe manner to mock extension functions?</p>
",0,1822,2021-09-22 12:38,,1,0,what
37814241,Properly testing an SDK that calls an API,<api><unit-testing><sdk><mocking><phpunit>,"<p>I have an API that I've written and now I'm in the middle of writing an SDK for 3rd parties to more easily interact with my API.</p>

<p>When writing tests for my SDK, it's my understanding that it's best not to simply call all of the API endpoints because:</p>

<ol>
<li>The tests in the API will be responsible for making sure that the API works.</li>
<li>If the SDK tests did directly call the API, my tests would be really slow.</li>
</ol>

<p>As an example, let's say my API has this endpoint:</p>

<pre><code>/account
</code></pre>

<p>In my API test suite I actually call this endpoint to verify that it returns the proper data.</p>

<p>What approach do I take to test this in my SDK? Should I be mocking a request to <code>/account</code>? What else would I need to do to give my SDK good coverage?</p>

<p>I've looked to other SDKs to see how they're handling this (Stripe, Algolia, AWS), but in some cases it does look like they're calling a sandbox version of the actual API.</p>

<p>(I'm currently working with PHPUnit, but I'll be writing SDKs in other languages as well.)</p>
",4,5548,2016-06-14 14:01,,3,0,what
61663982,Is it possible to patch method called on created previously mock?,<python><testing><mocking><pytest>,"<p>I have fixture which create <code>mocker.Mock</code> instead of <code>gui.Menu</code> object during initialization of <code>gui.Buttons</code>. Reference is stored in <code>Buttons.menu</code> attribute. In my test I check if proper function is called in <code>gui.Buttons.add</code>. Parametrized test worked well until I met condition where method from <code>gui.Menu</code> should be called. Now there is a mock. </p>

<pre><code>import pytest
from project import gui

@pytest.fixture
def buttons(mocker):
    mocker.patch('project.gui.tk.Frame.__init__', return_value=None)
    mocker.patch('project.gui.tk.Button')
    return gui.Buttons(mocker.Mock())


@pytest.mark.parametrize('value,patched',(
        (None, 'project.gui.show_no_connection'),
        (False, 'project.gui.Buttons.process_data'),
        (True, 'pytest.Mock.show_error'),
))
def test_add_calls_function(buttons, value, patched, mocker):
    mocker.patch('project.gui.Buttons.exist_check', return_value=value)
    mocked = mocker.patch(patched)
    buttons.add()
    mocked.assert_called_once()
</code></pre>

<p>With real object I could write <code>(True, 'project.gui.Menu.show_error')</code> inside <code>@pytest.mark.parametrize</code> instead of <code>(True, 'pytest.Mock.show_error')</code> which doesn't work and produces <code>ModuleNotFoundError: No module named 'pytest.Mock'</code>.</p>

<p>I wonder if it is possible to <code>patch</code> created mock object in my fixture to make it work like other parametrized examples. Is it even possible? Correct me please if way how I understand it is wrong.</p>

<p>Tested code looks like:</p>

<pre><code>import tkinter as tk
import tkinter.messagebox as msg

from project.connection import Database


def show_no_connection():
    msg.showerror('Error', 'Could not perform operation. Try again later.')


class Menu(tk.Tk):

    def __init__(self):
        super().__init__()
        self.form = Form()

    def show_error(self, message):
        self.form.clear()
        msg.showerror('Error', message)


class Form(tk.Frame):

    def clear(self):
        print('Clearing...')

    def get(self):
        return {'Title': 'Test', 'ISBN': 87327837823}


class Buttons(tk.Frame):

    def __init__(self, menu):
        super().__init__(menu)
        self.menu = menu

    def process_data(self, data, operation):
        operation(data)

    def add(self):
        data = self.menu.form.get()
        exists = self.exist_check(data.get('ISBN', None))
        if exists is None:
            show_no_connection()
        else:
            if exists:
                self.menu.show_error(
                    'Record with set ISBN already exists in database.')
            else:
                self.process_data(data, Database().add)

    @staticmethod
    def exist_check(number):
        if number:
            return Database().search({'ISBN': number})
        return False
</code></pre>

<p>Displayed error:</p>

<pre><code>=================================== FAILURES ===================================
_________ test_add_calls_function[True-project.gui.Gui.show_error] _________

buttons = &lt;[AttributeError(""'Buttons' object has no attribute '_w'"") raised in repr()] Buttons object at 0x7f840114aa10&gt;
value = True, patched = 'project.gui.Gui.show_error'
mocker = &lt;pytest_mock.plugin.MockFixture object at 0x7f840114ab90&gt;

    @pytest.mark.parametrize('value,patched',(
            (None, 'project.gui.show_no_connection'),
            (False, 'project.gui.Buttons.process_data'),
            (True, 'project.gui.Gui.show_error'),
    ))
    def test_add_calls_function(buttons, value, patched, mocker):
        mocker.patch('project.gui.Buttons.exist_check', return_value=value)
        mocked = mocker.patch(patched)
        buttons.add()
&gt;       mocked.assert_called_once()
E       AssertionError: Expected 'show_error' to have been called once. Called 0 times.

tests/test_gui_buttons.py:88: AssertionError
</code></pre>
",-1,1009,2020-05-07 17:26,,1,6,what
49109709,How to mock Base64 in Android?,<android><junit><mocking><base64><mockito>,"<p>I am writing a Unit test for a class that uses <code>android.util.Base64</code> and I get this error:</p>

<pre><code>java.lang.RuntimeException: Method encode in android.util.Base64 not mocked. See http://g.co/androidstudio/not-mocked for details.
at android.util.Base64.encode(Base64.java)
</code></pre>

<p>This is the code using the <code>encode()</code> method:</p>

<pre><code>ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
// [write some data to the stream]
byte[] base64Bytes = Base64.encode(byteArrayOutputStream.toByteArray(), Base64.DEFAULT);
</code></pre>

<p>Now I understand that I can't use Android library classes in my Unit tests. But how do I correctly mock <code>Base64</code> so I can write a correct Unit test for my class?</p>
",22,18747,2018-03-05 11:42,,5,8,how
28361564,calling python builtin dict on a mock,<python><dictionary><mocking>,"<p>I'd like to be able to setup a mock that allows me to return something when I apply the builtin <code>dict</code> method.</p>

<p>I've tried using <code>__iter__</code> to no avail.  I can't seem to get anything but an empty dictionary:</p>

<pre><code>import mock
mocked_object = mock.MagicMock()
mocked_object.__iter__.return_value = [1, 2, 3]
dict(mocked_object)
# {}
</code></pre>
",3,3764,2015-02-06 8:31,,2,2,what
38593352,Mocking Db in Java Unit tests,<java><unit-testing><mocking>,"<p>I am trying to unit test this code block in a method in my service layer. 
Could anyone suggest what can (/should) I test here and how to test them (esp. the insert to db part). Any pointers (/example code/doc) will be very helpful.</p>

<pre><code>if (element != null) {
    id = iplDAO.loadGames(element, batchVO.getId());
    iplPartyDetailsVO = element.getParty();
    if iplPartyDetailsVO != null) {
    try {
        iplDAO.insertPartyDetails(iplPartyDetailsVO, id, batchVO.getId());
    } catch (Exception e) {

        logger.logp(""className"");
        String err = ""blah"";
        iplDAO.insertIntoError(err_t);
    }
}
</code></pre>
",0,1912,2016-07-26 14:57,,1,3,what
66425453,How to simulate time passing from a unit test?,<c#><time><moq>,"<p>I have a method running in an infinite loop in a task from the ctor. The message does the equivalent to sending a <code>ping</code>, and upon a certain number of failed pings, prevents other commands from being able to be sent.  The method is started from the ctor with <code>Task.Factory.StartNew(()=&gt;InitPingBackgroundTask(pingCts.token));</code></p>
<pre><code>public async Task InitPingBackgroundTask (CancellationToken token)
{
   while(!token.IsCancellationRequested)
   {
      try 
      {
          Ping();
          // handle logic
          _pingsFailed = 0;
          _canSend = true;
      }
      catch(TimeoutException)
      {
          // handle logic
          if(++_pingsFailed &gt;= settings.MaxPingLossNoConnection)
             _canSend = false;
      }
      finally
      {
          await Task.Delay(settings.PingInterval);
      }
   }
}
</code></pre>
<p>I have a second method <code>DoCmd</code> like so:</p>
<pre><code>public void DoCmd()
{
   if(_canSend)
   {
      // handle logic
   }
}
</code></pre>
<p>In my test, using Moq, I can set the settings to have <code>PingInterval=TimeSpan.FromSeconds(1)</code> and <code>MaxPingLossNoConnection = 2</code> for the sake of my test.</p>
<p>After setting up the <code>sut</code> and everything else, I want to call <code>DoCmd()</code> and verify that it is not actually sent. (I have mocked its dependencies and can verify that the logic in its method was never called)</p>
<p>One way to achieve this is to add a sleep or delay from within the test, before calling <code>sut.DoCmd()</code>, but this makes the test take longer. Is there a way to simulate time passing (like <code>tick(desiredTime)</code> in angular, or something similar)? To simulate the passing of time without having to actually wait the time?</p>
<p>Any leads would be appreciated :-)</p>
<p><strong>EDIT</strong>
Added the test code:</p>
<pre><code>public void NotAllowSendIfTooManyPingsFailed()
{
   var settings = new Settings()
   {
      PingInterval=TimeSpan.FromSeconds(1),
      MaxPingLossNoConnection = 0 // ended up changing to 0 to fail immidiately
   }
   // set up code, that Ping messages should fail

   Thread.Sleep(100); // necessary to Ping has a chance to fail before method is called
   sut.DoCmd();

   // assert logic, verifying that DoCmd did not go through
}
</code></pre>
<p>Ideally, I would like to be able to play with <code>MaxPingLossNoConnection</code> and set it to different numbers to test circumstances. That would also require adding sleeps to let the time pass. In this test, I would want to remove the <code>Sleep</code> altogether, as well as in other similar tests where sleep would be longer</p>
",0,985,2021-03-01 15:59,,1,10,how
58632377,How to spy on typescript class using jasmine?,<typescript><unit-testing><jasmine><mocking>,"<p>I have a class that is calling backend to get data , so in below code i tried to write unit test for the class in order to mock it using spyOn so i can get the desire result, it is failing to import the class , Any idea how spyOn class methods using jasmine ?</p>

<p>Basically trying to spyOn on <code>core</code> method and underlying calls.</p>

<p>DrugPriceApi.ts</p>

<pre><code>export class DrugPriceApi extends Types.ModuleBase &lt; DrugPriceParam, DrugPriceResultSet[] &gt; {

    private _memberId: string = """";
    private _dependencies: any;
    private errorMessage: string = ""There was an issue while retrieving drug price. Please try again."";

    before(args: DrugPriceParam): Promise &lt; DrugPriceParam &gt; {
        args.daysSupply = args.daysSupply ? args.daysSupply : args.appName === ""VOYA"" ? ""90"" : ""BLNK"";
        return Promise.resolve(args);
    }

    core(args: DrugPriceParam, requestMethod: Interface.Core.RequestMethod, _dependencies: any): Promise &lt; any &gt; {
        this._dependencies = _dependencies;

        return new Promise &lt; any &gt; ((resolve: Function, reject: Function) =&gt; {
               this.getDrug(function(resolve){ resolve( //response here);});
                }
            }

        }
    }
}
</code></pre>

<p>DrugPriceApi.spec.ts</p>

<pre><code>import { Interface } from ""dist/karma/core-sdk-lib/src/ts/interface/index"";
import { } from 'jasmine';
import { Index } from ""../../../../../index"";
import { setup } from ""dist/karma/core-sdk-lib/src/ts/helper/TestSetup.helper"";
import { CApiSettings, CLogger } from ""@cvsdigital_specialty/common-utils"";
import { DrugPriceParam } from ""./DrugPriceApi.interface"";
import {DrugPriceApi} from ""./DrugPriceApi.node"";
    describe(""Module"", () =&gt; {
        let _sdkInstance: any;
        let param = {
            tokenId: '123',
            appName: 'CMK_TEST',
            refId: '123'
        } as DrugPriceParam;

        let memberInfo: any = {};
        memberInfo.dateOfBirth = ""11/11/11"";
        memberInfo.externalID = ""6172"";
        memberInfo.internalID = ""12"";
        memberInfo.clientId = ""22322"";
        memberInfo.planId = ""902H93"";
        memberInfo.eligibility = {
            ""benefitPlanList"": {
                ""benefitPlan"": [
                    {
                        ""active"": true,
                        ""deliverySystem"": 2,
                    },
                    {
                        ""active"": true,
                        ""deliverySystem"": 3,
                    }
                ]
            }
        };
        param.memberInfo = memberInfo;
        beforeEach(() =&gt; {
            spyOn(DrugPriceApi, 'core' as any).and.returnValue(1); // 'as any' prevents compiler warning
          });

          it('verifies that core was called', () =&gt; {
            const module = DrugPriceApi.core(param);
          });

    });
</code></pre>
",0,575,2019-10-30 19:23,,0,5,how
30390726,Return values set on for-loop/foreach loop,<c#><moq>,"<p>I'm new to Moq and I was able to mock some scenarios like returning list or an object. I'm having this problem where I need to get different values return from <code>GetNoteBookTypeAndProcess</code> in loop. In my below example I mock the GetNoteBooks method and return a list of NoteBook object (no issues here). 
Now in the foreach loop, I have this method <code>GetNoteBookTypeAndProcess</code> mocked and returns a string (chipset). 
But what I need is to return different chipset base on the mock that I set (loop). Currently I can only return 1 which return a 50 value.</p>

<p>I also copied and pasted the same setup but different Return for the <code>GetNoteBookTypeAndProcess</code> but still no luck.</p>

<pre><code>var results = GetNoteBooks(); //database call
var chipset = new List&lt;string&gt;();

foreach (var items in results)
{
    var result = GetNoteBookTypeAndProcess(items.OrderNum);
    chipset.Add(result);
}
</code></pre>

<p>Mock Unit Test</p>

<pre><code>        mock.Setup(m =&gt; m.GetNoteBooks()).Returns(new List&lt;NoteBook&gt;()
        {
            new NoteBook { OrderNum = 1, Price = 1000, Type = 50 },
            new NoteBook { OrderNum = 2, Price = 2000, Type = 51 },
            new NoteBook { OrderNum = 3, Price = 3000, Type = 52 }
        });

        mock.Setup(m =&gt; m.GetNoteBookTypeAndProcess(OrderNum)).Returns(50);
</code></pre>
",1,1614,2015-05-22 7:25,,1,4,other
56881191,Java: Mock external library for testing,<java><mocking><mockito><apache-zookeeper><powermock>,"<p>My tests are way too slow because I am using a configurations library in my code that takes at least 100ms any time I set or get something.</p>

<p>I am using Java and the configuration library that I use uses Apache ZooKeeper to store the data.
I used Mockito and Powermock several times but never tried to mock an external library and I wondering if it is even possible.</p>

<pre class=""lang-java prettyprint-override""><code>import org.HybridConfiguration;

public class VisitManagerClass {

    private static final String COUNT_ENABLED = ""countEnabled"";
    private static final String COUNT = ""count"";

    public static void pageVisited() {
        boolean isCountEnabled = HybridConfiguration.getBooleanValue(COUNT_ENABLED);
        if (isCountEnabled) {
            long currentCount = HybridConfiguration.getLongValue(COUNT);
            HybridConfiguration.setValue(COUNT, Long.toString(currentCount + 1));
        }
    }
}
</code></pre>

<p>I would expect to be able to mock the library HybridConfiguration so that tests could run without any delay.</p>
",2,1237,2019-07-04 5:30,,1,1,what
230389,How is Jmock used with HttpSession and HttpServletRequest,<java><junit><mocking><jmock>,"<p>I am new to jmock and trying to mock an HttpSession. I am getting:</p>

<p>java.lang.AssertionError: unexpected invocation: httpServletRequest.getSession()
no expectations specified: did you...
 - forget to start an expectation with a cardinality clause?
 - call a mocked method to specify the parameter of an expectation?</p>

<p>the test method:</p>

<p>@Test</p>

<pre><code>public void testDoAuthorization(){

    final HttpServletRequest request = context.mock(HttpServletRequest.class);
    final HttpSession session = request.getSession();

    context.checking(new Expectations(){{
       one(request).getSession(true); will(returnValue(session));
   }});

    assertTrue(dwnLoadCel.doAuthorization(session));
}
</code></pre>

<p>I have done a bit of searching and it isn't clear to me still how this is done. Feels like I am missing some small piece. Anyone with experience in this can just point me in the right direction.
thanks</p>
",0,11077,2008-10-23 16:18,,2,0,how
40900828,Unit Test with Moq - Value can not be null,<c#><entity-framework><unit-testing><entity-framework-6><moq>,"<p>I'm using EF6. The generated code is something like:</p>

<pre><code>public partial class MyDataContext : DbContext
{
    public MyDataContext() : base(""name=mydata"")
    {
    }

    public virtual DbSet&lt;Book&gt; Books { get; set; }
}
</code></pre>

<p>Then I have a generic repository like:</p>

<pre><code>public class GenericRepository&lt;TObject&gt; where TObject : class
{
    protected readonly MyDataContext Context;

    protected GenericRepository(MyDataContext context)
    {
        Context = context;
    }

    public virtual DbSet&lt;TObject&gt; GetAll()
    {
        return Context.Set&lt;TObject&gt;();
    }
}
</code></pre>

<p>Then I have a service that uses the GenericRepository to return data:</p>

<pre><code>public class MyDataService&lt;TObject&gt; where TObject : class
{
    private readonly MyDataContext context;

    public MyDataService(MyDataContext ct)
    {
        context = ct;
    }

    public ICollection&lt;TObject&gt; GetAll()
    {
        var r = new GenericRepository&lt;TObject&gt;(context);
        return r.GetAll().ToList();
    }
}
</code></pre>

<p>So I can get all books with something like this:</p>

<pre><code>var ds = new MyDataService&lt;Book&gt;(new MyDataContext());
var data = ds.GetAll();
</code></pre>

<p>This is working fine. Next I try to use Moq to unit test the above code with something like:</p>

<pre><code>var books = new List&lt;Book&gt;
{
    new Book {Id = 1, Name = ""BBB""},
    new Book {Id = 2, Name = ""ZZZ""},
    new Book {Id = 3, Name = ""AAA""},
}.AsQueryable();

var mockSet = new Mock&lt;DbSet&lt;Book&gt;&gt;();
mockSet.As&lt;IQueryable&lt;Book&gt;&gt;().Setup(m =&gt; m.Provider).Returns(books.Provider);
mockSet.As&lt;IQueryable&lt;Book&gt;&gt;().Setup(m =&gt; m.Expression).Returns(books.Expression);
mockSet.As&lt;IQueryable&lt;Book&gt;&gt;().Setup(m =&gt; m.ElementType).Returns(books.ElementType);
mockSet.As&lt;IQueryable&lt;Book&gt;&gt;().Setup(m =&gt; GetEnumerator()).Returns(books.GetEnumerator());

var mockContext = new Mock&lt;MyDataContext&gt;();
mockContext.Setup(c =&gt; c.Books).Returns(mockSet.Object);

var service = new MyDataService&lt;Book&gt;(mockContext.Object);
var data = service.GetAll();
</code></pre>

<p>However, I get the <code>""Value cannot be null.\r\nParameter name: source""</code> error on the last line. When I step into the code I see Books collection in the context object is empty.</p>

<p>What am I doing wrong?</p>
",5,4673,2016-12-01 0:49,,1,1,what
72692404,Mock a client to a dependency when doing integration tests,<testing><mocking><microservices>,"<p>I have a service composed of several micro services working in workflow. Some of these MS are calling dependencies.
Now I'd like to mock these calls, so when I send a message at the entrance of the workflow the dependencies answers get mocked, but my system works as normal.</p>
<p>The challenge is that I would want to configure the mock from the outside: Configure on the fly the answer I want to get from the mock, run my test, verify that my system behaves properly.</p>
<p>I worked for a company that shall remain unnamed that has an internal tool doing just that, but I'm wondering if there is a public tool doing this? I can't believe it doesn't exist, I bet more on my lack of knowledge about this, at that point ;)</p>
<p>Cheers</p>
",0,147,2022-06-20 20:02,,1,0,what
75370950,Interfaces in Lua (mocking dependencies),<java><lua><interface><mocking>,"<p><strong>Preamble</strong></p>
<p>I am writing Lua code to control virtual devices attached to a virtual computer. I do not have control over the &quot;component&quot; library/dependency.</p>
<pre class=""lang-lua prettyprint-override""><code>-- Component is used to access other devices which are attached to the computer on which this is running
local component = require &quot;component&quot;

-- ...

-- ge_terminal is a device which is connected. 
-- Said device is found when the computer starts up
-- So the ge_terminal field/property is not hard-coded, but added at runtime
component.ge_terminal.get_heat()
</code></pre>
<p>Such calls are very common in my program. My issue is that I do not have access to the external component to which <code>component.ge_terminal</code> refers within my development/testing environment.</p>
<p><strong>The Question</strong></p>
<p>I would like to know how to abstract calls to external components/devices to so that I can test the business-logic without access said external components/devices.</p>
<p><strong>Solutions in other languages</strong></p>
<p>In other languages such as Java or C#, this might be achieved using an interface, or by mocking the external dependency during testing. I would ideally like to find a solution which does not involve additional libraries (which I  do know exist for mocking in Lua).</p>
<pre class=""lang-java prettyprint-override""><code>
interface IComponentManager {
    String getProperty(String name) { ... }
}

interface IDevice {
    String getProperty(String name) { ... }
}

// By abstracting how components are accessed, the production versions can be replaced with mock versions.
// The production version calls the live equivalent of &quot;component.ge_terminal&quot; to return the real device.
// The mock version returns custom IDevices which can be configured for testing.
IComponentManager manager = new ProductionComponentManager();
IComponentManager manager = new MockComponentManager();

IDevice device = manager.getComponent(&quot;ge_terminal&quot;);
String heat = device.getProperty(&quot;heat&quot;);
</code></pre>
<p>(I am aware that this is not prime Java code, but it's just for demonstration)</p>
",1,250,2023-02-07 8:55,,0,6,other
77417087,Unit test failing as unable to mock MongoDb Filter Definition using NSubstitute,<c#><unit-testing><nsubstitute>,"<p>Im trying to write a unit test, which will confirm that my mongodb repository's Get document method is working. Current Code:</p>
<pre><code>[Fact]
public async Task GivenExistingDocumentId_WhenGetAsync_ThenDummyProjectionReturnedSuccessfully()
{
    // Arrange
    var documentId = &quot;123idempotentkey&quot;;
    var sourceCollection = &quot;testcollection&quot;;

    var dummyProjectionDto = new DummyProjectionDto
    {
        IdempotencyKey = &quot;123idempotentkey&quot;,
        Description = &quot;test-description&quot;
    };

    // Ensure the filter is properly initialized
    var filter = Builders&lt;DummyProjectionDto&gt;.Filter.Eq(&quot;_id&quot;, documentId);
    Assert.NotNull(filter);

    var cursor = Substitute.For&lt;IAsyncCursor&lt;DummyProjectionDto&gt;&gt;();
    cursor.Current.Returns(new List&lt;DummyProjectionDto&gt; { dummyProjectionDto });

    // Ensure filter parameter is not null when calling FindAsync
    _mongoCollectionMock.FindAsync(Arg.Is(filter), null, Arg.Any&lt;CancellationToken&gt;()).Returns(cursor);

    // Act
    var result = await _repository.GetAsync(documentId, sourceCollection, default);

    // Assert
    result.Should().NotBeNull();
    result.IdempotencyKey.Should().Be(dummyProjectionDto.IdempotencyKey);
    result.Description.Should().Be(dummyProjectionDto.Description);
}
</code></pre>
<p>Error I'm getting:</p>
<blockquote>
<p>Message:  System.ArgumentNullException : Value cannot be null.
(Parameter 'filter')</p>
<p>Stack Trace:  Ensure.IsNotNull[T](T value, String paramName)
IMongoCollectionExtensions.FindAsync[TDocument](IMongoCollection<code>1 collection, FilterDefinition</code>1 filter, FindOptions`2 options,
CancellationToken cancellationToken)
DummyProjectionRepositoryTests.GivenExistingDocumentId_WhenGetAsync_ThenDummyProjectionReturnedSuccessfully() line 98
--- End of stack trace from previous location ---</p>
</blockquote>
<p>I can confirm that the filter object is definitely not null, and the Assertion line passes.</p>
<p>My GetAsync implementation looks like this:</p>
<pre><code>public async Task&lt;DummyProjection&gt; GetAsync(string documentId, string sourceCollection, CancellationToken ct = default)
{
    var filter = Builders&lt;DummyProjectionDto&gt;.Filter.Eq(&quot;_id&quot;, documentId);

    var result = await _database
        .GetCollection&lt;DummyProjectionDto&gt;(GetCollectionName(sourceCollection))
        .FindAsync(filter, null, ct);

    var projectionDto = await result.SingleOrDefaultAsync(ct);

    if (projectionDto == null)
    {
        throw new MongoException($&quot;Document with ID {documentId} not found.&quot;);
    }
    else
    {
        var projectionDocument = new DummyProjection()
        {
            IdempotencyKey = projectionDto.IdempotencyKey,
            Description = projectionDto.Description,
        };

        return projectionDocument;
    }
}
</code></pre>
<p><strong>Why is my test throwing an ArgumentNullException for 'filter' when it is not null?</strong></p>
",0,230,2023-11-03 13:38,,0,5,why
50708600,Null exception when mocking Spring service in test,<spring><spring-mvc><spring-boot><mocking><mockito>,"<p>I am attempting to mock a Spring service and user the web MVC context to test a correct response JSON object is returned from the controller. It seems an exception is caught in the controller, but points to null, thus returning an unsuccessful response with no body.</p>

<p>I'm unsure what annotation I may be missing here. The service does require the SSRS config object in the constructor and upon debugging while testing, it is null in the controller try/catch block.</p>

<p>If that's the problem, I'm not sure how to fix it. If not, I'm unsure how to proceed to prevent the exception from being thrown.</p>

<pre><code>@Slf4j
@RestController
@RequestMapping(""/api/reports"")
public class ReportsController {
    private final ReportsService reportsService;

    public ReportsController(@NonNull ReportsService reportsService) {
        this.reportsService = reportsService;
    }

    @PutMapping(""/getReport"")
    @Step
    public ApiResult getReport(@RequestBody ReportParamJSON params)
    {
        ApiResult result = new ApiResult();

        try {
            byte[] rptStream = reportsService.getReport(params.name, params.params, params.format);
            result.body = new String(Base64.getEncoder().encode(rptStream));
            result.success = true;
        }
        catch (Exception exc)
        {
            result.success = false;
            result.messages.add(exc.toString());
        }

        return result;
    }
}

@Slf4j
@Service
public class ReportsService {
private final SsrsConfig ssrsConfig;

    public ReportsService(@NonNull SsrsConfig ssrsConfig) {
        this.ssrsConfig = ssrsConfig;
    }

    @Step
    public byte[] getReport(String report, List&lt;ReportParam&gt; params, String format) throws Exception{
        // return some binary data.
    }
}

@RunWith(SpringRunner.class)
@WebMvcTest
@WithMockUser
public class ReportsControllerTests {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private ReportsService reportsService;

    @Before
    public void initMocks(){
        MockitoAnnotations.initMocks(this);
    }

    @Test
    public void givenGetReportUri_whenRequestReport_thenReturnReport() throws Exception {

        String response = ""{\""body\"":\""data\"",\""success\"":true,\""messages\"":[]}"";

        ArrayList&lt;ReportParam&gt; params = new ArrayList&lt;&gt;();
        params.add(new ReportParam(""number"", ""1000""));
        params.add(new ReportParam(""status"", ""1""));
        when(reportsService.getReport(""test"", params, ""PDF"")).thenReturn(""data"".getBytes());


        mockMvc.perform(put(""/api/reports/getReport"")
            .content(""{\n"" +
                    ""  \""format\"": \""PDF\"",\n"" +
                    ""  \""name\"": \""test\"",\n"" +
                    ""  \""params\"": [\n"" +
                    ""    {\n"" +
                    ""      \""name\"": \""number\"",\n"" +
                    ""      \""value\"": \""1000\""\n"" +
                    ""    },\n"" +
                    ""    {\n"" +
                    ""      \""name\"": \""status\"",\n"" +
                    ""      \""value\"": \""1\""\n"" +
                    ""    }\n"" +
                    ""  ]\n"" +
                    ""}"")
            .contentType(MediaType.APPLICATION_JSON)).andExpect(status().isOk())
            .andExpect(content().contentType(MediaType.APPLICATION_JSON_UTF8))
            .andExpect(content().string(response));
    }
}

@ConfigurationProperties(prefix = ""ssrs"")
@Component
@Data
public class SsrsConfig {
    private String endpointUri;
}
</code></pre>
",0,269,2018-06-05 20:40,,0,3,how
75783343,What is a reasonable way to setup a unit testing environment in Angular with fake back-end?,<angular><unit-testing><mocking><test-environments>,"<p>I have a pretty standard Angular application, which comes with the standard Jasmine + Karma frameworks for unit testing.</p>
<p>In my application I have several services which make use of the <code>HttpClient</code> class to query a back-end, and I obviously need to unit test all these services too.</p>
<p>I realized I need to mock the back-end with a local server, which answers to the HTTP queries with hard-coded JSON.</p>
<p>I found many different suggestions on-line, but they don't fit or are too complicated.</p>
<p>What I'd like to have:</p>
<ul>
<li>no additional code to be added to the original angular services</li>
<li>no tricky solutions (like using HTTP Interceptors, etc.)</li>
<li>no complicated proxy configuration, or definition of specific <code>npm run</code> scripts</li>
<li>easy to write fake DB (e.g. hard-coded JSON file)</li>
<li>since my real back-end exposes Restful APIs, with standard CRUD operations, I would like to avoid describing each single end-point in the fake back-end</li>
<li>when I type <code>ng test</code> the fake back-end (with a different base URL) should be automatically used</li>
</ul>
<p>Thanks,</p>
<p>Thomas</p>
",-1,345,2023-03-19 16:15,,2,1,how
1823739,Mocking a Static Class,<mocking><static-classes>,"<p>I have a static class that wraps some native methods from winspool:</p>

<pre><code>public static class WinSpool
{
     [DllImport(""winspool.drv"")]
     public static extern int OpenPrinter(string pPrinterName, out IntPtr phPrinter, IntPtr pDefault);
     ...
     //some more methods here
}
</code></pre>

<p>I would like to mock them for unit testing, but couldn't find a pattern for this. (Does everyone avoid static classes?)</p>
",7,5993,2009-12-01 3:06,,2,0,what
40115754,"How to Moq methods that return ""this""",<c#><unit-testing><moq>,"<p>I have an interface</p>

<pre><code>interface IService
{
    IService Configure();
    bool Run();
}
</code></pre>

<p>The ""real"" implementation does this:</p>

<pre><code>class RealService : IService
{
    public IService Configure()
    {
        return this;
    }

    public bool Run()
    {
        return true;
    }
}
</code></pre>

<p>Using Moq to mock the service creates a default implementation of <code>Configure()</code> that returns <code>null</code>.  </p>

<p>Is there a way to setup methods in Moq that return the mocked instance?</p>
",8,3240,2016-10-18 18:43,,3,0,what
57831482,"How to mock a static variable, which is initialized with a static method call on that static variable",<java><mocking><junit4><jmockit>,"<p>The following simplified Client wrapper class with a singleton <code>Client</code> needs a <em>unit test</em> with <em>JMockit</em></p>

<pre><code>public class ClientWrapper {
    private static Client client = ClientBuilder
        .build()
        .setProperty(""prop1"", value);

    public void request(String val) {
        client.target(getfullURL(val)).invoke();
    }
    public String getFullURL(String requestMappingValue) {
        return ""http://xxxxx"" + requestMappingValue;
    }
}
</code></pre>

<p>I tried to write unit test with <em>jmockit 1.18</em></p>

<pre><code>public class ClientWrapperTest {
    @Tested private ClientWrapper tested;
    @Mocked private Client clientMock;
    @Mocked private Target targetMock;
    @Test
    public void testRequest() {
        //Partial mock on Client class
        new Expectations(Client.class) {{
            ClientBuilder.build();
            result = clientMock;

        }};
        //Partial mock on tested ClientWrapper
        new Expectations(tested) {{
            tested.getFullRUL(anyString);
            result = anyString;
        }};
        //Last mock
        new Expectations() {{
            clientMock.target(anyString);
            result = targetMock;
            targetMock.invoke();
            times = 1;
        }};
        tested.request(""/test"");
    }
}
</code></pre>

<p><strong>Problem</strong>: the <code>clientMock</code> is not returned successfully and thus caused the failure of this test</p>

<p><strong>Question:</strong> How to mock the static method call - <code>ClientBuilder.build()</code>, and then continue to make use of the mocked result Client instance to mock <code>client.invoke()</code>? </p>
",2,1710,2019-09-07 7:05,,1,3,how
28609070,Mocking __main__,<python><mocking><unit-testing>,"<p>I would like to ensure with tests that:
- the application cannot be imported
- the application can be started as a real application (i.e: python src.py)</p>

<p>I'm interested about that, why the following is not working:</p>

<p>src.py</p>

<pre><code>class A:
 def x(self):
  print('this is x')

if __name__ == '__main__':
  A().x()
</code></pre>

<p>test.py (snippet)</p>

<pre><code>class Test(unittest.TestCase):
  @mock.patch('src.A.x')
  def test_main(self, mock_x):
    import src
    mock_x.assert_any_call()
</code></pre>

<p>This test fails... why?</p>
",2,2910,2015-02-19 14:37,,2,0,why
68835390,Unit test FluentEmail in .NET 5 using xUnit and Moq,<c#><unit-testing><moq><xunit>,"<p>I'm trying to unit test <a href=""https://github.com/lukencode/FluentEmail"" rel=""nofollow noreferrer"">FluentEmail</a>, but I keep getting <code>null</code> in the send response.</p>
<p>This is how it's set up in the <code>ConfigureServices</code> method:</p>
<pre><code>// Set email service using FluentEmail
services.AddFluentEmail(&quot;sender@test.com&quot;)
        // For Fluent Email to find _Layout.cshtml, just mention here where your views are.
        .AddRazorRenderer(@$&quot;{Directory.GetCurrentDirectory()}/Views/&quot;)
        .AddSmtpSender(&quot;smtp.somecompanyname.com&quot;, 25)
        .AddSmtpSender(new System.Net.Mail.SmtpClient() { });
</code></pre>
<p>Now the email service looks like this:</p>
<pre><code>public class FluentEmailService : IFluentEmailService
{
    private readonly IFluentEmail _fluentEmail;
    private readonly ILogger&lt;FluentEmailService&gt; _logger;
    public FluentEmailService(ILogger&lt;FluentEmailService&gt; logger, IFluentEmail fluentEmail)
    {
        _logger = logger;
        _fluentEmail = fluentEmail;
    }

    public async Task&lt;SendResponse&gt; SendEmailAsync&lt;TModel&gt;(string subject, string razorTemplatePath, TModel model, string semicolonSeparatedEmailRecipients)
    {
        try
        {
            var sendResponse = await _fluentEmail
                            .To(semicolonSeparatedEmailRecipients)
                            .Subject(subject)
                            .UsingTemplateFromFile(razorTemplatePath, model)
                            .SendAsync();
            return sendResponse;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, &quot;Failed to send email. Check exception for more information.&quot;);
            return new SendResponse() { ErrorMessages = new string[] { ex.Message } };
        }
    }
}
</code></pre>
<p>My test method looks like this:</p>
<pre><code>[Fact]
public async Task Can_Verify_FluentEmail_WORKS_Async()
{
    // ARRANGE
    var mockFluentEmail = new Mock&lt;IFluentEmail&gt;();

    mockFluentEmail.Setup(m =&gt; m.To(It.IsAny&lt;string&gt;())).Returns(mockFluentEmail.Object);
    mockFluentEmail.Setup(m =&gt; m.Subject(It.IsAny&lt;string&gt;())).Returns(mockFluentEmail.Object);
    mockFluentEmail.Setup(m =&gt; m.UsingTemplateFromFile(It.IsAny&lt;string&gt;(), It.IsAny&lt;It.IsAnyType&gt;(), It.IsAny&lt;bool&gt;())).Returns(mockFluentEmail.Object);

    //Create FluentEmail service using fake logger and IFluentEmail
    var fakeLogger = Mock.Of&lt;ILogger&lt;FluentEmailService&gt;&gt;();
    var fluentEmailService = new FluentEmailService(fakeLogger, mockFluentEmail.Object);

    // ACT
    var sendResponse = await fluentEmailService.SendEmailAsync(&quot;Test Subject&quot;, &quot;Some Path&quot;, It.IsAny&lt;It.IsAnyType&gt;(), &quot;Some Recipient&quot;);
    
    // ASSERT
    Assert.NotNull(sendResponse);
    Assert.True(sendResponse.Successful);
    mockFluentEmail.Verify(f =&gt; f.To(&quot;Some Recipient&quot;), Times.Once(), &quot;Recipient should be set as: 'Some Recipient'.&quot;);
    mockFluentEmail.Verify(f =&gt; f.Subject(&quot;Test Subject&quot;), Times.Once, &quot;Subject should be set as: 'Test Subject'.&quot;);
    mockFluentEmail.Verify(f =&gt; f.UsingTemplateFromFile(&quot;Some Path&quot;, It.IsAny&lt;It.IsAnyType&gt;(), It.IsAny&lt;bool&gt;()), Times.Once, &quot;Path should be set as: 'Some Path'.&quot;);
    mockFluentEmail.Verify(f =&gt; f.SendAsync(null), Times.Once, &quot;1 email should be sent.&quot;);
}
</code></pre>
<p>The test always fails because I get <code>null</code> as the <code>sendResponse</code>.</p>
<p>Can someone please tell me if I'm doing this correctly?</p>
",1,888,2021-08-18 15:37,,1,0,what
44767817,Using gtest float comparison in Matcher,<c++><unit-testing><googletest><googlemock>,"<p>I like to write a matcher for a structure which holds some float values:</p>

<pre><code>struct Point3D
{
float x;
float y;
float z;
}

class Interface
{
virtual void SetPoint(Point3D point) = 0;
}

class MockInterface:
    public Interface
{
   MOCK_METHOD1(SetPoint, void(Point3D point));
}

MATCHER_P(Point3DEq, point, ""Comparison of a Point3D"")
{
   return point.x == arg.x &amp;&amp; point.y == arg.y &amp;&amp; point.z == arg.z;
}

TEST(Point3DComparison, TestIfPoint3DAreEqual)
{
   MockInterface interfaceFake;
   Point setPoint = { 1.0, 1.0, 1.0 }
   EXPECT_CALL(interfaceFake, SetPoint(Point3DEq(setPoint)).WillOnce(Return());
}
</code></pre>

<p>I don't like this Matcher because he doesn't respected good float comparison. I would like to write a Matcher with using the Floating Comparison of gmock or gtest. It should look similiar to that.</p>

<pre><code>MATCHER_P(Point3DEq, point, ""Comparison of a Point3D"")
{
   return EXPECT_THAT(point.x, FloatEq(arg.x) &amp;&amp; EXPECT_THAT(point.y, FloatEq(arg.y) &amp;&amp; EXPECT_THAT(point.z, FloatEq(arg.z);
}
</code></pre>

<p>The problem is that EXPECT_THAT is not returning any boolean value. Is there a nice clean way to do this using the functionality of gmock and gtest?</p>
",2,4037,2017-06-26 20:04,,1,0,what
40482023,Moq with c# System.Windows.MessageBoxButton.YesNoCancel,<c#><wpf><unit-testing><moq>,"<p>I'm currently writing some unit tests around a WPF module of a program. I've come to a point where a <code>ShowMessage</code> returns a <code>Yes</code> or <code>No</code> value within the statement. </p>

<pre><code>dService.ShowMessage(view, args);
</code></pre>

<p>The args takes a lambda as (shortened)</p>

<pre><code>new MessageArgs(arg1, arg2, arg3, (la) =&gt; 
{
   if (la.result == messResult.yes)
   {
   // do something
   }
}
</code></pre>

<p>I'm now trying to mock the result given back from this lambda but am having some difficulty and have been unable to find someone with a similar problem. </p>

<p>I've tried setting a default result within the lambda in my unit test:</p>

<pre><code>new MessageArgs(arg1, arg2, arg3, (la) =&gt; 
{
   if (la.result == messResult.yes)
   {
       la.result = messResult.yes;
   }
}
</code></pre>

<p>Which proved unsuccessful along with trying to set the arg result below the statement as:</p>

<pre><code>args.result = messResult.yes;
</code></pre>

<p>I have also tried to use Setup as:</p>

<pre><code>dServiceMock.Setup(x =&gt; x.ShowMessage)
</code></pre>

<p>but there is no return property as <code>ShowMessage</code> is a void function.</p>

<p>None have shown a change in action from my unit test. Has anyone else had a similar ""problem"" and found a solution or know of some documentation around this? I'll update this if I find something in the mean time.</p>

<p>Thank you.</p>
",-1,221,2016-11-08 8:17,,1,8,what
46282128,How to test a simple setter method,<android><junit><mocking><mockito><junit4>,"<p>the class i want to test is posted below in the code section. I am trying to test the ""setSubscriberName"" method.
the test I coded is posted below in the testing section. but at run time the test fails </p>

<p>please let me know how to test that setter method correctly</p>

<p><strong>code</strong></p>

<pre><code>public class ListViewModel {

private String mSubscriberName = null;

public ListViewModel(String subscriberName) {
    mSubscriberName = subscriberName;
}

public void setSubscriberName(String name) {
    mSubscriberName = name;
}

}
</code></pre>

<p><strong>testing</strong>:</p>

<pre><code>public class ListViewModelTest {

@Mock
private ListViewModel mListViewModel = null;
@Rule
public MockitoRule mockitoRule = MockitoJUnit.rule();

@Before
public void setUp() throws Exception {
    mListViewModel = new ListViewModel("""");
}

public void setSubscriberName(String str) {
    String mSubscriberName = null;
    mSubscriberName = str;
}
@Test
public void setSubscriberNameTest() throws Exception {
    ListViewModel spyListView = spy(mListViewModel);

    verify(spyListView).setSubscriberName(""abc"");
}

}
</code></pre>
",0,38,2017-09-18 14:42,,0,2,how
44893714,How to test api calls using fetch,<javascript><unit-testing><reactjs><mocking><fetch>,"<p>I can't find a definitive answer on what the proper way to unit test <code>fetch</code> is online. I'm using the <code>create-react-app</code> build. so far this is the closest I've found where a user recommends using <code>nock</code> &amp; <code>node-fetch</code>. I have seen some development on a library here: <a href=""https://github.com/wheresrhys/fetch-mock"" rel=""nofollow noreferrer"">https://github.com/wheresrhys/fetch-mock</a> but it's build is failing which makes me nervous.</p>

<p>Goal is to make this play nicely with <code>jest</code></p>

<p>Does anyone have any recommendations from experience on the best way to test request using the fetch api?</p>
",1,3536,2017-07-03 20:50,,1,0,what
50291291,Jest mock child dependency,<mocking><jestjs>,"<p>I have a config file that is imported into the file I will be testing, and I need the ability to mock out the config file, but I seem to be doing something wrong - I have</p>
<p>app.js</p>
<pre><code>import config from './config';
export default class App{
   static get(){
      //refers to config
   }
}
</code></pre>
<p>test file</p>
<pre><code>import App from './app';  
it('should do something', () =&gt; {
   jest.mock('./config', () =&gt; {
      return {
         //mocked config
      }
   })
})
</code></pre>
<p>but when running the test, I am getting the real config and not the mocked one.  Any ideas?</p>
",6,4891,2018-05-11 11:26,,1,0,what
22373236,It.IsAny<T>() used as a mocked object,<c#><unit-testing><moq>,"<p>Using moq, it is usual to provide a mock for an interface type <code>T</code> by using <code>Mock.Of&lt;T&gt;()</code>. But alternatively <code>It.IsAny&lt;T&gt;()</code> returns an Expression that also seems to be usable as an object in place of an object of type <code>T</code>. I've only seen <code>It.IsAny&lt;T&gt;()</code> used to define arguments for method calls in <code>Setup()</code>. What is the difference between <code>Mock.Of&lt;T&gt;()</code> and <code>It.IsAny&lt;T&gt;()</code> (besides syntax obviously)? Are there any circumstances where <code>It.IsAny&lt;T&gt;()</code> should be used to provide a mock over <code>Mock.Of&lt;T&gt;()</code>?</p>

<p>Here is an example of what I'm asking, which I'll build on Ufuk's answer. The mock provided to <code>new UserService()</code> can be either <code>It.IsAny&lt;IUserRepository&gt;()</code> or <code>Mock.Of&lt;IUserRepository&gt;()</code>. In this case, I'm not interested in setting up anything special about these mocks, only that they exist to satisfy the compiler. The <code>Assert.IsTrue()</code> statements are agnostic to the supplied <code>IUserRepository</code> for the purposes of these tests. The question is: are <code>It.IsAny&lt;IUserRepository&gt;()</code> and <code>Mock.Of&lt;IUserRepository&gt;()</code> functionally equivalent in this instance?</p>

<pre><code>[TestFixture]
public class MoqTests
{
    [Test] 
    public void TestInitializationWithItIsAny()
    {
        var subject = new UserService( It.IsAny&lt;IUserRepository&gt;() ); // It.IsAny&lt;T&gt;
        _userService.RegisterUser(""abc"");
        Assert.IsTrue( _userService.IsInitialized() );
    }

    [Test] 
    public void TestInitializationWithMockOf()
    {
        var subject = new UserService( Mock.Of&lt;IUserRepository&gt;() ); // Mock.Of&lt;T&gt;
        _userService.RegisterUser(""abc"");
        Assert.IsTrue( _userService.IsInitialized() );
    }
}

public class UserService
{
    private readonly IUserRepository _userRepository;
    private bool _isInitialized = false;

    public UserService(IUserRepository userRepository)
    {
        _userRepository = userRepository;
    }

    public bool RegisterUser(string userName)
    {
        _isInitialized = true;
        User user = new User { UserName = userName, CreatedOn = DateTime.Now };
        return _userRepository.RegisterUser(user);
    }

    public bool IsInitialized()
    {
        return _isInitialized;
    }
}

public interface IUserRepository
{
    bool RegisterUser(User user);
}

public class User
{
    public string UserName { get; set; }
    public DateTime CreatedOn { get; set; }
}
</code></pre>
",3,9833,2014-03-13 8:43,,1,0,what
73392164,How to test a Spring Boot REST API with multiple parallel requests,<java><spring-boot><mocking><integration-testing><spring-restcontroller>,"<p>I am writing integration tests for a REST API. I would like to test the application with multiple parallel requests. Can I do it programmatically?</p>
<p>Below is my Test class</p>
<pre><code>@RunWith(SpringRunner.class)
@ExtendWith({SpringExtension.class,MockitoExtension.class})
@SpringBootTest
@ActivePRofiles(&quot;test&quot;)
@ContextConfiguration(classes = MyConfiguration.class)
public class MyControllerTest {
    @Resource(name = &quot;products&quot;)
    public Map&lt;String,String&gt; products;

    @Autowired
    MockMvc mockMvc;

    @Autowired
    WebAplicationContext webApplicationContext;

    @Mock
    SomeService someService;
    ...
    ...
    @Test
    public void testMethod() {
        ...
        ...
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();
        ...
        assertEquals(HttpStatus.OK.value(),result.getResponse().getStatus());
    }
    ...
}
</code></pre>
",1,850,2022-08-17 16:45,,0,1,what
55369684,GMock's `WillOnce` with `Return` does not fail on wrong return value,<c++><googletest><virtual-functions><googlemock>,"<ol>
<li>I have created a mock of an external socket api in <code>my_inet.cpp</code> file.</li>
<li>GMock functions for that socket api is in <code>mock.h</code> file.</li>
<li>I am using my created socket api of <code>my_inet</code> in <code>server.cpp</code> file. </li>
<li>The test is written in <code>gtest.cpp</code>.</li>
</ol>

<p>Problem is that in <code>my_inet.cpp</code> I am returning <code>1000</code> and in <code>gtest.cpp</code> I have written <code>.WillOnce( Return( 10 ));</code>, and it does NOT fail.</p>

<p>Why?</p>

<hr>

<p>gtest.cpp</p>

<pre><code>TEST(HelloTest, HelloReturnsOne)
{
    MockMyTCPAPI obj_myTCP;

    EXPECT_CALL( obj_myTCP, hello())
    .Times( 2 )
    .WillOnce( Return( -100 ))
    .WillOnce( Return( 10 ));

    Server obj_server( &amp;obj_myTCP );

    EXPECT_EQ( obj_server.hi(), -100 );
    EXPECT_EQ( obj_server.hi(), 10 );
}
</code></pre>

<p>mock.h</p>

<pre><code>#include ""my_inet.h""
#include &lt;gmock/gmock.h&gt;

class MockMyTCPAPI : public MyTCPAPI {
 public:
  MOCK_METHOD0( hello,  int());
  MOCK_METHOD3( socket, int(int arg1, int arg2, int arg3));
  MOCK_METHOD3( bind,   int(int arg1, int arg2, int arg3));
  MOCK_METHOD2( listen, int(int arg1, int arg2));
  MOCK_METHOD3( accept, int(int arg1, int arg2, int arg3));
  MOCK_METHOD2( send,   int(int arg1, int arg4));
};
</code></pre>

<p>my_inet.cpp</p>

<pre><code>int MyTCPAPI::hello()
{
    return 1000;
}
</code></pre>

<p>server.cpp</p>

<pre><code>int Server::hi()
{
    return myTCPAPI-&gt;hello();
}
</code></pre>

<hr>

<p>Output:</p>

<pre><code>[==========] Running 1 test from 1 test case.
[----------] Global test environment set-up.
[----------] 1 test from HelloTest
[ RUN      ] HelloTest.HelloReturnsOne
[       OK ] HelloTest.HelloReturnsOne (0 ms)
[----------] 1 test from HelloTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test case ran. (0 ms total)
[  PASSED  ] 1 test.
</code></pre>
",1,930,2019-03-27 4:10,,1,0,why
37473996,"With Moq, how can I mock protected methods with out parameter?",<c#><unit-testing><moq>,"<p>For a method like:</p>

<pre><code>protected virtual bool DoSomething(string str) { }
</code></pre>

<p>I usually mock it through:</p>

<pre><code>var mockModule = new Mock&lt;MyClass&gt; { CallBase = true };
mockModule.Protected().Setup&lt;bool&gt;(""DoSomething"", ItExpr.IsAny&lt;string&gt;()).Returns(true);
</code></pre>

<p>But for a method like:</p>

<pre><code>protected virtual bool DoSomething(out string str) { }
</code></pre>

<p>How can I mock it?</p>
",14,12627,2016-05-27 2:42,,2,7,how
14747686,Ninject & MOQ for ASP.NET Integration Testing,<asp.net><ninject><moq><integration-testing>,"<p>I have a project where I implemented many unit-tests using MOQ which works as expected.</p>

<p>Now I have running some selenium integration tests to check the whole application. The Integration test runs within a unit-test Project in a testclass. When the application comes to the part, where a external webservice is used, it fails because that service is not available. What is the best option to create a Mock for that service?</p>

<ul>
<li><p>Can I change the Ninject-Injections from the ASP.NET at runtime (through the Unit-Test process)? I don't think so. - Details to the setup: The Integration-Test (which is a single unit-test within a test-project), starts the webserver, then starts selenium to connect on the Server and does some Input. I want now to change a IMyInterface with a mockump from the unit-test, without having any if then else in the real ASP.net code.</p></li>
<li><p>Should I make conditional bindings in the ASP.NET Injection setup when the test is running? But that would mean, that all MOQs should already been added at that point, so I can't add/change it from one test to another.</p></li>
<li><p>Or what is the best way for this testing?</p></li>
</ul>

<p>Thanks</p>
",1,354,2013-02-07 9:27,,0,4,what
31943353,Create Many Object for Testing Purposes,<java><spring><object><testing><mocking>,"<p>I would like to know what, for you, is the best way to create a large amount of Objects.</p>

<p>I give you an example.
i want to mock 50 product, product is a class with field STRING name and INTEGER price. </p>

<pre><code> public class StuffTO {

     String category;
     String name;
     String price;
     String qty;
 }
</code></pre>

<p>I don't need a particular name or price, they can be random.</p>

<p>Now I would like to know which is the best way to create 50 random product writing less code possible.. </p>
",-1,1253,2015-08-11 13:36,,4,3,what
39723345,Mocking functions in Golang to test my http routes,<testing><go><mocking><go-gin>,"<p>I'm totally confused figuring out how I can mock a function, without using any additional packages like golang/mock. I'm just trying to learn how to do so but can't find many decent online resources.</p>

<p>Essentially, I <a href=""https://nathanleclaire.com/blog/2015/10/10/interfaces-and-composition-for-effective-unit-testing-in-golang/"" rel=""nofollow"">followed this excellent article</a> that explains how to use an interface to mock things.</p>

<p>As so, I've re-written the function I wanted to test. The function just inserts some data into datastore. My tests for that are ok - I can mock the function directly. </p>

<p>The issue I'm having is mocking it 'within' an http route I'm trying to test. Am using the Gin framework.</p>

<p>My router (simplified) looks like this:</p>

<pre><code>func SetupRouter() *gin.Engine {

    r := gin.Default()
    r.Use(gin.Logger())
    r.Use(gin.Recovery())

    v1 := r.Group(""v1"")
    v1.PATCH(""operations/:id"", controllers.UpdateOperation)
}
</code></pre>

<p>Which calls the UpdateOperation function:</p>

<pre><code>func UpdateOperation(c *gin.Context) {
    id := c.Param(""id"")
    r := m.Response{}

    str := m.OperationInfoer{}
    err := m.FindAndCompleteOperation(str, id, r.Report)

    if err == nil {
      c.JSON(200, gin.H{
          ""message"": ""Operation completed"",
      })
    }
}
</code></pre>

<p><strong>So, I need to mock the FindAndCompleteOperation() function.</strong></p>

<p>The main (simplified) functions looks like this:</p>

<pre><code>func (oi OperationInfoer) FindAndCompleteOp(id string, report Report) error {
    ctx := context.Background()
    q := datastore.NewQuery(""Operation"").
        Filter(""Unique_Id ="", id).
        Limit(1)

    var ops []Operation

    if ts, err := db.Datastore.GetAll(ctx, q, &amp;ops); err == nil {
        {
            if len(ops) &gt; 0 {
                ops[0].Id = ts[0].ID()
                ops[0].Complete = true

                // Do stuff

                _, err := db.Datastore.Put(ctx, key, &amp;o)
                if err == nil {
                  log.Print(""OPERATION COMPLETED"")
                }
            }
        }
    }

    err := errors.New(""Not found"")
    return err
}

func FindAndCompleteOperation(ri OperationInfoer, id string, report Report) error {
    return ri.FindAndCompleteOp(id, report)
}

type OperationInfoer struct{}
</code></pre>

<p>To test the route that updates the operation, I have something like so:</p>

<pre><code>FIt(""Return 200, updates operation"", func() {
    testRouter := SetupRouter()

    param := make(url.Values)
    param[""access_token""] = []string{public_token}

    report := m.Report{}
    report.Success = true
    report.Output = ""my output""

    jsonStr, _ := json.Marshal(report)
    req, _ := http.NewRequest(""PATCH"", ""/v1/operations/123?""+param.Encode(), bytes.NewBuffer(jsonStr))

    resp := httptest.NewRecorder()
    testRouter.ServeHTTP(resp, req)

    Expect(resp.Code).To(Equal(200))

    o := FakeResponse{}
    json.NewDecoder(resp.Body).Decode(&amp;o)
    Expect(o.Message).To(Equal(""Operation completed""))
})
</code></pre>

<p>Originally, I tried to cheat a bit and just tried something like this:</p>

<pre><code>m.FindAndCompleteOperation = func(string, m.Report) error {
  return nil
}
</code></pre>

<p>But that affects all the other tests etc.</p>

<p>I'm hoping someone can explain simply what the best way to mock the FindAndCompleteOperation function so I can test the routes, without relying on datastore etc.</p>
",3,3880,2016-09-27 11:21,,2,3,what
66892982,NSubstitute test failing only in build server,<c#-3.0><nsubstitute><vs-unit-testing-framework>,"<p>Using the NSubstite framework for mocking in c# unit testing project and recently we created version2 API controller and business and repositories. But when created the tests for the controller the very first case is failing in Azure build pipeline. The same test case running without error with status as pass. I have tried all the ways from blogs but no luck. here is the error and code.</p>
<p>ERROR:</p>
<pre><code>Test method XXX threw exception:
NSubstitute.Exceptions.RedundantArgumentMatcherException: Some argument specifications (e.g. Arg.Is, Arg.Any) were left over after the last call.

This is often caused by using an argument spec with a call to a member NSubstitute does not handle (such as a non-virtual member or a call to an instance which is not a substitute), or for a purpose other than specifying a call (such as using an arg spec as a return value). For example:

var sub = Substitute.For&lt;SomeClass&gt;();
var realType = new MyRealType(sub);
// INCORRECT, arg spec used on realType, not a substitute:
realType.SomeMethod(Arg.Any&lt;int&gt;()).Returns(2);
// INCORRECT, arg spec used as a return value, not to specify a call:
sub.VirtualMethod(2).Returns(Arg.Any&lt;int&gt;());
// INCORRECT, arg spec used with a non-virtual method:
sub.NonVirtualMethod(Arg.Any&lt;int&gt;()).Returns(2);
// CORRECT, arg spec used to specify virtual call on a substitute:
sub.VirtualMethod(Arg.Any&lt;int&gt;()).Returns(2);
To fix this make sure you only use argument specifications with calls to substitutes. If your substitute is a class, make sure the member is virtual.

Another possible cause is that the argument spec type does not match the actual argument type, but code compiles due to an implicit cast. For example, Arg.Any&lt;int&gt;() was used, but Arg.Any&lt;double&gt;() was required.

NOTE: the cause of this exception can be in a previously executed test. Use the diagnostics below to see the types of any redundant arg specs, then work out where they are being created.

Diagnostic information:

Remaining (non-bound) argument specifications:
any Int64
any Int64

All argument specifications:
any Int64
any Int64
any Int64
any Int64


Stack trace
at NSubstitute.Core.Arguments.ArgumentSpecificationsFactory.Create(IList`1 argumentSpecs, Object[] arguments, IParameterInfo[] parameterInfos, MethodInfo methodInfo, MatchArgs matchArgs)
at NSubstitute.Core.CallSpecificationFactory.CreateFrom(ICall call, MatchArgs matchArgs)
at NSubstitute.Routing.Handlers.RecordCallSpecificationHandler.Handle(ICall call)
at NSubstitute.Routing.Route.Handle(ICall call)
at NSubstitute.Core.CallRouter.Route(ICall call)
at NSubstitute.Proxies.CastleDynamicProxy.CastleForwardingInterceptor.Intercept(IInvocation invocation)
at Castle.DynamicProxy.AbstractInvocation.Proceed()
at NSubstitute.Proxies.CastleDynamicProxy.ProxyIdInterceptor.Intercept(IInvocation invocation)
at Castle.DynamicProxy.AbstractInvocation.Proceed()
at Castle.Proxies.ObjectProxy_4.GetTemplateByApplicationIdTemplateId(Int64 applicationId, Int64 templateId)
at XXX() in YYY.cs:line 61

public Interface XXX
{
long Process(long x, string y, out string z);
}

[TestMethod]
public void XXX()
{
XXX _business = Substitute.For&lt;XXX&gt;();
Object model = GetFakeModel();
_business.Process(Arg.Any&lt;long&gt;(), Arg.Any&lt;string&gt;(), out Arg.Any&lt;string&gt;())
.Returns(x =&gt; { x[2] = &quot;Success&quot;; return 1; });
var _controller = new YYY(_business);
var result = _controller.Post(1, model) as ObjectResult;
Assert.IsNotNull(result);
}
</code></pre>
<p>How can we solve this problem. even i cant debug as its passing in the local machine. Tried running tests in sequential by adding a annotation [DoNotParallelize] but no luck.</p>
",2,679,2021-03-31 18:02,,0,2,how
43437827,unittest.mock doesn't work when tests are run with pytest,<python><mocking><flask-sqlalchemy><pytest><python-unittest.mock>,"<p>I have the following project structure:</p>

<pre><code>tests/
└── messenger/
    └── messaging_test.py
app/
├── __init__.py
├── models.py
└── messenger/
    ├── __init__.py
    └── messaging.py
</code></pre>

<p>Inside <code>messaging.py</code> module there's a function <code>send_schedule</code> with the following lines:</p>

<pre><code>talks = models.Talk.query.all()
raise ValueError(str(talks))  # the debug output
</code></pre>

<p>I'm trying to patch the <code>models.Talk.query.all()</code> call. Inside <code>messaging_test.py</code> there's the following test:</p>

<pre><code>@patch('app.models.Talk.query.all')
def test_send_schedule(self, all_query_mock):
    all_query_mock.return_value = []
    for talk_id in range(1, 6):
        talk_mock = MagicMock(id=talk_id, title=str(talk_id), speaker_facebook_id=1)
        all_query_mock.return_value.append(talk_mock)
    with vcr.use_cassette('vcr_cassettes/send_schedule.yaml'):
        response = messaging.send_schedule(self.access_token, self.user_id)

    self.assertTrue('recipient_id' in response)
    self.assertTrue('message_id' in response)
    self.assertEqual(response['recipient_id'], self.user_id)
</code></pre>

<p>When I run the test with <code>python3 -m pytest tests/messenger/messaging_test.py</code> command, <code>ValueError</code> outputs an empty list, which signifies that the call wasn't patched. Can you suggest a fix to that?</p>

<p>What did I do to solve the issue:</p>

<ul>
<li>Read <a href=""https://docs.python.org/3/library/unittest.mock.html#where-to-patch"" rel=""nofollow noreferrer"">""Where to patch""</a> paragraph of documentation. This led me to suspicion that <code>pytest</code> runs my tests in a weird way.</li>
<li>Tried to use <code>pytest-mock</code> but failed to figure out how to use it with <code>unittest.TestCase</code>.</li>
</ul>
",1,856,2017-04-16 13:34,,1,0,other
17609627,Fake It Easy - A<T>.Ignored() with string - A<string>.Ignored(),<c#><fakeiteasy>,"<p>I've a method with a string parameter and a bool return value.
I want to ensure that it always returns true</p>

<p>I tried</p>

<pre><code>myClass.Foo(A&lt;string&gt;.Ignored)
 .WithReturnType&lt;bool&gt;()
 .Returns(true);
</code></pre>

<p>Now I get the following exception</p>

<blockquote>
  <p>System.ArgumentException: The specified object is not recognized as a
  fake object. Result StackTrace:    bei
  FakeItEasy.Core.DefaultFakeManagerAccessor.GetFakeManager(Object
  proxy)    bei FakeItEasy.FakeFacade.GetFakeManager(Object fakedObject)
  bei FakeItEasy.Configuration.FakeConfigurationManager.CallTo(Object
  fakeObject)    bei FakeItEasy.A.CallTo(Object fake) [...]</p>
</blockquote>

<p>What am I doing wrong?</p>
",1,11695,2013-07-12 7:24,,2,0,what
5077059,Testing TryUpdateModel() with MStest and moq,<c#><asp.net-mvc><moq><mstest>,"<p>Im currently trying to test an insert method which uses TryUpdateModel(). I am faking the controllercontext which is needed and although that works it does not seem to be posting the model I have setup.</p>

<p>Here is the method I am testing:</p>

<pre><code> [AcceptVerbs(HttpVerbs.Post)]
    [GridAction]
    public ActionResult _SaveAjaxEditing(int? id)
    {
        if (id == null)
        {
            Product product = new Product();
            if (TryUpdateModel(product))
            {
                //The model is valid - insert the product.
                productsRepository.Insert(product);// AddToProducts(product);
            }
        }
        else
        {
            var recordToUpdate = productsRepository.Products.First(m =&gt; m.ProductID == id);
            TryUpdateModel(recordToUpdate);
        }
        productsRepository.Save();
        return View(new GridModel(productsRepository.Products.ToList()));
    }
</code></pre>

<p>And here is my current test:</p>

<pre><code>        [TestMethod]
    public void HomeControllerInsert_ValidProduct_CallsInsertForProducts()
    {
        //Arrange
        InitaliseRepository();

        var httpContext = CustomMockHelpers.FakeHttpContext();
        var context = new ControllerContext(new RequestContext(httpContext, new RouteData()), controller);
        controller.ControllerContext = context;
        //controller.ControllerContext = new ControllerContext();

        var request = Mock.Get(controller.Request);
        request.Setup(r =&gt; r.Form).Returns(delegate()
                                               {
                                                   var prod = new NameValueCollection
                                                                  {
                                                                      {""ProductID"", ""9999""},
                                                                      {""Name"", ""Product Test""},
                                                                      {""Price"", ""1234""},
                                                                      {""SubCatID"", ""2""}
                                                                  };
                                                   return prod;
                                               });


        // Act: ... when the user tries to delete that product
        controller._SaveAjaxEditing(null);
        //Assert
        _mockProductsRepository.Verify(x =&gt; x.Insert(It.IsAny&lt;Product&gt;()));
    }
</code></pre>

<p>The method is being called but when it gets to TryUpdateModel() it seems it cannot pickup the posted object. Any pointers on where I am going wrong would be great.</p>
",3,972,2011-02-22 10:42,,1,0,what
50394974,How do I undo a Setup call for a moq Mock?,<nunit><moq>,"<p>This might be a special use case that I am dealing with here. Here is what my simple C# NUnit test that uses Moq looks like</p>

<pre><code>Mock&lt;ISomeRepository&gt; mockR = new Mock&lt;ISomeRepository&gt;();
mockR.Setup(x =&gt; x.GetSomething).Returns(new Something(a=1,b=2);
--use the mocked repository here
</code></pre>

<p>Now later in this same unit test or another test case I want to invoke the real implementation of the method GetSomething() on this mockR object.
Is there a way to do that? My repository is Singleton at its heart. So even if I create a new object, the GetSomething method still returns the same Moq'd object.</p>
",1,2668,2018-05-17 15:15,,2,1,what
17064978,Hippomocks: How to expect only some of the arguments passed to ExpectCall()?,<c++><mocking><hippomocks>,"<p>In the mocking framework <a href=""https://www.assembla.com/spaces/hippomocks/wiki"" rel=""nofollow"">Hippomocks</a> it is possible to check the passed arguments within an expectation. For example:</p>

<pre><code>void Class::Method(int arg1);
...
m_mockRepository_p-&gt;ExpectCall(someObject_p, Class::Method).With(1);
</code></pre>

<p>Is there a possibility to check only some of the passed arguments? What should I write instead of ??? in the following code?</p>

<pre><code>void Class::Method(int arg1, char* buffer_p);
...
m_mockRepository_p-&gt;ExpectCall(someObject_p, Class::Method).With(1,???);
</code></pre>

<p>For your information: The use case is that someObjet_p creates internally a buffer to read data in it and passes it to Class::Method. Firstly I don't care in which buffer someObject_p would like the data to put in. Secondly I don't have access to the internals of someObject_p to pass it to With() - which is quite reasonable.</p>

<p>Note: I've tagged the question as C++ as I make use of ExpectCall but I'd guess the same would apply to ExpectCallFunc for flat functions.</p>

<p>Second note: Hippomocks provides methods for expectations named ""Match()"", ""getArgs()"", ""assignArgs()"" and ""matchesArgs()"" but neither did I find any documentation on it nor do I know whether they are intended to be used (for my use case) or not.</p>
",0,1894,2013-06-12 12:00,,1,0,what
47768754,Want to test a function that takes a lambda as input parameter. I use fakeiteasy,<c#><unit-testing><lambda><fakeiteasy>,"<p>The function that I want to test:</p>

<pre><code> string theText = _resourceManager.GetString&lt;MyApp.Localization
                  .MyTexts&gt;(x =&gt; x.TheKeyAsString);
</code></pre>

<p>The template is a class containing textrexources.
TheKeyAsString is a string that is the Key for getting the correct text.</p>

<p>How can I unit test this? </p>

<p>Here is what I did hope would work. It does not work:</p>

<pre><code>Expression&lt;Func&lt;MyApp.Localization.MyTexts, string&gt;&gt; myExpression = x =&gt; x.TheKeyAsString;

A.CallTo(() =&gt; _resourceManager.GetString&lt;MyApp.Localization.MyTexts&gt;(
               A&lt;Expression&lt;Func&lt;MyApp.Localization.MyTexts, string&gt;&gt;&gt;
              .That.Matches(x =&gt; x == myExpression )))
              .Returns(""TheText"");
</code></pre>

<p>Can anyone tell my how to set up FakeItEasy to deliver ""TheText"" when I call the ResourceManager like this:</p>

<pre><code>string theText = _resourceManager.GetString&lt;MyApp.Localization.MyTexts&gt;(
                 x =&gt; x.TheKeyAsString);
</code></pre>
",0,1232,2017-12-12 9:05,,2,1,how
56453237,"Unit Test mocking AWS Lambda Function with global section, Python",<python-3.x><amazon-web-services><function><aws-lambda><mocking>,"<p>I'm writing a python lambda with an initialisation to an external service in the global section of the lambda. How do I mock this external dependency as it is initialised at the creation of my class?</p>

<p>data_load.py</p>

<pre class=""lang-py prettyprint-override""><code>from elasticsearch import Elasticsearch,

# Global section - executed once for the life time of the container
def get_elastic_search_connection():
    try:
        client = Elasticsearch(
            hosts=[{'host': ""host"", 'port': 9191}],
            use_ssl=""true"",
            verify_certs=""true"",
            connection_class=RequestsHttpConnection)
        return client
    except Exception as e:
        LOGGER.error(""Unable to connect to ES"")
        exit(1)

es_client = get_elastic_search_connection()


# handler section - executed once per function invocation
def lambda_handler(event, context):
    es_client.bulk(body=""body"", index=""index"", doc_type=""doc"", _source=False)

</code></pre>

<p>In my test, as soon as the import statement imports data_load.py, it tries to initialise the global section of the lambda, which tries to make a http connection to host address.  How do I create a partial mock of data_loay.py so that I can test the lambda_handler method?  The es_client has to be initialised in the global section.  How do I dependency inject a mock into the global section?</p>

<p>test_data_load.py</p>

<pre class=""lang-py prettyprint-override""><code>import unittest
import search_lambda.data_load.data_load


class TestDatLoad(unittest.TestCase):

    def test_data_load(self):
        print(""Hello"")


if __name__ == '__main__':
    unittest.main()
</code></pre>
",2,359,2019-06-05 1:31,,0,0,how
20701679,Mocking callbacks in Laravel 4 (Mockery),<php><unit-testing><laravel-4><mockery>,"<p>I'm currently writing tests for a package in Laravel 4.</p>

<p>I am mocking the <code>Illuminate\Database\Query\Builder</code> which works nearly all the time except when a <code>where</code> method uses a callback, I cannot check if the methods inside the callback are called.</p>

<p>I was hoping one of you could shed some light.</p>

<pre><code>$query = \Mockery::mock('Illuminate\Database\Query\Builder', function ($mock) {
    /** @var \Mockery\Mock $mock */
    $mock-&gt;shouldReceive('where');
    $mock-&gt;shouldReceive('orWhere')-&gt;twice();
});
</code></pre>

<p>And the actual <code>where</code> method that should call <code>orWhere</code>. <strong>Note:</strong> That builder mock gets passed to the class below.</p>

<pre><code>$builder = new LaravelBuilder($query);
</code></pre>

<p>Which then calls <code>$builder-&gt;filter()</code> which contains the below code.</p>

<pre><code>$this-&gt;query-&gt;where(function ($query) use ($filterData) {
    /** @var \Illuminate\Database\Query\Builder|\Illuminate\Database\Eloquent\Builder $query */
    foreach($filterData['columns'] as $colData) {
        /** @var \Samvaughton\Ldt\Column $column */
        $column = $colData['column'];

        // See if this column is searchable
        if (!$column-&gt;isSearchable() || !$colData['searchable']) continue;

        // If the individual column term is empty, use the main term
        $term = (empty($colData['term'])) ? $filterData['term'] : $colData['term'];

        // Actually apply the filter
        $query-&gt;orWhere($column-&gt;getSqlColumn(), ""LIKE"", ""%{$term}%"");
    }
});
</code></pre>

<p>The main part is the bottom bit <code>$query-&gt;orWhere</code>, the PHPUnit tests fail every time as it doesn't run the <code>orWhere</code> even once. Before you say that it might not reach the execution of it due to <code>continue</code>, the data I am passing will allow this.</p>

<p>I suspect this is due to how I am mocking the <code>where</code> method in the first place. If I include an <code>exit</code> before the <code>foreach</code> it does not execute indicating that it doesn't even run anything inside the callback. I know that is the default behaviour but how do I get Mockery to run the same/similar callback?</p>

<p>I have tried using partial mocks, using <code>shouldExpect</code> but don't fully understand it. I've also tried searching around but no luck with this scenario.</p>

<p>Would be great if I could learn how to use mockery within callbacks.</p>
",6,2842,2013-12-20 10:37,,1,0,how
24790562,EasyMock 3.1 InvocationTargetException,<java><unit-testing><easymock>,"<p>I am writing a test using easymock and junit that should be fairly simple. I have added functionality to an existing project, and I am testing that a method that I added works as expected. I can't post the detailed code (it's for work), but here is a version with the names changed:</p>

<pre><code>public class ATest extends AbstractTestCase {
    private AFactory factory;
    private AServiceClient mockClient;
    private AServiceResult mockResult;
    private AnObject mockObject;
    private AnotherObject mockObject2;
    private Map&lt;String, Object&gt; mockMap;

    @Before
    public void setupMocks() {
        factory = new AFactory();
        mockClient = EasyMock.createMockBuilder(AServiceClient.class)
                .addMockedMethod(""getAServiceResult"")
                .createMock();
        factory.setClient(mockClient);
        mockResult = EasyMock.createMockBuilder(AServiceResult.class)
                .addMockedMethod(""getAnObject"")
                .createMock();
        mockObject = EasyMock.createMockBuilder(AnObject.class)
                .addMockedMethod(""getAnotherObject"")
                .createMock();
        mockObject2 = EasyMock.createMockBuilder(AnotherObject.class)
                .addMockedMethod(""getMap"")
                .createMock();

        mockMap = new HashMap&lt;String, Object&gt;();
        //Put a bunch of stuff in the map

        EasyMock.expect(mockObject2.getMap())
                .andReturn(mockMap)
                .once();
        EasyMock.expect(mockObject.getAnotherObject())
                .andReturn(mockObject2)
                .once();
        EasyMock.expect(mockResult.getAnObject())
                .andReturn(mockObject)
                .once();
    }

    @Test
    public void aTest throws SomeException {
        AnInstance inst = factory.getInstance();
        SomeInput input = SomeInput();
        //Populate input

        Set&lt;String&gt; expectedInnerInput = new HashSet&lt;String&gt;();
        //Populate expected inner input
        EasyMock.expect(mockClient.getAServiceResult(eq(expectedInnerInput), eq(""1"")))
                .andReturn(mockResult)
                .once();

        EasyMock.replay(mockClient, mockResult, mockObject, mockObject2);
        Map&lt;SomeKey, Object&gt; attrs = inst.getAttributes(""a string"", input);
        EasyMock.verify(mockClient, mockResult, mockObject, mockObject2);

        //A bunch of junit asserts on attrs
    }
}
</code></pre>

<p>(There may be typos in the above. Assume those mistakes came from me typing this here. My code was able to compile and run and it got all the way to the line between <code>EasyMock.replay</code> and <code>EasyMock.verify</code>.)</p>

<p>This is my stack trace (again with names changed):</p>

<pre><code>[junit] Testcase: aTest(com.apackage.test.validation.ATest):    Caused an ERROR
[junit] java.lang.reflect.InvocationTargetException--&gt;null
[junit] net.sf.cglib.core.CodeGenerationException: java.lang.reflect.InvocationTargetException--&gt;null
[junit]     at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:237)
[junit]     at net.sf.cglib.reflect.FastClass$Generator.create(FastClass.java:64)
[junit]     at net.sf.cglib.proxy.MethodProxy.helper(MethodProxy.java:120)
[junit]     at net.sf.cglib.proxy.MethodProxy.init(MethodProxy.java:74)
[junit]     at net.sf.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:213)
[junit]     at org.easymock.internal.ClassProxyFactory$MockMethodInterceptor.intercept(ClassProxyFactory.java:91)
[junit]     at com.apackage.aservice.client.AServiceClient$$EnhancerByCGLIB$$a9dce969.equals(&lt;generated&gt;)
[junit]     at org.easymock.internal.ExpectedInvocation.matches(ExpectedInvocation.java:85)
[junit]     at org.easymock.internal.UnorderedBehavior.addActual(UnorderedBehavior.java:57)
[junit]     at org.easymock.internal.MocksBehavior.addActual(MocksBehavior.java:87)
[junit]     at org.easymock.internal.ReplayState.invokeInner(ReplayState.java:58)
[junit]     at org.easymock.internal.ReplayState.invoke(ReplayState.java:46)
[junit]     at org.easymock.internal.MockInvocationHandler.invoke(MockInvocationHandler.java:40)
[junit]     at org.easymock.internal.ObjectMethodsFilter.invoke(ObjectMethodsFilter.java:85)
[junit]     at org.easymock.internal.ClassProxyFactory$MockMethodInterceptor.intercept(ClassProxyFactory.java:94)
[junit]     at com.apackage.aservice.client.AServiceClient$$EnhancerByCGLIB$$a9dce969.getAServiceResult(&lt;generated&gt;)
[junit]     at com.apackage.validation.AnInstance.getAttributes(AnInstance.java:31)
[junit]     at com.apackage.test.validation.ATest.aTest(ATest.java:100)
[junit]     at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
[junit]     at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
[junit]     at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
[junit]     at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:231)
[junit]     at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:88)
[junit]     at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
[junit]     at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
[junit]     at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:174)
[junit] Caused by: java.lang.reflect.InvocationTargetException
[junit]     at net.sf.cglib.core.ReflectUtils.defineClass(ReflectUtils.java:384)
[junit]     at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:219)
[junit] Caused by: java.lang.LinkageError: loader (instance of  sun/misc/Launcher$AppClassLoader): attempted  duplicate class definition for name: ""$java/lang/Object$$FastClassByCGLIB$$3f697993""
[junit]     at java.lang.ClassLoader.defineClass1(Native Method)
[junit]     at java.lang.ClassLoader.defineClass(ClassLoader.java:800)
</code></pre>

<p>Here are my constraints:</p>

<ul>
<li>I cannot use another version of EasyMock</li>
<li>I cannot use another mock library</li>
<li>I cannot not use mocks for this (obviously)</li>
</ul>

<p>I've seen some things saying this is an EasyMock bug, but I would think that other people would have run into the same problem as me and updated to a newer version. I'm pretty sure there is something I'm doing wrong.</p>
",0,1253,2014-07-16 20:55,,0,5,other
57194980,Getters and Setters vs FRIEND_TEST,<c++><googletest><googlemock>,"<p>I know this is not good class design for UT but...</p>

<p>In case there are protected variables that need to be tested, would it be better to just use FRIEND_TEST to get/set these variables on test?  Or should I create getters and setters (for each variable!)?</p>

<p>Ex. </p>

<pre><code>class Dog
{
public:
//some methods

protected:
   int age;
   std::string color;
   std::string breed
}
</code></pre>

<p>Declaring a FRIEND_TEST will not require much overhead unlike if I will create getters and setters for each == 6 new methods!  But what is the more correct solution?</p>
",0,792,2019-07-25 5:36,,2,1,what
64742010,"I need to test a controller method with Junit4, but unable to successfully do so. the method takes List<String> as parameter",<java><spring><unit-testing><junit><mocking>,"<p>My controller method looks like this:
I am mocking the serviceImpls and controller</p>
<pre><code>private MockMvc mockMvc;
@InjectMocks
private ModelController modelController;

@Mock
ModelServiceImpl modelServiceImpl;
.
.
.
    
    
    
@GetMapping(value = &quot;/getDetails/&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
 public ResponseEntity&lt;List&lt;String&gt;&gt; getDetails(@RequestParam(name=&quot;modelNames&quot;) List&lt;String&gt; modelNames) {
        return new ResponseEntity&lt;&gt;(modelServiceImpl.getDetailsByModels(modelNames), HttpStatus.OK);
    }
</code></pre>
<p>Test Method Looks like this:</p>
<pre><code>@Test
public void testGetModelDetails() throws Exception {
    List&lt;String&gt; modelNames = new ArrayList&lt;&gt;();
    models.add(&quot;rishima&quot;);
    List&lt;String&gt; results = new ArrayList&lt;&gt;();
    results.add(&quot;star23563&quot;);

    when(modelServiceImpl.getDetailsByModels(modelNames)).thenReturn(results);
    mockMvc.perform(get(&quot;/getDetails/&quot;)).accept(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());


}
</code></pre>
<p>But getting the error:</p>
<pre><code>java.lang.AssertionError: Status expected:&lt;200&gt; but was:&lt;400&gt;
at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:627)
at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:196)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
</code></pre>
<p>I have looked over the stackoverflow and tried but couldnt find solution for passing List as RequestParam.</p>
",-1,53,2020-11-08 19:05,,1,0,how
16665189,Is there any good way to check mock calls if it is copied in Google Mock Framework,<googletest><googlemock>,"<p>I use Google Test and Google Mock for making unit tests and there is a need to check calls of object, which was placed into a std::vector. Like this:</p>

<pre><code>TEST(FooTest, someTest)
{
  // Given
  CSomeClass someObject;
  StrictMock&lt;MockFoo&gt; strictFoo;
  std::vector&lt;Foo&gt; fooContainer;
  fooContainer.push_back(strictFoo);

  // Expected
  EXPECT_CALL(strictFoo, doSomething()); // can't do this because there is a copy of strictFoo in vector

  // When
  someObject.do(fooContainer);
}
</code></pre>

<p>I'd greatly appreciate any tips on accomplishing this.</p>
",1,236,2013-05-21 8:15,,1,0,how
45154882,Redux - Jest: Testing functions that have void return,<redux><mocking><jestjs><redux-thunk>,"<p>New to Jest and Redux and I'm having trouble with testing functions that are dispatching to the store but don't yield a return value. I'm trying to follow the example from the <a href=""http://redux.js.org/docs/recipes/WritingTests.html"" rel=""nofollow noreferrer"">Redux website</a> does this</p>

<pre><code>return store.dispatch(actions.fetchTodos()).then(() =&gt; {
      // return of async actions
      expect(store.getActions()).toEqual(expectedActions)
})
</code></pre>

<p>however I have several ""fetchtodos"" functions that  don't return anything which causes the error <strong>TypeError</strong>: </p>

<blockquote>
  <p><code>Cannot read property 'then' of undefined due to returning undefined</code></p>
</blockquote>

<p>I'm wondering what I can do to test that my mock store is correctly updating. Is there a way to dispatch the function, wait for it to finish and then compare the mock store with expected results?</p>

<p>Thanks</p>

<hr>

<p><strong>Edit: We're using typescript</strong></p>

<p><strong>action from tsx</strong></p>

<pre><code>export function selectTopic(topic: Topic | undefined): (dispatch: Redux.Dispatch&lt;TopicState&gt;) =&gt; void {
  return (dispatch: Redux.Dispatch&lt;TopicState&gt;): void =&gt; {

    dispatch({
      type: SELECT_Topic,
      payload: topic,
    });

    dispatch(reset(topic));
  };
}
</code></pre>

<p><strong>test.tsx</strong></p>

<pre><code>const middlewares = [thunk];
const mockStore = configureMockStore(middlewares);

describe('Select Topic action', () =&gt; {
  it('should create an action to select .', () =&gt; {
    const topic: Topic = mockdata.example[0];
    const expectedAction = {
      type: actions.SELECT_TOPIC,
      payload: topic,
    };

    const store = mockStore(mockdata.defaultState);

    return store.dispatch(actions.selectTopic(topic)).then(() =&gt; {
      expect(store.getState()).toEqual(expectedAction);
    });
  });
});
</code></pre>

<p>The action is what I'm given to test(and there are many other functions similar to it. I'm getting that undefined error when running the test code, as the function isn't returning anything. </p>
",0,1543,2017-07-17 22:57,,1,0,what
54379833,How to mock standart perl opendir and readdir functions?,<perl><mocking>,"<p>I'm writing test for function which gets list of all <code>*.pm</code> files in current directory.</p>

<p>Here is function:</p>

<pre><code>sub get_inspected_modules_list {
    my ( $dir ) = @_;
    opendir(my $dh, $dir) or die $!;
    my @files;
    while (my $file = readdir($dh)) {
        next unless (-f ""$dir/$file"");   # skip nested dirs
        next unless ($file =~ m/\.pm$/); # push only *.pm
        push @files, $file;
    }
    closedir($dh);
    return \@files
}
</code></pre>

<p>I tried to use <a href=""https://metacpan.org/pod/Test::MockFile::DirHandle"" rel=""nofollow noreferrer"">Test::MockFile::DirHandle</a> for test, but it prints <code>No such file or directory</code> error:</p>

<pre><code>subtest ""get_inspected_modules_list"" =&gt; sub {

    my $handle = Test::MockFile::DirHandle-&gt;new(
        ""/fake/path"", 
        [qw/Foo.pm Bar.pm Baz.pm test.txt 1.pl/]
    );

    warn Dumper get_inspected_modules_list( '/fake/path' ); # error

};
</code></pre>

<p>How to mock opendir/readdir calls ?</p>
",2,262,2019-01-26 15:33,,1,2,how
68861081,Rails MiniTest stub module method for the whole test,<ruby-on-rails><mocking><minitest><stubbing>,"<p>I want to test my service where I must to replace one module method by integer <code>50</code> for whole test. To do so I'm using Stub:</p>
<pre><code># tested service

module CashTransactions
  class DistributeFunds
    def initialize(users:, amount:)
      @users = users
      @amount = amount
    end

    def call
      users.each do |user|
        funds = CashTransactionSettings.calculate_amount_distribution(user, amount)
        CashTransaction.create!(user: user, funds: funds)
      end
    end
  end
end
</code></pre>
<p>Based on <a href=""https://github.com/seattlerb/minitest#label-Stubs"" rel=""nofollow noreferrer"">this</a> source I've prepared following test:</p>
<pre><code>test 'create CashTransaction records' do
  user1_funds = CashTransactionSettings
  user2_funds = CashTransactionSettings

  refute user1_funds.calculate_amount_distribution
  refute user2_funds.calculate_amount_distribution

  CashTransactionSettings.stub :calculate_amount_distribution, 50 do
    assert user1_funds.calculate_amount_distribution(user1, 100), 50
    assert user2_funds.calculate_amount_distribution(user2, 100), 50

    assert_equal 1, CashTransaction.where(user: user1, amount: 50).size
    assert_equal 1, CashTransaction.where(user: user2, amount: 50).size
  end
end
</code></pre>
<p>But instead of replacing <code>CashTransactionSettings.calculate_amount_distribution</code> by <code>50</code> it calls it, where am I wrong? or maybe it's not possible in MiniTest?</p>
",0,1494,2021-08-20 10:54,,1,0,what
59943078,"Cannot assign void to an implicitly-typed variable	in unit test",<c#><unit-testing><mocking>,"<p>everyone, I am trying to write a unit test for my Processor class. in my project, I take a JSON file and Deserialize it and then I build and process it then save it to my database 
this is my process class</p>

<pre><code>public class CustomerProcessors
    {
        private static IRepository _repository;
        private static PracticeEntities4 _context;
        private static Customer customer;
        public CustomerProcessors()
        {
        }

        public CustomerProcessors(IRepository repository)
        {
            _repository = repository;
        }


        public static void Process(Customer customer)
        {
            var oldcustomer = _repository.GetOldCustomerId(customer.Code.Value);
          if (oldcustomer == null)
            {
                Save(customer);
            }
            else
                update(customer);
        }

        private static void update(Customer customer)
        {

            _repository.UpdateCustomer(customer);

        }

        private static void Save(Customer customer)
        {
            _repository.SaveCustomer(customer);
        }
    }
</code></pre>

<p>this is my Builder </p>

<pre><code> public  Customer CustomerBuild(DtoCustomer dto)
        {
            return new Customer()
            {
                FirstName = dto.FirstName,
                LastName = dto.LastName,
                Address = dto.Address,
                Email = dto.Email,
                Code = int.Parse(dto.Code),
                PhoneNumber = dto.Phone

            };
        }
</code></pre>

<p>and finally, this is my unit test </p>

<pre><code>    [TestClass]
   public class CustomerProcessorTest
    {

        private static string path;
        private static CustomerDeserializer _customerDeserializer;
        private static CustomerBuilder _customerBuilder;
        private List&lt;Customer&gt; _customers;
        private static Mock&lt;IRepository&gt; mock;
        private  Customer customer;

        [ClassInitialize]
        public static void CLassInitialize(TestContext context)
        {
            path = Path.Combine(Environment.CurrentDirectory, @""JSON\"", ""Customer.json"");
        }

        [TestInitialize]
        public void TestInitialize()
        {
            mock = new Mock&lt;IRepository&gt;();
            _customerDeserializer = new CustomerDeserializer();
            _customerBuilder = new CustomerBuilder();
            _customers = new List&lt;Customer&gt;();
            Customer customer = new Customer();
        }

        [TestMethod]
        public void CusomerDeserialize_customerProcess()
        {
            //Arange
            mock.Setup(e =&gt; e.GetOldCustomerId(1001)).Returns(3);
            mock.Setup(e =&gt; e.GetOldStoreId(200)).Returns(3);
            //Act
            var dtos = CustomerDeserializer.Deserialize(path);
            var dto = dtos.FirstOrDefault(e =&gt; e.Code == ""1001"");
            var Builder= new CustomerBuilder();
            var customer = Builder.CustomerBuild(dto);
//Error here
                var process= CustomerProcessors.Process(customer);

            //Asset
            Assert.AreEqual(0, _customers.Count);
        }


    }
}
</code></pre>

<p>I have this error and I don't know what to do?</p>
",3,8672,2020-01-28 6:14,,1,5,what
28768359,Comparison of floating point arrays using google test and google mock,<c++><arrays><floating-point><googletest><googlemock>,"<p>I am new to Google's test products and trying them out with some signal processing code. I am trying to assert that to floating point arrays are equal to within some bounds, using google mock as suggested by the answer to <a href=""https://stackoverflow.com/questions/1460703/comparison-of-arrays-in-google-test"">this question</a>. I would like to know the recommended method for adding some error tolerance to an expression like the following . . . </p>

<pre><code>EXPECT_THAT(  impulse, testing::ElementsAreArray( std::vector&lt;float&gt;({
    0, 0, 0, 1, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0
}) )  );
</code></pre>

<p>I want the test to pass if the element-wise values in the arrays are within 10<sup>-8</sup> of one another.</p>
",6,5480,2015-02-27 15:17,,3,1,other
40256155,Rspec. The tested code is automatically started after test,<ruby><rspec><mocking><sensu>,"<p>I have a problem with the testing the Sensu Plugin.
Everytime when I start rspec to test plugin it test it, but anyway at the end of test, the original plugin is started automatically. So I have in my console:</p>

<pre><code>Finished in 0 seconds (files took 0.1513 seconds to load) 
1 example, 0 failures 
CheckDisk OK:       # This comes from the plugin
</code></pre>

<p>Short explanation how my system works:
Plugin call system 'wmic' command, processes it, checks the conditions about the disk parameters and returns the exit statuses (ok, critical, etc)
Rspec mocks the response from system and sets into the input of plugin. At the end rspec checks the plugin exit status when the mocked input is given.</p>

<p>My plugin looks like that:</p>

<pre><code>require 'rubygems' if RUBY_VERSION &lt; '1.9.0'
require 'sensu-plugin/check/cli'

class CheckDisk &lt; Sensu::Plugin::Check::CLI
  def initialize
    super
    @crit_fs = []
  end

  def get_wmic
    `wmic volume where DriveType=3 list brief`
  end

  def read_wmic
    get_wmic
    # do something, fill the class variables with system response  
  end

  def run
   severity = ""ok""
   msg = """"
   read_wmic
   unless @crit_fs.empty?
     severity = ""critical""  
  end  
  case severity
    when /ok/
      ok msg
    when /warning/
      warning msg
    when /critical/
      critical msg
    end
  end
end
</code></pre>

<p>Here is my test in Rspec:</p>

<pre><code>require_relative '../check-disk.rb'
require 'rspec'

  def loadFile
    #Load template of system output when ask 'wmic volume(...)
  end

  def fillParametersInTemplate (template, parameters)
    #set mocked disk parameters in template
  end

  def initializeMocks (options)
    mockedSysOutput = fillParametersInTemplate @loadedTemplate, options 
    po = String.new(mockedSysOutput)
    allow(checker).to receive(:get_wmic).and_return(po) #mock system call here
  end

  describe CheckDisk do
    let(:checker) { described_class.new }
    before(:each) do   
       @loadedTemplate = loadFile   
       def checker.critical(*_args)
          exit 2
       end    
     end

  context ""When % of free disk space = 10 &gt;"" do 
    options = {:diskName =&gt; 'C:\\', :diskSize =&gt; 1000, :diskFreeSpace =&gt; 100}       
    it 'Returns ok exit status ' do      
      begin                   
        initializeMocks options
        checker.run 
      rescue SystemExit =&gt; e 
        exit_code = e.status   
      end 
      expect(exit_code).to eq 0
    end  
  end 
end
</code></pre>

<p>I know that I can just put ""exit 0"" after the last example, but this is not a solution because when I will try to start many spec files it will exit after the first one. How to start only test, without running the plugin? Maybe someone can help me and show how to handle with such problem?
Thank you.</p>
",0,124,2016-10-26 7:25,,1,0,how
12073594,"jmock, return new object upon each call",<java><jmock>,"<p>I am setting up a mock object which is supposed to return a new business object each time I call a method f() on it. If I simply say returnValue(new BusinessObj()), it will return the same reference upon each call. If I do not know how many calls there will be to f(), i.e. I cannot use onConsecutiveCalls, how can I solve this issue?</p>
",3,1034,2012-08-22 12:52,,1,0,how
42362962,Nsubsitute - Mock db context which is invoked inside query handler,<c#><entity-framework><unit-testing><cqrs><nsubstitute>,"<p>Is there any way to mock dbcontext in situation like this? Im using cqrs. </p>

<pre><code>  public class QueryHandler1 : IQueryHandler&lt;Query1,string&gt;
  {
    private readonly IDbInvoker invoker;

    public QueryHandler1 (IDbInvoker invoker)
    {
        this.invoker = invoker;
    }

    public string Handle(Query1 query)
    {
        //Here I want to have my mocked context somehow.
        return invoker.Invoke&lt;MyMockedContext, string&gt;(context =&gt;
        {

            //logic which I want to test with my mocked context
        });
    }
</code></pre>
",4,360,2017-02-21 9:08,,0,12,what
28886305,ASP.NET MVC Unit test pattern design,<unit-testing><microsoft-fakes><fakeiteasy>,"<p>Anybody can suggest some good guideline or pattern for design asp.net mvc unit test.</p>

<p>I am new to mvc unit test framework design.</p>

<p>I have checked Microsoft fake,  Moq,  Fakeiteasy. But more preferable is Microsoft fake. Can you please suggest any good book or article from where I can get an idea how to handle cookies, session, controller, security  and action filter </p>

<p>Thanks</p>
",-1,240,2015-03-05 19:41,,1,2,what
62199135,Spying module and mocking module function,<reactjs><testing><mocking><jestjs><enzyme>,"<p>I'm writing some tests for my component but I'm facing some troubles here...</p>

<p><strong>Here is my Game component:</strong></p>

<pre><code>import React from 'react';
import User from './User';
import Board from './Board';
import Deck from './Deck';

class Game extends React.Component {
  constructor(props) {
    super(props);
    this.board = new Board();
    this.deck = new Deck();

    //some more code
  }

  componentDidMount() {
    this.initializeUser(""xpto"");
    //some more code
  }

  //some more code

  initializeUser(name) {
    const user = new User(name, this.deck);
    //some more code

    user.pickCards();
    //some more code
  }

  //some more code

  render() {
    return (
      &lt;div className=""game-container""&gt;
          something to show
          &lt;div id=""deck""&gt;&lt;/div&gt;
      &lt;/div&gt;
    );
  }
}


Game.propTypes = {
};

Game.defaultProps = {
};

export default Game;
</code></pre>

<p><strong>My Board class:</strong></p>

<pre><code>export default class Board {
  //some code
}
</code></pre>

<p><strong>My Deck class:</strong></p>

<pre><code>export default class Deck {
  constructor(props) {
    //some more code

    this.cardsLeft = 52;
    this.lastPick = 0;

    //some more code
  }

  pickCards() {
    this.lastPick = 4;
    this.cardsLeft -= this.lastPick;
    const deckElem = document.getElementById(""deck"");
    deckElem.innerHTML = this.cardsLeft;
    return this.lastPick;
  }

  //some more code
}
</code></pre>

<p><strong>My User class:</strong></p>

<pre><code>class User {
  constructor(name, deck) {
    this.name = name;
    this.tableDeck = deck;
    this.cards = 0;
    //some more code
  }

  //some more code

  pickCards() {
    const newCards = this.tableDeck.pickCards();
    this.cards += newCards;
    //some code
  }

  //some more code
}

export default User;
</code></pre>

<p>Now, at my tests I'm trying to test if the <code>Board</code> and <code>User</code> are called and if the <code>pickCards()</code> is called too.</p>

<p><strong>Here are my tests:</strong></p>

<pre><code>import React from 'react';
import { mount } from 'enzyme';
import Game from './Game';
import User from './User';
import Board from './Board';

describe('Game start', () =&gt; {
  let container;

  beforeEach(() =&gt; {
    container = document.createElement('div');
    document.body.appendChild(container);
  });

  afterEach(() =&gt; {
    document.body.removeChild(container);
    container = null;
  });

  it(""test where I'm having problems"", () =&gt; {
    const boardSpy = jest.spyOn(Board, 'constructor'),
      userSpy = jest.spyOn(User, 'constructor'),
      pickCardMock = jest.fn();

    User.pickCard = pickCardMock;

    const wrapper = mount(&lt;Game /&gt;, { attachTo: container });

    expect(boardSpy).toHaveBeenCalledTimes(1);
    expect(userSpy).toHaveBeenCalledTimes(1);
    expect(pickCardMock).toHaveBeenCalledTimes(1);

    //some more code
  });

  it(""example test where I need to test everything without mocks"", () =&gt; {
    const wrapper = mount(&lt;Game /&gt;, { attachTo: container });

    expect(wrapper.find(""#deck"").text()).toEqual('48');

    //some code
  });

  //some more tests
});
</code></pre>

<p>I don't want to mock <code>Board</code> and <code>User</code> because I need everything work normally on it. But I want to spy them to check if they were really called. And I want to mock <code>pickCard()</code> from <code>User</code>.</p>

<p>I already tried to use <code>jest.mock('./board');</code> and <code>require('board')</code> (for example) only inside my <code>it()</code> test but it didn't work. And now I'm trying to spy the components constructors.</p>

<p>But the <code>expect(boardSpy).toHaveBeenCalledTimes(1)</code> fails saying that was called 0 times and not 1 time.</p>

<p>And the <code>pickCardMock</code> seems not being linked to the <code>User</code> module because when debugging <code>pickCard</code> is a normal function and not a mock function and <code>expect(pickCardMock).toHaveBeenCalledTimes(1)</code> receives 0 too instead of 1.</p>

<p>Anyone knows how to solve these two problems (spy a module and mock a function in another module)?</p>

<p><strong>Again:</strong> </p>

<blockquote>
  <p><em>I don't want to mock things for the whole test suite, I just want to</em>
  <em>mock for a single test (and I want to be able to spy a module call).</em></p>
</blockquote>

<p>You can find all this code <a href=""https://github.com/Ninita1/SpyAndMockForTests"" rel=""nofollow noreferrer"">here</a>.</p>
",5,2096,2020-06-04 16:03,,3,3,how
24239472,Gmock Element Matcher for Container of Pointers,<c++><pointers><containers><googlemock><matcher>,"<p>In my unit tests, I want to test that a <code>GameLauncher</code> creates a <code>Game</code> containing some <code>Object</code>s, based on <code>CharacterSelections</code>. In Java-flavoured pseudocode, the test would be:</p>

<pre><code>Game game = gameLauncher.createGame(characterSelections);

assertThat(game.getObjects(), containsInAnyOrder(c1, c2, c3));
</code></pre>

<p>As I am working in c++, <code>game-&gt;getObjects()</code> returns a <code>vector&lt;Object*&gt;</code>. I am using a vector of pointers as <code>Object</code> is a polymorphic type.</p>

<p><a href=""https://code.google.com/p/googlemock/wiki/CheatSheet#Container_Matchers"" rel=""nofollow"">GMock#ContainerMatchers</a> gives a list of matchers for containers. Since STL containers use the <code>operator==</code> to determine equality between its elements (see <a href=""https://github.com/azriel91/cpp-container-equality"" rel=""nofollow"">github/cpp-container-equality</a>), I cannot simply use UnorderedElementsAre(...) as this will perform pointer comparisons.</p>

<p>What are my options?</p>

<pre><code>// redacted includes

class GameLauncherTest : public testing::Test {
    // ... redacted ...
};

TEST_F(GameLauncherTest, launchesGameWithCharacterInstanceForSelectedCharacters) {
    auto const characterSelections = new CharacterSelections();
    characterSelections-&gt;add(new CharacterSelection(0, false, 1));
    characterSelections-&gt;add(new CharacterSelection(3, false, 0));
    characterSelections-&gt;add(new CharacterSelection(2, true, 1));

    Game* const game = this-&gt;gameLauncher-&gt;launchGame(characterSelections);

    auto const character0 = new Character(0, objectData1);
    auto const character1 = new Character(1, objectData0);
    auto const character2 = new Character(2, objectData1);

    const vector&lt;Object*&gt; inGameObjects = game-&gt;getObjects();

    // fails
    EXPECT_THAT(inGameObjects, UnorderedElementsAre(character0, character1, character2));

    delete character0;
    delete character1;
    delete character2;
    delete characterSelections;
}
</code></pre>
",0,4141,2014-06-16 8:32,,1,1,what
59983087,How to Mock the return object,<c++><unit-testing><googletest><googlemock>,"<p>I try to mock a User class and its nested struct UserBuilder:</p>

<pre><code>class User
{
  public:
        virtual int loadData(const std::string&amp; filename);
        virtual UserBuilder getUserBuilder(const std::string&amp; functionName) const;

        struct UserBuilder
       {
        UserBuilder(std::string functionName) : m_functionName{functionName} {};
        virtual ~UserBuilder();
        virtual UserBuilder&amp; fun1();
        virtual UserBuilder&amp; fun2(int32_t num);
        virtual bool callFunction();
       private:
        std::string m_functionName{};
      };
}
</code></pre>

<p>This is the mock class for User:</p>

<pre><code>class UserMock : public User
{
public:
    MOCK_METHOD1(loadData, int(const std::string&amp; filename));
    MOCK_CONST_METHOD1(getUserBuilder, UserBuilder(const std::string&amp; functionName));
};
</code></pre>

<p>Thsi is the mock class for UserBuilder:</p>

<pre><code>struct UserBuilderMock : public User::UserBuilder
{
public:
    UserBuilderMock(std::string functionName) : User::UserBuilder(functionName) {}
    MOCK_METHOD0(fun1, UserBuilder&amp;());
    MOCK_METHOD1(fun2, UserBuilder&amp;(int32_t num));
    MOCK_METHOD0(callFunction, bool());
};
</code></pre>

<p>I want to test this function:</p>

<pre><code>void useCase(std::unique_ptr&lt;User&gt; userP)
{   
    int status = userP-&gt;loadFile(""init"");
    if (status == 0)
    {
        User::UserBuilder builder = userP-&gt;getUserlBuilder(""init"");
        bool result = builder.fun1().fun2(1).callFunction();
        return result;
    }
    else
    {
        return false;
    }
}
</code></pre>

<p>I give the getUserBuilder(""init"") a mock object builderMock as its return value, like this:</p>

<pre><code>auto userMock = std::make_unique&lt;UserMock&gt;();
ON_CALL(*userMock, loadFile(""init"")).WillByDefault(Return(0));
UserBuilderMock builderMock(""init"");
EXPECT_CALL(*userMock, getUserBuilder(""init"")).WillOnce(ReturnPointee(&amp;builderMock));
EXPECT_CALL(builderMock,fun1()).Times(1);
</code></pre>

<p>The test log fail: fun1 never called-unsatisfied and active.
I want to use the builderMock object to call the mock method fun1,fun2 and callFunction, but it still use the real UserBuilder object
call the real fun1,fun2 and callFunction. What should I do to make it use Mock object call the Mock method?</p>
",0,1480,2020-01-30 9:46,,1,2,what
20195863,Stub Method and Dynamically Set its Return Value to an Input Parameter,<ios><mocking><kiwi>,"<p>I'd like to dynamically return a value dependent of a parameter to a mocked method, conceptionally like this:</p>

<pre><code>[realObject stub] myMethod:CAPTUREDARGUMENT) andReturn:myMethod:CAPTUREDARGUMENT];
</code></pre>

<p>Or access the invocation in a block like with OCMock:</p>

<pre><code>void (^theBlock)(NSInvocation *) = ^(NSInvocation *invocation) {
    /* code that reads and modifies the invocation object */
};
[[[mock stub] andDo:theBlock] someMethod:[OCMArg any]];
</code></pre>

<p>Is that possible with Kiwi?</p>
",1,800,2013-11-25 14:42,,2,0,what
42363292,How can I implement unit tests in big and complex classes?,<c#><unit-testing><nunit><moq>,"<p>I'm implementing unit tests in a finance system that involves several calculations. One of the methods, receives an object by parameter with more than 100 properties, and based on this object's properties, it calculates the return.
In order to implement unit tests for this method, <strong>I need to have all of this object filled with valid values.</strong><br/><br/>
So...question: today this object is populated via database. On my Unit Tests (I'm using NUnit), I'd need to avoid the database and create a mock object of that, to test only the method's return. How can I efficiently test this method with this huge object? Do I really need to manually fill all of the 100 properties of it?
Is there a way to automatize this object creation using Moq (for example)?
<br/><br/>
obs: I'm writing unit tests for a system that is already created. It's not feasible to re-write all the architecture at this moment.
<br/>
Thanks a million!</p>
",22,7678,2017-02-21 9:22,,6,6,what
57359102,"How to create “FTPS” Mock Server for unit test in Java, Getting Error - javax.net.ssl.SSLException: 502 Command not implemented: AUTH",<java><mocking><ftps><apache-commons-net>,"<p>I need to mock ""FTPS"" server as part of unit testing. I am getting ""javax.net.ssl.SSLException: 502 Command not implemented: AUTH"" via using mock FTPS Server.</p>

<p>I went through <a href=""http://mockftpserver.sourceforge.net/"" rel=""nofollow noreferrer"">http://mockftpserver.sourceforge.net/</a> and <a href=""https://stackoverflow.com/questions/14042033/how-to-create-a-ftps-mock-server-to-unit-test-file-transfer-in-java"">How to create a &quot;FTPS&quot; Mock Server to unit test File Transfer in Java</a> but didn't find a way to connect as FTPS server. </p>

<pre class=""lang-java prettyprint-override""><code>import java.io.File;

import org.apache.commons.net.ftp.FTP;
import org.apache.commons.net.ftp.FTPFile;
import org.apache.commons.net.ftp.FTPSClient;
import org.mockftpserver.fake.FakeFtpServer;
import org.mockftpserver.fake.UserAccount;

public class FtpsMockTest {
    private FakeFtpServer fakeFtpServer;

    public FtpsMockTest(int port, String userName, String password, File homeDir){
        fakeFtpServer = new FakeFtpServer();
        fakeFtpServer.setServerControlPort(port);
        fakeFtpServer.addUserAccount(new UserAccount(userName, password, homeDir.getAbsolutePath()));
    }

    public static FTPSClient createFtpsClient(String hostname, Integer port, String username, String password)
            throws Exception {

        FTPSClient ftpsClient = new FTPSClient(""TLS"", false);

        ftpsClient.connect(hostname, port);
        ftpsClient.enterLocalPassiveMode();

        boolean loginStatus = ftpsClient.login(username, password);
        if (!loginStatus) {
            throw new Exception(""FTPS client login failed."");
        }

        ftpsClient.execPBSZ(0);
        ftpsClient.execPROT(""P"");
        ftpsClient.setFileType(FTP.BINARY_FILE_TYPE);
        ftpsClient.setFileTransferMode(FTP.STREAM_TRANSFER_MODE);

        return ftpsClient;
    }

    public static void main(String[] args) throws Exception {
        FtpsMockTest test = null;
        try {
            test = new FtpsMockTest(990, ""test"", ""test"", new File(""C:\\FuncTest""));
            test.start();

            FTPSClient ftpsClient = createFtpsClient(""127.0.0.1"", 990, ""test"", ""test"");
            FTPFile[] listFiles = ftpsClient.listFiles(""C:/Test"");
            System.out.println(""*** total available files ***"" + listFiles.length);
        }finally {
            test.stop();
        }
    }

    public void start(){
        fakeFtpServer.start();
        System.out.println(""**** FAKE FTPS Server Started ***"");
    }

    public void stop(){
        fakeFtpServer.stop();
        System.out.println(""**** FAKE FTPS Server Stopped ***"");
    }
}
</code></pre>

<p>I used above code to connect FTPS server, but i am getting below error. Could you please provide any input to solve below error.</p>

<pre><code>Exception in thread ""main"" javax.net.ssl.SSLException: 502 Command not implemented: AUTH.

    at org.apache.commons.net.ftp.FTPSClient.execAUTH(FTPSClient.java:214)
    at org.apache.commons.net.ftp.FTPSClient._connectAction_(FTPSClient.java:196)
    at org.apache.commons.net.SocketClient.connect(SocketClient.java:164)
    at org.apache.commons.net.SocketClient.connect(SocketClient.java:184)
    at com.asos.mule.core.connector.ftps.functional.FtpsMockTest.createFtpsClient(FtpsMockTest.java:25)
    at com.asos.mule.core.connector.ftps.functional.FtpsMockTest.main(FtpsMockTest.java:47)
</code></pre>
",3,1591,2019-08-05 12:59,,1,0,how
59796255,"requests-mock decorator pattern throwing a ""fixture 'm' not found"" error with pytest",<python-requests><mocking><pytest><python-decorators><requests-mock>,"<p>I'm making an HTTP GET request using the <a href=""https://2.python-requests.org/en/master/"" rel=""noreferrer"">requests</a> library. For example (truncated):</p>

<pre class=""lang-py prettyprint-override""><code>requests.get(""http://123-fake-api.com"")
</code></pre>

<p>I've written a test following the <a href=""https://requests-mock.readthedocs.io/en/latest/mocker.html#decorator"" rel=""noreferrer"">requests-mock decorator</a> pattern.</p>

<pre class=""lang-py prettyprint-override""><code>import requests
import requests_mock


@requests_mock.Mocker()
def test(m):
    m.get(""http://123-fake-api.com"", text=""Hello!"")

    response = requests.get(""http://123-fake-api.com"").text

    assert response.text == ""Hello!""
</code></pre>

<p>When I run the test with <a href=""https://docs.pytest.org/en/latest/"" rel=""noreferrer"">pytest</a>, I get the following error.</p>

<pre><code>E       fixture 'm' not found
</code></pre>

<p>Why is the requests-mock decorator throwing a ""fixture 'm' not found"" error? And how do I resolve it?</p>
",10,11146,2020-01-17 23:55,,1,4,how
6973242,Mimic another Ruby class so the object passes the === type check,<ruby><class><types><mocking>,"<p>I want to create an object that acts as a specific class, such as Fixnum, but isn't an instance of that class nor its subclasses.</p>

<p>There are various use-cases for this. In the Fixnum case, I want to define a more specific integer type that is essentially a Fixnum but implements some extra logic, too. I can't subclass Fixnum itself because immediate types such as Fixnum and Symbol can't be subclassed.</p>

<p>Another use-case is mocking in automated tests: sometimes you want to create an object that acts like a certain class (usually a model instance) but is for technical reasons not an instance of that exact class.</p>

<p>Here's how to create a specific integer type that delegates all methods to an internally stored fixnum:</p>

<pre><code>require 'delegate'
require 'forwardable'

# integer representing a page number
class PageNumber &lt; DelegateClass(Integer)
  extend Forwardable

  def initialize(value, name)
    @name = name
    super(value)
  end

  def inspect
    ""#{@name} #{to_i}""
  end

  alias_method :to_i, :__getobj__
  def_delegators :to_i, :instance_of?, :kind_of?, :is_a?
end
</code></pre>

<p>This object can pass <code>is_a?</code> and similar checks:</p>

<pre><code>page = PageNumber.new(1, ""page"")
page.is_a? Fixnum  #=&gt; true
</code></pre>

<p>But nothing I do can make it pass the <a href=""http://ruby-doc.org/core-1.8.7/classes/Module.html#M000203"" rel=""noreferrer""><code>Module#===</code></a> type check:</p>

<pre><code># my problem:
Fixnum === page    #=&gt; false
</code></pre>

<p>The fact that my object fails this check is very unfortunate, since the <code>===</code> method is used internally in <code>case</code> statements:</p>

<pre><code>case page
when Fixnum
  # it will never get here
when String
  # ...
else
  # ...
end
</code></pre>

<p>My question is how can I create a mock type that passes the <code>===</code> check <em>without</em> augmenting the <code>===</code> methods on built-in classes?</p>
",10,1464,2011-08-07 13:57,,2,3,how
54986885,Using jsonPath property in json schema returns a random string instead of the value in the given path,<javascript><json><mocking><jsonschema><faker>,"<p>Continuing from my <a href=""https://stackoverflow.com/questions/54940463/how-to-use-reference-field-values-generated-in-the-same-json-schema"">previous unresolved issue</a>, I am using <code>json-schema-faker</code> and <code>json-server</code> and i am currently trying to reuse some data from my json schema.</p>

<p>I have found  the property: <code>jsonPath</code> from <a href=""https://github.com/json-schema-faker/json-schema-faker/issues/11"" rel=""nofollow noreferrer"">this</a> page in Github which explains exactly what I am trying to do and what my problem is.</p>

<p>I am trying to test this property from my JavaScript application which generates these data and also from the <a href=""https://json-schema-faker.js.org/"" rel=""nofollow noreferrer"">json-schema-faker site</a> which is the library I use. Using this property using any of the above ways, returns a random string instead of the id I am referring to ( <code>""jsonPath"": ""$..properties.test.items.properties.id""</code>)</p>

<p><a href=""https://i.sstatic.net/8jKxM.png"" rel=""nofollow noreferrer""><img src=""https://i.sstatic.net/8jKxM.png"" alt=""enter image description here""></a></p>

<p>Validating using <a href=""https://jsonpath.curiousconcept.com/#"" rel=""nofollow noreferrer"">this</a> site, causes no issues and the value I am trying to re-use is picked up correctly using the <code>jsonPath</code>.</p>

<p>Is there anything I should import in my JavaScript code/mock data generator or what I am trying to do is not supported perhaps by the json-schema version? </p>

<p>Some of the paths I have tried to use are:</p>

<p><code>$..id
$..test.items.properties.id
$..test.id
</code></p>

<p>This is my json schema:</p>

<pre><code>{
  ""title"": ""teest"",
  ""type"": ""object"",
  ""required"": [
    ""test""
  ],
  ""properties"": {
    ""test"": {
      ""type"": ""array"",
      ""minItems"": 1,
      ""maxItems"": 3,
      ""uniqueItems"": true,
      ""items"": {
        ""type"": ""object"",
        ""required"": [
          ""id"",
          ""samples""
        ],
        ""properties"": {
          ""id"": {
            ""type"": ""string"",
            ""enum"": [
              ""1,"",
              ""2"",
              ""3""
            ]
          },
          ""samples"": {
            ""type"": ""array"",
            ""uniqueItems"": true,
            ""items"": {
              ""type"": ""object"",
              ""properties"": {
                ""test2"": {
                  ""type"": ""string"",
                  ""jsonPath"": ""$..properties.test.items.properties.id""
                }
              }
            }
          }
        }
      }
    }
  }
}
</code></pre>

<p>I would appreciate any help with this as I can't find anything online, and I really don't want to mock these data using hard-coded values.</p>
",1,2581,2019-03-04 15:55,,1,2,what
20923919,How do i use should_receive with [] on hashes?,<ruby><rspec><mocking>,"<p>I want to test that the <code>tags</code> object receives the method <code>[:artist]</code>.</p>

<pre><code>def artist
  @tagger.tags(@mp3)[:artist]
end
</code></pre>

<p>I'm trying something like this.</p>

<pre><code>tagger = double(""tagger"")
tags.tagger = tagger
tagger.stub(:tags) { Hash.new }
tagger.tags.stub(:[])

tagger.should_receive(:tags).with(mp3)
tagger.tags.should_receive('[:artist]')

tags.artist
</code></pre>

<p>This causes a syntax error because rspec tries to create a method like:</p>

<pre><code>def [:artist]
</code></pre>

<p>which is not valid syntax.</p>

<p>Is there a valid way to do this?</p>
",0,46,2014-01-04 17:01,,1,0,what
47150973,During TDD how to test following scenarios,<unit-testing><tdd><moq>,"<p>Trying to adopt TDD for development but there are some scenarios in which I was out of best options, how to write the code and test them.</p>

<p>Following are the code scenarios:</p>

<ol>
<li><p>There is a public method say Initialize(), it initializes only private members of class. How to test this method if it is working fine or not.</p></li>
<li><p>There is a private method say DoSomething() and is being called by 2 pubic method of same class Caller1() and Caller2(). While writing unit test for these two methods I cannot mock DoSomething() since its private, but this method code will be tested two times.
How to write code/test in such scenarios?</p></li>
<li><p>There is a public method DoSomething() which is being called form another public method Caller(). DoSomething() initialize a private member which is then used inside Caller(). I can mock DoSomething() while testing Caller() but wont be able to set data in the private member.
How to write code/test in this scenarios?</p></li>
</ol>

<p>I will update more scenarios in case I face any.</p>
",-1,95,2017-11-07 6:02,,2,1,how
24141580,mock static without @RunWith(PowerMockRunner.class),<java><junit><mocking><mockito><powermock>,"<p>I have folowing code:</p>

<pre><code>        @RunWith(PowerMockRunner.class)
        @PrepareForTest({RequestUtils.class, OsgiUtil.class})
        @PowerMockIgnore({""*""})
        public class MyTest
            ...
             @Test
             public somMethod(){    
                ....  
                mockStatic(RequestUtils.class);
                when(RequestUtils.getLocale(request)).thenReturn(locale);
            }
        }  
</code></pre>

<p>How to replace this code so that it work without <code>@RunWith(PowerMockRunner.class)</code>?</p>

<p>According the cause described in following <a href=""https://stackoverflow.com/questions/2454473/junit-parameterized-tests-together-with-powermock-how"">link</a> I cannot use <code>@RunWith(PowerMockRunner.class)</code></p>
",5,10224,2014-06-10 12:56,,1,2,how
30531335,EasyMock : static method and 'missing behavior definition for the preceding method call'?,<easymock>,"<p>I have the following core class MessagesUtil, which returns a message string from a specific bundle based on a locale - all the getMessage() methods are static</p>

<pre><code>public class MessagesUtil { ..

    public static String getMessage(HttpServletRequest request, String key, String bundle) {
        MessageResources resources = (MessageResources)request.getAttribute(bundle);
        String message = resources.getMessage((Locale)request.getSession().getAttribute(""org.apache.struts.action.LOCALE""), key);
        return message;
    }
}
</code></pre>

<p>I'm trying to write a unit test which coverage a business class which calls the MessageUtils object. The same test code below shows how i'm mocking the request and session, to return the MessageResources and then specific message keys</p>

<pre><code>import com.infonova.easymock.annotation.Mock;
import org.apache.struts.util.MessageResources;
import org.junit.Assert;
import org.junit.Test;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import java.util.Locale;

import static org.easymock.EasyMock.expect;

public class MappingsUtilsEasyMockTest {

    @Mock
    private HttpServletRequest request;

    @Mock
    private HttpSession session;

    @Mock
    private MessageResources messageResources;

    @Test
    public void mockMessagesUtilTests() {

        String key = ""ordermanagement.error.general"";

        expect(request.getAttribute(""CustomerManagementResources"")).andReturn(messageResources);
        // the locale
        Locale locale = Locale.ENGLISH;
        expect(session.getAttribute(""org.apache.struts.action.LOCALE"")).andReturn(locale);
        // the locale specific String from the message Resource
        expect(messageResources.getMessage(locale, key)).andReturn(""this_is_the_result"");

        Assert.assertEquals(MessagesUtil.getMessage(
                        request, key, CustomerManagementConstants.BUNDLE_NAME),
                ""this_is_the_result"");
    }
}
</code></pre>

<p>I get this exception</p>

<pre><code>java.lang.IllegalStateException: missing behavior definition for the preceding method call:
HttpServletRequest.getAttribute(""CustomerManagementResources"")
Usage is: expect(a.foo()).andXXX()
    at org.easymock.internal.MockInvocationHandler.invoke(MockInvocationHandler.java:42)
    at org.easymock.internal.ObjectMethodsFilter.invoke(ObjectMethodsFilter.java:85)
    at com.sun.proxy.$Proxy10.getSession(Unknown Source)
</code></pre>

<p>but i am setting the 'getAttribute(""CustomerManagementResources"")' field in the test setup.</p>

<p>Note - I have tried adding</p>

<pre><code>replay();
</code></pre>

<p>before i call the target method but there is no difference.</p>
",2,7183,2015-05-29 13:49,,1,0,other
68754394,Replace URL during build step of npm,<javascript><rest><npm><mocking><release>,"<p>I've a mock REST service during development and a real backend I want to use for the public release. Is there a way to replace the endpoint URL somehow during the npm build step?</p>
",0,367,2021-08-12 8:57,,1,0,what
45941260,Mocking a Go database SDK,<go><mocking>,"<p>I am attempting to create a wrapper for test emulating around the <a href=""https://godoc.org/cloud.google.com/go/datastore"" rel=""nofollow noreferrer"">Go Flex SDK for Google Cloud Datastore</a>. While I am currently successfully running the localhost emulator using</p>

<pre><code>gcloud beta emulators datastore start --no-store-on-disk
</code></pre>

<p>in a separate terminal from my testing window, I would prefer to create a mock database emulator that runs as part of the test process itself (without <code>exec</code>ing the above) so that I can run multiple tests in parallel, each with its own database emulator.</p>

<p>I have run into a problem with the Google SDK not implementing my interface.</p>

<p>My wrapper contains this code:</p>

<pre><code>package google

import (
    ""context""

    ""cloud.google.com/go/datastore""
)

type (
    // Datastore is a wrapper for the Google Cloud Datastore Client.
    Datastore datastore.Client

    // Datastorer represents things that can operate like a datastore.Client.
    Datastorer interface {
        Delete(context.Context, *datastore.Key) error
        Get(context.Context, *datastore.Key, interface{}) error
        GetAll(context.Context, *datastore.Query, interface{}) ([]*datastore.Key, error)
        Put(context.Context, *datastore.Key, interface{}) (*datastore.Key, error)
        PutMulti(context.Context, []*datastore.Key, interface{}) ([]*datastore.Key, error)
        RunInTransaction(context.Context, func(Transactioner) error, ...datastore.TransactionOption) (*datastore.Commit, error)
    }

    // Transactioner represents things that can operate like a datastore.Transaction.
    Transactioner interface {
        Commit() (*datastore.Commit, error)
        Delete(*datastore.Key) error
        DeleteMulti([]*datastore.Key) error
        Get(*datastore.Key, interface{}) error
        GetMulti([]*datastore.Key, interface{}) error
        Put(*datastore.Key, interface{}) (*datastore.PendingKey, error)
        PutMulti([]*datastore.Key, interface{}) ([]*datastore.PendingKey, error)
        Rollback() error
    }
)

// Delete deletes the entity for the given key.
func (d *Datastore) Delete(ctx context.Context, key *datastore.Key) error {
    return (*datastore.Client)(d).Delete(ctx, key)
}

// Get retrieves the entity for the given key.
func (d *Datastore) Get(ctx context.Context, key *datastore.Key, dst interface{}) error {
    return (*datastore.Client)(d).Get(ctx, key, dst)
}

// GetAll retrieves all entities for the given query.
func (d *Datastore) GetAll(ctx context.Context, q *datastore.Query, dst interface{}) ([]*datastore.Key, error) {
    return (*datastore.Client)(d).GetAll(ctx, q, dst)
}

// Put stores an entity for the given key.
func (d *Datastore) Put(ctx context.Context, key *datastore.Key, src interface{}) (*datastore.Key, error) {
    return (*datastore.Client)(d).Put(ctx, key, src)
}

// PutMulti is a batch version of Put.
func (d *Datastore) PutMulti(ctx context.Context, keys []*datastore.Key, src interface{}) ([]*datastore.Key, error) {
    return (*datastore.Client)(d).PutMulti(ctx, keys, src)
}

// RunInTransaction runs the given function in a transaction.
func (d *Datastore) RunInTransaction(ctx context.Context, f func(tx Transactioner) error, opts ...datastore.TransactionOption) (*datastore.Commit, error) {
    return (*datastore.Client)(d).RunInTransaction(ctx, func(t *datastore.Transaction) error {
        return f(t)
    }, opts...)
}
</code></pre>

<p>Note that these interfaces do not emulate the complete SDK. I am only including functions that I actually call in my code. I'll add new ones as needed later.</p>

<p>When I try to use an instance of <code>*datastore.Client</code> as a <code>Datastorer</code>, I get the following error:</p>

<pre><code>cannot use client (type *""cloud.google.com/go/datastore"".Client) as type Datastorer in field value:
    *""cloud.google.com/go/datastore"".Client does not implement Datastorer (wrong type for RunInTransaction method)
        have RunInTransaction(context.Context, func(*""cloud.google.com/go/datastore"".Transaction) error, ...""cloud.google.com/go/datastore"".TransactionOption) (*""cloud.google.com/go/datastore"".Commit, error)
        want RunInTransaction(context.Context, func(Transactioner) error, ...""cloud.google.com/go/datastore"".TransactionOption) (*""cloud.google.com/go/datastore"".Commit, error)
</code></pre>

<p>because <code>*datastore.Client</code> requires a function that takes a <code>func(*datastore.Transaction) error</code> and my interface wants a <code>func(Transactioner) error</code>.</p>

<p>Is there any way to change this so that it compiles?</p>

<p>If I can get it working, I plan to create types that implement my <code>Datastorer</code> and <code>Transactioner</code> interfaces and use maps to mock the real database. As far as tranactions go, for testing I can use <code>sync.Mutex</code> if I need them, but since each test is a single thread and will get its own database object, I may not need to lock them.</p>
",3,1224,2017-08-29 14:07,,2,2,what
10382560,Mocking System.Web.Caching.Cache - Mock or check for null?,<c#><unit-testing><caching><design-patterns><moq>,"<p>I'm writing some unit test and am wondering whether it's advantageous to mock the <code>Cache</code> and if so, how?</p>

<p>Currently in my tests I'm mocking out the <code>HttpContextBase</code> and wrapping it in a custom <code>HttpContextFactory</code>:</p>

<pre><code>var mockedHttpContextBase = new Mock&lt;HttpContextBase&gt;();

IHttpContextFactory httpContextFactory = new HttpContextFactory 
{ 
     Current = mockedHttpContextBase.Object 
};
</code></pre>

<p>and when my code consumes an <code>IHttpContextFactory</code> I check if the cache is null before doing anything with it.</p>

<pre><code>var cache = _httpContextFactory.Current.Cache;

Func&lt;SomeReturnType&gt; doSomeWork = () =&gt; _foo.someMethodIExecute(param1,param2);

return cache != null ? cache.GetOrStore(""doSomeWorkCacheKey"",doSomeWork, 900) 
                     : doSomeWork.Invoke();
</code></pre>

<p>Is it right to check for the cache being null like this each time I use it or would you mock the cache also in the test so that it's not null when running your unit tests?</p>
",8,6335,2012-04-30 10:59,,3,0,how
32860907,Unit Testing using Moq,<c#><mocking>,"<p>This is a method under my controller which is used to create dummy keys to encrypt the data in the application and store the same in the amazon s3 bucket.</p>

<pre><code>public JsonResult SaveMasterKeys(string MekText, int Thismek)
        {
            string folderName = string.Empty, fileName = string.Empty;
            List&lt;string&gt; folderNameList = new List&lt;string&gt;();
            folderNameList.Add(""Guard1"");
            folderNameList.Add(""Guard2"");
            try
            {
                if (Thismek == 1)
                {
                    folderName = ""Guard1"";
                    fileName = ""NewMek1.key"";
                }
                else
                {
                    folderName = ""Guard2"";
                    fileName = ""NewMek2.key"";
                }
                AWSS3File aws = new AWSS3File();

                //aws.BucketExist(filePath);
                //aws.CreateFile(MekText, filePath);
                // Check Weather the Folder is exist or not

                if (!aws.CheckFolderExist(folderName))
                {
                    foreach (var item in folderNameList)
                    {
                        aws.CreateFolder(item);
                        if (item == ""Guard1"")
                        {
                            aws.CreateFileIntoS3((item == folderName ? MekText : """"), item, ""NewMek1.key"");
                            aws.CreateFileIntoS3("""", item, ""Mek1.key"");
                        }
                        else
                        {
                            aws.CreateFileIntoS3((item == folderName ? MekText : """"), item, ""NewMek2.key"");
                            aws.CreateFileIntoS3("""", item, ""Mek2.key"");
                        }
                    }
                }
                else
                {
                    aws.CreateFileIntoS3(MekText, folderName, fileName);
                }
                ViewData[""SaveMessage""] = ""Saved successfully."";
            }
            catch (Exception ex)
            {
                XTP.Logger.LogCritical(""XTP.Web.internaltools"", ex.ToString());
                ViewData[""SaveMessage""] = ""Keys not updated successfully."";
            }
            return Json(new { success = true, value = ViewData[""SaveMessage""] }, JsonRequestBehavior.AllowGet);
        }
</code></pre>

<p>And this is the TESTMETHOD I have written for the same</p>

<pre><code>[TestMethod]
        public void MockAlways()
        {
            var mock = new Mock&lt;AccountController&gt;();
            JsonResult json = new JsonResult();
            //new { success = true, value = ViewData[""SaveMessage""] }, JsonRequestBehavior.AllowGet
            json.Data = new { success = true, value = ""sa"" };
            json.JsonRequestBehavior = JsonRequestBehavior.AllowGet;


            mock.Setup(x =&gt; x.SaveMasterKeys(""ss"", 1)).Returns(json);

            var controller = new AccountController();
            var result = controller.SaveMasterKeys(""ss"", 1) as JsonResult;

            Assert.AreEqual(mock.Object.SaveMasterKeys(""ssxs"", 1), result.Data.ToString());
        }
</code></pre>

<p>I am getting an invalid setup error. Is there a way to resolve this error?</p>
",0,476,2015-09-30 8:02,,1,2,what
32864047,Make sure function cannot be called during tests,<python><unit-testing><mocking>,"<p>First of all: Feel free to tell me that this is an antipattern!</p>

<p>In my code, I have some functions responsible for calling external API's. This is a prime candidate for mocking in the tests to make sure that the external API is not hit when tests are run.</p>

<p>The thing is, the way mocking works in python (at least the way I have been taught), we mock a position in the imported module structure explicitly, e.g.</p>

<pre><code>import mymodule

def test_api():
    mocker.patch('mymodule.mysubmodule.json_apis.my_api_wrapper_function')
    [...]
</code></pre>

<p>This will mock out the <code>my_api_wrapper_function</code> function for the test. However, what if refactoring moves the function or renames it, etc.? If the test is not updated, it will most likely pass, AND the external API is hit, because the new location of the function has not been mocked.</p>

<p>I see two solutions to this question, but I am not sure how to implement any of them</p>

<ul>
<li>Mock stuff in a better way, so that I am sure not to have problems when refactoring</li>
<li>Create a decorator, which will wrap a function and raise an exception if the function is called in a test context (I suppose this depends on the test runner that is used? In my case, it is <code>pytest</code>)</li>
</ul>
",1,117,2015-09-30 10:42,,1,6,how
13287860,Unit Test Assert against end result or verifying whether the parameters were called using Moq,<unit-testing><mocking><moq><stubbing>,"<p>Below is a class (Class1) that I want to test, but I'm not fully satisfied with my Unit Test. Please see below code samples.</p>

<p>System Under Test</p>

<pre><code>public interface IRepository {
    string GetParameter(int id);
}

public class Repository {
    public string GetParameter(int id) {
        return ""foo"";
    }
}

public class ErrorInfo {
    public string ErrorCodes { get; set; }
}

public interface IErrorProvider {
    ErrorInfo BuildErrorMessage(string errorCodes);
}

public class ErrorProvider {
    public ErrorInfo BuildErrorMessage(string errorCodes) {
        return new ErrorInfo(){ErrorCodes = errorCodes};
    }
}

public class Class1 {
    private readonly IRepository _repository;
    private readonly IErrorProvider _errorProvider;
    public Class1(IRepository repository, IErrorProvider errorProvider) {
        _repository = repository;
        _errorProvider = errorProvider;
    }

    public List&lt;ErrorInfo&gt; GetErrorList(int id) {
        var errorList = new List&lt;ErrorInfo&gt;();
        string paramName = _repository.GetParameter(id);

        if (string.IsNullOrEmpty(paramName)) {
            string errorCodes = string.Format(""{0}, {1}"", 200, 201);
            var error = _errorProvider.BuildErrorMessage(errorCodes);
            errorList.Add(error);
        }

        return errorList;
    }
}
</code></pre>

<p>Unit Tests</p>

<p>Below test passes and we check whether the correct error codes being used within the system under test.</p>

<pre><code>[TestMethod]
public void GetErrorList_WhenParameterIsEmpty_ReturnsExpectedErrorCodes2() {
        //Arrange
        var stubRepo = new Mock&lt;IRepository&gt;();
        stubRepo.Setup(x =&gt; x.GetParameter(It.IsAny&lt;int&gt;())).Returns(string.Empty);

        var stubErrorMock = new Mock&lt;IErrorProvider&gt;();

        const int id = 5;
        var sut = new Class1(stubRepo.Object, stubErrorMock.Object);

        //Act
        var result = sut.GetErrorList(id);

        //Verify
        string verifiableErrorCodes = ""200, 201"";
        stubErrorMock.Verify(x =&gt; x.BuildErrorMessage(verifiableErrorCodes));
}
</code></pre>

<p>However I would prefer testing the end result. For example, I want to Assert against the error codes that have been used in the production code. Below test fails but I like to know your thoughts on how to Assert against the errorCodes that has been used in the system under test. </p>

<pre><code>[TestMethod]
public void GetErrorList_WhenParameterIsEmpty_ReturnsExpectedErrorCodes1() {
        //Arrange
        var stubRepo = new Mock&lt;IRepository&gt;();
        stubRepo.Setup(x =&gt; x.GetParameter(It.IsAny&lt;int&gt;())).Returns(string.Empty);

        string expectedErrorCodes = ""200, 201"";
        var stubErrorRepo = new Mock&lt;IErrorProvider&gt;();
        stubErrorRepo.Setup(e =&gt; e.BuildErrorMessage(It.IsAny&lt;string&gt;()));

        const int id = 5;
        var sut = new Class1(stubRepo.Object, stubErrorRepo.Object);

        //Act
        var result = sut.GetErrorList(id);

        //Assert
        Assert.AreEqual(expectedErrorCodes, result.Single().ErrorCodes);
}
</code></pre>

<p>What would be the correct way to test this error codes that has been used in the system?</p>
",0,275,2012-11-08 11:09,,2,0,what
10464375,Is it possible to inject mocks for testing purposes with AndroidAnnotations?,<android><unit-testing><mocking><ioc-container><android-annotations>,"<p>I haven't found any examples on how to do this.  I'm assuming it is not possible based on examples like this:</p>

<pre><code>@Bean(MyImplementation.class)
MyInterface myInterface;
</code></pre>

<p>where the class to inject is already determined.</p>
",8,4909,2012-05-05 17:41,,2,2,what
34423564,How to mock open differently depending on the parameters passed to open(),<python><unit-testing><mocking><file-access>,"<p>My question is how to mock open in python, such that it reacts differently depending on the argument open() is called with. These are some different scenario's that should be possible:</p>

<ul>
<li>open a mocked file; read preset contents, the basic scenario.</li>
<li>open two mocked files and have them give back different values for the read() method. The order in which the files are opened/read from should not influence the results.</li>
<li>Furthermore, if I call <code>open('actual_file.txt')</code> to open an actual file, I want the actual file to be opened, and not a magic mock with mocked behavior. Or if I just don't want the access to a certain file mocked, but I do want other files to be mocked, this should be possible.</li>
</ul>

<p>I know about this question: <a href=""https://stackoverflow.com/questions/26783678/python-mock-builtin-open-in-a-class-using-two-different-files"">Python mock builtin &#39;open&#39; in a class using two different files</a>.
But that answer only partially answers up to the second requirement. The part about order independent results is not included and it does not specify how to mock only some calls, and allow other calls to go through to the actual files (default behavior).</p>
",2,3878,2015-12-22 19:59,,2,3,how
58151010,"Difference between resetAllMocks, resetModules, resetModuleRegistry, restoreAllMocks in Jest",<javascript><unit-testing><mocking><jestjs>,"<p>I'm trying to wrap my head around the following in Jest: </p>

<p><code>resetAllMocks</code>, <code>resetModules</code>, <code>resetModuleRegistry</code> and <code>restoreAllMocks</code> </p>

<p>and I'm finding it difficult. </p>

<p>I read the jest documentation but it's not too clear. I would appreciate it if someone can please provide me with an example of how the above work and they are different from each other.</p>
",156,95323,2019-09-28 23:21,,2,0,what
52306014,How to test a Laravel package that handles Eloquent models?,<php><laravel><unit-testing><eloquent><mocking>,"<p>I've created a package that manipulates eloquent models, and I've created test cases for it.</p>

<p>The package is supposed to call <code>save()</code> or <code>delete()</code> for the models, at some point, which would attempt to hit the database.</p>

<h3>Actual Database approach</h3>

<p>As first attempt <a href=""https://laracasts.com/discuss/channels/eloquent/how-to-test-package-that-relies-on-eloquent-mock-db"" rel=""noreferrer"">I tried this approach</a> and <a href=""https://laracasts.com/discuss/channels/guides/guide-how-to-run-integration-tests-from-a-package"" rel=""noreferrer"">also this</a>. The point is that in the context of a package (even using <code>orchestra/testbench</code>) I'd need to configure a database and migrations. Since the package itself does not have any model (but I've created a <em>dummy model</em> for test purposes) I see this approach as possibly overkill. In any case, I'd still accept to setup a prepared sqlite db in memory, which I also tried but could not make it work (It was attempting to use <code>forge</code> connection instead <code>sqlite</code> and I could not make it access another connection. I may provide details on what I did for it).</p>

<h3>Mocking approach</h3>

<p>Another possible attempt (as per my limited understanding on this) is to partially mock the model. But after I mocked it, it would not know how to handle other calls such as <code>fill()</code>, for which I was willing the common behavior, but I received a method not found exception.</p>

<h3>Method override approach</h3>

<p>Given that these two possible attempts went bad, I defaulted to a third possible approach which worked for me, but I'm honestly not sure if this is the way to go about it.</p>

<p>In order to avoid test failure due to lack of database when calling <code>save()</code> or <code>delete()</code> methods, I overrided them (<a href=""https://github.com/alariva/laravel-modelmerge/blob/master/tests/DummyContact.php"" rel=""noreferrer"">full source code here</a>) :</p>

<pre><code>class DummyContact extends Model
{
    // ...

    public function save(array $options = [])
    {
        $this-&gt;exists = true;
        $this-&gt;wasRecentlyCreated = true;
    }

    public function delete()
    {
        $this-&gt;exists = false;
        $this-&gt;wasRecentlyCreated = false;
    }
}
</code></pre>

<p>This way, I'm able to test the following code (<a href=""https://github.com/alariva/laravel-modelmerge/blob/master/src/ModelMerge.php"" rel=""noreferrer"">full source here</a>):</p>

<pre><code>public function unifyOnBase()
{
    $mergeModel = $this-&gt;merge();

    $this-&gt;modelA-&gt;fill($mergeModel-&gt;toArray());
    $this-&gt;modelA-&gt;save();
    $this-&gt;modelB-&gt;delete();

    return $this-&gt;modelA;
}
</code></pre>

<p>So my question is, is this approach acceptable? (I think it is fair, I don't see exceptional pitfalls, but I suspect there exist more elegant approaches). In case there are suggested approaches, like Mocking or using an actual DB for running the tests, I'd like to know <a href=""https://github.com/alariva/laravel-modelmerge/tree/master/tests"" rel=""noreferrer"">what adaptations should I do to my testing codebase</a> for taking them.</p>

<p><strong>Final but important note:</strong> I'm not willing to test models itself, I'm willing to test my code that uses (and thus depends on models).</p>
",6,2298,2018-09-13 2:55,,2,2,how
75214622,mock function from another module for testing,<typescript><mocking><mocha.js><chai><stub>,"<p>I'm using <code>Chai</code>, <code>Mocha</code> for testing in my project. I want to test the createTreefromFolder function from a module <code>tree.js</code>:</p>
<pre class=""lang-js prettyprint-override""><code>export function createTreefromFolder(path: string): string[] {
  const files = listFilesFromFolder(path);
  const tree: string[] = [createFirstBranch(path)];
  files.forEach((file) =&gt; {
    tree.push(Prefix.VERTICAL.concat(file));
  });
  return tree;
}
</code></pre>
<p>My goal is to mock <code>listFilesFromFolder</code> function in my test in order to return a specific value.</p>
<p>In the tests folder I have:</p>
<pre class=""lang-js prettyprint-override""><code>  it(&quot;creation of a unique folder tree&quot;, () =&gt; {
    const expectedArray: string[] = [&quot;🗃️ empty_folder&quot;];
    mock(&quot;src.tree.listFilesFromFolder&quot;).return_value = [&quot;empty_folder&quot;] // mock here
    expect(createTreefromFolder(empty_test_folder_path)).to.eql(expectedArray);
  });
</code></pre>
<p>Is there a way to do that as python do that with unitest.mock.patch ?</p>
",0,28,2023-01-23 20:17,,1,0,what
48666043,Mock method from the same class that tested method is using,<php><unit-testing><testing><codeception><mockery>,"<p>I have following code:</p>

<pre><code>class Foo() {
    public function someMethod() {
        ...
        if ($this-&gt;otherMethod($lorem, $ipsum)) {
            ...
        }
        ...
    }
}
</code></pre>

<p>and I'm trying to test the someMethod(), I don't want to test otherMethod() since it's quite complex and I have dedicated tests - here I would only like to mock it and return specific values.
So I tried to:</p>

<pre><code>$fooMock = Mockery::mock(Foo::class)
    -&gt;makePartial();
$fooMock-&gt;shouldReceive('otherMethod')
    -&gt;withAnyArgs()
    -&gt;andReturn($otherMethodReturnValue);
</code></pre>

<p>and in test I'm calling</p>

<pre><code>$fooMock-&gt;someMethod()
</code></pre>

<p>But it's using the original (not mocked) method otherMethod() and prints errors.</p>

<pre><code> Argument 1 passed to Mockery_3_Foo::otherMethod() must be an instance of SomeClass, boolean given
</code></pre>

<p>Could you help me please?</p>
",3,2900,2018-02-07 14:15,,1,3,how
54750544,Create manual mock for @material-ui withStyles in React with Jest,<javascript><reactjs><mocking><jestjs><material-ui>,"<p>I am trying to create manual mocks for the <code>@material-ui/core/styles</code> module, which exports the HOC called <code>withStyles</code>. </p>

<p>Using the inline mock with <code>jest.mock</code> works perfectly, but when I try to move this logic into sharable <code>__mocks__</code> folder, it does not work anymore. </p>

<p>I removed from the file being tested all the unecessary code, just keeping the two lines creating the issues:</p>

<pre><code>import { withStyles } from '@material-ui/core/styles';

console.log('loaded styles:', withStyles);

export default 'hello';
</code></pre>

<p>And the test simplified as well, just to see if the mock is working, is the following:</p>

<pre><code>import test from '../test';
console.log(test);
</code></pre>

<p>What I have tried is to create a <code>__mocks__</code> folder in the root of the project, where I have the <code>node_modules</code> folder. </p>

<p>There I created a first folder called <code>@material-ui</code> and inside it another folder called <code>core</code>. 
Inside this folder I have a file called <code>styles.js</code> with the following code:</p>

<pre><code>export const withStyles = 'hello world';
</code></pre>

<p>So the structure looks like:</p>

<pre><code>- __mocks__
  - @material-ui
    - core
      - styles.js
- node_modules
</code></pre>

<p>This is the code which works, with the mock defined inside the same testing file:</p>

<pre><code>jest.mock('@material-ui/core/styles', () =&gt; ({
  withStyles: () =&gt; Component =&gt; props =&gt; (
    &lt;Component
      classes=""""
      {...props}
    /&gt;
  ),
}));
</code></pre>

<p>What is happening with the <code>__mocks__</code> folder is that, if I do not call any </p>

<pre><code>jest.mock('@material-ui/core/styles');
</code></pre>

<p>inside my test file, it uses the real <code>withStyles</code>, so the real module.
No mock at all is being used.</p>

<p>If I use the:</p>

<pre><code>jest.mock('@material-ui/core/styles');
</code></pre>

<p>It uses an automatic mock autogenerated by jest (or it looks so), skipping the one I define above. </p>

<p>Just a note about packages, I used <code>CRA</code> for bootstrapping the app and the <code>jest</code> version I currently have is the 20, with the <code>react-scripts</code> version 1.0.17</p>

<p>Thanks to you all for you the help! </p>
",5,2128,2019-02-18 15:29,,2,3,other
12701359,How would this unit test translate to leveraging a mocking framework?,<c#><mocking><tdd><moq><rhino-mocks>,"<p>I'm trying to practice unit testing in the TDD way so I created a set of interfaces that I thought could be tested somewhat independently.  I'm not sure I succeeded but I'm now at the point where I'm pretty sure it's time for a mocking framework.  I learn best from example and I figure someone who's very proficient will probably be able to translate this into one of them quickly (Moq or Rhino Mocks maybe? those are the ones I've found).</p>

<p>Unit Test:</p>

<pre><code>    [TestMethod]
    public void RendererRendersEachWidgetByCallingBeginRenderThenEndRender()
    {
        // Mocks/Stubs
        ISpace space = new MockSpace();
        IWorld world = new MockWorld();
        IWidget widget1 = new MockWidget(""widget1"");
        IWidget widget2 = new MockWidget(""widget2"");
        world.Add(widget1);
        world.Add(widget2);

        // Object under test
        IRenderer target = new Renderer(world, space);
        target.Render();

        // verify BeginRender is called
        Assert.IsTrue((space as MockSpace).results.Contains(""Begin Render "" + widget1.Id));
        Assert.IsTrue((space as MockSpace).results.Contains(""Begin Render "" + widget2.Id));

        // verify EndRender is called
        Assert.IsTrue((space as MockSpace).results.Contains(""End Render "" + widget1.Id));
        Assert.IsTrue((space as MockSpace).results.Contains(""End Render "" + widget2.Id));

        // verify BeginRender is called before EndRender
        var orderedResults = (space as MockSpace).results.Select((s, i) =&gt; Tuple.Create(i, s));
        Assert.IsTrue(
            (orderedResults.Single(x =&gt; x.Item2 == ""Begin Render "" + widget1.Id).Item1) &lt;
            (orderedResults.Single(x =&gt; x.Item2 == ""End Render "" + widget1.Id).Item1));
        Assert.IsTrue(
            (orderedResults.Single(x =&gt; x.Item2 == ""Begin Render "" + widget2.Id).Item1) &lt;
            (orderedResults.Single(x =&gt; x.Item2 == ""End Render "" + widget2.Id).Item1));
    }
</code></pre>
",0,120,2012-10-03 3:05,,1,0,how
58209173,Mocking simple internal function using Jest for use in rendered React component,<javascript><reactjs><unit-testing><mocking><jestjs>,"<p>I have a simple React application with the following <code>App.js</code>, <code>App.test.js</code>, and <code>utils.js</code> files:</p>

<p><strong>App.js</strong></p>

<pre><code>import React from 'react';
import { randomNameGenerator } from './utils.js';
import './App.css';

function App() {
  return (
    &lt;div&gt;
      {randomNameGenerator()}
    &lt;/div&gt;
  );
}

export default App;
</code></pre>

<p><strong>App.test.js</strong></p>

<pre><code>import React from 'react';
import { render } from '@testing-library/react';
import '@testing-library/jest-dom/extend-expect'
import App from './App';

it('allows Jest method mocking', () =&gt; {
  const { getByText } = render(&lt;App /&gt;);
  expect(getByText(""Craig"")).toBeInTheDocument()
});
</code></pre>

<p><strong>utils.js</strong></p>

<pre><code>export function randomNameGenerator() {
    return Math.floor((Math.random() * 2) + 1) == 1 ? 'Steve' : 'Bill';
}

</code></pre>

<p>This is a simple example, but what I'm <em>trying to accomplish</em> is a Jest mock of the <code>randomNameGenerator()</code> function to only return <code>""Craig""</code> for that <strong>specific Jest test</strong>.</p>

<p>I've followed a wide variety of tutorials/guides, but can't find anything that works - the closest (by ""feel"") that I've gotten was this (in <code>App.test.js</code>), which had no effect:</p>

<pre><code>jest.doMock('./utils', () =&gt; {
  const originalUtils = jest.requireActual('./utils');
  return {
    __esModule: true,
    ...originalUtils,
    randomNameGenerator: jest.fn(() =&gt; {
      console.log('## Returning mocked typing duration!');
      return 'Craig';
    }),
  };
})
</code></pre>

<p><strong>The way it fails</strong> is expected:</p>

<pre><code>Unable to find an element with the text: Craig. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    &lt;body&gt;
      &lt;div&gt;
        &lt;div&gt;
          Steve
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/body&gt;

       6 | it('allows Jest method mocking', () =&gt; {
       7 |   const { getByText } = render(&lt;App /&gt;);
    &gt;  8 |   expect(getByText(""Craig"")).toBeInTheDocument()
         |          ^
       9 | });
</code></pre>
",3,16459,2019-10-02 20:50,,1,0,other
4818716,Generating stub classes of 3rd party libraries for Unit Tests,<java><unit-testing><mocking><stub>,"<p>I'm trying to do unit testing on an extension of the SWT library. I'm having trouble figuring out how to effectively mock and stub out the classes I'm extending to design my widgets.</p>

<p>The best solution I have thought of so far is to redefine the SWT classes in my test source so they get loaded over the top of the actual SWT libraries. Then I have the ability to make the stub methods do whatever I need.</p>

<p>The only problem i have with this method right now is the class files like Control.java are over 8K lines long and I want to stub each method, so I have no efficient way of removing the code that tries to access the underlying OS's GUI APIs I don't want to go through these lines of code.</p>

<p>There certainly must be something i'm doing horribly wrong, please help!</p>
",0,513,2011-01-27 16:05,,1,0,how
7293798,Junit test: static method invocation into testing method,<junit><easymock>,"<p>I have a code that will be tested:</p>

<pre><code>public void ackAlert(final Long alertId, final String comment) {
    final AnyTask task = AnyTask.create(
            ""ackAlert"", new Class[] { Long.class, String.class },
            new Object[] { alertId, comment });
    taskExecutor.execute(task);
}
</code></pre>

<p>I'm writting test to it:</p>

<pre><code> public void testAckAlert() throws Exception {

  final Long alertId = 1L;
  final String comment = ""tested"";

  final AnyTask task = AnyTask.create(
    ""ackAlert"", new Class[] { Long.class, String.class },
    new Object[] { alertId, comment });

  taskExecutor.execute(task);
  expectLastCall();

  replay(taskExecutor);

  testingObjectInstance.ackAlert(alertId, comment);

  verify(taskExecutor);

 }
</code></pre>

<p>And I got exception:</p>

<blockquote>
  <p>java.lang.AssertionError:    Unexpected method call
  execute(com.alert.bundle.model.AnyTask@4cbfea1d):
      execute(com.alert.bundle.model.AnyTask@65b4fad5): expected: 1,
  actual: 0</p>
</blockquote>

<p>Where is my error? I think problem is in invocation of static method <em>create</em>. </p>
",1,1928,2011-09-03 14:44,,2,5,what
66852436,How to mock data returned from MongoClient() in Python,<python><mongodb><unit-testing><mocking><pymongo>,"<p>I am trying to write test case, I want to mock data object returned from MongoClient(), below is the code.</p>
<p><strong>numbers.py</strong></p>
<pre class=""lang-py prettyprint-override""><code>def get_count():

    client_int = MongoClient('abc.xyz.com', port=27010)

    return client_int
</code></pre>
<p><strong>test_numbers.py</strong></p>
<pre class=""lang-py prettyprint-override""><code>@patch('pymongo.MongoClient')

def test_get_count(mocked_object):

    mocked_object.return_value = [{'1': 'data'}]

    assert numbers.get_count() == [{'1': 'data'}] # Here i am getting Assertion Error, MongoClient!=[{'1': 'data'}]
</code></pre>
<p>How to make this work?? What went wrong??</p>
",0,448,2021-03-29 10:19,,1,0,how
44800148,Shimming a control,<c#><unit-testing><mocking><mstest><microsoft-fakes>,"<p>I'm trying to write some unit tests on some legacy code using MSTest. I've added a fakes assembly on the class I'm testing, but it has a reference to a user control and that has code behind in it. 
I know this is probably not the right way to go about it, but is it possible to Shim a user control? They don't show up in the ShimContext, so I'm not holding out too much hope..</p>
",0,225,2017-06-28 10:37,,1,2,what
38982105,How do I use Moq to mock an interface that has methods that take concrete classes as parameters?,<c#><unit-testing><testing><moq>,"<ol>
<li>I have this scenario: an interface with 2 methods </li>
<li>the 2 methods take requests and return response </li>
<li>Methods contain functionality inside (check permissions and validate request and get data from database using entity framework.</li>
<li>But I want to test the methods and not just the interface. </li>
<li>I've tested the interface successfully but now I want to enter the method and test inside it. </li>
</ol>

<p>Code example:</p>

<pre><code> public interface IMyInterface
    {
      [OperationContract]
      responseObject GetData(Service&lt;RequestObject&gt; request);
    }

    public class MyConcreteClass : IMyInterface
    {
       public responseObject GetData(Service&lt;RequestObject&gt; request)
       {
          CheckForNull(request);
          ValidateMethod(request);
          //connect to db
          using(var context = new contextEntity)
          {
            //get data
          }
       }
    }
</code></pre>

<p>Now, I want to test the check nulls, permissions and data access, is it possible? Or do I have to extract interface from the internal methods?</p>

<p>PS, this is for my unit testing. I'm trying to eliminate external dependencies.
please explain in detail</p>
",0,794,2016-08-16 18:32,,2,6,what
23988175,Delphi mocking with nullable types,<delphi><mocking><spring4d>,"<p>What is the best way to setup Delphi DSharp mocks with Nullable types from the Spring framework? I've tried various approaches and I know I'm probably missing something really rudimentary, but I just can't figure out how to get the following code to work:</p>

<pre><code>program DSharkMockNullable;

{$APPTYPE CONSOLE}

{$R *.res}

uses
  DSharp.Testing.Mock,
  Spring,
  System.SysUtils;

type

  {$M+}
  IBaseMock = interface
  ['{B3311345-3C1F-47E3-8235-57B1BA04E957}']
    function GetId:  TNullableInteger;
    procedure SetId(Value: TNullableInteger);
    property Id: TNullableInteger read GetId write SetId;
  end;

  {$M+}
  IMockMe = interface(IBaseMock)
  ['{07F8F233-E8F5-4743-88C5-97A66BB01E29}']
    function GetObjectId:  TNullableInteger;
    procedure SetObjectId(Value: TNullableInteger);
    property ObjectId: TNullableInteger read GetObjectId write SetObjectId;
    function GetObjectName:  TNullableString;
    procedure SetObjectName(Value: TNullableString);
    property ObjectName: TNullableString read GetObjectName write SetObjectName;
  end;

  TMyObject = class
  public
    function ObjectIdAsString(const AObject: IMockMe): string;
  end;


{ TMyObject }

function TMyObject.ObjectIdAsString(const AObject: IMockMe): string;
var
  LId: Integer;
  LObjectId: Integer;
  LObjectName: string;
begin
  LId := AObject.Id;  // ***** FAILS HERE with an ""Invalid Typecast"" error
  LObjectId := AObject.ObjectId;
  LObjectName := AObject.ObjectName;
  Result := Format('Id: %d', [LId]);
  Result := Format('Object Id: %d', [LObjectId]);
  Result := Format('Object Name: %s', [LObjectName]);
end;

var
  LMock: Mock&lt;IMockMe&gt;;
  LObject: TMyObject;
begin
  try
    LMock.Setup.WillReturn(123).Any.WhenCalling.Id;
    LMock.Setup.WillReturn(456).Any.WhenCalling.ObjectId;
    LMock.Setup.WillReturn('blahblah').Any.WhenCalling.ObjectName;

    LObject := TMyObject.Create;
    Writeln(LObject.ObjectIdAsString(LMock.Instance));
    LObject.Free;

    Readln;
  except
    on E: Exception do
      Writeln(E.ClassName, ': ', E.Message);
  end;
end.
</code></pre>

<p>Any ideas or suggestions would be great? I'm using Delphi XE5.
Thanks. Rick.</p>
",3,801,2014-06-02 6:02,,2,0,what
41961343,unit testing a DAO method using mocked entity manager get issue when testing Exception,<java><unit-testing><mocking><persistence>,"<p>I have a simple DAO method that I'm trying to test:</p>

<pre><code>public boolean insertUser (User user) throws DaoException {
    boolean result = false;

    try {
        em.persist(user);
        result = true;
    } catch ( Exception e) {
        throw new DaoException( e );
    }

    return result;
}
</code></pre>

<p>as persist can return an exception I want to unit test this case:</p>

<p>I have mocked the entity manager:</p>

<pre><code>@Mock
EntityManager mockEm;
</code></pre>

<p>And my test:</p>

<pre><code>@Test
public void testExceptionEntityExistInsertUser() throws Exception {
    System.out.println(""entity already exist exception"");
    boolean result;
    when(mockEm.persist(user)).thenThrow(EntityExistsException.class);
    result = userDao.insertUser(user);
}
</code></pre>

<p>But on line when(mockEm.persist(user)).thenThrow(EntityExistsException.class); I have the following error:
'void' type not allowed here</p>

<p>I don't understand where the issue come from.</p>
",0,333,2017-01-31 15:30,,1,0,other
71924937,gmock template class 'const T1': actual parameter with requested alignment of 64 won't be aligned,<c++><c++11><googletest><googlemock>,"<p>I am trying to gmock the following template class</p>
<pre><code>template &lt;typename Type&gt;
class Interface {
  public:
    virtual bool insert(const Type&amp; param);

}
</code></pre>
<p>by using gmock as follows</p>
<pre><code>template &lt;typename Type&gt;

class CMockInterface: public Interface&lt;Type&gt; {

MOCK_METHOD1_T(insert, bool(const Type&amp;));

}

</code></pre>
<p>when building I get the following errors</p>
<p>error C2718: 'const T1': actual parameter with requested alignment of 64 won't be aligned</p>
<p>note: see reference to class template instantiation 'testing::internal::ImplicitlyConvertible&lt;const T &amp;,testing::internal::BiggestInt&gt;' being compiled</p>
<p>what is this error?</p>
",0,67,2022-04-19 12:26,,1,5,what
31776846,How to return different code and error with MockRestAdapter,<android><unit-testing><mocking><retrofit><http-error>,"<p>I use <code>MockRestAdapter</code> to return mock data in my tests, but I'd also like to test errors (401, 503, <code>UnknownHostException</code>, etc)
For <code>SocketTimeoutException</code>, there's an API, but how about different response code?</p>

<p>I've tried <code>MockWebServer</code> but no matter what I enqueue, I always get a 200 with the mock data from the adapter.</p>

<p>update: I want to run my tests like this:</p>

<pre><code>@RunWith(AndroidJUnit4.class)
@LargeTest
public class LoginActivityTest {
  @Test public void goodCredentials() {
      activity.login(""username"", ""password"");
      assert(...); // Got back 200 and user object (from mock)
  }
  @Test public void wrongCredentials() {
      activity.login(""username"", ""wrong_password"");
      something.setResponse(401, ""{error: wrong password}"");
      assert(...);
  }
  @Test public void someError() {
      activity.login(""username"", ""password"");
      something.setResponse(503, ""{error: server error}"");
      assert(...);
  }
}
</code></pre>

<p>update 2:</p>

<p>Found something, rather ugly, but does what I need:</p>

<pre><code>MockApi implements ServiceApi {
    public static Throwable throwable;
    @Override login(Callback&lt;User&gt; callback) {
        if (throwable != null) {
            sendError(callback)
        } else {
            callback.success(new User(""{name:test}""));
        }
    }
    private void sendError(Callback callback) {
        callback.failure(RetrofitError.unexpectedError("""", throwable));
    }
}

public class LoginActivityTest {
    @Test public void someError() {
        MockApi.throwable = new InterruptedIOException()
        activity.login(""username"", ""password"");
        // Assert having a time out message
   }
   @Test public void someError() {
       MockApi.throwable = new UnknownHostException()
       activity.login(""username"", ""password"");
       // Assert having a no internet message
   }
}
</code></pre>

<p>Still working on it, so any feedback will help :)</p>
",1,681,2015-08-02 21:33,,1,0,other
76772077,Mocking Imports within Storybook,<typescript><mocking><storybook>,"<p>I would like to Mock Imports within my Storybook Stories. I'm following the guide outlined here: [https://storybook.js.org/docs/7.0/react/writing-stories/build-pages-with-storybook#mocking-imports][1]</p>
<p>My decorator and parameters are working as expected but CustomComponent is still importing the production AuthClient instead of the mocked one. I'm guessing that I've configured webpackFinal incorrectly but for the life of me I don't see how.</p>
<pre><code>/src/clients/AuthClient.ts
  export class AuthClient()

/__mocks__/AuthClient.js
  export class AuthClient{}

/src/components/CustomComponent.tsx
  import { AuthClient } from 'src/clients/AuthClient';
  private authClient: AuthClient;

/.storybook/main.js
  module.exports = {
    webpackFinal: async (config) =&gt; {
      config.resolve.alias['src/clients/AuthClient'] = 
      require.resolve('../__mocks__/AuthClient.js');
    return config;
  }
}
</code></pre>
<p>Update: The theory right now is that our Stencil components are using rollup and Storybook is using webpack so pathing to the files isn't lining up.
[1]: <a href=""https://storybook.js.org/docs/7.0/web-components/writing-stories/build-pages-with-storybook#mocking-imports"" rel=""nofollow noreferrer"">https://storybook.js.org/docs/7.0/web-components/writing-stories/build-pages-with-storybook#mocking-imports</a></p>
",1,512,2023-07-26 13:57,,0,0,how
28207758,EasyMock java.lang.AssertionError: Unexpected method call,<java><easymock>,"<p>I am new to EasyMock and am stuck now. 
Can't I set the fields of mocked object?
Where am I going wrong? Any help would be really appreciated.</p>

<pre><code>IService service = EasyMock.createMock(IService.class);
service.setName(""abc""); 
EasyMock.replay(service);
org.junit.Assert.assertEquals(""abc"", service.getName());
EasyMock.verify(service);

    java.lang.AssertionError: 
      Unexpected method call getName():
        setName(""abc""): expected: 1, actual: 0
        at org.easymock.internal.MockInvocationHandler.invoke(MockInvocationHandler.java:45)
        at org.easymock.internal.ObjectMethodsFilter.invoke(ObjectMethodsFilter.java:73)
        at org.easymock.internal.ClassProxyFactory$MockMethodInterceptor.intercept(ClassProxyFactory.java:92)
</code></pre>
",0,27812,2015-01-29 5:46,,1,1,what
25077617,Mocking Domain Model & Building Tests Without Repetition,<c#><unit-testing><testing><mocking>,"<p>Looking for some clarification regarding testing. I have the following method in my Service layer:</p>

<pre><code>readonly IDomainModelRepository domainModelRepository;

public DomainModelDetailsDto Edit(int DomainModelID, IPrincipal User)
{
    DomainModel myDomainModel = domainModelRepository.Find(DomainModelID);
    if ((myDomainModel == null) || (!myDomainModel.UserCanEdit(User)))
        throw new UnauthorisedException();

    // Other stuff here...
}
</code></pre>

<p>Now I am building a suite of tests but have hit a couple of snags.</p>

<ol>
<li>The call to <code>myDomainModel.UserCanEdit(User)</code> cannot be mocked as DomainModel is not implementing any interface. It becomes even more complicated because the logic contained within UserCanEdit actually checks fields on other domain models within its graph. So how can I easily set this up to return a set value to allow me to test the Service?</li>
<li>I am testing that the method correctly responds if the repo does not find the DomainModel item. Then I test it correctly responds if the User cannot edit (well I will be when I solve point 1 above!). But after that, each test I write for the ""Other stuff here"" requires that I correctly set up the test to pass these first two checks. This seems cumbersome, and makes each test repeat the same code. Is there a better way?</li>
</ol>

<p>Perhaps the problem is that my code itself needs to be refactored in order to facilitate easier testing. If so, all advice appreciated!</p>
",0,196,2014-08-01 9:59,,2,0,how
51322707,Patching built-in method or class,<python><mocking><built-in>,"<p>I would like to find all instances in the code where np.random.seed is called (without using grep). In order to set a breakpoint in ipdb, I tried to find the source file with</p>

<pre><code>import inspect; inspect.getsourcefile(np.random.seed)
</code></pre>

<p>but it throws a TypeError because it is a built-in method (because it is coded in C). </p>

<p>Is it possible to watch any calls to np.random.seed by modifying something in the main source file?
Additionally, it would be suitable to patch this method, e.g. additionally logging it (or calling a debugger):</p>

<pre><code>def new_random_seed(seed):
    """"""
    This method should be called instead whenever np.random.seed 
    is called in any module that is invoked during the execution of 
    the main script
    """"""
    print(""Called with seed {}"".format(seed))
    #or: import ipdb; ipdb.set_trace()
    return np.random.seed()
</code></pre>

<p>Maybe using a mock framework is the way to go?</p>

<p>The second question concerns the scenario in which a class B inherits from a class A in a library and I want to use the functionality of class B, but overwrite a function it uses from class A without modifying classes A and B. Probably, I should use mocking, but I am not sure about the overhead, so I wrote the following:</p>

<pre><code>#in library
class A():
    def __init__(self, name):
        self.name = name
    def work(self):
        print(""{} working"".format(self.name))

class B():
    def __init__(self):
        self.A = A(""Machine"")
    def run_task(self):
        self.A.work()

# in main script
# Cannot change classes A and B, so make a subclass C
import types
class C(B):
    def __init__(self, modified_work):
        super().__init__()
        self.A.work = types.MethodType(modified_work, self.A) #MethodType for self

b = B()
b.run_task()
modified_work = lambda self: print(""{} working faster"".format(self.name))
c = C(modified_work)
c.run_task()
</code></pre>

<p>The output is:</p>

<pre><code>Machine working
Machine working faster
</code></pre>

<p>Is this good style?</p>
",0,39,2018-07-13 10:07,,1,0,what
29030361,Is it possible to make scoped expectations in Google Mock?,<c++><googlemock>,"<p>Is it possible to scope an expectation using Google Mock? In other words, let's say I have the following test fixture:</p>

<pre><code>class Fixture : public testing::Test
{
public:
    void SetUp();

    void TearDown();

    ObjectUnderTest testObject;
    MockObject mock;
};
</code></pre>

<p>Now, in the <code>SetUp()</code> function, I want to allow a mock function call as many times as is necessary during initialisation:</p>

<pre><code>void Fixture::SetUp()
{
    EXPECT_CALL(mock.DoStuff(_)).Times(Any());
    testObject.Initialise(mock);
}
</code></pre>

<p>After this, I want this particular expectation to go out-of-scope and any calls to <code>DoStuff()</code> to generate a failure. I can't use <code>RetiresOnSaturation()</code> because it will never saturate!</p>

<p>In other words, if I have the following test case:</p>

<pre><code>TEST_F(Fixture, DoesWhatItsSupposedTo)
{
    EXPECT_CALL(mock, DoStuff(Eq(3)));
    testObject.DoSomething(mock);
}
</code></pre>

<p>I would like this to fail if <code>DoSomething()</code> calls <code>DoStuff(4)</code> on the mock object. With gmock default behaviour (which is right for most scenarios), it will first check the second expectation that won't match; it will then check the expectation in <code>SetUp()</code> that will match and pass.</p>

<p>Does anyone know if this is possible?</p>
",4,1872,2015-03-13 10:51,,1,0,what
75025220,Mock http client that is set up inside of Program.cs,<c#><dependency-injection><mocking><polly>,"<p>I have a typed <code>HttpClient</code> that I am injecting in my application using the HttpClientFactory extension methods for services in Program.cs</p>
<p>My client looks something like this with the <code>HttpClient</code> injected via the constructor:</p>
<pre><code>public class MyClient
{
    private readonly HttpClient _httpClient;
    public MyClient(HttpClient httpClient)
    {
        _httpClient = httpClient;
    }

    public async Task&lt;string&gt; GetStuffFromApi()
    {
        // method to get content from API
        // return stuff
    }
}
</code></pre>
<p>The relevant section in <code>Program.cs</code> looks something like this for example:</p>
<pre><code>services.AddHttpClient&lt;IMyClient, MyClient&gt;(client =&gt;
{
    client.BaseAddress = new Uri(&quot;https://somewebsite.com/api&quot;);
    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue(&quot;text/plain&quot;));
}).AddPolicyHandler(MyClientPolicies.GetRetryAsyncPolicy());        
</code></pre>
<p>I would like to test the retry policy among other things for this client. I found a great mockhttp library that is helpful for the mock client setup (<code>MockHttp</code>), but I am unsure of exactly what I need to do in order to include the retry policy behavior in my mocked client.</p>
<p>So the test looks something like this using XUnit currently:</p>
<pre class=""lang-cs prettyprint-override""><code>public class MyClientTests
{
    [Fact]
    public async Task MyClient_RetriesRequest_OnTransientErrors()
    {
        // Arrange
        var mockHttp = new MockHttpMessageHandler();
        mockHttp.When(&quot;*&quot;).Respond(HttpStatusCode.RequestTimeout);
        var mockClient = new MyClient(mockHttp.ToHttpClient());
        // Act
        // ... call the method
        // Assert
        // ... assert the request was tried multiple times
    }
}
</code></pre>
<p>How do I test my mock http client including the additional configuration from Program.cs like the baseaddress and retry policies?</p>
",1,665,2023-01-05 22:55,,1,1,how
62840947,axios.create of jest's axios.create.mockImplementation returns undefined,<reactjs><mocking><jestjs>,"<p>I have written a test for component CategoryListContainer for just testing axios get call in it by mocking axios as below :</p>
<p>CategoryListContainer.test.js</p>
<pre><code>import React from 'react';
import { render, cleanup, waitForElement } from '@testing-library/react';
import { Provider } from 'react-redux';
import store from '../../Store';
import axios from 'axios';
import CategoryListContainer from './CategoryListContainer';

jest.mock('axios', () =&gt; ({
  create: jest.fn(),
}));

const products = {
  data: [
    {
      id: '0',
      heading: 'Shirt',
      price: '800',
    },
    {
      id: '1',
      heading: 'Polo tees',
      price: '600',
    },
  ],
};

afterEach(cleanup);
const renderComponent = () =&gt;
  render(
    &lt;Provider store={store()}&gt;
      &lt;CategoryListContainer /&gt;
    &lt;/Provider&gt;
  );

test('render loading state followed by products', async () =&gt; {
  axios.create.mockImplementation((obj) =&gt; ({
    get: jest.fn(() =&gt; Promise.resolve(products)),
  }));
  const { getByText } = renderComponent();
  await waitForElement(() =&gt; {
    expect(getByText(/loading/i)).toBeInTheDocument();
  });
});
</code></pre>
<p>As we see that in test 'render loading state followed by products' I wrote mock implemenation for axios.create as <code>axios.create.mockImplementation((obj) =&gt; ({ get: jest.fn(() =&gt; Promise.resolve(products)), }));</code></p>
<p>Now when I use axios.create in axiosInstance.js as below :</p>
<pre><code>import axios from 'axios';
const axiosInstance = axios.create({
  headers: {
    Accept: 'application/json',
    ContentType: 'application/json',
    authorization: '',
  },
});
console.log(axiosInstance);
export default axiosInstance;
</code></pre>
<p><code>console.log(axiosInstance)</code> shows undefined and therefore I'm getting the below error on running the test :</p>
<p>TypeError: Cannot read property 'get' of undefined</p>
<pre><code>  4 | const fetchCategories = () =&gt; async (dispatch) =&gt; {
  5 |   const response = await axiosInstance
&gt; 6 |     .get('/api/category/all')
    |      ^
  7 |     .catch((error) =&gt; {
  8 |       dispatch(fetchErrorAction(error));
  9 |       if (error.message.split(' ').pop() == 504) {
</code></pre>
<p>console.log src/backendApiCall/axiosInstance.js:9
undefined</p>
<p>I want to understand why console.log(axiosInstance) shows undefined . And the solution to making the test successful with making minimum changes to code .</p>
",0,3353,2020-07-10 19:15,,1,2,why
52433483,Moq - Cannot convert from IGenericRepository To Generic Repository,<c#><unit-testing><moq>,"<p>Please forgive me in advance, I'm trying to learn unit testing and Moq.</p>

<p>I think i've almost managed to set things up properly (but i could be wrong). When i execute the test below i get the following error:</p>

<blockquote>
  <p>Cannot convert from
  'TestMoq.DAL.IGenericRepository' to
  'TestMoq.DAL.GenericRepository'    TestMoq.UnitTests</p>
</blockquote>

<p>On this line:</p>

<pre><code>    _mockUnitWork.Setup(m =&gt; m.CreditRepository).Returns(_mockRepository.Object);
</code></pre>

<p>Here's my code:</p>

<p>MoqTest</p>

<pre><code>using System;
using NUnit.Framework;
using TestMoq.Controllers;
using TestMoq.Models;
using TestMoq.DAL;
using Moq;
using System.Web.Mvc;
using System.Runtime;
using System.Data.Entity;
using System.Collections.Generic;
using System.Linq;

namespace TestMoq.UnitTests.Controllers
{
    [TestFixture]
    public class BaseControllerTests
    {

        private Mock&lt;IGenericRepository&lt;Credit&gt;&gt; _mockRepository;
        Mock&lt;IUnitOfWork&gt; _mockUnitWork;



        [Test]
        public void MoqTest() {

            _mockRepository = new Mock&lt;IGenericRepository&lt;Credit&gt;&gt;();
            _mockUnitWork = new Mock&lt;IUnitOfWork&gt;();
            var _service = new CreditsController(_mockUnitWork.Object);

            List&lt;Credit&gt; listCredit= new List&lt;Credit&gt;() {
           new Credit() { CreditId = 1},
           new Credit() { CreditId = 2},
           new Credit() { CreditId = 3 }
          };

            _mockRepository.Setup(x =&gt; x.Get(null, null, ""*"")).Returns(listCredit);
            _mockUnitWork.Setup(m =&gt; m.CreditRepository).Returns(_mockRepository.Object);

            List&lt;Credit&gt; results = _service.GetAll() as List&lt;Credit&gt;;


            Assert.IsNotNull(results);
            Assert.AreEqual(3, results.Count);
        }
    }
}
</code></pre>

<p>CreditController.cs</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Data;
using System.Data.Entity;
using System.Linq;
using System.Net;
using System.Web;
using System.Web.Mvc;
using TestMoq.CustomFilters;
using TestMoq.DAL;
using TestMoq.Models;

namespace TestMoq.Controllers
{
    public class CreditsController : Controller
    {
        private UnitOfWork unitOfWork = new UnitOfWork();
        private IUnitOfWork _unitOfWork;

        public CreditsController()
        {
            this._unitOfWork = new UnitOfWork();
        }
        public CreditsController(IUnitOfWork _NewUnitOfWork)
        {
            this._unitOfWork = _NewUnitOfWork;
        }       

        public List&lt;Credit&gt; GetAll()
        {
            return _unitOfWork.CreditRepository.Get().ToList();
        }

    }
}
</code></pre>

<p>GenericRepository</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Data.Entity;
using System.Linq;
using System.Linq.Expressions;
using System.Web;
using TestMoq.Models;

namespace TestMoq.DAL
{

    public class GenericRepository&lt;TEntity&gt; : IGenericRepository&lt;TEntity&gt; where TEntity : class
    {
        internal TcpContext context;
        internal DbSet&lt;TEntity&gt; dbSet;

        public GenericRepository(TcpContext context)
        {
            this.context = context;
            this.dbSet = context.Set&lt;TEntity&gt;();
        }

        public virtual IEnumerable&lt;TEntity&gt; Get(
            Expression&lt;Func&lt;TEntity, bool&gt;&gt; filter = null,
            Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt; orderBy = null,
            string includeProperties = """")
        {
            IQueryable&lt;TEntity&gt; query = dbSet;

            if (filter != null)
            {
                query = query.Where(filter);
            }

            foreach (var includeProperty in includeProperties.Split
                (new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries))
            {
                query = query.Include(includeProperty);
            }

            if (orderBy != null)
            {
                return orderBy(query).ToList();
            }
            else
            {
                return query.ToList();
            }
        }

        public virtual TEntity GetByID(object id)
        {
            return dbSet.Find(id);
        }

        public virtual void Insert(TEntity entity)
        {
            dbSet.Add(entity);
        }

        public virtual void Delete(object id)
        {
            TEntity entityToDelete = dbSet.Find(id);
            Delete(entityToDelete);
        }

        public virtual void Delete(TEntity entityToDelete)
        {
            if (context.Entry(entityToDelete).State == EntityState.Detached)
            {
                dbSet.Attach(entityToDelete);
            }
            dbSet.Remove(entityToDelete);
        }

        public virtual void Update(TEntity entityToUpdate)
        {
            dbSet.Attach(entityToUpdate);
            context.Entry(entityToUpdate).State = EntityState.Modified;
        }
    }
}
</code></pre>

<p>IGenericRepository.cs</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;

namespace TestMoq.DAL
{
    public interface IGenericRepository&lt;TEntity&gt; where TEntity : class
    {
        void Delete(object id);
        void Delete(TEntity entityToDelete);
        IEnumerable&lt;TEntity&gt; Get(Expression&lt;Func&lt;TEntity, bool&gt;&gt; filter = null, Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt; orderBy = null, string includeProperties = """");
        TEntity GetByID(object id);
        void Insert(TEntity entity);
        void Update(TEntity entityToUpdate);
    }
}
</code></pre>

<p>UnitOfWork</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using TestMoq.Models;

namespace TestMoq.DAL
{

    public class UnitOfWork : IDisposable, IUnitOfWork
    {
        private TcpContext context = new TcpContext();
        public GenericRepository&lt;Credit&gt; creditRepository;

        //Other models &amp; methods removed for clarity


        public GenericRepository&lt;Credit&gt; CreditRepository
        {
            get
            {
                if (this.creditRepository == null)
                {
                    this.creditRepository = new GenericRepository&lt;Credit&gt;(context);
                }

                return creditRepository;
            }

        }

        public void Save()
        {
            context.SaveChanges();
        }

    }
}
</code></pre>

<p>IUnitOfWork.cs</p>

<pre><code>using TestMoq.Models;

namespace TestMoq.DAL
{
    public interface IUnitOfWork
    {
        GenericRepository&lt;Amendment&gt; AmendmentRepository { get; }
        GenericRepository&lt;Credit&gt; CreditRepository { get; }
        GenericRepository&lt;FileUpload&gt; FileUploadRepository { get; }
        GenericRepository&lt;Job&gt; JobRepository { get; }
        GenericRepository&lt;Subscription&gt; SubscriptionRepository { get; }
        GenericRepository&lt;Topic&gt; TopicRepository { get; }
        GenericRepository&lt;Writer&gt; WriterRepository { get; }

        void Dispose();
        void Save();
    }
}
</code></pre>

<p>Apologies in advance if i'm totally messing this up, if you've noticed any other massive errors in my way of thinking (im still getting my head around all this) please do point them out to me.</p>

<p>Thank you!</p>
",1,314,2018-09-20 21:21,,1,3,other
31073900,Change value of parameter in NSubstitute,<unit-testing><nsubstitute>,"<p>I have this method to mock with NSubstitute:</p>

<pre><code>public T VoerStoredProcedureUit&lt;T&gt;(string naam, params SqlParameter[] parameters)
</code></pre>

<p>The test method using it sends 2 SqlParameters to this method. VoerStoredProcedureUit is supposed to change the values of these parameters so the tested method can extract that.</p>

<p>I created the following with NSubstitute:</p>

<pre><code>SqlParameter[] param =
    {
        new SqlParameter(""@pat_id"", SqlDbType.BigInt) {Direction = ParameterDirection.Output, Value = ""Melding""},
        new SqlParameter(""@Melding"", SqlDbType.VarChar, 4096) {Direction = ParameterDirection.Output, Value = 2}
    };
    productieVerbinding.VoerStoredProcedureUit&lt;PatientNieuwResultaat&gt;(Arg.Any&lt;string&gt;(),
        Arg.Any&lt;SqlParameter[]&gt;()).ReturnsForAnyArgs(x =&gt;
        {
            x[1] = param;
            return PatientNieuwResultaat.Succes; 
        });
</code></pre>

<p>The setup however rises an exception: </p>

<pre><code>A first chance exception of type 'NSubstitute.Exceptions.ArgumentIsNotOutOrRefException' occurred in NSubstitute.dll

Additional information: Could not set argument 1 (SqlParameter[]) as it is not an out or ref argument.
</code></pre>

<p>How do you return a value if the method uses implicitly by reference values?</p>
",2,2331,2015-06-26 13:02,,2,0,how
32993466,How to mock this MVC Controller,<c#><asp.net-mvc><mocking>,"<p>I am using Fluent MVC to test some of my MVC controllers (some people argue this is not needed but this is more for a learning process rather than a production product).</p>

<p><strong>Interface</strong></p>

<pre><code>public interface ISettings&lt;T&gt; where T : BaseSettingsDto
{
    T GetSettings();
    bool SaveSettings(T model);
}
</code></pre>

<p><strong>Implementing the interface</strong></p>

<pre><code>public class GetSettingsConfiguration : ISettings&lt;FirstSettingsDto&gt;
{
    public FirstSettingsDto GetSettings()
    {
        var repo = new Repository();

        var result = repo.GetAll();
        // Do stuff
        return model;
    }

    public bool SaveSettings(FirstSettingsDto model)
    {
        var repo = new Repository();
        // Do stuff
    }
}
</code></pre>

<p>How I am using this in my controller (example):</p>

<pre><code>[HttpGet]
public ActionResult GetInformation()
{
    var admin = new GetSettingsConfiguration();
    var config = admin.GetSettings();
}
</code></pre>

<p>How would I actually mock this out since the Interface is using generics?</p>
",2,66,2015-10-07 13:26,,1,0,how
74290118,Mock implementation of another module not working in jest,<javascript><node.js><unit-testing><jestjs><mocking>,"<p>I am unit testing (using jest) a function named &quot;getTripDetails&quot; (inside file trip.js) that calls another file &quot;getTrace.js&quot; from different module (which exports a function as shown below).</p>
<p>I want to mock the call of function &quot;getTrace&quot; while testing &quot;getTripDetails&quot; function.</p>
<p>file: trips.js</p>
<pre><code>const gpsTrace = require(&quot;./gpsTrace&quot;);

getTripDetails = async(req, res)=&gt;{
    let gpsTraceRes = await gpsTrace(req.body, req.adToken)
    //more code...
    return {status:200};
}

</code></pre>
<p>file: getTrace.js</p>
<pre><code>module.exports = async(payload, token) =&gt;{
   try {
    //code
   } catch (e) {
     error(e)
     throw new Error(e)
   }
} 
</code></pre>
<p>This is what i tried after reading the docs.</p>
<p>file: test.js</p>
<pre><code>let ctrl = require(&quot;./trips&quot;);

describe(&quot;API -- testing&quot;, function () {

    it(&quot;Trip details&quot;, async function () {

        jest.mock('./gpsTrace');
        const gpsTrace = require('./gpsTrace');
        gpsTrace.mockImplementation(() =&gt; {});
        gpsTrace();
       
        await  ctrl.getTripDetails({},{});
        expect(response.status).to.eql(200);
    });
});

</code></pre>
<p>It did not get mocked, instead it was calling the original implementation.</p>
<p>Any suggesstions?</p>
",0,233,2022-11-02 13:38,,1,0,how
36614611,Mock out class nested inside classes for testing,<java><unit-testing><testing><mocking><mockito>,"<p>Alpha - parent with beta as child</p>

<pre><code>public class Alpha {
  Beta beta;

  public Alpha(int argument) {}

  void start() {
    beta = createBeta();
  }

  Beta createBeta() {
    return new Beta(this);
  }
}
</code></pre>

<p>Beta - child of alpha, has charlie</p>

<pre><code>public class Beta {
  Alpha alpha;
  Charlie charlie;

  public Beta(Alpha alpha) {
    this.alpha = alpha;
    this.charlie = createCharlie();
  }

  Charlie createCharlie() {
    return new Charlie().shuffle();
  }
}
</code></pre>

<p>Charlie - has a list, which is usually shuffled in production</p>

<pre><code>public class Charlie {
  List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();

  public Charlie() {
    for (int i = 0; i &lt; 6; i++) {
      list.add(i);
    }
  }

  public Charlie shuffle() {
    Collections.shuffle(list);
    return this;
  }

  @Override
  public String toString() {
    return list.toString();
  }
}
</code></pre>

<p>AlphaTest <strong>[need help with this test]</strong> - want to try different variations of shuffling to see how alpha/beta would react.</p>

<pre><code>public class AlphaTest {

  Charlie special = new Charlie();

  @Test
  public void testSpecialCharlie() {
    Alpha alpha = Mockito.spy(new Alpha(0));
    Beta beta = Mockito.spy(alpha.createBeta());

    Mockito.when(alpha.createBeta()).thenReturn(beta);
    Mockito.when(beta.createCharlie()).thenReturn(special);

    alpha.start();

    // FAILURE: expected:&lt;[0, 1, 2, 3, 4, 5]&gt; but was:&lt;[0, 4, 1, 5, 3, 2]&gt;
    assertEquals(special.list, alpha.beta.charlie.list);
  }
}
</code></pre>

<p>Goal is to test Alpha/Beta with different combinations of Charlie. Not sure what's the best way to do that? This is exact code copied. Open to changing the setup also to facilitate testing. Tried different variations, nothing really working. Would really appreciate help with this.</p>

<p>I am not sure, I tried a bunch of ways (mocking out <code>createCharlie()</code> function, mocking out <code>Charlie</code> class, mocking out <code>shuffle()</code>, moving <code>createCharlie()</code> to parent <code>Alpha</code> class, nothing really works properly or maybe I was missing something. Any help would be really appreciated. Thanks!</p>

<p>Wonder why I can't just do this:</p>

<pre><code>Charlie charlie = Mockito.mock(Charlie.class);
Mockito.when(charlie.shuffle()).thenReturn(special);
</code></pre>
",0,190,2016-04-14 5:36,,2,4,how
38455941,How can I write valid JUnit tests when mocking a filepath?,<java><unit-testing><junit><mocking><mockito>,"<p>I am trying to write some JUnit tests for a set of methods which use some REST services on the web.</p>

<p>In general, within my methods, I am providing a filepath and a configuration as a parameter, but I expect things will get more complicated as I progress.</p>

<p>For right now, what are the best ways for me to write JUnit tests for the likes of : </p>

<pre><code>public Answers changeFileToAnswer(String filePath, String mediaType) {
    File document = new File(filePath);
    Answers answers = restService.changeFileToAnswer(document, mediaType);
    return answers;
}
</code></pre>

<p>What kind of Unit tests can I write for a simple class like this? Testing the answers object would be an integration tests, since an external call is made here, right? What is good practise here? Is there a way to mock the filepath being passed in as a parameter? </p>

<p><strong>Notes -</strong> 
This method is from a REST interface which will later be exposed through a GUI. I am currently testing it with POST calls from POSTman. Due to this, I am passing in a string for the filePath rather than a file object (as I could not post this to my server).</p>

<p>Thanks.</p>
",1,8503,2016-07-19 10:28,,1,4,what
55592345,Unable to use mocking to throw an exception - the thrown exception is not being caught,<java><unit-testing><junit><mocking><powermockito>,"<p>I have a method where I'd like to mock an exception being thrown so that the catch statement is entered:</p>

<pre><code>public static String func(String val) {
  try {
    MessageDigest md5 = MessageDigest.getInstance(""MD5"");
    return Base64.encode(md5.digest(val.getBytes()));
  } catch (NoSuchAlgorithmException toCatch) {
      return ""*"";
  }
}
</code></pre>

<p>The test I've written is this:</p>

<pre><code>@Test
public void testFunc() throws Exception {
  MessageDigest md5 = PowerMockito.mock(MessageDigest.class);
  PowerMockito.when(md5.getInstance(anyString())).thenThrow(new NoSuchAlgorithmException());  
  Assert.assertEquals(""*"", func(""in""));
}
</code></pre>

<p>However i'm getting: </p>

<pre><code>java.security.NoSuchAlgorithmException:  MessageDigest not available
</code></pre>

<p>on the <code>PowerMockito.when()</code> line. Which implies the exception has been through, but not caught? What am I doing wrong?</p>

<p>Update:
I have tried the following modifications</p>

<pre><code>@PrepareForTest({MessageDigest.class}) 
@Test
public void testFunc() throws Exception {
  PowerMockito.mockStatic(MessageDigest.class); 
  PowerMockito.when(MessageDigest.getInstance(anyString())).thenThrow(new NoSuchAlgorithmException());
  Assert.assertEquals(""*"", testFunc(""in""));
}
</code></pre>

<p>This causes the function to run without triggering the exception.</p>

<p>And this:</p>

<pre><code>@PrepareForTest({MessageDigest.class})
@Test
public void testFunc() throws Exception { 
  PowerMockito.mockStatic(MessageDigest.class);
  MessageDigest md5 = PowerMockito.mock(MessageDigest.class); 
  PowerMockito.doThrow(new NoSuchAlgorithmException()).when(md5, ""getInstance"", anyString()); 
  Assert.assertEquals(""*"", func(""in""));
} 
</code></pre>

<p>Still doesn't invoke the catch statement, similar to what I was getting before.</p>
",2,929,2019-04-09 11:58,,4,0,what
45508301,boost::lockfree::queue as static data member,<c++><boost><googlemock>,"<p>We have a class where we declare <code>boost::lockfree::queue</code> as <code>static</code> data member and override <code>new</code> and <code>delete</code> operator. The logic in the <code>new</code> / <code>delete</code> operator is to create an instance of class to get / put pointer of an object in the queue.</p>

<p>The issue is that after the test cases finishes which is success I get segment fault. If I comment the <code>delete arr[i]</code> statement out there fault no longer occurs. </p>

<p>My assumption is that cause the Boost queue is static hence the data member will be destroyed last or its own destructor would be called when program is to end but then I am not sure what is in its destructor that causes the abort or gives segmentation fault.</p>

<p>Any pointers would be really helpful to resolve the issue?</p>
",0,305,2017-08-04 13:36,,1,0,how
3561481,"Mocking, Unit Testing (NUnit) setup problem with HttpHandler",<unit-testing><nunit><mocking><moq><httphandler>,"<p>This post relates to two other posts, <a href=""https://stackoverflow.com/questions/3518851/construtor-setter-injection-using-ioc-in-httphandler-is-it-possible"">here</a> and <a href=""https://stackoverflow.com/questions/3551709/using-ioc-container-as-a-service-locator-for-httphandler"">here</a>.</p>

<p>I'm new to Unit Testing &amp; Mocking. I have a test fixture that is trying to mock a HttpContext object including the response and request. I think the test code is not setup properly, as after calling the handler I get an error immediately. There error I am getting is:</p>

<p>UnitTests.UADHandlerFixture.Request_Is_Object:
System.NullReferenceException : Object reference not set to an instance of an object.</p>

<p>at Abstract.BaseHttpHandler.get_Request() in BaseHttpHandler.cs:line 21</p>

<p>at Abstract.BaseHttpHandler.get_IsRequestFromUAD() in BaseHttpHandler.cs:line 23</p>

<p>at Handlers.UADTimeHttpHandler.ProcessRequest(HttpContextBase context) in UADTimeHttpHandler.cs:line 19</p>

<p>at UnitTests.UADHandlerFixture.Request_Is_Object() in UADHttpHanderTests.cs:line 47</p>

<p>The test code is this:</p>

<pre><code>    [TestFixture]
public class UADHandlerFixture
{
    private Mock&lt;HttpContextBase&gt; _mockHttpContext;
    private Mock&lt;HttpRequestBase&gt; _mockHttpRequest;
    private Mock&lt;HttpResponseBase&gt; _mockHttpResponse;
    private UADTimeHttpHandler _handler;
    private WindsorContainer _container;

    [SetUp]
    public void Init()
    {
        _mockHttpRequest = new Mock&lt;HttpRequestBase&gt;();
        _mockHttpResponse = new Mock&lt;HttpResponseBase&gt;();
        _mockHttpContext = new Mock&lt;HttpContextBase&gt;();
        _container = new WindsorContainer();
        _container.AddComponent&lt;ILogger, FakeLogger&gt;();
        _container.AddComponent&lt;IDataRepository, FakeDataRepository&gt;();

        _mockHttpContext.SetupGet(x =&gt; x.Application[0]).Returns(_container);
        _mockHttpContext.SetupGet(x =&gt; x.Request).Returns(_mockHttpRequest.Object);
        _mockHttpContext.SetupGet(x =&gt; x.Response).Returns(_mockHttpResponse.Object);

        _handler = new UADTimeHttpHandler();
    }

    [Test]
    public void Request_Is_Object()
    {
        _handler.ProcessRequest(_mockHttpContext.Object);
    }
}
</code></pre>

<p>Handler:</p>

<pre><code>    public class UADTimeHttpHandler : BaseHttpHandler
{
    public override void ProcessRequest(HttpContextBase context)
    {
        if (IsRequestFromUAD)
        {
            Logger.Log(""Log stuff"");
            DataRepository.Write(""DB stuff"");
            ReturnResponse(HttpStatusCode.OK, DateTime.Now.ToString());
        }
        else
            ReturnResponse(HttpStatusCode.BadRequest);
    }
}
</code></pre>

<p>BaseHandler:</p>

<pre><code>public abstract class BaseHttpHandler : IHttpHandler
{
    private HttpContext _httpContext;
    private ILogger _logger;
    private IDataRepository _dataRepository;
    protected ILogger Logger { get { return _logger; } }
    protected IDataRepository DataRepository { get { return _dataRepository; } }
    protected HttpContext Context { get { return _httpContext; } }
    protected HttpRequest Request { get { return _httpContext.Request; } }
    protected HttpResponse Response { get { return _httpContext.Response; } }
    protected bool IsRequestFromUAD { get { return Request.UserAgent == null ? false : Request.UserAgent.Equals(""UAD""); } }
    public virtual bool IsReusable { get { return false; } }

    public void ProcessRequest(HttpContext context)
    {
        WindsorContainer container = (WindsorContainer)context.Application[0];
        _logger = container.Resolve&lt;ILogger&gt;();
        _dataRepository = container.Resolve&lt;IDataRepository&gt;();

        _httpContext = context;
        ProcessRequest(new HttpContextWrapper(context));
    }

    protected virtual void ReturnResponse(HttpStatusCode httpStatus)
    {
        Response.StatusCode = (int)httpStatus;
    }

    protected virtual void ReturnResponse(HttpStatusCode httpStatus, string response)
    {
        Response.StatusCode = (int)httpStatus;
        Response.Write(response);
    }

    protected virtual string GetInputStream()
    {
        using (var reader = new StreamReader(Request.InputStream))
        {
            return reader.ReadToEnd();
        }
    }

    public abstract void ProcessRequest(HttpContextBase context);
}
</code></pre>
",3,1712,2010-08-24 22:19,,0,0,other
76980147,Mocking BlobServiceClient using MOQ,<c#><unit-testing><moq><moq-3>,"<p>In my implementation code, I am fetching accountname from BlobServiceClient object. However when I try to mock it using MOQ, I see the error below. Is there a way to get around this error?</p>
<pre><code>storageClientMock = new Mock&lt;BlobServiceClient&gt;();
storageClientMock.Setup(x =&gt; x.AccountName).Returns(&quot;accountname&quot;);
</code></pre>
<blockquote>
<p>Message:  System.NotSupportedException : Unsupported expression: x =&gt;
x.AccountName Non-overridable members (here:
BlobServiceClient.get_AccountName) may not be used in setup /
verification expressions.</p>
</blockquote>
",-2,100,2023-08-25 19:49,,1,0,what
54745655,write common/generic Unit Tests for all controllers,<c#><unit-testing><asp.net-web-api><asp.net-web-api2><moq>,"<p>i would like to ask that in web api 2.0 is there is any way that i can write common/generic unit tests for all controllers? 
like i have to test that user is passing valid input to all actions in a controller. so that is going to be one unit test for all actions. is there any way i write only one unit test and use for all actions with-in controller? or if i broader the scope write one unit test that is to be used by all controllers? and similar functionality that is common among multiple controllers, i have to write multiple unit tests in conventional programming but i want to make it efficient.so is there any way to do that? </p>
",0,79,2019-02-18 10:54,,0,3,what
33174481,Can NSubstitute check calls that take an Expression<T>?,<c#><unit-testing><reflection><mocking><nsubstitute>,"<p>I'm trying to validate a call to a method that takes a parameter of type <code>Expression&lt;Func&lt;T, U&gt;&gt;</code>, but I'm not able to get NSubstitute to recognize it.</p>

<pre><code>public interface IFoo&lt;T&gt;
{
    void DoThing&lt;TProperty&gt;(TProperty i, Expression&lt;Func&lt;T, TProperty&gt;&gt; expression);
}

// this almost works, but throws AmbiguousArgumentException
myFoo.Received(1).DoThing(Arg.Is(10), Arg.Any&lt;Expression&lt;Func&lt;MyClassType, long&gt;&gt;&gt;());
</code></pre>
",1,578,2015-10-16 15:42,,2,3,what
23431499,Test method returns a string with Moq,<c#><unit-testing><tdd><moq>,"<p>I have a Integration project I wish to Test.  I have an external web service and I want to test that it returns a string.</p>

<p>I have an interface for IMyService and then an implementation - MyService.</p>

<p>I am attempting to write Unit Tests for this project but have never done any TDD before and am trying to use Moq for the first time.</p>

<p>The method I want to Test has the below signature:</p>

<pre><code> public string GetTicketId(Coordinate[] coordinates)
</code></pre>

<p>So far in my ServiceTest class I have the following:</p>

<pre><code>[TestClass]
public class MyServiceTest
{
    [TestMethod]
    public void GetTicketId()
    {
        var mockMyService = new Mock&lt;IMyService&gt;();

        var coordinates = new Coordinate[1];

        for (int i = 0; i &lt; coordinates.Length; i++)
        {
            var coord1 = new Coordinate { Id = i.ToString(), X = -110.5322, Y = 35.2108, QualityIndex = 90 };
            coordinates[i] = coord1;
        }

        //mockMyService.Setup(n =&gt; n.GetTicketId(coordinates)).Returns();

        //Assert.IsNotNull(ticketId);
    }
</code></pre>

<p>I am kind of stuck here - what is the correct way to pass in the co-ordinates to the mockMyService so what I want to be able to assert is that the string I get back from my External service call is not null - i.e I get a response from the External Service</p>
",1,772,2014-05-02 15:17,,2,0,what
47471868,SignalR testing - how to mock groups in new version of SignalR for ASP.NET Core 2,<c#><unit-testing><mocking><asp.net-core-2.0><asp.net-core-signalr>,"<p>I try to write test for my Hub method, but I don't know as because there is no documentation or code examples for current (1.0.0-alpha2-final) version of SignalR. There is my code:</p>

<pre><code>[Fact]
public void SaveVisitorInfoTest()
{   
    //Arrange
    var chatHub = new ChatHub();
    var mockClients = new Mock&lt;IHubClients&gt;();
    chatHub.Clients = mockClients.Object;
    dynamic groups = new ExpandoObject();
    var groupName = ""SomeConversation"";
    string actualName = null;
    string expectedName = ""someName"";
    groups.SendVisitorInfo = new Action&lt;string, string&gt;(n =&gt; {
        actualName = n;
    });
    mockClients.Setup(_ =&gt; _.Group(groupName)).Returns(groups);

    //Act
    chatHub.Clients.Group(groupName).InvokeAsync(""SendVisitorInfo"", expectedName);

    // Assert
    Assert.Equal(expectedName, actualName);
}
</code></pre>

<p>Visual Studio generates next error message while running the test:</p>

<blockquote>
  <p>Microsoft.CSharp.RuntimeBinder.RuntimeBinderException :
  'Moq.Language.Flow.ISetup'
  does not contain a definition for 'Returns'</p>
</blockquote>

<p>In old versions mock clients and groups creation looks like this: </p>

<pre><code>var mockClients = new Mock&lt;IHubCallerConnectionContext&lt;dynamic&gt;&gt;();
dynamic groups = new ExpandoObject();
groups.SendVisitorInfo = new Action&lt;string, string&gt;(n =&gt; {
        actualName = n;
    });
mockClients.Setup(_ =&gt; _.Group(groupName)).Returns((ExpandoObject)groups)
</code></pre>

<p>But I can't use IHubCallerConnectionContext now, so I tried:</p>

<pre><code>var mockClients = new Mock&lt;IHubClients&gt;();
</code></pre>

<p>but i don't know how to create mock groups in this case</p>

<p>Sorry for my terrible english</p>
",6,3036,2017-11-24 11:01,,1,2,how
22465391,"Mock generic, dynamic interface with Moq",<dynamic><moq>,"<p>I have the following interface to mock out:</p>

<pre><code>internal interface IRenderer
{
    void Render&lt;T&gt;(StringWriter stringWriter, T item) where T : struct;

    void Render(StringWriter stringWriter, decimal item);

    void Render(StringWriter stringWriter, string item);
}
</code></pre>

<p>And a test as follows:</p>

<pre><code>[Test]
[TestCase(""dummy-string"", ""dummy-string"")]
[TestCase(123, ""123"")]
[TestCase(123.456, ""123.456"")]
[TestCase(true, ""True"")]
[TestCase('C', ""C"")]
public void RendersExpectedValues(dynamic item, string rendered)
{
    // Do some stuff
    using (var stringWriter = new StringWriter(renderedBuilder)
    {
        _mockRenderer.Setup(x =&gt; x.Render(textWriter, item));
        _renderer.Render(textWriter, item);
    }

   Assert.It.Worked();
}
</code></pre>

<p>As you can see, <code>item</code> is <code>dynamic</code>, the overload is determined at runtime... I've played around with </p>

<pre><code>Type type = item.GetType();
_mockRenderer.Setup(x =&gt; x.Render&lt;type&gt;(textWriter, item));
</code></pre>

<p>and</p>

<pre><code>Type type = item.GetType();
_mockRenderer.Setup(x =&gt; x.Render&lt;typeof(type)&gt;(textWriter, item));
</code></pre>

<p>Neither of which work (of course).</p>

<p>Is this possible?  I can remove the string test case to a separate test.</p>
",2,849,2014-03-17 21:05,,1,0,what
4962558,How do I make my extensions ignore Moq? Moq.Interceptor is not serializable,<c#><unit-testing><serialization><moq><clone>,"<p>I took a method from this <a href=""https://stackoverflow.com/questions/78536/cloning-objects-in-c""> post (accepted answer code) </a> that serializes object so that I can get a new copy of that object.</p>

<p>Now I am trying to do a unit test but everytime I gets to the object that I am trying to clone it comes up with</p>

<blockquote>
  <p>Tests.ServiceLayer.TestTService.Test_Something:
  System.Runtime.Serialization.SerializationException
  : Type 'Moq.Interceptor' in Assembly
  'Moq, Version=3.1.416.3,
  Culture=neutral,
  PublicKeyToken=69f491c39445e920' is
  not marked as serializable.</p>
</blockquote>

<p>So it seems to be that my mocked up object has some stuff in it that the clone is trying to copy but can't.</p>

<p>I am not unsure how to tell it to ignore these things. I would mock out the clone but I am using an extension method that I don't think I can mock out.</p>
",1,1172,2011-02-10 20:54,,1,2,how
61594400,Testing Promise.all with Jest/Vuex,<mocking><jestjs><vuex><es6-promise>,"<p>I am trying to test a Vuex action that uses Promise.all to fetch data from an API, and then commits a mutation based on the response. However, both my assertion test (<code>expect.assertions(1)</code>) and the test to see if the commit was called are failing.</p>

<p>My action is: </p>

<pre><code>fetchUserProfile ({ dispatch, commit}) {
      const userAccountFetch = api.get('/user/account');
      const userProfileFetch = api.get('/user/profile');
      const userItemsFetch = api.get(`/user/purchases`);
      Promise.all([
        userAccountFetch.catch((error) =&gt; {
          console.error(error);
          return { error, };
        }), 
        userProfileFetch.catch((error) =&gt; { 
          console.error(error); 
          return { error, };
        }),
        userItemsFetch.catch((error) =&gt; {
          console.error(error);
          return { error, };
        }),
      ]).then((responses) =&gt; {
          commit('setUserAccount', {responses});
        }
      });
  }
</code></pre>

<p>My test is as follows: </p>

<pre><code>jest.mock('@api/api.js', () =&gt; ({ get: jest.fn(), }));
const mockApi = require('@api/api.js');

test('fetchUserProfile performs commit on successful fetch', () =&gt; {
    const mockResponse = [{userAccount: ....}, {userProfile: ...}, {userItems: ....}];
    mockApi.get.mockReturnValueOnce(Promise.resolve(mockResponse[0]));
    mockApi.get.mockReturnValueOnce(Promise.resolve(mockResponse[1]));
    mockApi.get.mockReturnValueOnce(Promise.resolve(mockResponse[2]));
    expect.assertions(1);
    fetchUserProfile({ commit, state, }).then(() =&gt; expect(commit).toHaveBeenCalledTimes(1));
  });
</code></pre>

<p>I put console.logs throughout my action, and the test is making it down to the line where I perform my commit, but for some reason the test is not passing.
I'm not sure what is wrong here. Any help would be tremendously appreciate.</p>
",0,3735,2020-05-04 14:18,,1,0,what
63630216,Mock static method from external Class (that I can't change!),<c++><unit-testing><googlemock>,"<p>I want to mock (with gmock) a static function from a class that I can't change.
A is the class that I want to mock:</p>
<pre><code>Class A
{
public:
   static std::string get_id();
...
}
</code></pre>
<p>B is my class that I want to test with gmock:</p>
<pre><code>Class B
{
public:
   B(A *a_ptr);
   ...

   std::string foo();
private:
   A *m_a_ptr;
}

B::B(A *a_ptr) : m_a_ptr(a_ptr)
{
}

std::string B::foo()
{
   id = m_a_ptr-&gt;get_id();
   return id;
}
</code></pre>
<p>How can I mock the method get_id without changing the class A?</p>
",2,2371,2020-08-28 8:31,,1,4,how
63706202,"How do I unit test a Servlet Filter with jUnit? ServletRequest, ServletResponse, FilterChain",<java><junit><mocking><aem><junit4>,"<p>How to properly cover Filter with JUnit?</p>
<pre><code>@SlingFilter(order = -700, scope = SlingFilterScope.REQUEST)
public class LoggingFilter implements Filter {

    private final Logger logger = LoggerFactory.getLogger(getClass());

    @Override
    public void doFilter(final ServletRequest request, final ServletResponse response,
            final FilterChain filterChain) throws IOException, ServletException {

        final SlingHttpServletRequest slingRequest = (SlingHttpServletRequest) request;
        logger.debug(&quot;request for {}, with selector {}&quot;, slingRequest
                .getRequestPathInfo().getResourcePath(), slingRequest
                .getRequestPathInfo().getSelectorString());

        filterChain.doFilter(request, response);
    }

    @Override
    public void init(FilterConfig filterConfig) {}

    @Override
    public void destroy() {}

}
</code></pre>
",6,10128,2020-09-02 13:07,,3,0,how
42286394,Does nock only work if there is an Internet connection?,<reactjs><testing><redux><nock>,"<p>I've been having issues using <strong>nock</strong> to test my Redux action creators. When I go offline, I keep getting failed promises meaning the HTTP request using Axios was not successful. When I go online, it works, though. </p>

<blockquote>
  <p>So does nock only work if there is an Internet connection?</p>
</blockquote>

<p><strong>Action Creator (uses axios 0.15.3)</strong></p>

<pre><code>export const fetchSomething = (id) =&gt; {
  return dispatch =&gt; {
    dispatch({
      type: FETCH_SOMETHING_LOADING
    });

    return axios.get(`${SOMEWHERE}/something?id=${id}`)
      .then(response =&gt; {
        return dispatch({
          type: FETCH_SOMETHING_SUCCESS,
          payload: response.data
        });
      })
      .catch(error =&gt; {
        return dispatch({
          type: FETCH_SOMETHING_FAILURE
        });
      });
  };
};
</code></pre>

<p><strong>Jest test for the action creator (nock v9.0.2)</strong></p>

<pre><code>test('should dispatch success action type if data is fetched successfully', () =&gt; {
  // Need this in order for axios to work with nock
  axios.defaults.adapter = require('axios/lib/adapters/http');

  nock(SOMEWHERE)
    .get('/something?id=123')
    .reply(200, someFakeObject);

  thunk = fetchSomething(123);

  return thunk(dispatch)
    .then(() =&gt; {
      expect(dispatch.mock.calls[1][0].type).toBe('FETCH_SOMETHING_SUCCESS');
    });
});
</code></pre>
",2,800,2017-02-16 23:03,,2,0,what
77911604,how to change mock object return value only for one test?,<javascript><reactjs><jestjs><module><mocking>,"<p>I have a simple suite of tests where in some cases I want to change mock a module value and in some cases not. Anyone has an idea how it to do?</p>
<p>this is my mock object inside mockConfig.js file</p>
<pre><code>module.exports = {
  skillGames: {
    leftMenuWidget: {
      filterByBadge: 'exclusive',
      limit: 6,
      title: 'Exclusive games',
    },
  }
}
</code></pre>
<p>when I try mock mockConfig.js file for my test like this`</p>
<pre><code>jest.mock('helpers/test/mockConfig', () =&gt; ({
      __esModule: true,
      skillGames: {
        leftMenuWidget: {
          limit: 6,
          title: 'Exclusive games',
        },
      },
    }));
</code></pre>
<p>I set filterByBadge value undefined for all tests, but me need that it will be undefined only for one test</p>
",0,35,2024-01-31 7:48,,1,0,how
32149828,How do I testing large complex code?,<java><unit-testing><mocking>,"<p>I have a legacy code that contains little more than a 8700 lines with each method on average around 200-300 lines long. I was wondering how am I able to cover most of those code even to get an output of a successful result. </p>

<p>For example:</p>

<pre><code>    public class Aviation implements FlightStruct, FlightSystem extends Vehicles {
    ...var decoration...
    ...override method definitions...

    public controls aviation(Flight request, Flight destination, Flight target) {

    FlightResponse flightResponse = new FlightResponse();

    flightResponse.speed = target.speed;
    angularVel.calculate(greatCircle.flightResponse.speed);
    _readVelData();
    if (vel.circular.velocity &lt;= 10000) {
    for(countryName : country) {
    calculateArrivalTime();
    _readFuel();
    if(fuel.limit &lt; pwi.percent*100) {
           createShortPathLandingPoint(Path newDestination, Register checkPoint);
       }
    }
}
    private eqiptment company(String name, Vendor vendor) {
    ....calculate equiptment stuff that calls bunch of private methods
    }

 ...alot more method here
    }
}
</code></pre>

<p>I was wondering how should I go about to unit test these kind of code?
I have attempted to stubb data but the inner method is too complicated to walk through. Usually one method calls down multiple layers of sub methods.
For example....
the fuel class calls _readfuel and in _readfuel it calls destinationCheckPoint, flightWayPoint, flightSpeedCalc...then in each of those sub method it calls its own sub method. (ex. flightWaypoint calls calculateWayPoint, angVelocity, speedLimit, ....)
Overall I do not think this is doable by stubbing the data because finding the right data is difficult.
Then My second option was to use Mockito to mock the method / classes. Which sounds more reasonable to do, but again I encounter where there are multiple sub method which are private...and mockito cannot mock the private method. I then attempted to use PowerMockito to mock the private method it work for a few thousand lines and there was something like this:</p>

<pre><code>while (!report.successful &amp;&amp; !telCList.isEmpty()) {
...
report.wayPoint = update.assignWayPoint(wayPointList); //null point exception
...
</code></pre>

<p>where the update was null and few hundred lines above it was declared</p>

<pre><code> UpdateGateWay update = setDestinationWayPoint(distance, speed, altitude);
</code></pre>

<p>setDestinationWayPoint is a private method and I use powerMockito to mock the behavior I have also returned the value as part of the stub. but when it get called below it become null.</p>

<p>I pretty much give up at this point. I was wondering if there would be more reasonable way to do this type of testing....</p>
",0,978,2015-08-21 21:56,,2,0,how
17496131,PhantomJS integration testing with angular against live backend,<angularjs><mocking><angularjs-e2e>,"<p>I am trying to make my e2e test environment to be like the actual production environment. I discovered that when I take out the ngMockE2E from my app and run tests that actually hit the backend server then all my tests in PhantomJS fail. In all other browsers tests always pass. </p>

<p>I'm not sure what the cause of this is. All I know is that when I put the ngMockE2E back in then all tests pass in PhantomJS and when I take it out the tests that depend on the xhttp request fail. </p>

<p>One more thing the live backend is cross origin. But like I said it works fine in all other browsers. I'm wondering if PhantomJS doesn't have cors support.</p>

<p>Does anyone know how to remedy this? Am I supposed to always use the mocks?</p>
",1,445,2013-07-05 20:02,,1,0,how
34829439,Laravel Mockery - Mocking a class with dependencies injected into constructor,<php><laravel><mocking><phpunit><mockery>,"<p>I am trying to mock a class with it's own constructor dependencies. I am using Laravel 5.2.</p>

<pre><code>class A {
    public function something() {}
}    

class B {
  protected $a;
  public function __construct(A $a) {
    $this-&gt;a = $a;
  }

  public function getA() {
    return $this-&gt;a-&gt;something();
  }
}

MockingTest extends TestCase {

  public function testItGetsSomething() {
    $m = Mockery::mock('B');
    $m-&gt;shouldReceive('getA')-&gt;once()-&gt;andReturn('Something');
  }
}
</code></pre>

<p>I am aware that I can change my <code>ClassB.__construct(A $a)</code> to:</p>

<pre><code>  public function __construct(A $a = null) {
    $this-&gt;a = $a ?: new A();
  }
</code></pre>

<p>But is there a better / cleaner way of doing this? I don't want to change my constructor code just for the sake of unit testing if there is a more acceptable method.</p>
",3,2150,2016-01-16 16:43,,1,0,what
64499695,JSONDecodeError on response.json() after API GET request on unit test Python,<python><json><unit-testing><mocking>,"<p>I am struggling with some unit testing on API requests and I am getting this <code>JSONDecodeError</code> in my unit test which doesn't make sense to me because the response is content-type <code>application/json</code> and it is not empty. At this point I don't have more ideas what is causing that.</p>
<p>My api requests module:</p>
<pre><code>import requests
from netrc_auth import netrc_authentication
from config import HOST


client = requests.session()
user, password = netrc_authentication(HOST)

response = client.get(
        f&quot;https://{HOST}:8000/rest/folder/info?&quot;
        f&quot;name=test-name&quot;,
        auth=(user, password)
    )
response_json = response.json()

if(
    response.status_code == 200
    and response_json[&quot;errors&quot;][0][&quot;desc&quot;] == &quot;No such folder!&quot;
  ):
      client.post(
            f&quot;https://{HOST}:8000/rest/folder/create?&quot;
            f&quot;name=test-name&quot;
            f&quot;&amp;path={BASE_PATH}/test&quot;,
            auth=(user, password),
        )
</code></pre>
<p>unit tests module:</p>
<pre><code>def test_check_folder(monkeypatch, requests_mock, host, credentials):
    client = requests.session()

    if credentials == &quot;&quot;:
        monkeypatch.setattr(netrc_authentication, &quot;netrc_authentication&quot;, mock_authentication)
        user, password = netrc_authentication(HOST)
        requests_mock.get(
            f&quot;https://{HOST}:8000/rest/folder/info?&quot;
            f&quot;name=test-name&quot;,
            text=&quot;Unauthorized&quot;,
            status_code=401,
        )

        response = client.get(
            f&quot;https://{HOST}:8000/rest/folder/info?&quot;
            f&quot;name=test-name&quot;,
            auth=(user, password)
        )
        assert response.status_code == 401
    else:
        user, password = netrc_authentication(host)

        requests_mock.get(
            f&quot;https://{HOST}:8000/rest/folder/info?&quot;
            f&quot;name=test-name&quot;,
            text=&quot;OK&quot;,
            status_code=200,
        )

        response = client.get(
            f&quot;https://{HOST}:8000/rest/folder/info?&quot;
            f&quot;name=test-name&quot;,
            auth=(user, password)
        )
        response_json = response.json()
        if (
            response.status_code == 200
            and response_json[&quot;errors&quot;][0][&quot;desc&quot;]
            == &quot;No such folder!&quot;
        ):
            requests_mock.post(
                f&quot;https://{HOST}:8000/rest/folder/create?&quot;
                f&quot;name=test-name&quot;
                f&quot;&amp;path={BASE_PATH}/test&quot;,
                auth=(user, password),
                text=&quot;OK&quot;,
                status_code=201,
            )

            response = client.post(
                f&quot;https://{HOST}:8000/rest/folder/create?&quot;
                f&quot;name=test-name&quot;
                f&quot;&amp;path={BASE_PATH}/test&quot;,
                auth=(user, password),
            )
            assert response.status_code == 201
        else:
            assert response.status_code == 200
</code></pre>
<p>It fails on the part <code>response_json = response.json()</code> of the unit test with <code>json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0) </code>.Any ideas what else I can try?</p>
",0,641,2020-10-23 12:07,,0,2,why
45236078,Moq: setup a constructor of a base class,<c#><unit-testing><moq><dbcontext>,"<p>I use Entity Framework in my ASP.NET project and I have to setup <code>ApplicationDbContext</code> constructor in this way:</p>

<pre><code>public ApplicationDbContext()
    : base(DBUtils.Configuration.GetConnection(), false)
{
}
</code></pre>

<p><code>DBUtils.Configuration.GetConnection()</code> returns an instance of <code>DbConnection</code> with all proper settings (e.g. connection string). <code>ApplicationDbContext</code> is inserting in every service constructor with <code>Ninject</code>.</p>

<p>It works perfectly but it make some problems during writing test methods. In others projects (with a default <code>ApplicationDbContext</code> constructor) I just mocked database object like this: <code>db = new Mock&lt;ApplicationDbContext&gt;()</code> in <code>[TestInitialize]</code> method:</p>

<pre><code>[TestClass]
public class MyServiceTest
{
    private MyService _service;
    private Mock&lt;ApplicationDbContext&gt; _db;

    [TestInitialize]
    public void Initialize()
    {
        _db = new Mock&lt;ApplicationDbContext&gt;();
    }

    //test methods
}
</code></pre>

<p>But now I need to insert <code>DbConnection</code> (probably by <code>DBUtils.Configuration.GetConnection()</code>, right?) to <code>:base()</code> of constructor in <code>ApplicationDbContext</code> and I cannot foind any solution how to do it. Simply assigned like:</p>

<pre><code>[TestInitialize]
public void Initialize()
{
    _db = new Mock&lt;ApplicationDbContext&gt;();
    _db.Object.Database.Connection = DBUtils.Configuration.GetConnection();
}
</code></pre>

<p>or</p>

<pre><code>[TestMethod]
public void Some_Test_Method()
{
    //...do stuff...
    _db.Setup(x =&gt; x.Database.Connection).Returns(DBUtils.Configuration.GetConnection());
    //...do stuff...
}
</code></pre>

<p>is obviously not working.</p>

<p>If I not apply connection in test class I get exception: <em>Failed to find or load the registered .Net Framework Data Provider</em> for every test method with stack trace:</p>

<pre><code>Result StackTrace:  
in System.Data.Common.DbProviderFactories.GetFactory(DataRow providerRow)   
   in System.Data.Common.DbProviderFactories.GetFactory(String providerInvariantName)    
   in DBUtils.Configuration.GetConnection(String providerName)    
   in Invoices.Models.ApplicationDbContext..ctor() w C:\Users\user\Documents\Visual Studio 2015\Projects\Invoice\Invoices\Models\IdentityModels.cs:line 61    
   in Castle.Proxies.ApplicationDbContextProxy..ctor(IInterceptor[] )
 --- End of inner exception stack trace ---
</code></pre>

<p>Where line 61 is exactly <code>: base(DBUtils.Configuration.GetConnection(), false)</code></p>

<p>So the question is: how can I insert an instance of my <code>DbConnection</code> into <code>:base()</code> in Moq project?</p>

<p><strong>@EDIT:</strong></p>

<p>Everything working if I modify <code>ApplicationDbContext</code> constructor in this way:</p>

<pre><code>public ApplicationDbContext()
    : base(""DefaultConnection"", throwIfV1Schema: false)
{
    try
    {
        var connectionString = DBUtils.Configuration.GetConnection().ConnectionString;

        this.Database.Connection.ConnectionString = connectionString;
        this.SaveChanges();
    }
    catch (Exception ex)
    {
        //log exception here
    }
}
</code></pre>

<p>But like I said before: I would rather setup database connection by inserting them into constructor.</p>
",1,1715,2017-07-21 11:05,,0,5,how
21316985,Java SVNKit Mock for JUnit tests,<java><unit-testing><junit><mocking><svnkit>,"<p>I'm working on an SVN Monitor and I need to Mock an instance of a SVNRepository for testing.</p>

<p>I've seen this code here in another question (<a href=""https://stackoverflow.com/questions/876993/mock-svn-instance-for-testing-svnkit-tests"">Mock svn instance for testing svnkit tests</a>)</p>

<pre><code>import static org.junit.Assert.*;
import java.io.*;
import org.apache.commons.io.FileUtils;
import org.junit.*;
import org.tmatesoft.svn.core.*;

public class SVNTest {

    private static final String path = ""/tmp/testrepo"";
    SVNURL tgtURL;

    @Before
    public void setUp() throws Exception {
        SVNRepositoryFactoryImpl.setup();
        tgtURL = SVNRepositoryFactory.createLocalRepository( new File( path ), true , false );
    }

    @After
    public void tearDown() throws IOException {
        FileUtils.deleteDirectory(new File(path));
    }

    @Test
    public void test() {
        fail(""Not yet implemented"");
    }

}
</code></pre>

<p>And it works like charm, but now I need to add SVNLogEntries to the repo...
I've been looking in the API but I haven't found anything useful yet. Any Ideas?</p>
",2,595,2014-01-23 18:55,,1,0,other
16911740,Mock never called,<python><django><unit-testing><mocking><python-mock>,"<p>I tried to implement a mock in my unit tests but it is never called, even though it should.</p>

<p>tests.py</p>

<pre><code>from mock import patch

class MyTest(TestCase):
    def test_add(self):
        name = 'Test'

        with patch('my_module.my_file.my_function') as add_method:
            m = MyModel(name=name)
            m.save()

        add_method.assert_called_with(name=name)
</code></pre>

<p>models.py</p>

<pre><code>from my_module.my_file import my_function

class MyModel(Model):
    name = CharField(max_length=12)

    def save(self, *args, **kwargs):
        my_function(self.name)

        super(MyModel, self).save(*args, **kwargs)
</code></pre>

<p>my_file.py</p>

<pre><code>def my_function(name):
    # Processing...
</code></pre>

<p>When I run the unit test, it just tells me the mock has not been called, though it should be, I know the script works fine. Do you have any idea/advice for me?</p>
",2,142,2013-06-04 7:07,,1,0,what
63575621,How to pass a model attribute to Thymeleaf when using Spring @WebMvcTest with Junit5,<spring><spring-mvc><mocking><integration-testing><junit5>,"<p>I am pretty new to Spring and testing. I have a simple application in which I use Thymeleaf and pass a TITLE text attribute via the .addAttribute method of the Model in the controller.</p>
<p>Trying to integration test the http response using JUnit5 with the WebMvcTest annotation it throws an exception on reaching the Thymeleaf TITLE attribute in the layout fragment. It works fine when I bypass the HEAD fragment exchange so it's pretty obvious to me I need to somehow pass the attribute to the mocked web context but can't find a simple answer anywhere.</p>
<pre><code>@Controller
public class IndexController {

    @RequestMapping({&quot;&quot;, &quot;/&quot;, &quot;index&quot;, &quot;index.html&quot;})
    public String getIndexPage(Model model){

        model.addAttribute(&quot;title_text&quot;, &quot;an index title&quot;);
        return &quot;index&quot;;
    }
}
</code></pre>
<p>In the index.html page is simply a replace command to add the HEAD from the layout fragment;</p>
<pre><code>&lt;head th:replace=&quot;fragments/layout :: head_tag&quot;&gt;
    &lt;title&gt;Bringbackdada.com&lt;/title&gt;
&lt;/head&gt;
</code></pre>
<p>In the layout.html is the TITLE tag of the fragment that throws the exception;</p>
<pre><code>&lt;head th:fragment=&quot;head_tag&quot;&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;

    &lt;title th:text=&quot;${title_text}&quot;&gt;title text&lt;/title&gt;

    &lt;link rel=&quot;stylesheet&quot; th:href=&quot;@{/resources/css/main.css}&quot;/&gt;
&lt;/head&gt;
</code></pre>
<p>And the integration test I am trying to perform;</p>
<pre><code>@WebMvcTest(controllers = IndexController.class)
class IndexControllerIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @Test
    void getIndexPageResponse() throws Exception {
        mockMvc.perform(get(&quot;/&quot;))
                .andExpect(status().isOk());
    }
}
</code></pre>
<p>And the stacktrace;</p>
<pre><code>org.springframework.web.util.NestedServletException: Request processing failed; nested exception is org.thymeleaf.exceptions.TemplateProcessingException: Error during execution of processor 'org.thymeleaf.spring5.processor.SpringHrefTagProcessor' (template: &quot;fragments/layout&quot; - line 14, col 28)

    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:626)
    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)
    at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:733)
    at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:167)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:134)
    at org.springframework.web.servlet.resource.ResourceUrlEncodingFilter.doFilter(ResourceUrlEncodingFilter.java:64)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:134)
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:134)
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:134)
    at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:183)
    at com.bringbackdada.site.controllers.IndexControllerIntegrationTest.getIndexPageResponse(IndexControllerIntegrationTest.java:22)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.base/java.lang.reflect.Method.invoke(Method.java:566)
    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:686)
    at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
    at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
    at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
    at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
    at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
    at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$6(TestMethodTestDescriptor.java:212)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:208)
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:137)
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:71)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$5(NodeTestTask.java:135)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$7(NodeTestTask.java:125)
    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:135)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:123)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:122)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:80)
    at java.base/java.util.ArrayList.forEach(ArrayList.java:1540)
    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:38)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$5(NodeTestTask.java:139)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$7(NodeTestTask.java:125)
    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:135)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:123)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:122)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:80)
    at java.base/java.util.ArrayList.forEach(ArrayList.java:1540)
    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:38)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$5(NodeTestTask.java:139)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$7(NodeTestTask.java:125)
    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:135)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:123)
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:122)
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:80)
    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:32)
    at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
    at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:51)
    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:248)
    at org.junit.platform.launcher.core.DefaultLauncher.lambda$execute$5(DefaultLauncher.java:211)
    at org.junit.platform.launcher.core.DefaultLauncher.withInterceptedStreams(DefaultLauncher.java:226)
    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:199)
    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:132)
    at com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:71)
    at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)
    at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:220)
    at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:53)
Caused by: org.thymeleaf.exceptions.TemplateProcessingException: Error during execution of processor 'org.thymeleaf.spring5.processor.SpringHrefTagProcessor' (template: &quot;fragments/layout&quot; - line 14, col 28)
    at org.thymeleaf.processor.element.AbstractAttributeTagProcessor.doProcess(AbstractAttributeTagProcessor.java:117)
    at org.thymeleaf.processor.element.AbstractElementTagProcessor.process(AbstractElementTagProcessor.java:95)
    at org.thymeleaf.util.ProcessorConfigurationUtils$ElementTagProcessorWrapper.process(ProcessorConfigurationUtils.java:633)
    at org.thymeleaf.engine.ProcessorTemplateHandler.handleStandaloneElement(ProcessorTemplateHandler.java:918)
    at org.thymeleaf.engine.StandaloneElementTag.beHandled(StandaloneElementTag.java:228)
    at org.thymeleaf.engine.Model.process(Model.java:282)
    at org.thymeleaf.engine.ProcessorTemplateHandler.handleOpenElement(ProcessorTemplateHandler.java:1587)
    at org.thymeleaf.engine.OpenElementTag.beHandled(OpenElementTag.java:205)
    at org.thymeleaf.engine.TemplateModel.process(TemplateModel.java:136)
    at org.thymeleaf.engine.TemplateManager.parseAndProcess(TemplateManager.java:661)
    at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1098)
    at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1072)
    at org.thymeleaf.spring5.view.ThymeleafView.renderFragment(ThymeleafView.java:362)
    at org.thymeleaf.spring5.view.ThymeleafView.render(ThymeleafView.java:189)
    at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1373)
    at org.springframework.test.web.servlet.TestDispatcherServlet.render(TestDispatcherServlet.java:136)
    at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1118)
    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1057)
    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)
    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)
    ... 80 more
Caused by: java.lang.NullPointerException
    at org.webjars.WebJarAssetLocator.getFullPathExact(WebJarAssetLocator.java:262)
    at org.springframework.web.servlet.resource.WebJarsResourceResolver.findWebJarResourcePath(WebJarsResourceResolver.java:109)
    at org.springframework.web.servlet.resource.WebJarsResourceResolver.resolveUrlPathInternal(WebJarsResourceResolver.java:94)
    at org.springframework.web.servlet.resource.AbstractResourceResolver.resolveUrlPath(AbstractResourceResolver.java:54)
    at org.springframework.web.servlet.resource.DefaultResourceResolverChain.resolveUrlPath(DefaultResourceResolverChain.java:82)
    at org.springframework.web.servlet.resource.CachingResourceResolver.resolveUrlPathInternal(CachingResourceResolver.java:170)
    at org.springframework.web.servlet.resource.AbstractResourceResolver.resolveUrlPath(AbstractResourceResolver.java:54)
    at org.springframework.web.servlet.resource.DefaultResourceResolverChain.resolveUrlPath(DefaultResourceResolverChain.java:82)
    at org.springframework.web.servlet.resource.ResourceUrlProvider.getForLookupPath(ResourceUrlProvider.java:239)
    at org.springframework.web.servlet.resource.ResourceUrlEncodingFilter$ResourceUrlEncodingRequestWrapper.resolveUrlPath(ResourceUrlEncodingFilter.java:124)
    at org.springframework.web.servlet.resource.ResourceUrlEncodingFilter$ResourceUrlEncodingResponseWrapper.encodeURL(ResourceUrlEncodingFilter.java:157)
    at org.thymeleaf.linkbuilder.StandardLinkBuilder.processLink(StandardLinkBuilder.java:528)
    at org.thymeleaf.linkbuilder.StandardLinkBuilder.buildLink(StandardLinkBuilder.java:138)
    at org.thymeleaf.context.AbstractEngineContext.buildLink(AbstractEngineContext.java:167)
    at org.thymeleaf.standard.expression.LinkExpression.executeLinkExpression(LinkExpression.java:290)
    at org.thymeleaf.standard.expression.SimpleExpression.executeSimple(SimpleExpression.java:85)
    at org.thymeleaf.standard.expression.Expression.execute(Expression.java:109)
    at org.thymeleaf.standard.expression.Expression.execute(Expression.java:138)
    at org.thymeleaf.standard.processor.AbstractStandardExpressionAttributeTagProcessor.doProcess(AbstractStandardExpressionAttributeTagProcessor.java:144)
    at org.thymeleaf.processor.element.AbstractAttributeTagProcessor.doProcess(AbstractAttributeTagProcessor.java:74)
    ... 99 more
</code></pre>
<p>EDIT: It turns out having been an issue in the Maven packaging that somehow got corrupted since I last time worked with the code a few hours ago.</p>
",0,500,2020-08-25 9:11,,1,2,other
15647418,How to mock an exception when creating an instance of a new class using Mockito,<java><junit><mocking><mockito>,"<p>Within a method, I have an exception being caught which I want to mock.</p>

<p>I know how to mock an object to throw an exception using mock.doSomething(), but I need to throw a remote exception when a class makes a new instance of itself.</p>

<pre><code>transient Bicycle bike = null;

public Bicycle getBicycle() {
    if (bike == null) {
        try {
            bike = new Bicycle(this);
        } catch (RemoteException ex) {
            System.out.println(""No bikes found"");
        }
    }
    return bike;
}
</code></pre>

<p>I want to be able to mock everything in the try block, but I don't understand how you mock the creation of a new class, the following line to be specific:</p>

<pre><code>bike = new Bicycle(this);
</code></pre>

<p>I have tried many different Mockito tests, such as:</p>

<pre><code>Bicycle b = mock(Bicycle.class);
Mockito.doThrow(new RemoteException()).when(b = new Bicycle());
</code></pre>

<p>Although I understand this will and is not working, I want to do something similar.</p>

<p>I have read the Mockito docs and haven't found anything useful:</p>

<p><a href=""http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html"" rel=""noreferrer"">http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html</a></p>
",11,18357,2013-03-26 21:06,,3,2,how
20500135,EasyMock - do you have to reset() mocks after test?,<java><unit-testing><mocking><easymock>,"<p>I think the answer is yes, but I was unable to find anything definite in the easymock  <a href=""http://easymock.org/EasyMock3_0_Documentation.html"" rel=""nofollow"">documentation</a>.</p>

<p>I'm getting an error when first test is mocking a class, and then another test is using this class in a regular way. The class turns out to be mocked in the second test and fails with unexpected invocation.</p>

<p>Is there a way to automate the cleanup, besides using the <code>EasyMockSupport</code> and calling <code>resetAll()</code> in <code>@After</code> method (preferably something that doesn't have to be repeated in each class)?</p>
",4,8744,2013-12-10 16:41,,2,1,what
47643192,How to mock functions in golang,<go><mocking>,"<p>I have written a simple package, which basically consists of a lot of getter functions. Each file in this package corresponds to a service, so for instance the product file, contains functions relating to the product service/db, order file to order service etc. Each function takes as parameters a db resource to the underlying db, and parameters for the sql, eg. productid, name, orderid. Each of the functions returns a struct (eg. Order, product) or an error:</p>

<pre><code>// product.go

package lib

type Product struct {
   ID int
   Name string
   Price float
}

func GetProductById(DB *sql.DB, ID int) (p Product, err error) {
   q := ""SELECT * FROM product WHERE id = "" + ID
   ...
}

func GetProductByName(DB *sql.DB, name string) (p Product, err error) {
   ...
}

// order.go

package lib

type Order struct {
   ID int
   Date string
   Items []items
}

func GetOrderById(DB *sql.DB, ID int) (o Order, err error) {
   ...
}
</code></pre>

<p>The problem is that I'm not able to mock these functions from my main package. What I really like to do, is to rewrite the package, so I somehow can pass to function to a type instead. But I'm not sure how to do this. Especially not when the functions take different input parameters and return different structs. Is there a way to do this?</p>
",8,18767,2017-12-04 22:42,,1,0,what
62596812,Angular Testing - TypeError: Cannot read property '7' of undefined,<angular><testing><mocking><jasmine><session-storage>,"<p>I'm new to the Angular Testing and I'm trying to make this test work, but can't find a way to solve this. If anyone has any thoughts, please.</p>
<blockquote>
<p>TypeError: Cannot read property '7' of undefined
at 
at AnaliseContasTitularComponent.ngOnInit (http://localhost:9876/<em>karma_webpack</em>/src/app/extratos-mensais-interno/analise-contas-titular/analise-contas-titular.component.ts:103:2)</p>
</blockquote>
<p>Executing this command to execute the test:</p>
<blockquote>
<p>ng test --codeCoverage=true --progress=false --watch=false</p>
</blockquote>
<p>My test unit file:</p>
<pre><code>import { Overlay } from '@angular/cdk/overlay';
import { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';
import { InjectionToken } from '@angular/core';
import { MAT_DIALOG_SCROLL_STRATEGY, MatDialog } from '@angular/material/dialog';
import { MatSnackBar } from '@angular/material/snack-bar';
import { RouterTestingModule } from '@angular/router/testing';
import { AnaliseContasTitularComponent } from './analise-contas-titular.component';

import { ExtratosMensaisInternoService } from '../extratos-mensais-interno.service';

describe('AnaliseContasTitularComponent', () =&gt; {
  let component: AnaliseContasTitularComponent;
  let fixture: ComponentFixture&lt;AnaliseContasTitularComponent&gt;;

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      imports: [ RouterTestingModule, HttpClientTestingModule ],
      declarations: [ AnaliseContasTitularComponent ],
      providers: [ MatDialog, Overlay, MatSnackBar,
        { provide: InjectionToken, useValue: {} },
        { provide: MAT_DIALOG_SCROLL_STRATEGY, useValue: {} },
      ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(AnaliseContasTitularComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });
  

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});
</code></pre>
<p>the ngOnInit methor on the .ts file:</p>
<pre><code>ngOnInit(): void {
    const competencia: CompetenciaInterno = this.serv.getCompetenciaSelecionada();

    this.serv.getExtratoMensal(competencia[7]).subscribe((res: ExtratoMensalData) =&gt; {
      this.extratoMensal = res.data;
    }, (error: HttpErrorResponse) =&gt; {
      this.utils.showDialogError(error);
    });

  }
</code></pre>
<p>And the service file, with the method that is called by the ngOnInit:</p>
<pre><code>getCompetenciaSelecionada(): CompetenciaInterno {
    return JSON.parse(sessionStorage.getItem('competenciaInterno'));
  }
</code></pre>
<p>I can't find an example on the internet dealing with the mocking data in a way that works.</p>
<p>I just need to stop this error, because I have multiple files ocurring that same error. For me to proceed with other tests.</p>
<p>Thank you</p>
",1,412,2020-06-26 14:21,,1,0,what
56975736,How to mock function to return response with attributes?,<python><unit-testing><mocking><python-unittest>,"<p>I'm messing around with <code>unittest.mock</code> and got some problems with it.</p>

<p>I have an object <code>client</code> with method <code>get_messages()</code> which returns <code>response</code> with attributes <code>data</code> and <code>has_more</code>. I want to mock it to return fixed <code>data</code> and <code>has_more</code> in first call and another fixed <code>data</code> and <code>has_more</code> in second call.</p>

<p>In first call I want to receive object <code>response</code> with attributes:
<code>data=['msg1', 'msg2']</code>
<code>has_more=True</code> </p>

<p>In second call I want to receive object <code>response</code> with attributes:</p>

<p><code>data=['msg3', 'msg4']</code></p>

<p>I've been trying doing it this way, but I'm kind of confused, no idea if this is the way.</p>

<pre class=""lang-py prettyprint-override""><code>@patch('Client')
def test_client_returns_correct_messages(self, MockClient):
    MockWebClient.get_messages.side_effects = [
    Mock(name='response',
         data={'messages': received_messages,
               'has_more': True}),
    Mock(name='response',
         data={'messages': received_messages,
               'has_more': False})]

messages = client.get_messages()
</code></pre>
",2,1562,2019-07-10 17:22,,2,1,other
57159931,Jest mocking a function within another function,<node.js><mocking><jestjs>,"<p>I have searched quite a bit, and whilst there are many questions asked about mocking functions, none of the solutions I've found work for my setup, and I'm not quite sure why. I have the following:</p>

<p><strong><em>questionnaire-service.js</em></strong></p>

<pre><code>const service = require('./request-service')();

function questionnaireService() {
    function createQuestionnaire() {
        const opts = {
            url: `http://some-url.com`,
            body: {
                data: ""some-data""
            }
        };
        return service.post(opts);
    }

    return Object.freeze({
        createQuestionnaire
    });
}

module.exports = questionnaireService;
</code></pre>

<p><strong><em>request-service.js</em></strong></p>

<pre><code>const got = require('got');
const merge = require('lodash.merge');

function requestService() {
    function post(options) {
        let opts = {
            method: 'POST',
            headers: {
                accept: 'application/json',
                'Content-Type': 'application/json'
            },
            json: true,
            body: options.body
        };
        opts = merge(opts, options);
        return got(opts.url, opts);
    }

    return Object.freeze({
        post
    });
}

module.exports = requestService;
</code></pre>

<p>I am trying to write tests for the questionnaire service, and want to mock the 'post' function. I have tried the following</p>

<p><strong><em>questionnaire-service.test.js</em></strong></p>

<pre><code>const requestService = require('./request-service')();
const questionnaireService = require('./questionnaire-service')();
const createdQuestionnaire = require('./test-fixtures/res/get_questionnaire.json');

describe('questionnaire service routes', () =&gt; {
    it('Should create a new questionnaire', async () =&gt; {
        const spy = jest.spyOn(requestService.post);
        spy.mockReturnValue(createdQuestionnaire);

        const response = await questionnaireService.createQuestionnaire();

        expect(requestService.post).toBeCalled();
        expect(response).toMatch(createdQuestionnaire);
    }

    it('Should create a new questionnaire', async () =&gt; {
        jest.doMock('./questionnaire-service', () =&gt;
            jest.fn(() =&gt; ({
                createQuestionnaire: () =&gt; createdQuestionnaire
            }))
        );

        const response = await questionnaireService.createQuestionnaire();

        expect(questionnaireService.createQuestionnaire).toBeCalled();
        expect(response).toMatch(createdQuestionnaire);
    }

    it('Should create a new questionnaire', async () =&gt; {
        jest.doMock('./request-service', () =&gt;
            jest.fn(() =&gt; ({
                post: () =&gt; createdQuestionnaire
            }))
        );

        const response = await questionnaireService.createQuestionnaire();

        expect(requestService.post).toBeCalled();
        expect(response).toMatch(createdQuestionnaire);
    }
});
</code></pre>

<p>All of the above yield the same error: <code>RequestError: getaddrinfo ENOTFOUND some_token some_token:443</code> which sounds like it's being thrown by the 'GOT' module not finding a url to hit. Can someone shed some light on how to get this to work correctly?</p>
",0,907,2019-07-23 8:32,,1,0,how
54399080,Nock.js: how do I check for the existence of a header?,<node.js><nock>,"<p>I am using Nock with Mocha, and want to check that certain headers exist on a request. I don't care about the other headers, and I don't care about the specific content of the headers whose existence I'm checking for. Is there an easy way to do this? <code>.matchHeader()</code> passes when the specific header is absent, and <code>reqheaders</code> fails unless I specify all the header fields.</p>
",9,8346,2019-01-28 9:39,,1,0,what
75670979,How to write unit test case for a Golang function in which one or more function calls are there and they have to be mocked?,<unit-testing><go><mocking><testify>,"<p>I am new to Golang. I am trying to write unit test cases for the functions that I implemented. Here is one such,</p>
<pre><code>func SaveProjectInfo(projectInfo processor.ProjectInfo, configMap map[string]string, client *mongo.Client) error {
    collection := client.Database(configMap[constants.Dbname_str_key]).Collection(configMap[constants.Db_collection_str])
    return UpsertProjectInfo(collection, projectInfo)
}
</code></pre>
<p>Here, the function takes 3 arguments, out of which first two can be created with stubbed data. I am trying to create a mock mongo client using go.mongodb.org/mongo-driver/mongo/integration/mtest -</p>
<pre><code>mt := mtest.New(t, mtest.NewOptions().ClientType(mtest.Mock)) 
defer mt.Close() 
client := mt.Client
</code></pre>
<p>Which looks to be not working, as it ends up creating a nil client.</p>
<p>Also, <code>func UpsertProjectInfo()</code> that makes a real-time mongo call, is being invoked here internally and it is required to be mocked for the sake of writing unit test case of <code>func SaveProjectInfo()</code>.
I looked into the Testify mock package from here, <a href=""https://github.com/stretchr/testify"" rel=""nofollow noreferrer"">https://github.com/stretchr/testify</a>. However, I could not quite figure out how to make use of the testObj(which I am going to set mock expectations to) during the actual function call.</p>
<p>Kindly guide, thank you!</p>
",3,422,2023-03-08 8:50,,0,0,how
9486884,How to mock a javax.mail.Address?,<java><mocking>,"<pre><code>import javax.mail.Address;

public class MockAddress extends Address{

    @Override
    public String getType() {
        // TODO Auto-generated method stub
        return ?;
    }

    @Override
    public String toString() {
        // TODO Auto-generated method stub
        return ?;
    }

    @Override
    public boolean equals(Object address) {
        // TODO Auto-generated method stub
        return ?;
    }

}
</code></pre>

<p>Where I need add some code to change email on my fake email?</p>
",0,327,2012-02-28 17:34,,1,0,other
55639557,In C# Unit test how do equivalent of Java's Spy (instead of Mock) to only mock some methods on a class?,<c#><visual-studio><unit-testing><mocking>,"<p>In Java, when I have a class that calls some other class' static method, I always encapsulate this so I can test it without actually hitting that real resource. For example:</p>

<pre><code>public class HasSomeStaticCall
{
    public HasSomeStaticCall()
    {
        this.something = callStaticThing();
    }

    protected String callStaticThing()
    {
        return SomeThirdParty.getFromStaticMethod();
    {
}
</code></pre>

<p>In Java, I can then use <code>Spy</code> instead of <code>Mock</code> and then use all the real methods except for that one.</p>

<p>Example:</p>

<pre><code>public void test()
{
    HasSomeStaticCall obj = Mockito.spy( HasSomeStaticCall.class );

    //Only mock this one method
    Mockito.doReturn( ""SomeValue"" ).when( obj ).callStaticThing();
}
</code></pre>

<p>How would I do this in C#? (I'm using the .Net Framework 4.7.x, <em>not</em> .Net Core) </p>
",9,8309,2019-04-11 19:06,,1,6,how
12562542,Unit test an asynchronous callback method that is used when peek is completed,<c#><moq><mstest><msmq>,"<p>I wish to unit test a callback method that is called when a peek to a messagequeue is completed and can't figure out how to do this.</p>

<p>My abstract class;</p>

<pre><code>public abstract class QueueHandler : WindowsServiceBase
{
    private readonly IMessageQueueWrapper _listeningQueue;
    private PeekCompletedEventHandler _peekHandler;

    protected QueueHandler(IMessageQueueWrapper listeningQueue) 
        : base()
    {
        _listeningQueue = listeningQueue;
    }

    protected override void ExecuteInternal()
    {
        _listeningQueue.BeginPeek();
    }

    protected override void ConfigureInternal()
    {
        if (_peekHandler != null) return;

        _peekHandler = OnPeekCompleted;
        _listeningQueue.PeekCompleted += OnPeekCompleted;
    }

    protected void OnPeekCompleted(object sender, PeekCompletedEventArgs e)
    {
        try
        {
            var msg = _listeningQueue.EndPeek(e.AsyncResult);

            ...
        }
        catch (Exception ex)
        {
            ...
        }
    }
}
</code></pre>

<p>My concrete class used for unittesting;</p>

<pre><code>internal class QueueuHandlerImplementation : QueueHandler
{
    public QueueuHandlerImplementation(IMessageQueueWrapper listeningQueue)
        : base(listeningQueue)
    {
    }
}
</code></pre>

<p>My unit test;</p>

<pre><code>public void OnPeekCompletedWhenBeginPeekShouldCallOnPeekCompleted()
{
        QueueuHandlerImplementation queueHandler = new QueueuHandlerImplementation(_listeningQueueMock.Object);

    //Arrange
    queueHandler.Configure();
    _listeningQueueMock.Setup(m =&gt; m.BeginPeek()).Raises(
                    m =&gt; m.PeekCompleted += null, new PeekCompletedEventArgs() { AsyncResult = new Mock&lt;IAsyncResult&gt;().Object});

    //Act
    _queueHandler.Execute();

    //Assert
    Assert.AreEqual(true, _queueHandler.IsConfigured);
}
</code></pre>

<p>This is not possible since <code>PeekCompletedEventArgs</code> does not have a default constructor.</p>

<pre><code>public void OnPeekCompletedWhenBeginPeekShouldCallOnPeekCompleted()
{
        QueueuHandlerImplementation queueHandler = new QueueuHandlerImplementation(_listeningQueueMock.Object);

    //Arrange
    queueHandler.Configure();
    _listeningQueueMock.Setup(m =&gt; m.BeginPeek()).Raises(
                m =&gt; m.PeekCompleted += null, PeekCompletedEventArgs.Empty);

    //Act
    _queueHandler.Execute();

    //Assert
    Assert.AreEqual(true, _queueHandler.IsConfigured);
}
</code></pre>

<p>This looks nice but when calling execute i get an error saying Object of type ""'System.EventArgs' cannot be converted to type 'System.Messaging.PeekCompletedEventArgs'.""... and I don't have any AsyncResult to take care of if I would get that far.</p>
",4,976,2012-09-24 9:48,,1,0,how
29170814,Mocking a generic protected method,<c#><unit-testing><justmock>,"<pre><code>public class BaseClass
{
     protected static bool GetSomething&lt;T&gt;(HttpWebRequest request, out T response)
     {

     }
}


public class Class
{
     public bool DoSomething(string arg1, string arg2, out string reason)
     { 

          if (GetSomething(request, out response))
          {

          }  

     }
}
</code></pre>

<p>I'm trying to test DoSomething, but in order to do that I need to mock GetSomething. I can't seem to be able to mock it unless I change the GetSomething method so that it isn't generic.  If I do that, the following works:</p>

<pre><code>var successfullResponse = new Response { Status = AuthenticationStatus.Success };
Mock.SetupStatic(typeof(Class));
Mock.NonPublic.Arrange&lt;Class&gt;(""GetSomething"", ArgExpr.IsAny&lt;HttpWebRequest&gt;(), ArgExpr.Out(successfullLoginResponse));

string reason;
var classInstance = new Class();
bool result = classInstance.DoSomething(arg1, arg2, out reason);
Assert.IsTrue(result);
Assert.IsNull(reason);
</code></pre>

<p>Shouldn't the same call work when GetSomething is generic?  If not, how can I mock GetSomething?</p>

<p>*We've submitted a ticket to Telerik. I'll update this post as soon as I discover anything.</p>
",1,1008,2015-03-20 15:57,,1,1,how
33311881,Mock CSV DictReader,<python><python-2.7><csv><mocking>,"<p>Is there a way to mock the <code>DictReader</code> for unit testing without actually having to write a file and then re-open it. </p>

<p>My functions accept a <code>DictReader</code> instance, so I could just easily pass them one to test their functionality, but cannot seem to get one without opening a file. </p>

<p>Currently I am manually writing a CSV file and then deleting it each test.</p>

<pre><code>class TestRowsStuff(unittest.TestCase):
    def write_csv(self, path, iterable):
        with open(path, 'wb') as f:
            writer = csv.DictWriter(f, [PP, SN, TN])
            writer.writeheader()
            writer.writerows(iterable)

    def setUp(self):
        ...
        self.test_file = os.path.join('test.csv')
        self.write_csv(self.test_file, test_values)

    def tearDown(self):
        os.remove(self.test_file)
</code></pre>
",4,6623,2015-10-23 21:47,,3,1,what
25816859,NBuilder Usage On Collection,<c#><reflection><mocking><nbuilder>,"<p>I found this implementation of NBuilder here:
<a href=""https://gist.github.com/markgibaud/4150878"" rel=""nofollow"">https://gist.github.com/markgibaud/4150878</a></p>

<p>This works like a charm until I need to add some collection inside.<br>
For example:</p>

<pre><code>public class UserDto
{
    public string UserName {get;set;}
    public List&lt;AddressDto&gt; Addresses {get;set;} //this will be null
}

public class AddressDto
{
    public string Street {get;set;}
    //...
}
</code></pre>

<p>I want to fill any collection with at least one record.</p>

<p>I end up with this piece of code:</p>

<pre><code>private static object BuildObjectList(Type type)
    {
        try
        {
            var builderClassType = typeof (Builder&lt;&gt;);
            Type[] args = {type};
            var genericBuilderType = builderClassType.MakeGenericType(args);
            var builder = Activator.CreateInstance(genericBuilderType);

            var createListOfSizeMethodInfo = builder.GetType().GetMethod(""CreateListOfSize"", new[] {typeof (int)});

            var objectBuilder = createListOfSizeMethodInfo.Invoke(builder, new object[] {1});
            var buildMethodInfo = objectBuilder.GetType().GetMethod(""Build"");
            return buildMethodInfo.Invoke(objectBuilder, null);
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
            return null;
        }
    }
</code></pre>

<p>But there's some issue also when I try to invoke build method.</p>
",1,536,2014-09-12 21:08,,1,6,other
46766889,Mocking library functions when unit testing chef custom resource,<unit-testing><mocking><chef-infra><chefspec>,"<p>I have created a very simple custom resource in Chef, and inside that resource is some simple logic. The logic in question calls out to some custom helper methods.</p>

<p>I can build the resource, and execute it as part of a recipe - but if I would like to unit test the behaviour within the resource itself to ensure the flow is correct. As such, I want to be able to mock the behaviour of those helper functions so that I can direct the resource behaviour. Unfortunately, I can't get this to work.</p>

<p>My recipe looks like this:</p>

<pre><code>my_resource 'executing' do
    action :execute
end
</code></pre>

<p>The resource looks like this:</p>

<pre><code>action :execute do
  if my_helper?(node['should_be_true'])
    converge_by ""Updating"" do
      my_helper_method
    end
  end
end

action_class do
  include CustomResource::Helpers
end
</code></pre>

<p>The functions are simple:</p>

<pre><code>module CustomResource
  module Helpers
    def my_helper?(should_be_true)
      should_be_true
    end

    def my_helper_method
      hidden_method
    end

    def hidden_method
      3
    end
  end
end
</code></pre>

<p>When I try to mock the behaviour of these in my ChefSpec tests, I get errors:</p>

<pre><code>it 'executes' do
  allow(CustomResource::Helpers).to receive(:my_helper?).and_return(true)
  expect(CustomResource::Helpers).to receive(:my_helper_method)
  expect { chef_run }.to_not raise_error
end


Failure/Error: expect(CustomResource::Helpers).to receive(:my_helper_method)

   (CustomResource::Helpers).my_helper_method(*(any args))
       expected: 1 time with any arguments
       received: 0 times with any arguments
</code></pre>

<p>Any ideas what I'm doing wrong in my mocking?</p>

<p>Thanks in advance!</p>
",0,1092,2017-10-16 9:21,,2,4,what
57154996,Unable to patch an object's attribute correctly,<python><unit-testing><mocking><python-mock>,"<p>I have a Python module as follows:</p>

<pre><code># src/exec.py

class A:

    def run(self, stuff):
        b = B(stuff.x)

class B:
    def __init__(self, x):
        self.obj = self.create_some_obj()
</code></pre>

<p>I'm trying to test a part of  class <code>A</code> independently, for which I need to replace the <code>obj</code> in <code>B</code> with a fake object. I'm doing this as follows:</p>

<pre><code># test/test_execs.py

import exec as ex

class FakeObjForB:
    def __init__(self):
        # some init

class TestClass:

    @patch.object(ex.B, 'obj', FakeObjForB())
    def test_with_fake_obj(self):
        a = ex.A()
        a.run()
        # assert something about the state of a that depends on the b inside its run method
</code></pre>

<p>Running this test gives me the error: <code>AttributeError: &lt;class 'B'&gt; does not have the attribute 'obj'</code>. I tried replacing the line with the <code>@patch</code> decorator with <code>@patch.object(ex.B, 'obj', FakeObjForB(), create=True)</code>. This, however, results in <code>b.obj</code> using the actual definition, and not <code>FakeObjForB</code>, which in turn leads to a false-failure in the assertion in <code>test_with_fake_obj</code>. Any clues about what I'm doing incorrectly here?</p>
",1,925,2019-07-22 23:44,,1,0,what
35733297,Moq generate class declaration while using ninject,<c#><dependency-injection><ninject><moq>,"<p>I am trying to unit test a 3rd party library which has many of interface definitions on their constructors. </p>

<p>For example;</p>

<pre><code>IKernel kernel = new StandardKernel();
kernel.Bind&lt;IOwnerDataProvider&gt;().To&lt;OwnerDataProviderFake&gt;();
</code></pre>

<p>I had to create OwnerDataProviderFake manually since I would like not to use real implementation of it.</p>

<p>Is there any way to use Moq to create a fake implementation of this interface instead of creating manually?</p>

<p>For example something like;</p>

<pre><code>kernel.Bind&lt;IOwnerDataProvider&gt;().To&lt;Mock.GenerateFakeClassDefinition&lt;IOwnerDataProvider&gt;()&gt;();
</code></pre>
",0,86,2016-03-01 20:55,,1,1,what
4804858,Mocking a Controller dependency with Moq using specflow,<asp.net-mvc><moq><watin><specflow>,"<p>I am new to specflow and a have a doubt about how to mock my
controller dependencies.
For instance I have a UserController class which depends on my
UserRepository class that a pass to the controller class on its
constructor.
So using Moq I am doing something like this:</p>

<pre><code>var mock = new Mock&lt;UserRepository&gt;();
mock.Setup(m =&gt; m.ListAll()).Returns(new List&lt;User&gt;());
var browser = new IE(string.Format(""http://localhost:4265/{0}"",
username));
</code></pre>

<p>But my controller is not using the mocked object, how should I do
that?</p>

<p>Thanks</p>
",1,2680,2011-01-26 13:03,,2,0,how
49111705,Nunit test fails when not in debug mode,<c#><nunit><moq>,"<p>when I run the TEST in debug mode it works, otherwise it fails.</p>

<p>I am using <code>Moq</code>.</p>

<p>When the following line is added everything works fine.</p>

<p><code>_repositoryMock.Setup(m =&gt; m.GetSingleBy(It.IsAny&lt;Expression&lt;Func&lt;Configuration, bool&gt;&gt;&gt;())).Returns((Configuration)null);</code></p>

<p>Without the line above it works only in DEBUG mode.</p>

<pre><code>[Test]
public void ChangeServiceTier() {
 //Arrange
 const int configurationId = 6;
 const int serviceTierId = 12;

 //Act
 var result = _configurationService.ChangeServiceTier(configurationId, serviceTierId);

 //Assert
 result.Should().BeNull();

}
</code></pre>

<p>Method</p>

<pre><code> public ConfigurationDto ChangeServiceTier(int id, int serviceTierId) {
  var cfg = _repository.GetSingleBy &lt; Configuration &gt; (s =&gt; s.Id == id);

  if (cfg == null) {
   return null;
  }
  return _mapper.Map &lt; ConfigurationDto &gt; (cfg);
 }
</code></pre>

<p>TEST Fail rason:
<code>Message: Expected result to be &lt;null&gt;, but found ConfigurationDto...</code></p>

<p>For some reason, <code>cfg</code> is null only in debug MODE.</p>

<p>Any thoughts?</p>
",0,953,2018-03-05 13:36,,1,8,other
71952298,How to write unit test case for sql execute reader,<c#><unit-testing><moq><xunit.net>,"<p>I want to write a unit test case using xunit and moq for the below method.
The method has a stored procedure call and uses executereader.</p>
<pre class=""lang-cs prettyprint-override""><code>public bool IsInternalRecipient(string recipientAddress) {
    bool isInternalRecipient = false;
    int domains = recipientAddress.Count(F =&gt; f == ‘@‘);
    if (domains = 1) {
        MailAddress address = new MailAddress(recipientAddress)
        string domain = address.Host;
        using(SqlConnection connection = new SqlConnection(DelayedSendConnectionString)) {
            using(var cmd_select = new SqlCommand(&quot;spDomainExists&quot;, connection)) {
                DateTime LastModified = DateTime.Now.ToLocalTime();
                DateTime ServerSendTime = DateTime.Now.ToUniversalTime @)
                cmd_select.CommandType = CommandType.StoredProcedure;
                cmd_select.Parameters.Add(&quot;@Domain&quot;, SqlDbType.VarChar, 100).Value = domain;
                try {
                    connection.Open()
                } 
                catch (Exception ex) {
                }
                try {
                    int domainCount = Convert.ToInt16(cmd_select.ExecuteScalar());
                    if (domainCount == 1) {
                        isInternalRecipient = true;
                    }
                } 
                catch (Exception ex) {
                }
                finally {
                    connection.Close();
                }
        }
    }
    return isInternalRecipient;
}
</code></pre>
<p>For the above method 'IsInternalRecipient()' method I want to add success and exception unit test case.
I am beginner to unit test. Can someone help me out?.</p>
",1,395,2022-04-21 9:44,,0,4,how
56907401,How to mock only one method of an interface,<unit-testing><go><mocking><testify><gomock>,"<p>I am struggling to understand mocking in Go (am looking for something related to Mockito.spy equivalent of java in Go).</p>
<p>Let's say I have an interface in Go with 5 methods. But the piece of code that I want to test has references to only two methods. Now how do I mock this dependency without implementing all methods , i.e my actual implementation in source code implements 5 methods of interface , but is there a way to avoid implementing dummy interface implementation of 5 methods in test file. Following is the way am currently doing , implementing 5 methods is manageable but what if the interface has 20 methods , it becomes tedious to mock implement all the methods in test file.</p>
<h2>Example:</h2>
<h2>Source code in handler.go:</h2>
<pre><code>type Client struct {}
type ClientStore interface {
  func(c *Client) methodOne() error {// some implementation}
  func(c *Client) methodTwo() error {// some implementation}
  func(c *Client) methodThree() error {// some implementation}
  func(c *Client) methodFour() error {// some implementation}
  func(c *Client) methodFive() error {// some implementation}
}
</code></pre>
<h2>Source code in api.go:</h2>
<pre><code> func processFeed(c Client) error {
     err := c.methodOne()
     if(err != null) {
      return err
    }
     err1 := c.methodTwo()
     if(err1 != null) {
      return err1
    }
 }
</code></pre>
<h2>Test class code:</h2>
<pre><code>import &quot;testify/mock&quot;

func TestFeed(t *testing.T){
   mockClient := &amp;MockClient{}
   err := processFeed(mockClient)
   assert.NotNil(t , err)
 
}

type MockClient struct {
  mock.Mock
}

  func(c *MockClient ) methodOne() error {fmt.Printf(&quot;methodOne&quot;);nil}
  func(c *MockClient ) methodTwo() error {return errors.New(&quot;mocked error&quot;)}
  func(c *MockClient ) methodThree() error {fmt.Printf(&quot;methodThree&quot;);nil}
  func(c *MockClient ) methodFour() error {fmt.Printf(&quot;methodFour&quot;);nil}
  func(c *MockClient ) methodFive() error {fmt.Printf(&quot;methodFive&quot;);nil}


</code></pre>
<h2>Question:</h2>
<p>Is there a way to mock only what i required in the above case only the methodOne() and methodTwo() methods and not worry about remaining methods in tests ? Can you please suggest any other alternatives if they are present ? Thank you</p>
",2,2557,2019-07-05 17:49,,1,1,what
22028580,How should variance in mock objects be handled?,<java><unit-testing><junit><mocking>,"<p>Let's say I have the following interface I want to mock:</p>

<p><strong>Searcher.java</strong></p>

<pre><code>public interface Searcher {

    public String search();

    public void someMethod();

}
</code></pre>

<p>What do I do when I want to use different mock implementations for this interface? For example, in one test I would like to let the <code>search()</code> method return the empty string, in another test I would like it to start doing some HTTP requests etc. </p>

<p>Do I encapsulate the behaviour, like fx. putting it in a SearchBehaviour interface and then writing implementations for that interface:</p>

<pre><code>public class SearcherMock implements Searcher {

    private SearchBehaviour searchBehaviour;

    public SearcherMock(SearchBehaviour searchBehaviour) {
        this.searchBehaviour = searchBehaviour;
    }

    @Override
    public String search() {
        return searchBehaviour.search();
    }

    @Override
    public void someMethod() {
        // Do something here
    }

} 
</code></pre>

<p>Or do I create a new mock class for each mock implementation that varies? Fx. <code>EmptySearcher</code> and <code>HTTPSearcher</code>?</p>
",1,106,2014-02-25 23:35,,3,3,what
57464702,How do you override calls being made in GoMock?,<unit-testing><gomock>,"<p>I'm trying to write unit tests mocking service calls being made using GoMocks and It's been a real struggle.</p>

<p>One way I'm trying to simplify the code is to make a private method that gives a good response for all the mocks and then in each individual test that needs a different response of a mock call (e.g., testing a mock failure), I want to override that call with a different response.</p>

<p>e.g., of the setupMocks fn (scrubbed)</p>

<pre><code>func setupMocks(s *SSAdapterV1Suite, userId string) {
    s.mockDBDao.EXPECT().Mark(userId, gomock.Any()).
        Return(nil)
    s.mockDBDao.EXPECT().Get(userId).
        Return(userData, nil)
    s.mockDBDao.EXPECT().Delete(gomock.Any(), gomock.Any()).
        Return(nil)
}
</code></pre>

<p>When I use the setupMocks fn in the ""Success"" scenario, it works fine.</p>

<p>However, if I try to use it in another unit test where I want to test how an error in the service call will get handled, gomocks will use the mockResponse setup in the setupMocks fn instead of the one which I wanted to override with.</p>

<p>Is there a call or something I can do in GoMocks to override a mock <code>EXPECT()</code> response with something else instead of appending the <code>callstack</code>?</p>
",1,5267,2019-08-12 16:14,,1,0,what
75528269,How to test Vue component with API data retrieval using jest-fetch-mock?,<vue.js><unit-testing><jestjs><mocking><vuejs3>,"<p>I am attempting to test my Vue component that retrieves data from an API. When I wrote <code>mount(MyComponent)</code>, I received an error message indicating that <code>fetch</code> was undefined in my component. To address this issue, I imported <code>jest-fetch-mock</code> to mock the fetch request. I also added <code>fetchMock.resetMocks()</code> to the <code>beforeEach()</code> and used <code>fetchMock.mockResponseOnce(mockData)</code> before defining a wrapper. While this resolved the error, my component still failed to receive any data.</p>
<p>The component renders a data in list using <code>ul/li</code> items. but the mock data recived empty <code>&lt;ul&gt;&lt;/ul&gt;</code> element. It should receive my mock data.</p>
<pre><code>+----------------+---------+
| Using          | Version |
+----------------+---------+
| Vue            | latest  |
| Ionicframework | latest  |
+----------------+---------+
</code></pre>
",1,98,2023-02-22 4:27,,0,2,other
72940968,"How to mock final variable initialized inside constructor ,using EasyMock and PowerMock?",<java><junit><powermock><easymock>,"<p>Below mentioned code is implementation class, Need to mock the final variables inside junit .And to set the required value.</p>
<pre><code>public class XyzInterceptor 
    private final int requestLimit;
    private final int responseLimit;
    LimitHealper limitHealper = LimitHealper.getInstance();
    //Constructor
    public XyzInterceptor() {
        requestLimit = limitHealper.getLimits(&quot;fff&quot;);
        responseLimit = limitHealper.getLimits(&quot;fff&quot;);
            }
            
        public boolean preHandle(final HttpServletRequest request, final HttpServletResponse response, final Object handler) {

        // Check if rate limit is disabled
        if (requestLimit == 0 &amp;&amp; responseLimit == 0) {
            return true;
        }
        
        //logic inside
        
        }
}
</code></pre>
<p>Test Method</p>
<pre><code>@Test
    public void preHandelWhenLimitIsavailable() {       
        
        MockHttpServletRequest req = get(&quot;/customResource&quot;)
                .buildRequest(new MockServletContext());        
              
        MockHttpServletResponse resp = new MockHttpServletResponse();           
            
        XyzInterceptor crrli = PowerMock.createPartialMock(XyzInterceptor.class, &quot;XyzInterceptor&quot;);
        EasyMock.expect(limitHealper.getLimits(EasyMock.anyObject(String.class))).andReturn(6000).anyTimes();
        EasyMock.replay(limitHealper);
        crrli.preHandle(req, resp, &quot;doesn't matter&quot;);        
        Assert.assertEquals(200,resp.getStatus());
        
    }
</code></pre>
<p>While running the test  getting below error
org.powermock.reflect.exceptions.MethodNotFoundException: No methods matching the name(s) XyzInterceptor were found in the class hierarchy of class com.xx.xx.xx.xx.XyzInterceptor.</p>
<p>Note : On top of the class i have these annotation
@RunWith(PowerMockRunner.class)
@PrepareForTest(XyzInterceptor .class)</p>
",0,728,2022-07-11 15:26,,1,2,other
21048437,Mocking static class with powermockito,<java><unit-testing><mocking><powermock>,"<p>Even though I followed the <a href=""https://code.google.com/p/powermock/wiki/MockitoUsage13"" rel=""nofollow"">manual</a> I cannot seem to mock a static method with PowerMock. I'm trying to mock a singleton god class.</p>

<p>The test code is as follows:</p>

<pre><code>@RunWith(PowerMockRunner.class)
@PrepareForTest(GodClass.class)
public class SomeTestCases {
    @Test
    public void someTest() {
         PowerMockito.mockStatic(GodClass.class);
         GodClass mockGod = mock(GodClass.class);
         when(GodClass.getInstance()).thenReturn(mockGod);
         // Some more things mostly like:
         when(mockGod.getSomethingElse()).thenReturn(mockSE);

         // Also tried: but doesn't work either
         // when(GodClass.getInstance().getSomethingElse()).thenReturn(mockSE);

         Testee testee = new Testee(); // Class under test
    }
}
</code></pre>

<p>And Testee:</p>

<pre><code>class Testee {
     public Testee() {
    GodClass instance = GodClass.getInstance();
    Compoment comp = instance.getSomethingElse();
     }
}
</code></pre>

<p>However, this doesn't working. Debugging mode shows that <code>instance</code> is <code>null</code>. What must be done different?</p>

<p>(Yes, I know the code is horrible but it's legacy and we want to have some unit tests before refactoring)</p>
",3,1679,2014-01-10 15:43,,1,1,what
76848922,Testing a function without a parameter and using moq and xunit,<c#><unit-testing><moq><xunit>,"<p>I'm trying to write a unit test for a function:</p>
<pre><code>public async Task&lt;IEnumerable&lt;Person&gt;&gt; GetPerson()
{
    var query = &quot;SELECT * FROM Person&quot;;
    using (var connection = _context.CreateConnection())
    {
        var person = await connection.QueryAsync&lt;Person&gt;(query);
        return person.ToList();
    }
}
</code></pre>
<p>which is in the <code>PersonServices</code> class and inherits from the <code>IPersonServices</code> interface.</p>
<p>Test:</p>
<pre><code>[Fact]
public void TestGetPersonReturnPerson()
{
    var mocGetPerson = new Mock&lt;IPersonServices&gt;();
    mocGetPerson.Setup(m =&gt; m.GetPerson().Result).Returns(Task.FromResult&lt;IEnumerable&lt;Person&gt;&gt;) ;
    IPersonServices personServices = mocGetPerson.Object;

    Assert.NotNull(personServices);
}
</code></pre>
<p>Test fails...</p>
",1,53,2023-08-07 5:10,,1,1,other
31874481,Moq System.IO.FileNotFoundException,<c#><exception><xamarin><moq>,"<p>I have exception for this code:</p>

<pre><code>var _mobileClient = new Mock&lt;IMobileServiceClient&gt;();
_model = new MyGroupsViewModel(_mobileClient.Object); // Exception
</code></pre>

<p>system.io.filenotfoundexception could not load file or assembly or one of its dependencies</p>

<p><a href=""https://i.sstatic.net/LfkVy.png"" rel=""nofollow noreferrer""><img src=""https://i.sstatic.net/LfkVy.png"" alt=""Stack Trace""></a></p>

<p>How i can fix it?</p>
",2,985,2015-08-07 9:36,,0,6,how
46753429,"Just Mock, Mocking not working as expected",<c#><unit-testing><model-view-controller><justmock>,"<p>I am new at Just Mock, facing a problem to pass this method, need help to understand the issue.</p>

<p>I have a following code that I want to test</p>

<pre><code>public ActionResult Create(JournalViewModel journal)
    {
        if (ModelState.IsValid)
        {
            var newJournal = _mapper.Map&lt;JournalViewModel, Journal&gt;(journal);// Mapper Updates cause syntax change

            newJournal.UserId = (int)_membershipService.GetUser().ProviderUserKey;

            var opStatus = _journalService.AddJournal(newJournal);
            if (!opStatus.Status)
                throw new System.Web.Http.HttpResponseException(new HttpResponseMessage(HttpStatusCode.InternalServerError));

            return RedirectToAction(""Index"");
        }
        else
            return View(journal);
    }
</code></pre>

<p>and following code that I have written for testing</p>

<pre><code>[TestMethod()]
    public void Create_return_journal()
    {

        var userMock = Mock.Create&lt;MembershipUser&gt;();
        Mock.Arrange(() =&gt; userMock.ProviderUserKey).Returns(1);
        Mock.Arrange(() =&gt; membershipService.GetUser()).Returns(userMock);

        var opStatusMock = Mock.Create&lt;OperationStatus&gt;();
        opStatusMock.Status = true;
        Mock.Arrange(() =&gt; journalService.AddJournal(Mock.Create&lt;Journal&gt;())).Returns(opStatusMock);


        //Act
        PublisherController controller = new PublisherController(journalService, membershipService, mapper);
        ViewResult actionResult = (ViewResult)controller.Create(Mock.Create&lt;JournalViewModel&gt;());
        var model = actionResult.Model as JournalViewModel;

        //Assert
        Assert.IsNotNull(model);

    }
</code></pre>

<p>over here I am expecting opstatus.Status to be true but getting false everytime, which results it to go in </p>

<pre><code>if (!opStatus.Status)
                throw new System.Web.Http.HttpResponseException(new HttpResponseMessage(HttpStatusCode.InternalServerError));
</code></pre>

<p>TIA</p>
",0,431,2017-10-15 9:06,,1,0,what
70183017,patching a function if that function is imported using the from statement,<python><unit-testing><mocking><python-unittest>,"<p>I have a case similar to the following code where I am trying to patch a fucntion that is imported using the from statement:</p>
<pre><code>from module1 import function1

def function2():
    function1_result = function1()
    return 2*function1_result
</code></pre>
<p>and then the testing code is:</p>
<pre><code>from unittest import patch
def test_function2():
    func1_value = 5
    with patch(&quot;module1.function1&quot;, return_value=func1_value) as patched_func1:
        function2_value = function2()
    assert function2_value==2*func1_value
</code></pre>
<p>However the code runs but it doesn't use the patched function 1 and actually calls the function. However, if I change the import statement to just <code>import module1</code> then the test runs fine.</p>
",0,47,2021-12-01 11:00,,1,4,other
23500677,How to fix error for mock object not being able to work as concrete class?,<unit-testing><symfony><mocking><phpunit>,"<p>I have a service for which I want to write tests. The service expects an concrete implementation of a class:</p>

<pre><code>MyService
{

    public function doSth(MyObject $object) {
         ...
    }

}
</code></pre>

<p>In my test file I create the mock like so:</p>

<pre><code>public function getMyObjectMock()
{
    $mock = $this-&gt;getMock('My\SomeOtherBundle\Entity\MyObject');
    return $mock;
}
</code></pre>

<p>In the test I will create an mock via into the service. I will get this strange error message:</p>

<pre><code>Argument 1 passed to My\Bundle\Services\Service::doSth()
must be an instance of My\Bundle\Entity\MyObject,
instance of Mock_MyObject_974a63e9 given,
called in My/Bundle/Tests/Services/ServiceTest.php on line 47 and defined
</code></pre>

<p>How to fix that? Can I only declare interfaces in other classes? Or can I make the mock object look like the concrete class?</p>
",0,164,2014-05-06 17:00,,2,0,how
6101030,How to create Mock for the abstract base class using MOQ framework?,<unit-testing><moq>,"<p>I want to write unit tests for MyClass but its base class is an abstract class.</p>

<pre><code>public class MyClass : AbstractBaseClass
{
}
</code></pre>

<p>I want to Mock the AbstractBase class, so that I can skip some of the logic in its constructor when I create the MyClass instance I want to test.  Is there anyway I can do this?</p>

<pre><code>//Unit Test
var test = new Mock&lt;IInterface&gt;();
var derivedclass = new DerivedClass(test.Object);

test.Setup(d=&gt;d.MyMethod(It.IsAny&lt;string&gt;()).returns(2);
derivedclass.MyMethod(""hello"");


// Derived Class
class DerivedClass : AbstractClass{

     //constuctor
    public DerivedClass(IInterface interface){
        _interface = interface;
    }
    public MyMethod(string str){
        return 2;
    }
}

//Abstract Class
public abstract class AbstractClass
{

 // This method gets called when i create the  instance of the derived class in my unit   
  test..

   protected AbstractedClass() : this(new SomeOtherClass()){
       DoSomethingElse();    /// I want to skip this method or mock it.
   }
 }
</code></pre>
",6,21775,2011-05-23 18:01,,2,1,what
52316030,JustMock multiple Mocks of same interface,<c#><unit-testing><mocking><justmock>,"<p>In our solution we used to have a really ancient version of JustMock. We wrote around 7000 tests and one pattern that would sometimes emerge is to have a default mock of a certain interface for all test-cases and in some tests ""override"" that default mock.</p>

<p>This means that in a few hundred tests we create a mock and arrange it and then create another mock of the same type and arrange that too. Then we would make an assertion on that second mock.</p>

<p>Some months ago we updated to the current version and now these multiple mocks of the same type seem not to work anymore. Take the example below. I create two Mocks of the same type and assert that the second mock is called once. With a 2012 version of JustMock this tests fails but with a more recent it does not fail.</p>

<p>So what is JustMock doing, that prevents me from making multiple mocks of the same type and asserting on them? And why does it do that?</p>

<pre><code>public interface IFoo
{
    void Bar();
}
[TestClass]
public class UnitTest1
{
    [TestMethod]
    public void TestMethod1()
    {
        var bar = Mock.Create&lt;IFoo&gt;();
        Mock.Arrange(() =&gt; bar.Bar()).OccursOnce();

        var foo = Mock.Create&lt;IFoo&gt;();
        Mock.Arrange(() =&gt; foo.Bar()).OccursOnce();

        Mock.Assert(foo); // Succeeds in recent versions, fails in older versions as I would expect
        //Mock.Assert(bar); // Would fail as expected
    }
}
</code></pre>
",2,483,2018-09-13 14:34,,2,0,why
10593453,"JMockIt: Is it possible to mock same class twice, in the same TestClass, to verify behaviour in different scenarios",<mocking><jmockit>,"<p>I need to write a test, where-in, the behaviour of a class can be verified, for different behaviours of a Mocked class. To support multiple behaviours for the same method, we need to mock the class multiple times, in the same TestClass.</p>

<p>Is it possible using JMockIt?</p>

<p>Here is an example of what I want. This is the main class to be tested and its test:</p>

<pre><code>public class MyClass {

    private Foo fooObj = null;

    public setfooObj(Foo obj) {
        fooObj = obj;
    }

    public boolean process() {
        // uses fooObj.getName() to process 
    }
}

public class MyClassTest {

    @MockClass(realClass = mypackage.Foo.class)
    public static class MockFoo {

        @Mock
        public static boolean getName() {
            return ""test"";
        }
    }

    @Test
    public void validateProcessing() {
        MyClass testObj = new MyClass();
        assertEquals(false, testObj.process);
    }
}
</code></pre>

<p>Now, I want to verify <code>testObj.process()</code> method's behaviour, when <code>MockFoo.getName()</code> returns different values. For my first assertion, I want to use its value as ""test""(as returned by the mocked function), but for the following ones, I want to check with different values.</p>
",4,5367,2012-05-15 2:29,,2,4,how
59121586,In TestCafe Is possibile to register xhr and use as mocking (automocking),<testing><mocking><automated-tests><testcafe><automocking>,"<p>I'm using testCafe for my functional test.</p>

<p>My project used a lot of XHR request and I don't want to waste my time to generate each single mock.</p>

<p>Exists an automocker like this: <a href=""https://github.com/scottschafer/cypressautomocker"" rel=""nofollow noreferrer"">https://github.com/scottschafer/cypressautomocker</a> for testcafe?</p>
",4,178,2019-12-01 0:38,,1,0,other
55711701,"gtest - ensure that a method is not called before, but can be called after a certain method call",<c++><unit-testing><googletest><googlemock>,"<p>How can I test that <code>setState()</code> method is not called before <code>subscribe()</code>, while allowing but not forcing it to be called after?</p>

<p>The code below shows what I want to achieve.</p>

<p>This is the method I want to test:</p>

<pre><code>...

void FirstState::enter()
{
    mInfoSubscription.subscribe(mInfoListener);

    mStateMachine.setState(mFactory.makeState(StateId::SecondState));
}

...
</code></pre>

<p>This is a unit test:</p>

<pre><code>class FirstStateTest : public ::testing::Test {
protected:
    FirstStateTest()
        : mFirstState{mMockStateMachine, mMockStatesFactory,
                      mMockInfoSubscription, mMockInfoListener}
    {
    }

    NiceMock&lt;MockStateMachine&gt; mMockStateMachine;
    NiceMock&lt;MockStatesFactory&gt; mMockStatesFactory;
    NiceMock&lt;MockInfoSubscription&gt; mMockInfoSubscription;
    NiceMock&lt;MockInfoListener&gt; mMockInfoListener;

    FirstState mFirstState;
};

TEST_F(FirstStateTest, ensure_that_subscription_is_done_before_state_change)
{
    // This method must not be called before ""subscribe()"".
    EXPECT_CALL(mMockStateMachine, doSetState(_)).Times(0);  // doesn't work the way I want

    EXPECT_CALL(mMockInfoSubscription, subscribe(_)).Times(1);

    // At this moment it doesn't matter if this method is called or not.
    EXPECT_CALL(mMockStateMachine, doSetState(_)).Times(AtLeast(0));  // doesn't work the way I want

    mFirstState.enter();
}

// other unit tests ...
...
</code></pre>

<p><strong>Edit 1:</strong> </p>

<p>Just in case, this is how <code>MockStateMachine</code> looks:</p>

<pre><code>class MockStateMachine : public IStateMachine {
public:
    MOCK_METHOD1(doSetState, void(IState* newState));
    void setState(std::unique_ptr&lt;IState&gt; newState) { doSetState(newState.get()); }
};
</code></pre>
",1,728,2019-04-16 15:28,,1,0,how
54150344,Moq verify method signature sees invocations but doesn't match on them?,<c#><unit-testing><moq>,"<p>I have an interface like so:</p>

<pre><code>public interface IStatisticsCollector : IDisposable
{
    Task Measure(string metricName, decimal value, IDictionary&lt;string, string&gt; tags = null);
}
</code></pre>

<p>I am injecting this <code>IStatisticsCollector</code> into my class and using it like this:</p>

<pre><code>var stopwatch = new Stopwatch();
await dataCollector.Measure(""rbk_init"", stopwatch.ElapsedMilliseconds);
...
await dataCollector.Measure(""rbk_compiled"", stopwatch.ElapsedMilliseconds);
...
</code></pre>

<p>Setting up my unit test to verify that I am recording all the statistics points I want, I mock the <code>IStatisticsCollector</code>:</p>

<pre><code>private readonly Mock&lt;IStatisticsCollector&gt; _statisticsCollector = new Mock&lt;IStatisticsCollector&gt;();
_statisticsCollector.Setup(x =&gt; x.Measure(It.IsAny&lt;string&gt;(), It.IsAny&lt;long&gt;(), It.IsAny&lt;IDictionary&lt;string, string&gt;&gt;())).Verifiable();
</code></pre>

<p>When I run my unit test, my verification fails on this line:</p>

<pre><code>//assert
_statisticsCollector.Verify(
    x =&gt; x.Measure(It.IsAny&lt;string&gt;(), It.IsAny&lt;long&gt;(), It.IsAny&lt;IDictionary&lt;string, string&gt;&gt;()), Times.Exactly(5));
</code></pre>

<p>...with the following message:</p>

<pre><code>Moq.MockException : 
Expected invocation on the mock exactly 5 times, but was 0 times: x =&gt; x.Measure(It.IsAny&lt;string&gt;(), (decimal)It.IsAny&lt;long&gt;(), It.IsAny&lt;IDictionary&lt;string, string&gt;&gt;())

Configured setups: 
IStatisticsCollector x =&gt; x.Measure(It.IsAny&lt;string&gt;(), (decimal)It.IsAny&lt;long&gt;(), It.IsAny&lt;IDictionary&lt;string, string&gt;&gt;())

Performed invocations: 
IStatisticsCollector.Measure(""rbk_init"", 31, null)
IStatisticsCollector.Measure(""rbk_compiled"", 35, null)
IStatisticsCollector.Measure(""rbk_stored"", 36, null)
IStatisticsCollector.Measure(""rbk_db_updated"", 352, null)
IStatisticsCollector.Measure(""rbk_completed"", 361, null)
   at Moq.Mock.VerifyCalls(Mock targetMock, InvocationShape expectation, LambdaExpression expression, Times times, String failMessage) in C:\projects\moq4\src\Moq\Mock.cs:line 378
</code></pre>

<p>... this was strange because it looks like it captured 5 matching invocations, but apparently didn't consider any of them to actually be matches.  Now I postulated this might be related to the fact that the stopwatch's <code>ElapsedMilliseconds</code> was a long but the interface was expecting a decimal (with an implicit cast), so I changed the verify to look for <code>It.IsAny&lt;decimal&gt;()</code>, but that got me an unexpected result:</p>

<pre><code>Moq.MockException : 
Expected invocation on the mock exactly 5 times, but was 1 times: x =&gt; x.Measure(It.IsAny&lt;string&gt;(), It.IsAny&lt;decimal&gt;(), It.IsAny&lt;IDictionary&lt;string, string&gt;&gt;())

Configured setups: 
IStatisticsCollector x =&gt; x.Measure(It.IsAny&lt;string&gt;(), It.IsAny&lt;decimal&gt;(), It.IsAny&lt;IDictionary&lt;string, string&gt;&gt;())

Performed invocations: 
IStatisticsCollector.Measure(""rbk_init"", 28, null)
   at Moq.Mock.VerifyCalls(Mock targetMock, InvocationShape expectation, LambdaExpression expression, Times times, String failMessage) in C:\projects\moq4\src\Moq\Mock.cs:line 378
</code></pre>

<p>It found one... and only one.  There doesn't seem to be an exception thrown, so I don't know why there would only be one.</p>

<p>I also noted the null value on the optional argument, and tried to verify against a null value instead of an <code>IDictionary&lt;string, string&gt;</code>, but this was similarly fruitless.</p>

<p>Can someone explain this behavior?  What do I need to do to fix my test?</p>
",2,1151,2019-01-11 16:20,,1,0,why
76818001,Use `mockall` crate for a trait with trait bounds,<rust><mocking>,"<p>I'd like to use <code>mockall</code> to generate a mock implementation for this trait:</p>
<pre><code>#[cfg_attr(test, automock)]
trait MyTrait {
    fn process&lt;T: Read&gt;(&amp;self, data: T);
}
</code></pre>
<p>This leads to the compiler error:</p>
<blockquote>
<p>error[E0310]: the parameter type <code>T</code> may not live long enough</p>
</blockquote>
<p>I could fix it by adding the <code>'static</code> lifetime to <code>T</code> as suggested by the compiler, but I don't want to do that. What is the best way to mock this trait without changing the function signature?</p>
",-1,453,2023-08-02 8:32,,1,0,what
24518571,How to mock an object within an AngularJS factory method,<angularjs><mocking><angularjs-factory>,"<p>I have created an Angular factory that has methods which handle saving code to a server. One of the factory methods contains a third party object which has a method which does the actual callout. I would like to test this code, but I can't work out how to mock out the third party object.</p>

<p><a href=""http://plnkr.co/edit/2zE2idMLL4Ukr3uocw36"" rel=""nofollow"">I have set up a plunker</a> with a Jasmine test. </p>

<p>My aim for this test is just to successfully get the code to use my mock object rather than the ThirdPartySavingUtils object. Is that possible?</p>

<pre><code>var app = angular.module(""MyApp"", []);

app.factory(""SavingUtils"", function() {

  return {

    saveStuff: function() {
      if(typeof ThirdPartySavingUtils !== ""undefined"") {
        return ThirdPartySavingUtils.value;
      }
    }
  };
});
</code></pre>

<p>this is my jasmine tests</p>

<pre><code>describe(""Mocking Test"", function() {

  var ThirdPartySavingUtilsMock;
  var SavingUtils;

  beforeEach(function() {

    angular.mock.module(""MyApp"", function($provide) {

      ThirdPartySavingUtilsMock = {
        value: ""I am the mock object""
      };

      $provide.value(""ThirdPartySavingUtils"", ThirdPartySavingUtilsMock);
    });

    inject(function(_SavingUtils_) {
      SavingUtils = _SavingUtils_;
    });
  });

  it(""should run without throwing an exception"", function() {

    expect(true).toBe(true);
  });

  it(""should mock out ThirdPartySavingUtils with ThirdPartySavingUtilsMock"", function() {

    var result = SavingUtils.saveStuff();

    expect(result).toEqual(""I am the mock object"");
  });
});
</code></pre>
",1,3499,2014-07-01 20:15,,1,0,what
566091,Easymock: does the order of captures matter?,<java><mocking><easymock>,"<p>This might seem like a pretty detailed question about Easymock, but I'm having a hard time finding a support site/forum/mailing list for this library.</p>

<p>I'm encountering a bug when using the <code>captures()</code> method that seems to return the captured parameters out of order.</p>

<p>Here's a simplified version of what I am testing:</p>

<pre><code>public class CaptureTest extends TestCase {

    // interface we will be mocking
    interface Processor {
            void process(String x);
    }

    // class that uses the interface above which will receive the mock
    class Component {

        private Processor processor;

        private String[] s = { ""one"", ""two"", ""three"", ""four"" };

        Component(Processor processor) {
            this.processor = processor;
        }

        public void doSomething() {
            for (int i = 0; i &lt; s.length; i++) {
                processor.process(s[i]);
            }
        }
}

    public void testCapture() {

        //create the mock, wire it up    
        Processor mockProcessor = createMock(Processor.class);
        Component component = new Component(mockProcessor);

        //we're going to call the process method four times
        //with different arguments, and we want to capture 
        //the value passed to the mock so we can assert against it later    
        Capture&lt;String&gt; cap1 = new Capture&lt;String&gt;();
        Capture&lt;String&gt; cap2 = new Capture&lt;String&gt;();
        Capture&lt;String&gt; cap3 = new Capture&lt;String&gt;();
        Capture&lt;String&gt; cap4 = new Capture&lt;String&gt;();

        mockProcessor.process(and(isA(String.class), capture(cap1)));
        mockProcessor.process(and(isA(String.class), capture(cap2)));
        mockProcessor.process(and(isA(String.class), capture(cap3)));
        mockProcessor.process(and(isA(String.class), capture(cap4)));

        replay(mockProcessor);

        component.doSomething();

        //check what values were passed to the mock
        assertEquals(""one"", cap1.getValue());
        assertEquals(""two"", cap2.getValue());
        assertEquals(""three"", cap3.getValue());
        assertEquals(""four"", cap4.getValue());

        verify(mockProcessor);
    }

}
</code></pre>

<p>(Please note that this is just a simplified test case - I know that I could specify the exact value of the arguments I expect passed to my mock, but in my real case the arguments are complex objects with a handful of fields, and I want to capture the object so I can assert against just a few of those fields without re-creating the entire object in my test case).</p>

<p>When I run the test, it fails at:</p>

<blockquote>
  <p>junit.framework.ComparisonFailure: expected:&lt;[one]> but was:&lt;[four]></p>
</blockquote>

<p>Meaning that the parameter that EasyMock is capturing in <code>cap1</code> is not the first call to the method, but the last (since the value is <code>four</code>). I get the same results if I reverse the <code>captures()</code> declarations, i.e. use <code>cap4</code> with the first method call, etc.</p>

<p>This seems like it might be a bug within EasyMock - different parameters passed to the same method in different invocations don't seem to be capture correctly.</p>

<p>Is anyone else using <code>capture()</code> with EasyMock and having similar problems? Is there an easy workaround you know of, or a different way I can capture the parameters being passed to my mock's methods?</p>

<p><em>Update 1</em>: fixed code sample to show I am using <code>createMock</code>, not <code>createStrictMock</code>, but I get the same error with both (although the actual value of what is captured changes).</p>
",6,4013,2009-02-19 16:26,,6,2,what
37886117,Why unit test is failing although it contains all the values I am testing,<unit-testing><mocking><nunit><xunit><nsubstitute>,"<p>This is the fail error I get on my xUnit with NSubstitute:</p>

<pre><code>Xunit.Sdk.ContainsException
Assert.Contains() Failure
Not found: Please send my Password.
Name: Blake Lively
Phone: 7021102502
I Lost my pass, Help
In value:  Blake Lively
</code></pre>

<p>And this is what I have in my unit test code:</p>

<pre><code>    var whatsInIt = msg.Notes;

    Assert.Contains(msg.Notes, ""Blake Lively"");
    Assert.Contains(msg.Notes, ""7021102502"");
    Assert.Contains(msg.Notes, ""Help"");
</code></pre>

<p>I wrote that <code>whatsInIt</code>  to put a break point and see what is there before asserting it, so the value I see in is is this:</p>

<pre><code>Please send my Password.
Name: Blake Lively
Phone: 7021102502
I Lost my pass, Help
</code></pre>

<p>So why is it still failing? </p>
",0,729,2016-06-17 16:17,,1,0,why
55687830,How to unit test with Moq the Azure Key Vault,<c#><azure><unit-testing><moq><azure-keyvault>,"<p>I need to mock the endpoint of the Key Vault in order to know if I am calling the function to get the key vault once.</p>

<p>I am developing this with C# and Moq (Framework) in order to do the testing.</p>

<p>The interface is the following:</p>

<pre><code>public interface IKeyVaultConnection
{
    string GetKeyVaultValue(string variableName);
}
</code></pre>

<pre><code> public class KeyVaultConnection
    {
        public KeyVaultClient keyVaultClient;
        private string endpointKeyVault;

        public KeyVaultConnection(string keyVaultAddress = ""DefaultEndpoint"")
        {
            AzureServiceTokenProvider azureServiceTokenProvider = new AzureServiceTokenProvider();
            keyVaultClient = new KeyVaultClient(new KeyVaultClient.AuthenticationCallback(azureServiceTokenProvider.KeyVaultTokenCallback));
            endpointKeyVault = $""https://{ keyVaultAddress }.vault.azure.net"";
        }

        private async Task&lt;string&gt; AsyncGetSecretValue(string keyName)
        {
            var secret = await keyVaultClient.GetSecretAsync($""{endpointKeyVault}/secrets/{ keyName }"")
                    .ConfigureAwait(false);

            return secret.Value;
        }

        public string GetKeyVaultValue(string variableName)
        {
            Task&lt;string&gt; task = Task.Run(async () =&gt; await AsyncGetSecretValue(variableName));
            task.Wait();
            return task.Result;
        }
}

</code></pre>

<pre><code> Mock&lt;IKeyVaultConnection&gt; mock = new Mock&lt;IKeyVaultConnection&gt;();
//-----&gt;&gt;&gt;&gt;&gt;&gt;   Need to setup the endpoint
 mock.Setup(x =&gt; x.GetKeyVaultValue(It.IsAny&lt;string&gt;())).Returns(It.IsAny&lt;string&gt;());
 // mock.Verify(x =&gt; x.GetKeyVaultValue(It.IsAny&lt;string&gt;()), Times.Once());
</code></pre>

<p>What I need is to fake the connection to the endpoint in order to get that I am calling that function once and I am getting errors like:</p>

<pre><code>""KeyVaultErrorException: Operation returned an invalid status code 'NotFound'""
</code></pre>

<p>for not providing the endpoint.</p>

<p>If I uncomment last line <code>(mock.Verify(x =&gt; x.GetKeyVaultValue(It.IsAny&lt;string&gt;()), Times.Once());)</code>  I get this:</p>

<pre><code>""Expected invocation on the mock once, but was 0 times: 
 x =&gt; x.GetKeyVaultValue(It.IsAny&lt;string&gt;())""
</code></pre>
",1,10507,2019-04-15 11:05,,2,11,other
77704169,Mocking RouteData for AuthorizationHandler Tests,<c#><asp.net-core><asp.net-web-api><moq>,"<p>I have an authorization handler in my web API project which needs to read route data (not query string). The code works perfectly fine, but I have hit a dead end trying to unit test it. Tried a lot of HttpContext mocking but nothing seems to give me the desired result.</p>
<p><strong>Edit 1</strong>:</p>
<p>Ideally, when the test executes, I would want &quot;httpContext.GetRouteValue(&quot;param&quot;)&quot; to return &quot;myparamvalue&quot;. That's what I get when I run the service and call the api using &quot;localhost:8080//api/controller/myparamvalue/my-action&quot; endpoint.</p>
<p><strong>API Endpoint</strong> looks like below:</p>
<pre class=""lang-cs prettyprint-override""><code>[Authorize(Policy = &quot;MyCustomPolicy&quot;)]
[Route(&quot;{param}/my-action&quot;)]
[HttpGet]
public ActionResult&lt;string&gt; GetResult([FromRoute] string param)
{
    return Content(&quot;Dummy response&quot;);
}
</code></pre>
<p><strong>Authorization Handler code:</strong></p>
<pre class=""lang-cs prettyprint-override""><code>protected override Task HandleRequirementAsync(AuthorizationHandlerContext context, MyRequirement requirement)
{
    // some other code
    string paramValue = string.Empty;
    if (context.Resource is HttpContext httpContext)
    {
        paramValue = Convert.ToString(httpContext.GetRouteValue(&quot;param&quot;));
    }
    // more code that makes use of paramValue 
}
</code></pre>
<p><strong>Unit Test code:</strong></p>
<pre class=""lang-cs prettyprint-override""><code>public async Task SucceedWhenCalledWithParam()
{
    //Arrange
    ClaimsPrincipal principal = CreatePrincipal(&quot;testscope&quot;, &quot;scope&quot;);
    MyRequirement = new();

    var httpContext = new DefaultHttpContext();
    httpContext.Request.Host = new HostString(&quot;localhost:8080&quot;);
    httpContext.Request.Path = new PathString(&quot;/api/controller/myparamvalue/my-action&quot;);

    AuthorizationHandlerContext context = new(new[] { requirement }, principal, httpContext);

    MyAuthHandler authHandler = new();

    //Act
    await authHandler.HandleAsync(context).ConfigureAwait(false);

    //Assert
    Assert.IsTrue(context.HasSucceeded);
}
</code></pre>
<p>I have referred quite a few questions before raising this one. Some of them are listed below:</p>
<p><a href=""https://stackoverflow.com/a/58566024/419556"">https://stackoverflow.com/a/58566024/419556</a></p>
<p><a href=""https://stackoverflow.com/q/50916969/419556"">Mock IHttpContextAccessor in Unit Tests</a></p>
<p><a href=""https://stackoverflow.com/a/54164807/419556"">https://stackoverflow.com/a/54164807/419556</a></p>
",0,108,2023-12-22 14:20,,0,7,other
5620897,Clojure GUI programming is hard,<scala><clojure><mocking><mvp>,"<p>I am writing a utility program using a Swing GUI. I am trying to use Martin Fowler's <a href=""http://martinfowler.com/eaaDev/PresentationModel.html"" rel=""noreferrer"">Presentation Model</a> to facilitate testing. My application will automatically store several user preferences using <code>java.util.prefs.Preferences</code> (i.e.: main window position and size). I spent several hours over the weekend trying to create a Clojure mock of the <code>Preferences</code> API (using <a href=""http://easymock.org/"" rel=""noreferrer"">EasyMock</a>) so that I could test my presenter code, but could not get it working. Clojure GUI programming using non-OO style is hard for a long-time OO programmer. I feel that if I can discover/develop patterns for these things (mocking, ""interfaces"" for visual ""classes"", etc.), I can continue to use the same patterns throughout the rest of the application.</p>

<p>I have also been developing the same application in Scala to compare the programming patterns and have found it to be much more intuitive, even though I am trying to use Scala in a fairly strict functional style (excluding, of course, calls to Java classes like the Swing API -- which will have the same mutability issues in the Clojure version, but of course, will also be single-threaded).</p>

<p>In my Scala code, I create a class called <code>MainFrame</code> that extends <code>JFrame</code> and implements the trait <code>MainView</code>. <code>MainView</code> exposes all of the <code>JFrame</code> calls as abstract methods that I can implement in a mock object:</p>

<pre><code>trait LabelMethods {
  def setText(text: String)
  //...
}

trait PreferencesMethods {
  def getInt(key: String, default: Int): Int
  def putInt(key: String, value: Int)
  //...
}

trait MainView {
  val someLabel: LabelMethods
  def addComponentListener(listener: ComponentListener)
  def getLocation: Point
  def setVisible(visible: Boolean)
  // ...
}

class MainFrame extends JFrame with MainView {
  val someLabel = new JLabel with LabelMethods
  // ...
}

class MainPresenter(mainView: MainView) {
  //...
  mainView.addComponentListener(new ComponentAdaptor {
    def componentMoved(ev: ComponentEvent) {
      val location = mainView.getLocation
      PreferencesRepository.putInt(""MainWindowPositionX"", location.x)
      PreferencesRepository.putInt(""MainWindowPositionY"", location.y)
  }
  mainView.someLabel.setText(""Hello"")
  mainView.setVisible(true)
}

class Main {
  def main(args: Array[String]) {
    val mainView = new MainFrame
    new MainPresenter(mainView)
  }
}

class TestMainPresenter {
  @Test def testWindowPosition {
    val mockPreferences = EasyMock.mock(classOf[PreferencesMethods])
    //... setup preferences expectation, etc.
    PreferencesRepository.setInstance(mockPreferences)

    val mockView = EasyMock.createMock(classOf[MainView])
    //... setup view expectations, etc.
    val presenter = new MainPresenter(mockView)
    //...
  }
}
</code></pre>

<p>I am using a pseudo-singleton (<code>setInstance</code> included so that a mock can replace the ""real"" version) for the Preferences, so the details are not shown. I know about the cake pattern, but found mine to be a little easier to use in this case.</p>

<p>I have struggled with doing the similar code in Clojure. Are there any good examples of open-source projects that do this kind of thing? I have read several books on Clojure (Programming Clojure, The Joy of Clojure, Practical Clojure), but have not seen these issues dealt with. I have also studied Rich Hickey's <code>ants.clj</code>, but his use of Swing in that example is pretty basic.</p>
",14,3221,2011-04-11 11:56,,1,0,what
39171775,InvalidCountException: Method should be called exactly 1 times but called 0 times,<mockery><laravel-5.3>,"<p>when I run test with mockery on laravel, this error message:</p>

<blockquote>
  <p>Mockery\Exception\InvalidCountException: Method findOrFail(1) from Mockery_0__Customer should be called exactly 1 times but called 0 times</p>
</blockquote>

<h3><em>TestCase</em></h3>

<pre><code>public function createApplication()
{
    $app = require __DIR__.'/../bootstrap/app.php';

    $app-&gt;make(Kernel::class)-&gt;bootstrap();

    return $app;
}

protected function seeJsonValidFailedResponse()
{
    print_r($this-&gt;response-&gt;getContent());
    $this-&gt;assertEquals(400, $this-&gt;response-&gt;status());
    return $this;
}

protected function seeJsonValidResponse()
{
    print_r($this-&gt;response-&gt;getContent());
    $this-&gt;assertEquals(200, $this-&gt;response-&gt;status());
    return $this;
}

public function setUp()
{
    parent::setUp();
}

public function tearDown()
{
    parent::tearDown();
}
</code></pre>

<h3><em>CustomerTest</em></h3>

<pre><code>use Mockery;

class CustomerTest extends TestCase
{

    use WithoutMiddleware;

    public function testIndexSuccess()
    {
        $idCustomer= 1;

        $mockCustomer = Mockery::mock('Customer');
        $mockCustomer
            -&gt;shouldReceive('findOrFail')
            -&gt;once()
            -&gt;with($idCustomer)
            -&gt;andReturn(true);

        $this-&gt;app-&gt;instance('Customer', $mockCustomer);
        $this-&gt;get('/customer/history/' . $idCustomer)
             -&gt;seeJsonValidResponse();
    }
}
</code></pre>

<h3><em>Controller</em></h3>

<pre><code>use App\Customer;

class CustomerController extends Controller
{

    public function __construct(Customer $customer) {
        $this-&gt;customerModel =  $customer;
    }

    public function history($id)
    {
        $customer = $this-&gt;customerModel-&gt;findOrFail($id);
        $issues = $customer-&gt;issues();
        return view('customer/history', compact('customer', 'issues'));
    }
}
</code></pre>
",1,3489,2016-08-26 17:30,,1,1,other
61008064,pytest mock class from different module,<python><mocking><python-unittest>,"<p>I am trying to mock a class which is instantiated in the constructor of the class I am trying to test. If I define the class I am trying to mock in the same module as the one I am trying to test, everything works fine but when they are in separate modules, I get errors.</p>

<p>Here's my example, taken from <a href=""https://medium.com/@yeraydiazdiaz/what-the-mock-cheatsheet-mocking-in-python-6a71db997832"" rel=""nofollow noreferrer"">here</a> (Note that in my real example, the test class is in a ""tests"" submodule and the other two files are in ""app.src.code..."" module.</p>

<p>What am I missing?</p>

<p>helper.py:</p>

<pre><code>import os

class Helper:
    def __init__(self, path):
        self.path = path

    def get_path(self):
        base_path = os.getcwd()
        return os.path.join(base_path, self.path)
</code></pre>

<p>worker.py:</p>

<pre><code>from helper import Helper

class Worker:    
    def __init__(self):
        self.helper = Helper('db')

    def work(self):
        path = self.helper.get_path()
        print(f'Working on {path}')
        return path
</code></pre>

<p>test_worker.py:</p>

<pre><code>import unittest
from unittest.mock import patch
from worker import Worker


class WorkerTest(unittest.TestCase):
    def test_patching_class(self):
        with patch('helper.Helper') as MockHelper:
            MockHelper.return_value.get_path.return_value = 'testing'
            worker = Worker()
            MockHelper.assert_called_once_with('db')
            self.assertEqual(worker.work(), 'testing')
</code></pre>
",-1,3352,2020-04-03 8:41,,1,4,what
55052467,How to mock PythonOperator's python_callable and on_failure_callback?,<python><unit-testing><mocking><airflow>,"<p>What and where do I mock, with an Airflow <code>PythonOperator</code>,  such that:</p>

<ul>
<li>the <code>python_callback</code> raises a exception, triggering the call of the <code>on_failure_callback</code>, and </li>
<li>I can test whether that callback is called, and with what arguments?</li>
</ul>

<p>I have tried mocking both the {python_callable} and <code>PythonOperator.execute</code>, in a number of places, without success.</p>

<p>The code files look something like this:</p>

<p><strong>dags/my_code.py</strong></p>

<pre><code>class CustomException(Exception): pass

def a_callable():
    if OurSqlAlchemyTable.count() == 0:
        raise CustomException(""{} is empty"".format(OurSqlAlchemyTable.name))
    return True

def a_failure_callable(context):
    SlackWebhookHook(
        http_conn_id=slack_conn_id,
        message= context['exception'].msg,
        channel='#alert-channel'
        ).execute()
</code></pre>

<p><strong>dags/a_dag.py</strong></p>

<pre><code>from my_code import a_callable, a_failure_callable

new_task = PythonOperator(
    task_id='new-task', dag=dag-named-sue, conn_id='a_conn_id', timeout=30,
    python_callable=a_callable,
    on_failure_callback=a_failure_callable)
</code></pre>

<p><strong>dags/test_a_dag.py</strong></p>

<pre><code>class TestCallback(unittest.TestCase):

    def test_on_failure_callback(self):
        tested_task = DagBag().get_dag('dag-named-sue').get_task('new-task')

        with patch('airflow.operators.python_operator.PythonOperator.execute') as mock_execute:
            with patch('dags.a_dag.a_failure_callable') as mock_callback:
                mock_execute.side_effect = CustomException
                tested_task.execute(context={})

            # does failure of the python_callable trigger the failure callback?
        mock_callback.assert_called()

            # did the exception message make it to the failure callback?
        failure_context = mock_callback.call_args[0]
        self.assertEqual(failure_context['exception'].msg,
                        'OurSqlAlchemyTable is empty')O
</code></pre>

<p>The test does raise <code>CustomException</code> at the line <code>self.task.execute(context={})</code> -- but, in the test code itself.  What I want is for that error to be
raised in the Airflow code such that the <code>PythonOperator</code> fails and calls <code>on_failure_callback</code>.</p>

<p>I have tried any number of permutations, all either raising in test without
triggering, calling the python_callable, or not finding an object to patch:</p>

<pre><code>patch('dags.a_dag.a_callable') as mock_callable
      'a_dag.a_callable'
      'dags.my_code.a_callable'
      'my_code.a_callable'
      'airflow.models.Task.execute'
</code></pre>

<p>(<code>Python3</code>, <code>pytest</code>, and <code>mock</code>.)</p>

<p><strong>What am I missing / doing wrong?</strong></p>

<p>(Better still, I would like to verify the arguments passed to <code>SlackWebhookHook</code>.  Something like:</p>

<pre><code>with patch('???.SlackWebhookHook.execute') as mock_webhook:
    ... as above ...

kw_dict = mock_webhook.call_args[-1]
assert kw_dict['http_conn_id'] == slack_conn_id
assert kw_dict['message'] == 'OurSqlAlchemyTable is empty'
assert kw_dict['channel'] == '#alert-channel'
</code></pre>

<p>(But I am first focussing on testing the failure callback.)</p>

<p>Thank you in advance.</p>
",6,2037,2019-03-07 20:40,,0,0,what
54599903,How to mock an Exception on a get-property with Moq,<c#><nunit><moq>,"<p>I have a getter only property like</p>

<pre><code>public ICar Car
{
  { 
    get 
    {
      return _car ?? (_car = GetCar());
    }
  }
}
</code></pre>

<p><code>GetCar()</code> will throw <code>NotSupportedException</code> under certain circumstances and I want to unit test this.  I am using Moq.</p>

<p>I am trying to use this in my unit test but it does not work on properties, only on methods</p>

<pre><code>var sut = new CarProcessor(...); //init subject under test
Assert.Throws&lt;NotSupportedException&gt;(() =&gt; sut.Car); //evaluate result of Car property
</code></pre>

<p>This wont compile and it says <strong>""Only assignment call, increment, decrement, await and new object expression can be used as a statement""</strong> error.</p>

<p>Doing same as above for a method instead property works fine.</p>
",0,291,2019-02-08 20:43,,1,1,how
32230890,mocking formula-derived fields in Grails 2.2.1,<unit-testing><grails><mocking><spock>,"<p>I have a Domain class that uses a constraint with formula to calculate several fields. The fields are nullable, but when I am unit testing, the created objects fail to save, throwing ValidationException.</p>

<p>When I test this same code in while running the debugger (not in unit test), the fields are null, yet there are no errors.</p>

<p>I feel that if I could Mock the formula to return 0, I could run the test successfully. For example: <code>Part.metaClass.getNumberOfObj1 = { return 0 }</code>. Of course, this does not work. </p>

<p>Is there a way to mock the mapping of a formula onto these fields so the object can be persisted? Or, if not, is there a way to modify my setup to eliminate the (weird) errors that I am getting?</p>

<p>The Domain Class</p>

<pre><code>class Part extends Base {
    ...
    Long    numberOfObj1
    Long    numberOfObj2
    Long    numberOfObj3

    static hasMany = [obj1:Obj1,obj2:Obj2,obj3:Obj3]

    static mapping = {
        numberOfObj1  formula: '(select count(id) from ' + Base.defaultSchema() + '.obj_1 ob1 where (ob1.pt_id = ID and ob1.deleted = \'F\'))'
        numberOfObj2  formula: '(select count(id) from ' + Base.defaultSchema() + '.obj_2 ob2 where (ob2.pt_id = ID)'
        numberOfObj3  formula: '(select count(id) from ' + Base.defaultSchema() + '.obj_3 ob1 where (ob3.pt_id = ID )'  
    ... }  
}
</code></pre>

<p>The Unit test</p>

<pre><code>@TestMixin(ControllerUnitTestMixin)
@TestFor(PartController)
class PartControllerSpec extends BaseTestSpec {
    def ""given a part search, when the create action is called""() {
        given:
            def obj1= createObj1()
            params.number = ""1""
            params.rev = ""A""

        when:
            controller.create()

        then:
            //test stuff
    }
}
</code></pre>

<p>Inside controller.create()</p>

<pre><code>def create() {
    newPart = new Part(number:params.number,
                       revision:params.rev)//fields are null here
    try{
        newPart.save(flush:true, failOnError:true)
    } catch (Throwable th) {
        return
    }
</code></pre>

<p>The Error</p>

<pre><code>grails.validation.ValidationException: Validation error occured during call to save():
- Field error in object 'com.Part' on field 'numberOfObj1': rejected value [null];codes [com.Part.numberOfObj1.nullable.error.com.Part.numberOfObj1,...
</code></pre>
",2,204,2015-08-26 15:35,,2,2,what
40221323,Mockito: injected mock class not injected for other classes,<java><spring><unit-testing><mocking><mockito>,"<p>So I have a simple java class:</p>

<pre><code>@Component
public class IWantToTestThisClass {

@Autowired
private ClassA classA;

@Autowired 
private ClassB classB;

public ObjectA doIt(...) {
   classB.returnObject();
}
</code></pre>

<p>ClassA contains:</p>

<pre><code>@Component
public class ClassA { 

@Autowired 
private ClassB classB;

public ObjectA doIt() {
   classB.returnObject(...);
}
</code></pre>

<p>ClassB:</p>

<pre><code>@Component
public class ClassB { 

public ObjectA returnObject(...) {
   ...
}
</code></pre>

<p>My test setup looks like this:</p>

<pre><code>@InjectMocks
private IWantToTestThisClass iWantToTestThisClass;

@Mock
private ClassA classA;

@Mock
private ClassB classB;

@Before
public void setUp() {
    initMocks(this);

    when(classA.doSmt()).thenCallRealMethod();
    when(classB.doSmt()).thenCallRealMethod();
}
</code></pre>

<p>The problem is that ClassB is not injected for ClassA.</p>

<p>Then returnObject(ClassB) is called through classA it returns NullPointerException(ClassB is not mocked/injected).</p>

<p>If returnObject(classB) is called through IWantToTestThisClass it is okay.</p>

<p>Is it a way to inject ClassB for both classes at the same time? I want to call real methods, not mocked ones.</p>
",0,2978,2016-10-24 14:45,,2,6,what
58822673,Testing a static method which needs to mock a member method and suppress singleton constructor with PowerMockito,<java><unit-testing><mocking><mockito><powermockito>,"<p>I would like to test on a static method (e.g. <code>HobbyUtil.java:shareReadContext(int lineNumber)</code> ) which would ask a Singleton class (e.g. <code>Shelf.java</code> ) to get an object (e.g. a <code>Book</code> ) for further retrieving values (e.g. <em>lines of context</em> ) from that returned object.</p>

<p>However, during the mock case execution, the ctor of that Singleton class (i.e. <code>Shelf.java</code> ) would trigger several other Singleton classes (e.g. <code>LibraryA.java</code> ) in a chain; and one of them would trigger <code>java.lang.ExceptionInInitializerError</code>. </p>

<p>I think mocking/spying those irrelevant Singleton classes is out of the spirit of Mock Test as they are irrelevant to my testing scope.</p>

<p>So I decided to suppress the private ctor of this Singleton class (i.e. <code>Shelf.java</code> ) and just let the getter method in this class (i.e. <code>getBook()</code> ) to return a mocked object with my preferred behavior, which would perfectly match my test case.</p>

<p>The problem I've encountered is that I follow this link to suppress the ctor of <strong>Shelf.java</strong> successfully:
<a href=""https://stackoverflow.com/questions/8100816/suppress-a-singleton-constructor-in-java-with-powermock"">suppress a singleton constructor in java with powermock</a></p>

<p>but I couldn't figure out the way to let this getter method return what I want properly (i.e. return a mocked object).</p>

<p>The version of <em>PowerMockito</em>, <em>hamcrest</em> and <em>JUnit</em> I am using are listed here for a reference:</p>

<pre><code>&lt;dependency&gt;&lt;groupId&gt;org.powermock&lt;/groupId&gt;&lt;artifactId&gt;powermock-module-junit4&lt;/artifactId&gt;&lt;version&gt;1.7.0&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;  
&lt;dependency&gt;&lt;groupId&gt;org.powermock&lt;/groupId&gt;&lt;artifactId&gt;powermock-api-mockit02&lt;/artifactId&gt;&lt;version&gt;1.7.0&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;
&lt;dependency&gt;&lt;groupId&gt;org.hamcrest&lt;/groupId&gt;&lt;artifactId&gt;hamcrest-all&lt;/artifactId&gt;&lt;version&gt;1.3&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;
&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;
</code></pre>

<p>I have also replicated the case with below sample classes to show what I have encountered (HobbyUtilTest.java is the class for my test case):</p>

<p>Supposed there are 5 Java classes in the application:</p>

<pre><code>public interface Book {
    public String getContext(int lineNumber);
}
</code></pre>

<pre><code>public class Shelf {

    private static final Shelf shelf = new Shelf();
    private String BOOK_NAME = ""HarryPotter"";
    private Book book = null;

    private Shelf() {
        book = LibraryA.getInstance().getBook(BOOK_NAME);
        // many relatively complicated logics are here in actual class ... 
        // I want to suppress this ctor 
    }

    public static Shelf getInstance() {
        return shelf;
    }

    public Book getBook() {
        return book;  // I want to return my mocked object while calling this method in test case
    }

}
</code></pre>

<pre><code>public class HobbyUtil {

    public static String shareReadContext(int lineNumber){
        String context = """";
        Book book = Shelf.getInstance().getBook();

        for (int i = 0 ; i &lt; lineNumber; i++) {
            context += book.getContext(i);
        }
        return context;
    }

    private HobbyUtil() {}
}
</code></pre>

<pre><code>public class LibraryA {
    private static final LibraryA library = new LibraryA();
    private Book book;

    private LibraryA() {
        throw new java.lang.ExceptionInInitializerError();
    }

    public static LibraryA getInstance() {
        return library;
    }

    public Book getBook(String bookName) {
        return book;
    }
}
</code></pre>

<pre><code>public class BookImpl implements Book{

    private String bookName = null;

    BookImpl(String bookName){
        this.bookName = bookName;
    }

    @Override
    public String getContext(int lineNumber) {
        return lineNumber + "": Context"";
    }
}
</code></pre>

<p>And I would test the static method <code>shareReadContext(int lineNumber)</code> in <code>HobbyUtil.java</code> with <code>HobbyUtilTest.java</code></p>

<pre><code>import static org.hamcrest.CoreMatchers.is;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.mockito.ArgumentMatchers.anyInt;
import static org.powermock.api.mockito.PowerMockito.when;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.powermock.api.mockito.PowerMockito;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.PowerMockRunner;

@RunWith(PowerMockRunner.class)
@PrepareForTest(value = { Shelf.class })
public class HobbyUtilTest {

    @Test
    public void testShareReadContext() throws Exception {

        Book mockBook = PowerMockito.mock(Book.class);
        when(mockBook.getContext(anyInt())).thenReturn(""context for test"");

        PowerMockito.suppress(PowerMockito.constructor(Shelf.class));
        //PowerMockito.spy(Shelf.class);
        //when(Shelf.getInstance().getBook()).thenReturn(mockBook); // does not work
        //PowerMockito.doReturn(mockBook).when(Shelf.getInstance().getBook()); // does not work
        //PowerMockito.when(Shelf.class, ""getBook"").thenReturn(mockBook); // does not work
        //TODO any approach for it?

        String context = HobbyUtil.shareReadContext(1);
        assertThat(context, is(""context for test""));
    }
}

</code></pre>

<p>Could anyone please help to suggest how could I let the line <code>Book book = Shelf.getInstance().getBook();</code> in <code>HobbyUtil.java</code> return my mocked object (i.e. <code>mockBook</code> )?</p>
",0,927,2019-11-12 16:18,,2,0,how
44454662,"Mocking gives, Actually there were zero interations with this mock",<android><unit-testing><mocking><mockito>,"<p>Test when we run as a single test, it works perfect, but when it bundles with other tests, it gives Actually there were zero interations with this Mock. Also notice only one such method the error whereas other tests passes though same Verify case is used.</p>

<pre><code>public class SubjectScheduleScreenPresenterTest {

    @InjectMocks
    private SubjectScheduleScreenPresenter presenter;

    @Mock
    private Context context;

    @Mock
    private SubjectScheduleScreenView view;

    @Mock
    private Payment payment;

    @Mock
    private UserDB userDB;

    @Mock
    private Calendar calendar;
    @Mock
    private SharedPreferences.Editor editor;

    private APIInterface apiInterface;

    @Before
    public void setUp(){
        MockitoAnnotations.initMocks(this);
        apiInterface = NetworkContext.getInstance().getService(APIInterface.class);

    }

    @After
    public void afterMethod(){
        this.presenter = null;
    }

    @Test
    public void gotoPaytmTest(){
        double amount = 2.0, latitude =78.35,longitude = 78.50;
        int subjectId=2,tutorId = 2;

        Mockito.when(userDB.getValueFromSqlite(""email"",1)).thenReturn(""jayakishan100@gmail.com"");
        Mockito.when(userDB.getValueFromSqlite(""userId"",1)).thenReturn(""38"");

        presenter.gotoPaytm(amount,subjectId,tutorId,latitude,longitude,calendar,editor);
        Call call = apiInterface.getOrderId();

        try {
            Response&lt;SessionBooking&gt; sessionBookingResponse = call.execute();
            SessionBooking sessionBooking =sessionBookingResponse.body();

//            Mockito.verify(payment).callPaytm(sessionBooking.getOrderId(),userDB.getValueFromSqlite(""email"",1),
//                    amount,context,Integer.parseInt(userDB.getValueFromSqlite(""userId"",1)),-1,subjectId,latitude,longitude,
//                    calendar,editor);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    @Test
    public void getSubjectDataTestSuccess(){

        int searchId = 2,from = 1;
        presenter.getSubjectData(searchId,from);

        ScheduleSubject scheduleSubject = new ScheduleSubject(searchId);
        Call call = apiInterface.getSubjectDataForScheduling(scheduleSubject);

        try {
            Response&lt;ScheduleSubject&gt; scheduleSubjectResponse =call.execute();
            ScheduleSubject scheduleSubject1 = (ScheduleSubject) scheduleSubjectResponse.body();
            Mockito.verify(view).setValues(from,scheduleSubject1.getSubjectName().trim(), scheduleSubject1.getPrice());
        } catch (IOException e) {
            e.printStackTrace();
        }

    }

    @Test
    public void getSubjectDataTestFailure(){

        int searchId = -3,from = 1;
        presenter.getSubjectData(searchId,from);

        ScheduleSubject scheduleSubject = new ScheduleSubject(searchId);
        Call call = apiInterface.getSubjectDataForScheduling(scheduleSubject);

        try {
            Response&lt;ScheduleSubject&gt; scheduleSubjectResponse =call.execute();
            ScheduleSubject scheduleSubject1 = (ScheduleSubject) scheduleSubjectResponse.body();
            Mockito.verify(view).setValues(from,scheduleSubject1.getSubjectName().trim(), scheduleSubject1.getPrice());
        } catch (IOException e) {
            e.printStackTrace();
        }

    }
}
</code></pre>

<p><code>getSubjectDataTestSuccess</code> is alone method gives me error while other test being passed.</p>
",0,56,2017-06-09 9:51,,0,2,other
45222786,Mockito - when thenReturn,<java><mocking><mockito>,"<p>I'm new to the Mockito library and I can't understand the following syntax:
before the test I defined - </p>

<pre><code>when(CLASS.FUNCTION(PARAMETERS)).thenReturn(RETURN_VALUE)
</code></pre>

<p>And the actual test is  - </p>

<pre><code>assertSame(RETURN_VALUE, CLASS.FUNCTION(PARAMETERS))
</code></pre>

<p>Don't I just set the return value of the function with the first line of code (<code>when... thenReturn</code>) to be <code>RETURN_VALUE</code>? If the answer is yes, then of course <code>assertSame</code> will be true and the test will pass, what am I missing here? </p>
",31,88486,2017-07-20 18:38,,1,2,what
54226961,Patching variable in a python function with unittest and mock,<python><unit-testing><mocking><python-unittest>,"<p>I have the following my_func.py with create_config function.</p>

<p>*my_func.py</p>

<pre><code>from fabric.state import env

def create_config(node_name):
    config = {
    ""log_level"": ""INFO"",
    ""addr1"": ""127.0.0.1"",
    }
    config[""addr2""] = env.host
    return config
</code></pre>

<p>I tried the following approach to mock env.host variable where env is an import from fabric.state.</p>

<p>*test.py</p>

<pre><code>import unittest
import my_func
import mock


class MyTestCase(unittest.TestCase):
    def setUp(self):
        self.master_config = {
              ""log_level"": ""INFO"",
              ""addr2"": ""0.0.0.0"",
              ""addr1"": ""127.0.0.1"",
        }

    @mock.patch('env.host')
    def test_create_consul_config(self, mock_host):
        mock_host.return_value = ""0.0.0.0""
        result = my_func.create_config('master')
        self.assertDictEqual(self.master_config, result)


if __name__ == '__main__':
    unittest.main()
</code></pre>

<p>I am getting import error with 'env'. What is the best way to mock variable within a function with python mock.</p>

<pre><code>ImportError: No module named env
</code></pre>
",2,20427,2019-01-16 23:33,,2,1,what
20447546,Unit testing a MVC controller,<asp.net-mvc><unit-testing><mocking>,"<p>I'm trying to figure out the best way to build my unit tests for an MVC app.  I created a simple model and interface, which is used by the controller constructors so that the testing framework (Nsubstitute) can pass a mocked version of the repository.  This test passes, as expected.</p>

<p>My problem is now I want to take this a step further and test the file I/O operations in the ""real"" instantiation of IHomeRepository.  This implementation should read a value from a file in the App_Data directory.  </p>

<p>I've tried building a test without passing a mocked version of IHomeRepsotory in, however HttpContext.Current is null when I run my test.</p>

<p>Do I need to mock HttpContext?  Am I even going about this in the right way?</p>

<pre><code>//The model
public class VersionModel
{
    public String BuildNumber { get; set; }
}



//Interface defining the repository
public interface IHomeRepository
{
    VersionModel Version { get; }
}


//define the controller so the unit testing framework can pass in a mocked reposiotry.  The default constructor creates a real repository
public class HomeController : Controller
{

    public IHomeRepository HomeRepository;

    public HomeController()
    {
        HomeRepository = new HomeRepoRepository();
    }

    public HomeController(IHomeRepository homeRepository)
    {
        HomeRepository = homeRepository;
    }
.
.
.

}


class HomeRepoRepository : IHomeRepository
{
    private VersionModel _version;

    VersionModel IHomeRepository.Version
    {
        get
        {
            if (_version == null)
            {
                var absoluteFileLocation = HttpContext.Current.Server.MapPath(""~/App_Data/repo.txt"");
                if (absoluteFileLocation != null)
                {           
                    _version = new VersionModel() //read the values from file (not shown here)
                    {
                        BuildNumber = ""value from file"",
                    };
                }
                else
                {
                    throw new Exception(""path is null"");
                }
            }
            return _version;
        }
    }
}



[Fact]
public void Version()
{
    // Arrange
    var repo = Substitute.For&lt;IHomeRepository&gt;();  //using Nsubstitute, but could be any mock framework
    repo.Version.Returns(new VersionModel
    {
       BuildNumber = ""1.2.3.4"",
    });

    HomeController controller = new HomeController(repo);  //pass in the mocked repository

    // Act
    ViewResult result = controller.Version() as ViewResult;
    var m = (VersionModel)result.Model;

    // Assert
    Assert.True(!string.IsNullOrEmpty(m.Changeset));
}
</code></pre>
",1,616,2013-12-07 22:33,,1,0,what
68941925,How can you mock a closure (inner function) in python?,<python><mocking><closures>,"<p>I have a python function with a lot of functionality and several inner functions. I want to mock out the return value of one of those functions. Is it possible to use the mock package to mock out the inner function?</p>
<p>Here's an example</p>
<pre class=""lang-py prettyprint-override""><code>def outer(values):
    a = 1
    def inner():
        return np.mean(values)

    if inner() == 1:
        return None

    return inner()
</code></pre>
<p>Ok it's a strange example, but what I want is to mock out inner() to return a certain value. I tried to mock with <code>@mock.patch('outer.inner')</code> and I tried <code>@mock.patch.object(outer, 'inner')</code>, but neither works. Is it possible to mock a closure?</p>
",1,1687,2021-08-26 16:05,,2,3,what
58920928,Insert ObjectId into mongodb,<python><mongodb><testing><mocking><mongomock>,"<p>I'm working on a mongo database which, for some reason, has the user id stored as <code>ObjectId</code>.</p>

<p>In order to test some functions, I'd like to be able to populate a test database - for example, as follows:</p>

<pre><code>import mongomock
from bson import ObjectId

client = mongomock.MongoClient(""mongodb://localhost:27017/test-database"")
database = client.get_default_database()
database.test_collection.insert({'_id': ObjectId('my_user_id'), 'value': 'my_value'})
</code></pre>

<p>However, running this returns</p>

<blockquote>
  <p>InvalidId: 'my_user_id' is not a valid ObjectId, it must be a 12-byte
  input or a 24-character hex string</p>
</blockquote>

<p>How can I correctly insert an ObjectId object into my test database, so I can test querying it using</p>

<pre><code>database.test_collection.find_one({'user': ObjectId('my_user_id')})
</code></pre>

<p>(which works fine when I query the real database)?</p>
",1,8852,2019-11-18 18:39,,2,0,how
61022182,How to mock a React Component static method with Jest,<reactjs><mocking><jestjs><static-methods><react-component>,"<p>This was really hard to find out how to do. I could not find any code to show you how to mock a static method in a React Component. This way worked for me.</p>

<pre><code>// YourComponent.js

class YourComponent extends Component {
  static getHelloWorld () {
    return 'hello world';
  }

  render() {
    return (
      &lt;div&gt;{YourComponent.getHelloWorld()}&lt;/div&gt;
    )
  }
}

export default YourComponent;
</code></pre>

<pre><code>// YourComponent.test.js
import { mount } from 'enzyme';
import YourComponent from './YourComponent';

YourComponent.__proto__.getHelloWorld = jest.fn(() =&gt; { return 'Hello Universe' });

describe('YourComponent test for mocking static method', () =&gt; {
  it('should render', () =&gt; {
    const wrapper = mount(&lt;YourComponent /&gt;);

    expect(wrapper.text()).toEqual('Hello Universe');
  });
});
</code></pre>
",2,1968,2020-04-04 0:07,,1,0,how
70437444,Mockito nested calling,<java><mocking><mockito>,"<p>I have the following classes:</p>
<pre class=""lang-java prettyprint-override""><code>class LibraryClass implements LibraryInterface {
    @Override
    public void calculate(Order order)
    {
        //some logic
    }
    @Override
    protected void findAll(Order order)
    {
     //some logic
    }

    protected Map resetAllValues(Order order)
    {
     //some logic
    }
    @Override
    protected void sum(order) {//somelogic}
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>class MyCustomClass extends LibraryClass {
    @Override
    public void calculate(Order order)
    {
        findAll(order);

    }

    @Override
    protected void findAll(Order order)
        {
            //some logic
        final Map taxValueMap = resetAllValues(order);

        sum(order);
        }

    @Override
    protected void sum(order)
    {
        int totalCount = getTotalPrice(order);
        int totalItems = getTotalItems(order);
    }
    private int getTotalPrice(Order order) { ...}
    private int getTotalItems(Order order) { ...}
}
</code></pre>
<p>Where <code>LibaryClass</code> and <code>LibraryInterface</code> are from a library that I cannot change and I have implemented <code>MyCustomClass</code>. My goal is with Mockito to verify that the values of <code>totalCount</code> and <code>totalItems</code> are some expected value when I pass in calculate method some order.</p>
<p>Now I got stumbled across 2 problems:</p>
<ol>
<li><p><code>resetAllValues(order)</code> - I want to make this method return an empty map with Mockito, but I can't because the method is protected. If I don't make this method return an empty map for example it tries to make DB calls and throws exceptions.</p>
</li>
<li><p>If I manage somehow to do 1., then how should I verify that the returned values from the private methods <code>getTotalPrice</code> and <code>getTotalItems</code> return the correct value.</p>
</li>
</ol>
",1,120,2021-12-21 14:57,,1,5,how
8241887,How to create a stub with Moq,<c#><asp.net-mvc-3><nunit><moq><rhino-mocks>,"<p>How do I creat a pure stub using Moq?  With Rhino Mocks I did it like this:</p>

<pre><code>[TestFixture]
public class UrlHelperAssetExtensionsTests
{
     private HttpContextBase httpContextBaseStub;
     private RequestContext requestContext;
     private UrlHelper urlHelper;
     private string stylesheetPath = ""/Assets/Stylesheets/{0}"";

     [SetUp]
     public void SetUp()
     {
          httpContextBaseStub = MockRepository.GenerateStub&lt;HttpContextBase&gt;();
          requestContext = new RequestContext(httpContextBaseStub, new RouteData());
          urlHelper = new UrlHelper(requestContext);
     }

     [Test]
    public void PbeStylesheet_should_return_correct_path_of_stylesheet()
    {
        // Arrange
        string expected = stylesheetPath.FormatWith(""stylesheet.css"");

        // Act
        string actual = urlHelper.PbeStylesheet();

        // Assert
        Assert.AreEqual(expected, actual);
    }
}
</code></pre>

<p>How would I create a stub for <code>MockRepository.GenerateStub&lt;HttpContextBase&gt;();</code> using Moq?  Or should I just stay with Rhino Mocks?</p>
",19,20317,2011-11-23 12:06,,3,0,how
59998651,xUnit Setup function not being called,<c#><moq><xunit>,"<p>I have a very basic unit test. For some reason the test passed only the first time but all subsequent calls have failed. Here is the test code:</p>

<pre><code>private Mock&lt;IMyInterface&gt; _mockObject;
public Test() {
   _mockObject = new Mock&lt;IMyInterface&gt;();
}

[Fact]
public void ItReturnsTheRightThing() {
   _mockObject.SetUp(o =&gt; o.FunctionIWantToMock()).Returns(new SpecialObject(true));
   var classIWantToTest = new ClassIWantToTest(_mockObject.Object);
   classIWantToTest.RunCode();
   ...
}
</code></pre>

<p>The interface:</p>

<pre><code>internal interface IMyInterface {
    SpecialObject FunctionIWantToMock();
}
</code></pre>

<p>The production code:</p>

<pre><code>public class ClassIWantToTest {
    IMyInterface _client;
    internal ClassIWantToTest(IMyInterface client) {
        _client = client;
    }
    public bool RunCode() {
        SpecialObject so = _client.FunctionIWantToMock();
        return so.Value; // This line is the problem
        ...
    }
}
</code></pre>

<p>The problem is that when I run my test, my mock function isn't returning what I setup in the SetUp function, it's not returning the <code>SpecialObject(true)</code> but rather <code>null</code>. I then get a null reference exception. When I debug the test, I can't step into the <code>_client.FunctionIWantToMock</code> call, it just immediately steps to the next line and populates <code>so</code> with null. </p>
",0,556,2020-01-31 6:01,,2,2,other
9025112,Moq Verify Expression,<c#><moq>,"<p>Good Day,</p>

<p>I have a class that performs a registry lookup to determine where an application is installed (on a 64-bit machine).</p>

<p>I'm writing a unit test in an attempt to verify that and here's what I have:</p>

<pre><code>[Test, Explicit]
public void Validate64Bit()
{
    wsMock.Setup(x =&gt; x.IsInstalled).Returns(true);
    wsMock.Setup(x =&gt; x.Path).Returns(@""C:\Program Files (x86)\DIRP\"");

    IWorkstationLocator workstationLocator = new WorkstationLocator();
    string workstationInstallationPath = workstationLocator.Path;

    Assert.That(workstationInstallationPath != string.Empty, ""The install path should exist."");
    wsMock.Verify(x =&gt; x.Path == workstationInstallationPath, 
        ""64-bit Workstation Install Path should match:  "" + @""C:\Program Files (x86)\DIRP\"");
    }
</code></pre>

<p>But I'm getting an error:</p>

<p>System.ArgumentException :  Expression is not a method invocation:
    x => x.Path == .workstationInstallationPath</p>

<p>So my question is:  I want to test if x.Path == wrokstationInstallationPath.</p>

<p>How would I do this in a .Verify() method?</p>

<p>Or am I better off using an Assert?</p>

<p>TIA,</p>

<p>coson</p>
",1,1489,2012-01-26 20:48,,2,0,how
950104,Mocking HttpPostedFileBase with Rhino Mocks,<mocking><extension-methods><rhino-mocks>,"<p>I'm new to mocking so I need a bit of guidance on how to mock HttpPostedFileBase with Rhino Mocks. I am trying to verify that my ToByteArray() extension works as expected and this is what I have so far:</p>

<pre><code>[Test]
    public void Should_return_a_byte_array_with_a_length_of_eleven()
    {
        // Arrange
        var stream = new MemoryStream(System.Text.Encoding.Default.GetBytes(""TestContent""));
        var httpPostedFileBase = MockRepository.GenerateMock&lt;HttpPostedFileBase&gt;();

        httpPostedFileBase.Expect(x =&gt; x.InputStream).Return(stream);
        httpPostedFileBase.Expect(x =&gt; x.ContentLength).Return(11);

        // Act
        var byteArray = httpPostedFileBase.ToByteArray();

        // Assert
        Assert.That(byteArray.Length, Is.EqualTo(11));
    }
</code></pre>

<p>I can tell that the values get set but by the time my extensionmethod gets the HttpPostedFileBase it has lost all it's values. Any help would be much appreciated.</p>

<p>/ Kristoffer</p>
",1,2039,2009-06-04 12:04,,1,0,how
30531637,Python: Mock doesn't work inside celery task,<python><django><unit-testing><mocking><celery>,"<p>I want to use python <code>mock</code> library for testing that my Django application sends email.</p>

<p>Test code:</p>

<pre><code># tests.py
from django.test import TestCase

class MyTestCase(TestCase):

    @mock.patch('django.core.mail.mail_managers')
    def test_canceled_wo_claiming(self, mocked_mail_managers):
        client = Client()
        client.get('/')
        print(mocked_mail_managers.called)
        mocked_mail_managers.assert_called_with('Hi, managers!', 'Message Body')
</code></pre>

<p><strong>First example - without tasks</strong></p>

<pre><code># views.py
from django.views.generic import View
from django.core.mail import mail_managers

class MyView(View):

    def get(self, request):
        mail_managers('Hi, managers!', 'Message Body')
        return HttpResponse('Hello!')
</code></pre>

<p><strong>Second example - with tasks</strong></p>

<pre><code># views.py
from django.views.generic import View
from . import tasks

class MyView(View):
    def get(self, request):
        tasks.notify.apply_async()
        return HttpResponse('Hello!')


# tasks.py
from celery import shared_task
from django.core.mail import mail_managers

@shared_task
def notify():
    mail_managers('Hi, managers!', 'Message Body')
</code></pre>

<p>The first example works normal, second example fails, with <code>Not called</code> exception. </p>

<p>My settings:</p>

<pre><code># Celery
BROKEN_URL = 'memory://'
BROKER_BACKEND = 'memory'

CELERY_ALWAYS_EAGER = True
CELERY_EAGER_PROPAGATES_EXCEPTIONS = True
TEST_RUNNER = 'djcelery.contrib.test_runner.CeleryTestSuiteRunner'
</code></pre>

<p>Is it possible to perform such integrated test or the only way to solve this problem is split test into two?</p>
",4,3425,2015-05-29 14:02,,2,0,what
12459041,How to test method with nested for loops,<java><unit-testing><junit><mocking><mockito>,"<p>I am beginer in unit testing. 
I use JUnit and Mockito. This is one example method which I want to test. </p>

<pre><code>public List&lt;Person&gt; getPeopleList(List&lt;Aggregate&lt;Person&gt;&gt; aggregateList) {
    List&lt;Person&gt; resultList = new ArrayList&lt;Person&gt;();
    for (Aggregate&lt;Person&gt; aggregate : aggregateList) {
        resultList.add(aggregate);

        for (Person person : aggregate) {
            resultList.add(person);
        }
    }
    return resultList; // the result is person and aggregate list
}
</code></pre>

<p>I tried to many ways, but I can't do it well. Example:</p>

<pre><code>@Test
public void getPeopleListTest(){
    ClassUnderTest testedClass = new ClassUnderTest();

    Aggregate aggregate = mock(Aggregate.class);
    Iterator&lt;Aggregate&lt;Person&gt;&gt; aggregateIterator = mock(Iterator.class);
    when(aggregateIterator.hasNext()).thenReturn(true, false);
    when(aggregateIterator.next()).thenReturn(aggregate);

    List&lt;Aggregate&lt;Person&gt;&gt; aggregateList = mock(List.class);

    aggregateList.add(aggregate);

    List&lt;Person&gt; list = testedClass.getPeopleList(aggregateList);

    assertEquals(1, list.size());
}
</code></pre>

<p>Thank you in advance.</p>
",2,2438,2012-09-17 12:20,,2,0,how
31411700,phpunit mock method called in constructor,<constructor><mocking><phpunit>,"<p>I test a config class, which is parsing a config file and allows me to get the various settings for an app.</p>

<p>My goal is to mock the <code>parse()</code> method of the Config class, which is called in the constructor and to set what this method is returning in the constructor. </p>

<p>This way, it prevents <code>file_get_contents()</code> from being called (in the <code>parse()</code> method) and enables me to have a Config class with the <code>config</code> property already set to contain an array of properties. </p>

<p>But I haven't succeeded doing that.</p>

<p>Here is the code:</p>

<p>The config class:</p>

<pre><code>&lt;?php namespace Example;

use Symfony\Component\Yaml\Parser;

class Config
{

private $parser;
private $config;

public function __construct(Parser $parser, $filePath)
{
    $this-&gt;parser = $parser;
    $this-&gt;config = $this-&gt;parse($filePath);
}

public function parse($filePath)
{
    $fileAsString = file_get_contents($filePath);

    if (false === $fileAsString) {
        throw new \Exception('Cannot get config file.');
    }

    return $this-&gt;parser-&gt;parse($fileAsString);
}

public function get($path = null)
{
    if ($path) {
        $config = $this-&gt;config;

        $path = explode('/', $path);

        foreach ($path as $bit) {
            if (isset($config[$bit])) {
                $config = $config[$bit];
            }
        }

        return $config;

    }

    return false;
    }

}
</code></pre>

<p>The test:</p>

<pre><code>&lt;?php namespace Example;

class ConfigTest extends \PHPUnit_Framework_TestCase
{

    private function getConfigTestMock($configAsArray)
    {
        $parser = $this-&gt;getMockBuilder('\Symfony\Component\Yaml\Parser')
            -&gt;getMock();

        $configMock = $this-&gt;getMockBuilder('Example\Config')
            -&gt;setConstructorArgs([$parser, $configAsArray])
            -&gt;setMethods(['parse', 'get'])
            -&gt;getMock();

        $configMock-&gt;expects($this-&gt;once())
            -&gt;method('parse')
            -&gt;willReturn($configAsArray);

        return $configMock;
    }

    /**
     * @test
     */
    public function get_returns_false_if_no_path_given()
    {
        $configMock = $this-&gt;getConfigTestMock(['param1' =&gt; 'value1']);

        // Testing further...

    }
}
</code></pre>
",2,1443,2015-07-14 16:00,,2,0,other
34816578,How to detect API modifications when mocking e2e tests?,<angularjs><unit-testing><mocking><protractor><e2e-testing>,"<p>I'd like to setup a solid e2e testing foundation on our team's project but I can't find a simple solution to that question :</p>

<p><strong>When you are mocking all of your calls, what is the best way to detect if the actual model of the objects returned by your server has been modified ?</strong></p>

<p>Your tests would still pass because they're testing an outdated version of the model but the app is potentially broken.</p>

<p>For example, if a mock assumes that <code>/api/users/1</code> returns <code>null</code> if the user doesn't exist, when it actually returns an empty object, then although the tests may pass, the behaviour being tested relies on incorrect assumptions and may therefore fail in unexpected ways.</p>

<p>Or maybe the backend is somehow providing static json files with the latest up-to-date model and the frontend relies on this ?</p>

<p>This of course supposes that the people working on the backend and the people working on the frontend are separate teams.</p>

<p>I am using Angular 1.x and Protractor here but this doesn't really depend on the technology.</p>
",17,1500,2016-01-15 17:27,,3,0,how
34620071,Mock entire es6 class except constructor in Jest?,<javascript><mocking><jestjs><ecmascript-6>,"<p>If I have a class A, like this:</p>

<pre><code>class A{
    constructor(foo){
        this.foo = foo;
    }

    doStuff(){
        //Code protected by an NDA, they'll nuke my house if I tell you what it does.
    }

    nukeHouse(){
        //The implementation of this is somewhat buggy...
    }
}
</code></pre>

<p>I'd like users of the class A to have access to <code>this.foo</code>, so I don't want to mock the constructor. All other methods should be mocked. I can probably manually say <code>A.prototype.doStuff = jest.genMockFunction()ù, and do the same for</code>A.prototype.nukeHouse`, but I'm hoping there's a way to do this, without having to update the mocking code every time I add a method to A.</p>

<p>Is there a way to do this?</p>
",1,1161,2016-01-05 19:49,,1,0,what
73898124,How to mock an attribute of a class with @patch?,<python><mocking><patch>,"<p>I have the following class with one attribute:</p>
<pre><code>class Eobi(): 
    def __init__(self, partitions): 
        self.partitions = partitions 
</code></pre>
<p>Then I have the following test function, where I am trying to mock the attribute <code>partitions</code> of the class <code>Eobi</code>. And I have it to return 100.</p>
<pre><code>@mock.patch('exchanges.protocols.eobi.parser.EobiExchange.partitions', return_value = 100)
def test_check_for_sequence_reset(mock_EobiExchange, xwbo_exchange, test, result):

    .....
</code></pre>
<p>The above results in some errors with regards to the patching- I have a feeling I haven't mocked the attribute correctly. Any suggestions?</p>
<p>The error is quite complex, so unless it is needed I will leave it out.</p>
<p>Here is my production code:</p>
<pre><code>def check_for_sequence_reset(self, packet, pkthdr, partition):

        channel = self.partitions[pkthdr.partitionid].channels[packet.header.dst_ip]

        # potential sequence reset detected
        if channel.next_seqno != 0:
            if channel.next_seqno &gt; pkthdr.applseqnum:
                if pkthdr.applseqresetindicator:
                    # Reset. No alert, this is legitimate behaviour.
                    if not partition.in_reset:
                        partition.in_reset = True
                        return True
                else:
                    partition.in_reset = False
                return False
</code></pre>
<p>I want <code>channel</code> to take the value of 100.</p>
",0,24,2022-09-29 15:30,,0,2,how
15071199,Android Mock location don't work with google maps,<android><mocking><maps><location>,"<p>I created an Android application that mock the gps location, its works great with most of the programs like igo, waze, osmAnd, GPS status and more, but not with google maps that still show the actual position I'm on.</p>

<p>I disabled the gps and network location as well.</p>

<p>Any ideas why is it? how to solve it? Thanks </p>

<p>The code I use:</p>

<pre><code>public void setLocation(double latitude, double longitude, double altitude, float bearing, float speed){
    String PROVIDER_NAME = LocationManager.GPS_PROVIDER;
    locationManager.addTestProvider(PROVIDER_NAME, false, false, false, false, true, true, true, Criteria.POWER_LOW, Criteria.ACCURACY_FINE);

    locationManager.setTestProviderEnabled(PROVIDER_NAME, true);
    locationManager.setTestProviderStatus(PROVIDER_NAME, LocationProvider.AVAILABLE, null, System.currentTimeMillis());

    Location location = new Location(PROVIDER_NAME);
    location.setLatitude(latitude);
    location.setLongitude(longitude);
    location.setAltitude(altitude);
    location.setBearing(bearing);
    location.setSpeed(speed);   
    location.setTime(System.currentTimeMillis());
    locationManager.setTestProviderLocation(PROVIDER_NAME, location.getLocation());
}
</code></pre>
",3,9106,2013-02-25 16:08,,2,3,how
45887611,How to mock another class method call from the method being tested using powermock-easymock?,<java><unit-testing><junit><powermock><easymock>,"<p>I'm using easymock and powermock to write unit test case for the below  isRegisteredUSer() of Class B. How to mock getUserInformation() of Class A and return a mocked UserAccessBean?</p>

<pre><code>class A{
    private int userId;
    A(int userId){
       this.userId = userId;
    }
    public UserAccessBean getUserInformation(){
       UserAccessBean userAB = new USerAccessBean().findByUserId(userId);
       return userAB;
    }
}


Class B{
    public static boolean isRegisteredUSer(int userId){
    A a = new A(userId);
    UserAccessBean userAB  = a.getUserInformation();
    if(userAB.getUserType().equals(""R"")){
       return true;
     }
     return false;
}


JUnit

    public class BTest extends EasyMockSupport{
    UserAccessBean userAB = null;
    A a = null;
    int userId = 12345;
    @Before
    public void setUp() throws Exception {
        userAB = new UserAccessBean();
    }

        @Test
    public void when_UserDesctiptionIsR_Expect_True_FromIsRegisteredUser() throws Exception{
        //data setup
        userAB.setDescription(""R"");
        A a = new A(12345);

        EasyMock.expect(a.isRegisteredUser()).andReturn(userAB);
        PowerMock.replayAll();

        Boolean flag  = B.isRegisteredUser(userId);
        assertEquals(flag, true);
        PowerMock.verifyAll();  

    }
  }
</code></pre>

<p>Even If I use EasyMock.expect() to mock getUserInformation() method call, my console is going inside getUserInformation() when I run my JUnit. </p>

<p>Can someone please help me to mock another class functions method (Class A's getUserInformation)  call from the method (Class B's isRegisteredUSer) being tested?</p>
",0,800,2017-08-25 18:36,,1,1,how
24418778,Mockito - InvalidUseOfMatchersException,<java><service><mocking><mockito>,"<p>I have been trying to debug this piece of code for a while now but still no luck. I continues to throw ""InvalidUseOfMatchersException"" specifically for this code:</p>

<p>For the set up:</p>

<pre><code>        service = mock(Service.class);
        newRequest = mock(Request.class);
        when(service.newRequest(anyString(), anyString(), anyString())).thenReturn(
            newRequest);
</code></pre>

<p>And in the class that service is used in:</p>

<pre><code> Request newRequest = Service.newRequest(
            mId, ""mp"", itemID);
</code></pre>

<p>I am assuming that it fails because I pass in 3 ""anyString()"" in the when...thenReturn clause but it could possibly be that it is failing on the hardcoded ""mp"". So I tried to replace the when clause with this: </p>

<pre><code>when(service.newRequest(anyString(), eq(""mp""), anyString())).thenReturn(
            newRequest);
</code></pre>

<p>But still receive the InvalidUseOfMatchersException.</p>

<p>Am I missing something about how mockito is supposed to work for this?</p>

<p>full stack:</p>

<pre><code>    org.mockito.exceptions.misusing.InvalidUseOfMatchersException: 
Invalid use of argument matchers!
3 matchers expected, 2 recorded.
This exception may occur if matchers are combined with raw values:
    //incorrect:
    someMethod(anyObject(), ""raw String"");
When using matchers, all arguments have to be provided by matchers.
For example:
    //correct:
    someMethod(anyObject(), eq(""String by matcher""));

For more info see javadoc for Matchers class.
    at ServiceFacade.getSimilarities(ServiceFacade.java:29)
    at FacadeTest.getSimilarities(FacadeTest.java:60)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at sun.reflect.DelegatingMethodImpl.invoke(DelegatingMethodImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:606)
</code></pre>
",2,6689,2014-06-25 21:20,,1,5,what
